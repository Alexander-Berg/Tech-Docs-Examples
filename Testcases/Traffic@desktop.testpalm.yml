feature: Колдунщик пробок
counter: /$page/$main/$result[@wizard_name="traffic"]/title

specs-integration:
  Проверяем показ колдунщика:
    - do: получить выдачу по запросу 'пробки в москве'
    - assert: |
        колдунщик пробок присутствует на странице,
        в колдунщике присутствует карта,
        на карте присутствует кнопка 'На большую карту'
    - counter: /$page/$main/$result[@wizard_name="traffic"]/point

specs:
  Для любого города:
    Проверка внешнего вида для длинного названия города:
      - params:
          foreverdata: '1533230636'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: длинный заголовок обрезан многоточием
      - screenshot: внешний вид [long-title]

  Для города без баллов:
    Общие проверки:
      - do: получить выдачу по запросу 'пробки в туапсе'
      - assert: колдунщик пробок присутствует на странице
      - screenshot: внешний вид [plain]

  Для города c 0 баллов:
    - params:
        foreverdata: '1997556160'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: колдунщик пробок присутствует на странице
    - screenshot: внешний вид [plain]

  Для города с баллами:
    beforeEach:
      - do: получить выдачу по запросу 'пробки в москве'
      - assert: колдунщик пробок присутствует на странице
      - screenshot: внешний вид [main-view-{{PLATFORM}} >> plain]

    Проверка внешнего вида:
      - label: main-view-{{PLATFORM}}
      - screenshot: внешний вид [plain]
      - assert: |
          в шапке колдунщика есть светофор с баллами,
          в шапке колдунщика есть время с описанием дорожной обстановки

    Проверка ссылок:
      - tags: [title, greenurl, maps]
      - do: кликнуть по ссылке в заголовка колдунщика
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/title'
      - assert: открылась страница сервиса Яндекс.Карты с отображёнными на ней пробками
      - do: кликнуть по ссылке с количеством баллов возле иконки светофора
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/point'
      - assert: открылась страница сервиса Яндекс.Карты с отображёнными на ней пробками
      - do: кликнуть по кнопке 'На большую карту'
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/map/goto-map'
      - assert: открылась страница сервиса Яндекс.Карты с отображёнными на ней пробками
      - assertMetrics: '*'

    Проверка контролов на карте:
      - tags: [maps, zoom, location]
      - do: кликнуть по контролу с плюсом на карте колдунщика
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/map/round-button'
      - assert: масштаб карты увеличился
      - do: кликнуть по контролу с минусом на карте колдунщика
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/map/round-button'
      - assert: масштаб карты уменьшился
      - do: кликнуть по контролу с геолокацией на карте колдунщика
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/map/round-button'
      - assert: |
          карта перерисовалась на текущее местоположение,
          слой пробок отображается
      - assertMetrics: '*'

files:
  - src/features/Traffic/Traffic.test/Traffic@desktop.hermione.js
  - src/features/Traffic/Traffic.test/Traffic@desktop.hermione.e2e.js

v-team: VanillaGeo

tags: [reviewed, hasE2E]

tlds: all
