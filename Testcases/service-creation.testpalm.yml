feature: Создание сервиса

specs:
  beforeEach:
    - do: (PREPARE) запустить в Runner сценарий "api/v4/services/ POST - создание сервисов" (https://github.yandex-team.ru/pixel/abc-runner)

  Создание сервиса с родителем:
    - do: отправить запрос "Создание сервиса с родителем" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201"
    - screenshot: ответ на запрос должен содержать поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2012-29-52.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Создание сервиса без родителя:  
    - do: отправить запрос "Создание сервиса без родителя" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201"
    - screenshot: ответ на запрос должен содержать поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2012-29-52.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Пользователь с ограниченной ролью не может создавать сервисы:
    - do: отправить запрос "Ограниченная роль" с токеном "robot-cat-matroskin"
    - assert: пришёл ответ со статусом "403" и телом "Your permissions are not enough"
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS" 

  Пользователь с сильно ограниченной ролью не может создавать сервисы:
    - do: отправить запрос "Сильно ограниченная роль" с токеном "robot-cat-bayun"
    - assert: пришёл ответ со статусом "403" и телом "Your permissions are not enough"
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS" 

  Нельзя создавать сервис под базовый нелистовой:  
    - do: отправить запрос "Нельзя создавать сервис под базовый, нелистовой" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "403"
    - screenshot: ответ на запрос должен содержать поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2012-36-01.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

priority: blocker

files:
  - tests/unit/services/api/test_services.py
  - tests/unit/services/views/test_catalog.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:abc:src/blocks/desktop/abc-new/**
  - fitcher:abc:src/blocks/desktop/m-head/**
  - fitcher:abc:src/features/ServiceCreation/**
  - fitcher:plan:tests/unit/services/api/test_services.py
  - fitcher:plan:tests/unit/services/views/test_catalog.py

