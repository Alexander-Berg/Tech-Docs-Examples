feature: Объектный ответ
type: Выбор кинотеатра

priority: normal
tlds: ru
description: Кейсы только для прохождения на России, вне России функциональность пока не работает!!! Если вы находитесь не в России и не видите функциональность с заглушкой Смотреть / Купить, а видите например заглушки Плюса или заглушки Покупки/Аренды, то скипните эти кейсы.

aliases:
  - &CheckContentKP
    - do: получить выдачу по запросу "джентльмены" (иччи фильм, море соблазна, вторжение фильм)
    - assert: в правой колонке видна заглушка с кнопкой "Смотреть"/"Купить"
  - &CheckContentSoapKP
    - do: получить выдачу по запросу "твин пикс" (пишеблок, топи, рик и морти, время приключений)
    - assert: в правой колонке видна заглушка с кнопкой "Смотреть"/"Купить"
  - &CheckContentMoreTv
    - do: получить выдачу по запросу "псих" (чики, регби сериал, хэппи энд, нави рождённые побеждать фильм)
    - assert: в правой колонке видна заглушка с кнопкой "Смотреть"/"Купить"
  - &CheckContentAmediateka
    - do: получить выдачу по запросу "игра престолов" (почему женщины убивают, мир дикого запада, чужак, добровольцы)
    - assert: в правой колонке видна заглушка с кнопкой "Смотреть"/"Купить"

specs:
  Внешний вид заглушки и попапа:
    - priority: high
    - label: cinema-choice
    - do: получить выдачу по запросу 'бойцовский клуб' (альтернативные запросы 'джентльмены', 'друзья', 'рик и морти')
    - assert: в правой колонке видна заглушка с кнопкой "Cмотреть"/"Купить"
    - screenshot: примерный внешний вид заглушки [stub]
    - do: кликнуть в заглушку
    - assert: отобразился попап с выбором кинотеатров
    - screenshot: примерный внешний вид попапа [popup]
    - do: навести на любую строчку с кинотеатром
    - assert: строка подсветилась
    - screenshot: внешний вид попапа с ховером на строке [popup-hover]
    - do: проскроллить попап в самый низ до появления футера
    - screenshot: внешний вид [popup-scrolled]

  Внешний вид попапа с диффом в сезонах и анонсами:
    - params:
        foreverdata: '3318151351'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в правой колонке видна заглушка с кнопкой "Cмотреть"/"Купить"
    - do: кликнуть в заглушку
    - assert: отобразился попап с выбором кинотеатров
    - screenshot: примерный внешний вид попапа [popup]
    - do: немного проскроллить попап до появления предложения с разницей в сезонах
    - screenshot: примерный внешний вид попапа [popup-scrolled-to-seasons]
    - do: проскроллить попап в самый низ до появления футера
    - screenshot: внешний вид [popup-scrolled-to-footer]

  Переход по ссылке "Условия подключения для партнёров":
    - do: получить выдачу по запросу "один дома"
    - assert: в правой колонке отобразился ОО с фильмом
    - screenshot: внешний вид заглушки [cinema-choice >> stub]
    - do: нажать на кнопку в заглушке ОО
    - assert: появился попап с вариантами просмотра
    - do: в попапе нажать на ссылку Условия подключения для партнеров
    - assert: произошел переход на страницу условия подключения для партнера

  Отображение кнопки "Смотреть" в заглушке и попапе для разных типов подписок и контента:
    Без подписки, контент EST:
      beforeEach:
        - do: авторизоваться пользователем с купленным фильмом (test-serp-assessors-plus / hL5-tYe-VGX-fzg)
        - assert: пользователь авторизован
      Купленный фильм:
        - do: получить выдачу по запросу "Зверопой" (альтернативные запросы "Семейка Крудс", "Мадагаскар 1") # 3651955251
        - assert: в правой колонке отобразился ОО с фильмом
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Некупленный фильм:
        - do: получить выдачу по запросу "шрек 2004" # 2278058256
        - assert: в правой колонке отобразился ОО с фильмом
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившейся шторке отображается название кинотеатра

    Без подписки, контент TVOD:
      beforeEach:
        - do: авторизоваться пользователем с арендованным фильмом (test-serp-assessors-plus / hL5-tYe-VGX-fzg)
        - assert: пользователь авторизован
      Купленный фильм:
        - tags: no_assessors #сейчас ничего не арендовано
        - do: получить выдачу по запросу "бэтмен навсегда" # 3424170864
        - assert: в правой колонке отобразился ОО с фильмом
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Некупленный фильм:
        - do: получить выдачу по запросу "один дома 2" (аватар 2009) # 3151722067
        - assert: в правой колонке отобразился ОО с фильмом
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра отображается цены аренды

    Подписка Плюс (YA_PLUS), SVOD контент:
      beforeEach:
        - do: авторизоваться пользователем с подпиской (test-serp-assessors-plus/hL5-tYe-VGX-fzg), не сохраняя пароль
        - assert: пользователь авторизован
      Кинопоиск фильм:
        - *CheckContentKP # 2008554663
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Кинопоиск сериал:
        - *CheckContentSoapKP # 1878607782
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Moretv:
        - *CheckContentMoreTv # 4264413299
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившейся шторке отображается название кинотеатра
      Amediateka:
        - *CheckContentAmediateka # 2071379147
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке отображается название кинотеатра

    Подписка Кинопоиск + more.tv (YA_PLUS_SUPER), SVOD контент:
      beforeEach:
        - do: авторизоваться пользователем с подпиской (test-serp-assessors-more/kAd-XRd-dkH-4Wp), не сохраняя пароль
        - assert: пользователь авторизован
      Кинопоиск фильм:
        - *CheckContentKP # 2499687092
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Кинопоиск сериал:
        - *CheckContentSoapKP # 3957356613
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Moretv:
        - *CheckContentMoreTv # 1248584537
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Amediateka:
        - *CheckContentAmediateka # 1680151915
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившейся шторке отображается название кинотеатра

    Подписка Кинопоиск + Амедиатека (YA_PREMIUM), SVOD контент:
      beforeEach:
        - do: авторизоваться пользователем с подпиской (test-serp-assessors-amedia/XPw-QXu-bcH-3XW), не сохраняя пароль
        - assert: пользователь авторизован
      Кинопоиск фильм:
        - *CheckContentKP # 418287501
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск  отображается кнопка "Смотреть"
      Кинопоиск сериал:
        - *CheckContentSoapKP # 1599602001
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Moretv:
        - *CheckContentMoreTv # 1637400114
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"
      Amediateka:
        - *CheckContentAmediateka # 3013872723
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившемся попапе рядом с названием кинотеатра Кинопоиск отображается кнопка "Смотреть"

    Без подписки SVOD контент:
      beforeEach:
        - do: авторизоваться пользователем без подписки (oo-film / o0film20), не сохраняя пароль
        - assert: пользователь авторизован
      Кинопоиск фильм:
        - *CheckContentKP # 1935403
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившейся шторке отображается название кинотеатра
      Кинопоиск сериал:
        - *CheckContentSoapKP # 1199289960
        - screenshot: внешний вид заглушки [cinema-choice >> stub]
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившейся шторке отображается название кинотеатра
      Moretv:
        - *CheckContentMoreTv # 9449927
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившейся шторке отображается название кинотеатра
      Amediateka:
        - *CheckContentAmediateka # 534276340
        - do: нажать на кнопку в заглушке ОО
        - assert: в появившейся шторке отображается название кинотеатра

  Навигация:
    Обновление страницы [manual]:
      - tags:
        - skip_manual_check
      - priority: minor
      - automation: SERP-140074
      - tags: [navigation]
      - do: получить выдачу по запросу "рик и морти"
      - assert: в правой колонке отобразился ОО с сериалом
      - screenshot: внешний вид заглушки [cinema-choice >> stub]
      - do: обновить страницу и до окончания загрузки нажать на превью сериала
      - assert: отрылся попап с вариантами просмотра

  Просмотр:
    Фильма доступного по подписке:
      - do: авторизоваться в Яндексе пользователем с подпиской Плюс
      - do: перейти по запросу "Джентльмены"
      - assert: в правой колонке отобразилась карточка фильма
      - do: кликнуть в обложку фильма и в выпадающем меню выбрать пункт с просмотром на Кинопоиске
      - assert: |
          попап со списком кинотеатров закрылся
          началось проигрывание фильма, обложка фильма скрыта
          не произошёл переход на Кинопоиск

    Фильма, который недоступен на поиске для просмотра:
      - do: авторизоваться в Яндексе пользователем с подпиской Плюс Амедиатека
      - do: перейти по запросу "Миллиарды"
      - assert: в правой колонке отобразилась карточка фильма
      - do: кликнуть в обложку фильма и в выпадающем меню выбрать пункт с просмотром на Кинопоиске
      - assert: |
          попап со списком кинотеатров закрылся
          проигрывание фильма не началось, отображается обложка фильма
          произошёл переход на Кинопоиск

  Попап скрывается под шапкой при скролле:
    - priority: minor
    - do: получить выдачу по запросу "один дома 2" (аватар 2009)
    - assert: в правой колонке отобразился ОО с фильмом
    - screenshot: внешний вид заглушки [cinema-choice >> stub]
    - do: нажать на кнопку в заглушке ОО
    - assert: отобразился попап с выбором кинотеатров
    - do: проскроллить выдачу вниз до конца
    - assert: при скролле попап скрывается под шапкой

specs-integration:
  Ранжирование внутри попапа [manual]:
    - automation: SERP-140074
    - tags: skip_manual_check #непонятно как сэмулировать наличие подписки
    - do: авторизоваться пользователем с подпиской
    - assert: пользователь авторизован
    - do: получить выдачу по запросу "один дома 1"
    - assert: в правой колонке отобразился ОО с фильмом
    - do: нажать на кнопку "Смотреть" в заглушке ОО
    - assert: открылся попап, где Кинопоиск вынесен вверх списка с кнопкой Смотреть

files:
  - features/desktop/z-entity-search/film-card/cinema-choice.hermione.js

v-team: Video

tags:
  - skip_e2e_check
