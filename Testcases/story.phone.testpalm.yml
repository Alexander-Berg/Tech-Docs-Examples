feature: Cюжет Яндекс.Новостей

description: Сюжет - это основная сущность сервиса, которая обладает несколькими блоками. Блоки заголовка, аннотации и медиаблок позволяют пользователю ознакомиться с кратким содержанием сюжета, блок Подробнее о событии предоставляют пользователю выбор лицензированного информационного агентства для полного ознакомления с сюжетом. Траурный сюжет - сюжет об убийстве, смерти, тяжелых травмах, захвате заложников, теракте.

specs-integration:
  архивный подгружает ленту новостей:
    - do: разлогиниться и открыть архивный сюжет в браузере (например, https://yandex.ru/news/story/a--a84a4edbf9cae6a9cd7ea71b63883423)
    - do: проскроллить сюжет ниже блока "Подробнее о событии"
    - assert: |
        под архивным сюжетом есть рекламный блок,
        под рекламным блоком есть заголовок "Интересное",
        ниже подгружается следующий сюжет (неархивный)

  должен открываться:
      - do: перейти по ссылке https://yandex.ru/news/rubric/politics
      - assert: страница открылась
      - do: тапнуть по первой карточке в рубрике
      - assert: открылась страница сюжета
      - do: поскроллить вниз до следующего сюжета
      - assert: подгружается новый сюжет

  архивный должен открываться:
      - do: перейти по ссылке https://yandex.ru/news/story/a--a84a4edbf9cae6a9cd7ea71b63883423
      - assert: открылась страница архивного сюжета
      - do: поскроллить вниз до следующего сюжета
      - assert: подгружается новый сюжет

  архивный битый урл не должен пятисотить:
      - do: перейти по ссылке https://yandex.ru/news/story/a--1
      - assert: открылась страница с "Не удалось отобразить сюжет"

  архивный из поиска не должен пятисотить:
      - do: перейти по ссылке https://yandex.ru/news/yandsearch?cl4url=www.interfax.ru/sport/419977&lang=ru&lr=10747
      - assert: открылась страница с "Не удалось отобразить сюжет"

  архивный траурный не должен пятисотить:
      - do: перейти по ссылке https://yandex.ru/news/story/V_Karelii_nakanune_Dnya_vlyublennykh_muzhchina_napal_s_nozhom_na_druga_zastav_ego_u_sebya_doma--759e143203cc60ccb0bdcb0b865f9a26?from=region&lang=ru&lr=18
      - assert: открылась страница с сюжетом

  должен открываться под кукой адблока:
      - do: перейти по ссылке https://yandex.ru/news
      - assert: открылась страница рубрикаи Главное
      - do: установить куку bltsr=1
      - do: тапнуть по первой карточке в рубрике
      - assert: открылась страница сюжета
      - do: поскроллить вниз до следующего сюжета
      - assert: подгружается новый сюжет

  только с аннотацией и точкой в ссыли открывается без пятисоток:
      - do: перейти на https://yandex.ru/news/story/Loki._Nachalo--95e8347dfff99f7c478f79aceaff3d00?lang=ru&t=1577177299&persistent_id=82973291
      - assert: произошел переход без ошибок

  только с аннотацией без медия открывается без пятисоток:
      - do: перейти на https://yandex.ru/news/story/Sevastopol_mogut_perevesti_na_pochasovuyu_podachu_vody--477f51f6e403c15e260efc3313256660?persistent_id=81518858
      - assert: произошел переход без ошибок

  отображает соответствующее заголовку название таба в браузере:
    - do: открыть любой сюжет на сервисе
    - assert: |
        произошел переход на сюжет,
        заголовок сюжета соответствует названию таба браузера,
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/photo_2019-10-28_10-55-33%20%282%29.jpg
    - do: поскроллить вниз до следующего сюжета (чтоб предыдущий сюжет скрылся за границей экрана)
    - assert: |
        отображается следующий сюжет,
        название таба браузера соответствует заголовку отображенного в данный момент на экране сюжета

  несуществующий не должен пятисотить:
      - do: перейти по ссылке https://yandex.ru/news/story/aaaa-1
      - assert: открылась страница с "Не удалось отобразить сюжет"

  404 не должен пятисотить:
      - do: перейти по ссылке https://yandex.ru/news/404
      - assert: открылась страница с "Не удалось отобразить сюжет"

specs:
  должен содержать ссылки на источник:
    - tags:
        - smoke
        - backend_news
    - do: открыть НЕ спортивный сюжет из топа новостей на Главной
    - assert: |
        открывается страница выбранного сюжета,
        над заголовком отображается название источника,
    - do: тапнуть по названию источника над заголовком
    - assert: |
        в новой вкладке открывается страница с новостью от источника,
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile
    - do: вернуться на страницу сюжета Яндекс.Новости
    - do: тапнуть по любому источнику из блока суммаризации (текст между оглавлением и медиаблоком). скрин - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-03_18-08-12.png
    - assert: |
        в новой вкладке открывается страница с той же новостью от источника,
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile

  должен содержать блок "Подробнее о событии":
    - tags:
        - smoke
        - backend_news
    - do: открыть сюжет, который содержит большое количество источников
    - assert: |
        в сюжете под медиаблоком присутствует блок 'Подробнее о событии',
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-09-21_16-56-28%20%282%29.png
    - do: проскроллить карусель источников в блоке "Подробнее о событии"
    - assert: |
        карусель состоит из карточек источников, в каждой есть лого и название источника и заголовок,
        карусель скроллится,
        всего не более 9 источников
    - do: тапнуть по первому источнику
    - assert: |
        в новой вкладке открывается турбо-источник с новостью от источника,
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile
    - do: вернуться на страницу сюжета Яндекс.Новости
    - do: тапнуть по любому источнику из последнего в карусели
    - assert: |
        в новой вкладке открывается страница с новостью от источника,
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile

  позволяет пользователю авторизоваться с помощью избранного [manual]:
    - tags:
        - backend_news
    - do: зайти на сервис без залогина
    - do: перейти в любой сюжет
    - do: доскроллить до 'Подробнее о событии' и кликнуть на иконку настройки источников справа от наименования блока - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-30_18-05-23.png
    - assert: |
        отображается кнопка 'Войти', на фоне кнопки отбражается некликабельный список источников,
        внешний вид - https://jing.yandex-team.ru/files/an-smirn0v/shot_210412_190945.png
    - do: нажать на кнопку 'Войти'
    - assert: открылась страница с предложением авторизации
    - do: авторизоваться на сервисе
    - assert: произошел возврат к сюжету, открыто окно 'Настройка источников', кнопки у источников для добавления в избранные и нежелательные становяться каликабельными

  позволяет авторизованному пользователю добавить источник в избранное и удалить его на нацдоменах [manual]:
    - tags:
#      - ua_suite
      - by_suite
      - backend_news
    - tlds:
#      - ua
      - by
    - reasonNotToAuto:
      - Нет возможности автоматизировать проверку на нацдомене, т.к. команда yaGoTld не сохраняет дамп
    - automation:
      - NERPA-12077
    - do: перейти на страницу https://yandex.by/tune/geo и выставить город "Минск"
    - do: перейти на тестовый стенд
    - do: открыть главную страницу Яндекс Новостей на домене by в неавторизованном состоянии
    - do: перейти в любой сюжет
    - do: доскроллить до 'Подробнее о событии' и кликнуть на кнопку 'Троеточие'
    - do: выбрать 'Настроить источники'
    - assert: |
        отображается кнопка 'Войти', на фоне кнопки отбражается некликабельный список источников
    - do: нажать на кнопку 'Войти'
    - assert: появился попап с предложением авторизации
    - do: авторизоваться на сервисе
    - assert: произошел возврат к сюжету, открыто окно 'Настройка источников', кнопки у источников для добавления в избранные и нежелательные становяться каликабельными

  должен содержать ссылку на все источники по сюжету:
    - tags:
        - backend_news
    - do: открыть сюжет, который содержит большое количество источников
    - assert: в сюжете под медиаблоком присутствует блок 'Подробнее о событии' с источниками по сюжету
    - do: тапнуть по заголовку 'Подробнее о событии'
    - assert: в той же вкладке осуществляется переход на страницу со всеми источниками по сюжету

  должен содержать персональную ленту новостей [manual]:
    - reasonNotToAuto:
      - Необходима ручная проверка персонализации
    - automation:
      - NERPA-11632
    - tags:
        - personal_feed
        - smoke
        - backend_news
    - do:
          залогиниться на сервисе под пользователем Александр Овечкин (логин и пароль взять со страницы-инструкции на вики - https://wiki.yandex-team.ru/eva/testing/projects/nerpa/#loginyiparolidljatestovyxpolzovatelejj)
          если возникла проблема с авторизацией - залогиниться под любым другим пользователем из таблицы - Ольга Бузова или Стив Джобс
    - do: открыть любой сюжет
    - do: проскроллить ленту новостей ниже первого сюжета
    - assert:
          если вы залогинены под пользователем Александр Овечкин - в ленте присутствует большое количество спортивных сюжетов (могут встречаться сюжеты и другой тематики)
          если вы залогинены под пользователем Ольга Бузова - в ленте присутствует большое количество сюжетов про шоу-бизнес (могут встречаться сюжеты и другой тематики)
          если вы залогинены под пользователем Стив Джобс - в ленте присутствует большое количество сюжетов про технологии (могут встречаться сюжеты и другой тематики)
    - do: ОБЯЗАТЕЛЬНО выйти из тестового аккаунта

  может содержать:
    медиаблок с видео, который:
      имеет внешний вид [manual]:
        - tags:
            - smoke
        - browsers:
            notFor:
              - ios-safari-9-touch
              - android-browser-5.1-touch
        - do: открыть выдачу сервиса на странице рубрики 'Главное'
        - do: перейти в НЕтраурный и НЕспортивный сюжет с видео тапом по заголовку в новостной карточке
        - assert: |
            сюжет содержит медиаблок с видео (если в сюжете нет медиаблока с видео, открыть другой сюжет),
            под основным видео может быть карусель превью видео (если карусели с превью нет, открыть другой сюжет),
            карусель превью скроллится по горизонтали,
            каждое превью видео содержит иконку плей и название источника видео,
            если иконки плей нет, значит - это превью фото, это ок,
            по умолчанию активен медиаблок с видео, видео не воспроизводится автоматически,
            в левом нижнем углу отображается название источника видео,
            внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-01_12-57-37.png
        - do: перевернуть устройство в ландшафтную ориентацию
        - assert: медиаблок с видео отображается корректно, карусель скроллится по горизонтали
        - do: вернуть устройство обратно в портретную ориентацию
        - do: поскроллить ленту сюжетов, найти сюжет с одним видео в медиаблоке
        - assert: |
            видео не воспроизводится автоматически,
            под основным видео отсуствует карусель с превью,
            в левом нижнем углу отображается название источника видео,
            внешний вид -https://jing.yandex-team.ru/files/kossakovskaya/2021-07-01_12-57-52.png
        - do: перейти по ссылке в архивный сюжет https://yandex.ru/news/story/V_Karelii_nakanune_Dnya_vlyublennykh_muzhchina_napal_s_nozhom_na_druga_zastav_ego_u_sebya_doma--759e143203cc60ccb0bdcb0b865f9a26?from=region&lang=ru&lr=18&rubric=Petrozavodsk
        - do: поскроллить ленту сюжетов, поискать сюжеты с видео
        - assert: сюжеты с видео отображаются в формате медиаблока согласно описанию из шагов выше

      позволяет скроллить настройки видео [manual]:
        - browsers:
            notFor:
                - ios-safari-9-touch
                - ios-safari-10-touch
                - ios-safari-11-touch
        - tags:
            - smoke
            - backend_news
        - do: перейти в нетраурный сюжет с видео тапом по заголовку в новостной карточке
        - do: запустить видео и тапнуть по кнопке шестеренки в видеоблоке (если шестеренки нет, то сначала тапните по иконке включения звука и затем по кнопке шестеренки)
        - assert: отобразился поп-ап с настройками качества, скорости, и возможностью сообщить о проблеме, внешний вид - https://jing.yandex-team.ru/files/volkhonov/touch-video-settings.png
        - assert: (настройки качества отсутствуют на Ios)
        - do: тапнуть в поп-апе по настройке "Скорость"
        - assert: открылся поп-ап со списком скоростей воспроизведения видео
        - do: поскроллить список вниз и вверх
        - assert: список в поп-апе скроллится, при этом остальная страница остается неподвижной

      позволяет перейти в просмотрщик и выйти из него [manual]:
        - tags:
            - smoke
            - backend_news
        - browsers:
            notFor:
              - ios-safari-9-touch
              - ios-safari-10-touch
              - ios-safari-11-touch
              - android-browser-5.1-touch
        - do: открыть выдачу сервиса на странице рубрики 'Главное'
        - do: перейти в любой нетраурный сюжет тапом по заголовку в новостной карточке
        - assert: |
            сюжет содержит карусель с видео (если в сюжете нет медиаблока с видео, открыть другой сюжет),
            видео не воспроизводится автоматически,
            первью видео содержат кнопку "плей" по центру краточки, если кнопки "плей" нет - это фото, откройте другой сюжет,
            внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-29_19-24-28.png
        - do: тапнуть на первое видео
        - assert: |
            раскрывается окно просмотрщика с крестиком в правом верхнем углу,
            видео, которое было выбрано в сюжете, проигрывается сначала, без звука,
            в шапке просмотрщика над видео отображается заголовок сюжета и название источника сюжета,
            на самом видео в верхнем правом углу отображается источник видео (на android может перекрываться кнопкой включения звука),
            под каждым видео отображается заголовок видео и название источника видео,
            под видео может отображаться кнопка Показать еще n видео, если видео в сюжете несколько,
            под видео сюжета отображается лента рекомендованных видео с заголовком Интересное,
            внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-29_19-29-22.png
        - do: включить звук на видео в просмотрщике и закрыть его тапом по крестику
        - assert: видео в медиаблоке не проигрывается, звук не идет
        - do: снова тапнуть на видео
        - assert: видео в просмотрщике проигрывается сначала, без звука
        - do: проскроллить ленту просмотрщика какое-то время
        - assert: лента просмотрщика бесконечная
        - do: закрыть окно просмотрщика по крестику
        - assert: |
            происходит возврат к сюжету с медиаблоком из шага 2,
            видео не проигрывается, звука нет

      содержит ленту рекомендованного видео в просмотрщике [manual]:
        - tags:
            - backend_news
        - browsers:
            notFor:
              - ios-safari-9-touch
              - ios-safari-10-touch
              - ios-safari-11-touch
              - android-browser-5.1-touch
        - reasonNotToAuto:
          - Необходимы ручные проверки персонализации и медиаблока
        - do: открыть выдачу сервиса на странице рубрики "Главное"
        - do: перейти в любой сюжет с видео тапом по заголовку в новостной карточке (если в сюжете нет медиаблока с видео, открыть другой сюжет)
        - do: тапнуть по любому видео в сюжете
        - assert: |
            раскрывается окно просмотрщика с видео,
            воспроизодится видео, которое было выбрано в сюжете, автоматически, либо по тапу на кнопку плей, без звука
        - do: проскроллить ленту в просмотрщике до рекомендованных видео под заголовком Интересное
        - assert: |
            лента скроллится плавно, без морганий,
            происходит автоматический подскролл к верху видео,
            в ленте рекомендованных видео больше 1-2 видео,
            в шапке отображается заголовок Интересное и крестик, шапка залипает при скролле,
            верхнее видео воспроизодится автоматически, либо по тапу на кнопку плей, без звука,
            перед воспроизведением может отображаться превью на пару секунд,
            под верхним видео нижняя часть экрана затемнена и неактивна,
            под каждым видео отображается заголовок видео и название источника видео,
            внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-29_19-32-24.png
        - do: тапнуть по заголовку под любым рекомендованным видео (название новости НЕ должно быть спортивным)
        - assert: |
            происходит переход на страницу сюжета с видео из ленты,
            сюжет содержит медиаблок, видео не воспроизводится автоматически
        - do: тапнуть по аппартаной или браузерной кнопке "Назад"
        - assert: происходит переход к просмотрщику, в котором автоматически проигрывается видео из сюжета из шага 2
        - do: закрыть просмотрщик тапом по крестику
        - assert: открылся сюжет из шага 2, видео не воспроизводятся
        - do: тапнуть по любому видео в сюжете, дождаться окончания проигрывания видео из сюжета
        - assert: после проигрывания одного видео из сюжета происходит автоматический переход к блоку фото (если этот блок есть, если его нет - видео воспроизводится до конца и ставится на паузу)
        - do: тапнуть по аппартаной или браузерной кнопке "Назад"
        - assert: происходит переход к сюжету из шага 2
        - do: тапнуть по любому видео в сюжете и нажать "Показать еще 3 видео" (если кнопки нет - найти другой сюжет с бОльшим количеством видео, кнопка показать еще видео будет дублироваться до тех пор пока не отобразятся все видео сюжета), дождаться окончания проигрывания последнего видео из сюжета
        - assert: после проигрывания последнего видео из сюжета происходит автоматический переход к блоку "Интересное" (Обратите внимание! Если в сюжете были фото, то перехода не произойдет! Видео дойдет до конца и воспроизводение остановится. Будет доступна иконка включения видео сначала - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-29_20-01-41.png)

      содержит больше 2-х видео [manual]:
        - tags:
            - smoke
        - browsers:
            notFor:
              - ios-safari-9-touch
              - ios-safari-10-touch
              - ios-safari-11-touch
              - android-browser-5.1-touch
        - do: открыть выдачу сервиса на странице рубрики 'Главное'
        - do: перейти в любой нетраурный сюжет тапом по заголовку в новостной карточке
        - assert: |
           сюжет содержит медиаблок с видео (если в сюжете нет медиаблока с видео, открыть другой сюжет),
           видео не воспроизводится автоматически,
           на основном видео отображается кнопка 'плей',
           под основным видео может быть карусель превью видео, если видео в сюжете несколько,
           внешний вид - https://jing.yandex-team.ru/files/an-smirn0v/shot_210405_152814.png
        - do: тапнуть по превью видео из карусели
        - assert: |
            раскрывается окно просмотрщика,
            воспроизводится видео, которое было выбрано из карусели (с соответствующим источником), автоматически с начала, либо по тапу на кнопку плей, без звука,
            на самом видео в верхнем правом углу отображается источник видео (на android может перекрываться кнопкой включения звука),
            под видео может отображается кнопка Показать еще n видео,
            внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-29_19-29-22.png
        - do: тапнуть по кнопке Показать еще n видео
        - assert: раскрываются остальные видео из сюжета порциями по 3 видео
        - do: чуть проскроллить ленту видео из сюжета так, чтобы воспроизводилось второе видео
        - assert: |
            происходит автоматический подскролл к верху видео,
            появляется шапка с заголовком сюжета, которая залипает при скролле,
            верхнее видео воспроизодится автоматически, без звука,
            перед воспроизведением может отображаться превью на пару секунд,
            под верхним видео нижняя часть экрана затемнена и неактивна,
            внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-29_19-30-52.png
        - do: поскроллить ленту видео ДО заголовка Интересное (то есть, чтобы НЕ проигрывались видео из раздела Интересное)
        - assert: |
            лента скроллится плавно, без морганий,
            под каждым видео отображается заголовок видео и название источника видео,
            количество видео соответствует количеству видео в медиаблоке (до заголовка Интересное)
        - do: закрыть окно просмотрщика
        - assert: происходит возврат к сюжету

      в нетраурном сюжете содержит рекламу в видео [manual]:
        - tags:
            - advert
        - browsers:
            notFor:
              - ios-safari-9-touch
              - ios-safari-10-touch
              - ios-safari-11-touch
              - android-browser-5.1-touch
        - reasonNotToAuto:
          - Необходима ручная проверка рекламы в видео
        - do: открыть выдачу сервиса на странице рубрики 'Главное'
        - do: перейти в любой нетраурный сюжет тапом по заголовку в новостной карточке
        - assert: |
            сюжет содержит медиаблок с видео (если в сюжете нет медиаблока с видео, открыть другой сюжет),
            по умолчанию активен медиаблок с видео, видео не воспроизводится автоматически,
            под основным видео может быть карусель превью видео (если карусели с превью нет, открыть другой сюжет)
        - do: тапнуть по кнопке "Плей" на любом видео и подождать 30 секунд видео (если видео длительностью < 40сек, переключиться на другое видео сюжета или перейти в другой нетраурный сюжет)
        - do: надо именно подождать, перемотка не сработает
        - assert: на 30ой секунде видео прерывается рекламой
        - do: дождаться окончания рекламы или тапнуть Пропустить
        - assert: видео продолжает воспроизведение с места, на котором прервалось рекламой
        - do: дождаться полного окончания проигрывания текущего видео
        - assert: после окончания видео идет подскролл к блоку фото (если такой блок в сюжете есть, если нет - подскрол к блоку "Интересное")
        - do: проскролить вверх к начальному видео (видео снова воспроизводится автоматически - это ок)
        - do: раскрыть блок похожих видео тапом по кнопке "Показать еще N видео"
        - do: тапнуть по первому видео в открывшемся блоке и дождаться, когда оно закончится (можно промотать ближе к концу)
        - assert: после окончания воспроизведения первого видео, автоматически воспроизводится следующее видео из блока
        - do: тапнуть по проигрывающемуся видео и снова подождать 30 секунд видео (если видео длительностью < 40сек, проскроллить до другого видео)
        - assert: на 30ой секунде видео прерывается рекламой
        - do: аналогичным образом проверить, что реклама проигрывается на 30 секунде видео из ленты рекомендованных видео

      в траурном сюжете не содержит рекламу в видео  [manual]:
        - browsers:
            notFor:
              - ios-safari-9-touch
              - ios-safari-10-touch
              - ios-safari-11-touch
              - android-browser-5.1-touch
        - reasonNotToAuto:
          - Необходима ручная проверка рекламы в видео
        - do: открыть выдачу сервиса на странице рубрики 'Происшествия'
        - do: найти траурный сюжет (Траурный сюжет - сюжет об убийстве, смерти, тяжелых травмах, захвате заложников, теракте.)
        - do: |
            перейти в траурный сюжет тапом по заголовку в новостной карточке,
            проверить еще раз, что сюжет действительно траурный - отсутствует блок рекламы под рубрикатором,
            внешние отличия траурного и нетраурного сюжетов - https://jing.yandex-team.ru/files/nightsonne/2021-10-26_15-18-16.png
        - assert: |
            сюжет содержит медиаблок с видео (если в сюжете нет медиаблока с видео, открыть другой сюжет),
            видео в медиаблоке не воспроизводится автоматически
        - do: тапнуть по любому видео, длительностью >40сек (если видео длительностью < 40сек, включить другое видео сюжета или перейти в другой траурный сюжет)
        - assert: |
            раскрывается окно просмотрщика,
            воспроизводится видео автоматически либо по тапу на кнопку плей, без звука
        - do: подождать 30 секунд видео (надо именно подождать, перемотка не сработает)
        - assert: на 30ой секунде видео НЕ прерывается рекламой
        - do: аналогичным образом проверить, что реклама НЕ проигрывается на 30 секунде других видео из сюжета
        - do: проскроллить до ленты рекомендованных видео в просмотрщике
        - assert: в рекомендованных видео присутствует реклама на 30 секунде

    #  содержит ленту персонализированных видео в просмотрщике [manual]:
    #    - tags:
    #        - backend_news
    #    - do:
    #        залогиниться на сервисе под пользователем Александр Овечкин (логин и пароль взять со страницы-инструкции на вики - https://wiki.yandex-team.ru/eva/testing/projects/nerpa/#loginyiparolidljatestovyxpolzovatelejj)
    #        если возникла проблема с авторизацией - залогиниться под любым другим пользователем из таблицы - Ольга Бузова или Стив Джобс
    #    - do: перейти в любой сюжет с медиаблоком
    #    - do: тапнуть по любому видео в сюжете
    #    - assert: раскрывается окно просмотрщика с видео
    #    - do: проскроллить ленту в просмотрщике до рекомендованных видео под заголовком Интересное
    #    - assert:
    #        если вы залогинены под пользователем Александр Овечкин - в ленте большинство видео по спортивной тематике
    #        если вы залогинены под пользователем Ольга Бузова - в ленте большинство видео про шоу-бизнес
    #        если вы залогинены под пользователем Стив Джобс - в ленте большинство видео про технологии

  может содержать рекламу:
    - tags:
        - smoke
        - advert
        - backend_news
    - do: открыть любой нетраурный и не спортивный сюжет в рубрике наука
    - assert: под рубрикатором отображается реклама
    - do: проскроллить сюжет ниже блока 'Подробнее о событии'
    - assert: присутствует рекламный блок, ниже подгружается следующий сюжет

  не содержит рекламу в траурном сюжете:
    - tags:
        - smoke
        - advert
        - backend_news
    - do: открыть любой траурный сюжет (проще найти в рубрике Происшествия)
    - assert: под рубрикатором отсутствует реклама
    - do: проскроллить сюжет ниже блока 'Подробнее о событии'
    - assert: присутствует рекламный блок, ниже подгружается следующий сюжет

  подгружает сюжеты в ленте под сюжетом после восстановления соединения [manual]:
    - tags:
      - smoke
      - backend_news
    - reasonNotToAuto:
      - не удалось автоматизировать, тк выполнение команды setNetworkConnection в браузерах заканчивается ошибкой 'unknown error - network connection must be enabled'/'operation is unsupported on Android'
    - do: открыть любой сюжет на сервисе
    - do: проскроллить сюжет ниже блока 'Подробнее о событии'
    - assert: может присутствовать реклама, ниже подгружается еще один сюжет
    - do: отключить интернет на устройстве
    - do: проскроллить страницу вниз
    - assert: отображается спинер на серой подложке
    - do: включить интернет на устройстве
    - assert: спинер пропадает, подгружается новый сюжет

  не содержит дублей в ленте под сюжетом [manual]:
    - tags:
      - backend_news
    - reasonNotToAuto:
      - Необходима ручная проверка сюжетов на дубликаты
    - do: открыть любой сюжет на сервисе
    - do: проскроллить ленту под сюжетом до нескольких подгрузившихся сюжетов (10 и более)
    - assert: среди подгрузившихся сюжетов в ленте отсутствуют повторяющиеся (могут быть похожие картинки, но заголовок и источник должны быть разными)

  открывается при переходе с главной страницы Яндекса:
    - tags:
        - backend_news
        - brow_only
    - do: залогиниться под аккаунтом 	Ольга Бузова, логин и пароль можно найти по ссылке https://wiki.yandex-team.ru/eva/testing/projects/nerpa/#loginyiparolidljatestovyxpolzovatelejj
    - do: открыть главную страницу Яндекса https://yandex.ru/
    - do: тапнуть по любой новости из блока "Сейчас в СМИ" (кроме спортивных новостей)
    - assert: в текущей вкладке открывается страница соответствующего сюжета Яндекс.Новостей
    - do: вернуться на главную страницу Яндекса
    - do: найти блок "Интересное в СМИ", тапнуть по любой карточке новостей (кроме спортивных новостей)
    - assert: в текущей вкладке открывается страница соответствующего сюжета Яндекс.Новостей

  архивный отображается корректно:
    - tags:
        - smoke
        - backend_news
        - brow_only
    - do: открыть архивный сюжет в браузере (например, https://yandex.ru/news/yandsearch?cl4url=https%3A%2F%2Fvz.ru%2Fnews%2F2019%2F1%2F31%2F962089.html&lr=2&mar=1 или https://yandex.ru/news/story/a--a84a4edbf9cae6a9cd7ea71b63883423)
    - assert: |
        сюжет отображается корректно,
        присутствуют заголовок, аннотация сюжета и ссылка В источнике
        над заголовком присутствует источник,
        отсутствует блок с эмоджи внизу сюжета,
        отображается иконка поделения внизу сюжета,
        может присутствовать настройка-троеточие с выпадающим меню,
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2020-12-30_13-24-55.png,

  архивный содержит ссылку на источник в аннотации:
    - tags:
        - smoke
        - backend_news
        - smoke_zen
    - do: открыть архивный сюжет в браузере (например, https://yandex.ru/news/yandsearch?cl4url=https%3A%2F%2Fvz.ru%2Fnews%2F2019%2F1%2F31%2F962089.html&lr=2&mar=1 или https://yandex.ru/news/story/a--a84a4edbf9cae6a9cd7ea71b63883423)
    - do: перейти по ссылке 'В источнике'
    - assert: |
        в новой вкладке открывается новость от источника,
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile
    - do: тап на аппаратную или браузерную кнопку "Назад"
    - assert: происходит возврат к сюжету

  архивный содержит ссылку на источник в блоке Подробнее о событии:
    - tags:
      - smoke
      - backend_news
    - do: открыть архивный сюжет в браузере (например, https://yandex.ru/news/yandsearch?cl4url=https%3A%2F%2Fvz.ru%2Fnews%2F2019%2F1%2F31%2F962089.html&lr=2&mar=1 или https://yandex.ru/news/story/a--a84a4edbf9cae6a9cd7ea71b63883423)
    - do: тапнуть по любому источнику из блока "Подробнее о событии"
    - assert: |
        в новой вкладке открывается новость от источника,
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile,
        Обратите внимание! При переходе по некоторым источникам в адресной строке utm-меток может не быть, т.к. источник может их скрыть. Это ок. Проверьте еще несколько источников и если нигде нет меток - только тогда заводите баг

  cодержит меню поделения для ios:
    - do: перейти в любой сюжет
    - assert: |
        иконка поделения расположена внизу сюжета https://jing.yandex-team.ru/files/nightsonne/2020-12-30_13-29-31.png,
        кнопка не наезжает на другие элементы социального блока
    - do: тапнуть по кнопке Поделиться
    - assert: |
        появляется меню со списком сервисов, в которых возможно поделиться сюжетом,
        меню может быть нативным (внизу) или в виде выпадающего меню, скрин https://jing.yandex-team.ru/files/nightsonne/2020-12-30_13-30-42.png,
        выпадающее меню может разворачиваться вниз или вверх в зависимости от свободного места на экране,
        выпадающее меню при скролле скрывается под шапкой и рубрикатором
    - do: тапнуть по крестику
    - assert: поп-ап поделения закрылся

  cодержит меню поделения для android:
    - do: перейти в любой сюжет
    - assert: |
        иконка поделения расположена внизу сюжета https://jing.yandex-team.ru/files/nightsonne/2020-12-30_13-29-31.png,
        кнопка не наезжает на другие элементы социального блока
    - do: тапнуть по кнопке Поделиться
    - assert: |
        появляется меню со списком сервисов, в которых возможно поделиться сюжетом,
        меню может быть нативным (внизу) или в виде выпадающего меню, скрин https://jing.yandex-team.ru/files/nightsonne/2020-12-30_13-30-42.png,
        выпадающее меню может разворачиваться вниз или вверх в зависимости от свободного места на экране,
        выпадающее меню при скролле скрывается под шапкой и рубрикатором
    - do: тапнуть по крестику
    - assert: поп-ап поделения закрылся

  cодержит кнопку, позволяющую поделиться новостью:
    - do: перейти в любой сюжет
    - assert: иконка поделения расположена внизу сюжета https://jing.yandex-team.ru/files/nightsonne/2020-12-30_13-29-31.png,
    - do: тапнуть по кнопке Поделиться
    - do: поделиться новостью на любом сервисе из списка (может потребоваться авторизоваться на сервисе)
    - assert: на внешнем сервисе отобразится новая запись с ссылкой на сюжет сервиса Яндекс.Новости
    - do: на внешнем сервисе кликнуть по ссылке на сюжет сервиса Яндекс.Новости
    - assert: открывается сюжет Яндекс.Новостей
    - do: проскроллить сюжет вниз до следующего сюжета
    - do: поделиться следующим сюжетом на любом сервисе
    - assert: на внешнем сервисе отобразится новая запись с ссылкой на сюжет сервиса Яндекс.Новости
    - do: на внешнем сервисе кликнуть по ссылке на сюжет сервиса Яндекс.Новости
    - assert: открывается сюжет Яндекс.Новостей

#убрали блок вот тут - https://st.yandex-team.ru/NEWREL-2394
  для сущностей, открытых в новом табе ПП (андроид), в урл прокидывает utm_referrer:
    - browsers:
        notFor:
          - ios-pp-3.2-touch
    - do: открыть вертикаль новостей тапом по иконке в бендере ПП
    - assert: открыта вертикаль новостей
    - do: тапнуть по любой новостной карточке
    - assert: в новом табе ПП открывается страница сюжета
    - do: проверить тап по названию источника над заголовком, 'В источнике' после аннотации
    - assert: |
        в новом табе ПП открывается страница источника,
        в урле есть метка utm_referrer
    - do: вернуться к сюжету и  поскроллить ленту сюжетов, пока не попадется сюжет с блоком 'С чего все начиналось'
    - do: тапнуть по источнику или заголовку в блоке 'С чего все начиналось'
    - assert: |
        в новом табе ПП открывается страница источника,
        в урле есть метка utm_referrer
    - do: вернуться к сюжету и тапнуть по любом источнику в блоке 'Подробнее о событии'
    - assert: |
        в новом табе ПП открывается страница источника,
        в урле есть метка utm_referrer
    - do: вернуться к сюжету и тапнуть по 'Подробнее о событии'
    - assert: |
        в новом табе ПП открывается страница инстори,
        в урле есть метка utm_referrer

  должен содержать настройку-троеточие, которая:
    позволяет открыть попап статистики для неархивного сюжета:
      - tags:
          - backend_news
          - smoke_zen
      - do: открыть выдачу сервиса на странице рубрики 'Главное'
      - do: перейти в первый сюжет из топ-5 новостей тапом по заголовку в новостной карточке (если первый сюжет спортивный - перейти в любой другой неспортивный из топ-5)
      - do: поскроллить до конца сюжета и тапнуть на икноку с тремя точками в блоке сюжета https://jing.yandex-team.ru/files/vasekerka/2021-10-07_13-32-20.png
      - assert: |
          раскрывается выпадающее меню, содержащее пункты 'Настроить источники' и 'Статистика сюжета' (пункт Автовоспроизведение может отсутствовать),
          скрин https://jing.yandex-team.ru/files/an-smirn0v/shot_201229_163510.png
      - do: кликнуть по пункту меню 'Статистика сюжета'
      - assert: |
          раскрывается шторка с заголовком 'Статистика' и информационной таблицей по сюжету,
          в таблице присутствуют обязательные пункты Документы в сюжете, Документы за час, Сюжеты в теме, Общий интерес, Вес сюжета, Позиция в топе,
          в таблице могут присутствовать пункты (только для региональных сюжетов) Позиция в региональном топе, Региональный интерес,
          в графе 'Общий интерес' стоит значение 'Высокий', выделенное зеленым цветом, в графе 'Вес сюжета' стоит значение 'Большой', выделенное черным цветом (в редких случаях значения могут отличаться),
          в графе 'Позиция в топе' стоит значение '1', имеется указание раздела топа - 'Россия' (Внимание! Цифра позиции должна соответствовать позиции сюжета в топе, и если в начале кейса вы открыли сюжет не из топ-1, цифра будет другой),
          в конце таблицы отображается ссылка на справочную информацию,
          внешний вид https://jing.yandex-team.ru/files/terenandrevna/20201012_18%3A47%3A37.png
      - do: закрыть окно Статистики, тапнув по галочке сверху и перейти на страницу рубрики Авто
      - do: открыть любой сюжет рубрики и раскрыть в нем попап статистики из трех точек
      - assert: |
          раскрывается окно с заголовком 'Статистика' и информационной таблицей по сюжету,
          в графе 'Общий интерес' и 'Вес сюжета' могут стоять значения, выделенные соотвествующими цветами: низкий (красный), средний (желтый), высокий (зеленый), большой (черный),
          у каждого пункта в таблице имеется свое цифровое или буквенное значение,
          в конце таблицы отображается ссылка на справочную информацию

    позволяет открыть попап статистики для неархивного сюжета в ландшафтном режиме:
      - do: перевернуть устройство в ландшафтный режим
      - do: открыть выдачу сервиса на странице рубрики 'Главное'
      - do: перейти в первый сюжет из топ-5 новостей тапом по заголовку в новостной карточке
      - do: тапнуть на икноку с тремя точками в блоке сюжета
      - assert: |
          раскрывается выпадающее меню, содержащее пункты 'Настроить источники' и 'Статистика сюжета' (пункт Автовоспроизведение может отсутствовать),
          скрин https://jing.yandex-team.ru/files/an-smirn0v/shot_201229_163510.png
      - do: кликнуть по пункту меню 'Статистика сюжета'
      - assert: |
          раскрывается шторка с заголовком 'Статистика' и информационной таблицей по сюжету,
          в таблице присутствуют обязательные пункты Документы в сюжете, Документы за час, Сюжеты в теме, Общий интерес, Вес сюжета, Позиция в топе,
          в таблице могут присутствовать пункты (только для региональных сюжетов) Позиция в региональном топе, Региональный интерес,
          в графе 'Общий интерес' стоит значение 'Высокий', выделенное зеленым цветом, в графе 'Вес сюжета' стоит значение 'Большой', выделенное черным цветом (в редких случаях значения могут отличаться),
          в графе 'Позиция в топе' стоит значение '1', имеется указание раздела топа - 'Россия',
          в конце таблицы отображается ссылка на справочную информацию

    позволяет открыть попап статистики для регионального сюжета:
      - tags:
          - backend_news
      - do: открыть выдачу сервиса на странице региональной рубрики
      - do: перейти в любой сюжет из топ-5 новостей тапом по заголовку в новостной карточке
      - do: тапнуть на икноку с тремя точками в блоке сюжета и далее по пункту меню 'Статистика сюжета'
      - assert: |
          раскрывается шторка с заголовком 'Статистика' и информационной таблицей по сюжету,
          в таблице присутствуют обязательные пункты Документы за час, Документы в сюжете, Сюжеты в теме, Общий интерес, Вес сюжета, Позиция в топе,
          в таблице присутствуют пункты Позиция в региональном топе, Региональный интерес,
          в графах 'Общий интерес', 'Вес сюжета' и 'Региональный интерес' могут стоять значения, выделенные соотвествующими цветами: низкий (красный), средний (желтый), высокий (зеленый), большой (черный),
          в графе 'Позиция в региональном топе' стоит значение от '1' до '5',
          у пунктов 'Позиция в региональном топе' и 'Региональный интерес' имеется указание раздела топа - <название региона>,
          внешний вид https://jing.yandex-team.ru/files/nightsonne/2021-12-09_23-35-48.png
      - do: перейти на страницу https://yandex.ru/news/region/syktyvkar
      - do: перейти в любой сюжет из топ-5 новостей кликом по заголовку в новостной карточке
      - assert: |
          таблица соответствует требованиям, описанным в шаге выше,
          у пунктов 'Позиция в региональном топе' и 'Региональный интерес' имеется указание раздела топа - Сыктывкар

# В асессорском экспе теперь комменты отображаются всегда. Временно убираем эту логику из кейсов
#    может содержать пункт с комментариями [manual]:
#      - tags:
#          - backend_news
#      - do: открыть выдачу сервиса на странице Главное без залогина в режиме инкогнито
#      - do: перейти в любой сюжет кликом по заголовку в новостной карточке
#      - assert: |
#          в блоке сюжета не отображается иконка комментариев,
#          иконка поделения отображается под аннотацией с надписью Поделиться,
#          иконка с тремя точками отображается под аннотацией
#      - do: тапнуть на икноку с тремя точками в блоке сюжета
#      - assert: |
#          раскрывается выпадающее меню с пунктами Статистика сюжета и Комментировать (может содержаться пункт Автовоспроизведение),
#          рядом с кнопкой Комментировать отображается счетчик комментариев (при нуле счетчик не отображается),
#          скрин https://jing.yandex-team.ru/files/terenandrevna/20201019_21%3A18%3A59.png
#      - do: тапнуть по кнопке Комментировать
#      - assert: раскрывается шторка комментариев

# аналогично с десктопом - странный кейс, который по факту не проверяет настройку автоплея (ее и нет вовсе) и проверяет воспроизведение видео в сюжете, которое уже и так проверяется в других кейсах
#    в нетраурном сюжете содержит настройку 'Автоплей' [manual]:
#      - tags:
#          - backend_news
#      - browsers:
#          notFor:
#            - ios-safari-9-touch
#            - ios-safari-10-touch
#            - android-browser-5.1-touch
#      - do: открыть выдачу сервиса на странице рубрики 'Главное'
#      - do: перейти в любой нетраурный сюжет тапом по заголовку в новостной карточке
#      - assert: |
#          сюжет содержит медиаблок с видео (если в сюжете нет медиаблока с видео, открыть другой сюжет),
#          видео не воспроизводится автоматически,
#          на основном видео отображается кнопка 'плей',
#          под основным видео может быть карусель превью видео, если видео в сюжете несколько,
#          внешний вид - https://jing.yandex-team.ru/files/an-smirn0v/shot_210405_152814.png
#      - do: тапнуть по кнопке плей на любом видео в сюжете
#      - assert: |
#          раскрывается окно просмотрщика с видео,
#          воспроизодится видео, которое было выбрано в сюжете, автоматически либо по тапу на кнопку плей, без звука
#      - do: закрыть страницу просмотрщика, поскроллить ленту сюжетов
#      - assert: во всех сюжетах видео в медиаблоке не воспроизводится автоматически

# Эту логику снесли - автоплей теперь везде
#    в траурном сюжете не содержит настройку 'Автоплей' [manual]:
#        - tags:
#            - backend_news
#        - browsers:
#            notFor:
#              - ios-safari-9-touch
#              - android-browser-5.1-touch
#        - do: открыть траурный сюжет на сервисе (проще найти в рубрике Происшествия)
#        - assert: |
#            сюжет содержит медиаблок с видео (если в сюжете нет медиаблока с видео, открыть другой траурный сюжет),
#            видео в медиаблоке не воспроизводится автоматически,
#            под основным видео может быть карусель превью видео, если видео в сюжете несколько,
#            внешний вид - https://jing.yandex-team.ru/files/terenandrevna/20200825_12%3A00%3A22.png
#        - do: тапнуть на основное видео в медиаблоке
#        - assert: |
#            раскрывается окно просмотрщика с видео,
#            воспроизодится видео, которое было выбрано в сюжете, автоматически, без звука
#        - do: закрыть страницу просмотрщика
#        - assert: видео в медиаблоке не проигрывается
#        - do: тануть по иконке троеточия в правом верхнем углу сюжета
#        - assert: раскрылось выпадающее меню с одним пунктом Статистика сюжета

  с фото:
    - do: открыть страницу 'https://yandex.ru/news/story/a--e8546b06747c9a197adc770fd90af96f'
    - screenshot: внешний вид соответствует скриншоту [picture]

  с видео:
    #Эти кейсы для тестов - полностью проверяют внешний вид сюжета. => кейс нужен только для бэка, поэтому добавляю его сюда
    - tags:
        - smoke
        - backend_news
    - do: открыть любой неспортивный сюжет с видео, например 'https://yandex.ru/news/story/aaa--114afaf222e0edecc40cd8f85108dde6'
#    - screenshot: внешний вид соответствует скриншоту [video]
    - assert: |
        на странице сюжета отображается заголовок с источником над ним,
        сюжет содержит медиаблок с видео (если в сюжете нет медиаблока с видео, открыть другой сюжет),
        в сюжете присутствует суммаризация, в конце каждого сниппета указан источник,
        ниже отображается карусель 'Подробнее о событии', карусель скроллится вправо-влево,
        внещний вид - https://jing.yandex-team.ru/files/vasekerka/2021-11-23_20-46-44.png,
        в ПП отсутствует шапка

#убрали блок вот тут - NEWREL-2394
  с блоком «С чего все начиналось»:
    - do: открыть сюжет, который содержит блок 'С чего все началось', например https://yandex.ru/news/story/Upravlyayushhij_direktor_rejtingovoj_sluzhby_NRA_nazval_prichiny_novogo_krizisa--9186782eb97eeea46aac02088ccb32a7?lang=ru&from=story&wan=1&stid=n6i1zkdF6tnpwIz4ag9w&t=1628862829&persistent_id=155683141
    - screenshot: внешний вид соответствует скриншоту [origin]
    - assert: над блоком 'Подробнее о событии' располагается блок 'С чего все началось', который содержит иконку издания, заголовок, аннотацию и название источника
    - do: тапнуть по названию источника
    - assert: |
        в новой вкладке открывается страница с новостью от источника
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile
    - do: вернуться на вкладку с сюжетом на Яндекс.Новостях
    - do: тапнуть по заголовку новости в блоке 'С чего все началось' (заголовок выделен жирным шрифтом - https://jing.yandex-team.ru/files/kossakovskaya/2021-09-08_14-14-15.png)
    - assert: |
        в новой вкладке открывается страница с той же новостью от источника
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile

  с заголовком и аннотацией:
    - do: открыть страницу 'https://yandex.ru/news/story/j--5805d1922b659d404966a4874b396d21'
    - screenshot: внешний вид соответствует скриншоту [plain]

# тут NERPA-12283 флаг с новым дизайном цитаты, этот кейс может позже пригодиться
#    - tags:
#       - backend_news
#  с цитатой:
#    - do: открыть страницу сюжета с цитатой (проще найти в рубрике Политика), например 'https://yandex.ru/news/story/a--39981f8713a9a1f38fcdccff32d9affc'
#    - screenshot: внешний вид соответствует скриншоту [quote]
#    - assert: после блока отображается цитата на сером фоне, под цитатой присутствует аватарка и фио автора
#    - do: тапнуть по фио автора цитаты
#    - assert: в новой вкладке открывается страница Яндекс.Поиска с результатами поиска по автору цитаты

  с забаненными блоками:
    - do: открыть страницу 'https://yandex.ru/news/story/j--065b2a41b43e24e690cc5412b6a6c101?flags=yxneo_news_story_bans=likes,pictures,video'
    - assert: Нет блока реакций
    - assert: Нет блока с видео
    - assert: Нет блока с картинкой

  с блоком "Ещё по теме":
    - params:
        flags:
          - yxneo_news_phone_story_theme=1
    - do: открыть страницу 'https://yandex.ru//news/story/j--fb08fd29a5f2573252ab577af3ed74bf?flags=yxneo_news_phone_story_theme=1'
    - screenshot: внешний вид соответствует скриншоту [related]

  с блоком "Официальный комментарий":
    - do: открыть страницу 'https://yandex.ru/news/story/a--3d3956cd8c550b4708096f79a4d380f6'
    - screenshot: внешний вид соответствует скриншоту [official]

  с "Официальными комментариями":
    - params:
        flags:
          - yxnews_official_statement_multiple_comments=1
          - yxnews_official_statement_inverted_sort_order=0
    - do: открыть страницу 'https://yandex.ru/news/story/o--3c5b053ec0a6b0fe298db61513f1320e?flags=yxnews_official_statement_multiple_comments=1;yxnews_official_statement_inverted_sort_order=0'
    - screenshot: внешний вид блока Официальных комментариев соответствует скриншоту [plain]

  с "Официальными комментариями" в хвосте:
    - params:
        flags:
          - yxneo_news_story_official-in-tail=1
    - do: открыть страницу 'https://yandex.ru/news/story/a--b497efe4ebd28917064672f7038c777f?flags=yxneo_news_story_official-in-tail=1'
    - screenshot: внешний вид блока "Подробнее о событии" соответствует скриншоту [plain]

  с полнотекстовой аннотацией:
    - params:
        flags:
          - yxnews_add_fulltext_snippet=1
          - yxnews_fulltext_max_part_size=500
          - yxnews_fulltext_parts_count=3
          - yxneo_story_fulltext-annotation=1
          - yxneo_story_fulltext-annotation-adv=1,0
    - do: открыть страницу 'https://yandex.ru/news/story/f--88e59fafe5ac46cb59e0e7241c172355?flags=yxnews_add_fulltext_snippet%3D1%3Byxnews_fulltext_max_part_size%3D500%3Byxnews_fulltext_parts_count%3D3%3Byxneo_story_fulltext-annotation%3D1;yxneo_story_fulltext-annotation-adv=1,0'
    - screenshot: внешний вид аннотации соответствует скриншоту [closed]
    - do: тапнуть Читать далее
    - screenshot: внешний вид аннотации соответствует скриншоту [opened]

  с трагичной полнотекстовой аннотацией не содержит рекламу:
    - params:
        flags:
          - yxnews_add_fulltext_snippet=1
          - yxnews_fulltext_max_part_size=500
          - yxnews_fulltext_parts_count=3
          - yxneo_story_fulltext-annotation=1
          - yxneo_story_fulltext-annotation-adv=1,0
    - do: открыть страницу 'https://yandex.ru/news/story/f--dd9865eaff6bb3f665f5b28c47cb5d99?flags=yxnews_add_fulltext_snippet%3D1%3Byxnews_fulltext_max_part_size%3D500%3Byxnews_fulltext_parts_count%3D3%3Byxneo_story_fulltext-annotation%3D1;yxneo_story_fulltext-annotation-adv=1,0'
    - do: тапнуть Читать далее
    - assert: |
        развернулось подробное описание новости
        внутри этого описания нет рекламных блоков

  отображает компоненты в кастомном порядке:
    - do: открыть страницу 'https://yandex.ru/news/story/m--032de1f69e8fe1f90cc170976d9a7edd?flags=yxneo_news_story_blocks-sequence=tail,origin,socials'
    - screenshot: внешний вид соответстует скриншоту [customOrder]

# тут NERPA-12283 флаг с новым дизайном цитаты, этот кейс может позже пригодиться
#    - tags:
#       - backend_news
#  отображает источник возле цитаты:
#    - do: открыть любой сюжет с цитатой, например,https://yandex.ru/news/story/a--6d01fbaf4ea2255c194509c8edbe53f7
#    - assert: после вида деятельности автора цитаты отображается источник цитаты
#    - do: тапнуть по источнику цитаты
#    - assert: |
#        в новой вкладке открылась страница источника,
#        в урле прокинуты параметры &utm_source=yxnews и utm_medium=mobile

# тут NERPA-12283 флаг с новым дизайном цитаты, этот кейс может позже пригодиться
#  отображает источник возле цитаты, в которой указан только автор:
#    - do: открыть любой сюжет с цитатой, где не указывается вид деятельности автора цитаты, например, https://yandex.ru/news/story/a--cc3682c516c9748360d997f1ff239885
#    - assert: |
#          после фио автора цитаты отображается источник цитаты,
#          фио и источник не склеились друг с другом

  не перерисовывается рекламный блок вверху страницы [manual]:
    - tags:
      - rareCase
    - reasonNotToAuto:
      - Необходима ручная проверка загрузки содержимого рекламного блока
    - do: открыть любой сюжет, кроме рубрик Происшествия и Коронавирус
    - assert: вверху страницы отображается рекламный блок
    - assert: после загрузки страницы реклама не перерисовывается (не моргает и не меняется)

  содержит суммаризацию, разворачивающуюся по кнопке "Читать далее":
    - params:
        flags:
          - yxnews_yt_request_summary=1,
          - yxneo_news_story_blocks-sequence=summarization,
          - yxneo_news_phone_story_summarization=4,
          - yxneo_news_story_summarization_collapse=1,
    - do: открыть страницу 'https://yandex.ru/news/story/a--226a22582f129586a1bec85ccbf4c5b0?flags=yxnews_yt_request_summary=1;yxneo_news_story_blocks-sequence=summarization;yxneo_news_phone_story_summarization=4;yxneo_news_story_summarization_collapse=1'
    - screenshot: внешний вид соответствует скриншоту [summarization-collapsed-v1]
    - do: тапнуть "Читать далее"
    - screenshot: внешний вид соответствует скриншоту [summarization-expanded-v1]

  содержит суммаризацию, скрывающуюся по кнопке "Свернуть":
    - params:
        flags:
          - yxnews_yt_request_summary=1,
          - yxneo_news_story_blocks-sequence=summarization,
          - yxneo_news_phone_story_summarization=4,
          - yxneo_news_story_summarization_collapse=1,
          - yxneo_news_story_summarization_auto-expand=1,
    - do: открыть страницу 'https://yandex.ru/news/story/a--a20794917f9d7ab0b95d74bbd1018ad8?flags=yxnews_yt_request_summary=1;yxneo_news_story_blocks-sequence=summarization;yxneo_news_phone_story_summarization=4;yxneo_news_story_summarization_collapse=1;yxneo_news_story_summarization_auto-expand=1'
    - screenshot: внешний вид соответствует скриншоту [summarization-expanded]
    - do: тапнуть "Свернуть"
    - screenshot: внешний вид соответствует скриншоту [summarization-collapsed]

  открывает первую суммаризацию в ленте (по флагу):
    - params:
        flags:
          - yxnews_yt_request_summary=1,
          - yxneo_news_story_blocks-sequence=summarization,
          - yxneo_news_phone_story_summarization=3,
          - yxneo_news_story_summarization_collapse=1,
          - yxneo_news_phone_story_summarization_auto_expand_first=1,
    - do: открыть страницу 'https://yandex.ru/news/story/a--104cfc298ab345c0fc2581ec2091e9f6?flags=yxnews_yt_request_summary=1;yxneo_news_story_blocks-sequence=summarization;yxneo_news_phone_story_summarization=3;yxneo_news_story_summarization_collapse=1;yxneo_news_phone_story_summarization_auto_expand_first=1'
    - assert: суммаризация развернута
    - do: проскроллить до следующего сюжета
    - assert: суммаризация свернута

  содержит саджест источников, открывающий попап с настройками избранного:
    - params:
        flags:
          - yxneo_news_phone_favorites-suggest=1,
          - yxnews_optout_counter_treshold=0,
          - yxnews_optout_hot_size=1,
          - yxnews_optout_candidate_size=50,
          - yxnews_optout_min_count=1,
          - yxnews_optout_max_count=5,
          - yxnews_optout_show_count=1000,
          - yxnews_optout_show_delay=0,
          - yxnews_optout_disable_delay=0,
          - yxnews_enable_api_favorites=1,
          - yxnews_arranged_flags_patch={"default":{"touch":{"news_story":{"arranged.modules":"from_rubrics_top,uniq_filter,recommender,similarity_filter,personalized_agencies,user_settings"}}}}
    - do: открыть страницу 'https://yandex.ru/news/story/a--659c5ddd55b93649509a47d3a08f20bc?userid=448850646&flags=yxneo_news_phone_favorites-suggest=1;yxnews_optout_counter_treshold=0;yxnews_optout_hot_size=1;yxnews_optout_candidate_size=50;yxnews_optout_min_count=1;yxnews_optout_max_count=5;yxnews_optout_show_count=1000;yxnews_optout_show_delay=0;yxnews_optout_disable_delay=0;yxnews_enable_api_favorites=1;yxnews_arranged_flags_patch={"default":{"touch":{"news_story":{"arranged.modules":"from_rubrics_top,uniq_filter,recommender,similarity_filter,personalized_agencies,user_settings"}}}}'
    - screenshot: внешний вид соответствует скриншоту [favorites-suggest]

  содержит саджест источников (2ой вариант дизайна):
    - params:
        flags:
          - yxneo_news_phone_favorites-suggest=2,
          - yxnews_optout_counter_treshold=0,
          - yxnews_optout_hot_size=1,
          - yxnews_optout_candidate_size=50,
          - yxnews_optout_min_count=1,
          - yxnews_optout_max_count=5,
          - yxnews_optout_show_count=1000,
          - yxnews_optout_show_delay=0,
          - yxnews_optout_disable_delay=0,
          - yxnews_enable_api_favorites=1,
          - yxnews_arranged_flags_patch={"default":{"touch":{"news_story":{"arranged.modules":"from_rubrics_top,uniq_filter,recommender,similarity_filter,personalized_agencies,user_settings"}}}}
    - do: открыть страницу 'https://yandex.ru/news/story/a--659c5ddd55b93649509a47d3a08f20bc?userid=448850646&flags=yxneo_news_phone_favorites-suggest=2;yxnews_optout_counter_treshold=0;yxnews_optout_hot_size=1;yxnews_optout_candidate_size=50;yxnews_optout_min_count=1;yxnews_optout_max_count=5;yxnews_optout_show_count=1000;yxnews_optout_show_delay=0;yxnews_optout_disable_delay=0;yxnews_enable_api_favorites=1;yxnews_arranged_flags_patch={"default":{"touch":{"news_story":{"arranged.modules":"from_rubrics_top,uniq_filter,recommender,similarity_filter,personalized_agencies,user_settings"}}}}'
    - screenshot: внешний вид соответствует скриншоту [favorites-suggest-high]

  содержит видео в сюжетах топ-5 [manual]:
    - tags:
      - backend_news
      - brow_only
    - browsers:
        notFor:
          - ios-safari-9-touch
          - ios-safari-10-touch
          - ios-safari-11-touch
          - android-browser-5.1-touch
    - reasonNotToAuto:
      - Необходима ручная проверка наличия видео в сюжетах топ-5 (для бэка)
    - do: открыть главную страницу новостей https://yandex.ru/news
    - assert: главная страница содержит топ-5 - это пять первых новостных карточек до рекламной карточки
    - do: тапнуть по заголовку первой новости в топ-5
    - assert: |
        в той же вкладке открывается сюжет,
        в сюжете может быть видеоблок
    - do: запустить видео, если оно есть в сюжете (если нет, пропустить этот шаг)
    - assert: видео воспроизводится
    - do: вернуться на главную страницу новостей
    - do: тапнуть по заголовку второй новости в топ-5
    - assert: |
        в той же вкладке открывается сюжет,
        в сюжете может быть видеоблок
    - do: запустить видео, если оно есть в сюжете (если нет, пропустить этот шаг)
    - assert: видео воспроизводится
    - do: вернуться на главную страницу новостей
    - do: тапнуть по заголовку третьей новости в топ-5
    - assert: |
        в той же вкладке открывается сюжет,
        в сюжете может быть видеоблок
    - do: запустить видео, если оно есть в сюжете (если нет, пропустить этот шаг)
    - assert: видео воспроизводится
    - do: вернуться на главную страницу новостей
    - do: тапнуть по заголовку четвертой новости в топ-5
    - assert: |
        в той же вкладке открывается сюжет,
        в сюжете может быть видеоблок
    - do: запустить видео, если оно есть в сюжете (если нет, пропустить этот шаг)
    - assert: видео воспроизводится
    - do: вернуться на главную страницу новостей
    - do: тапнуть по заголовку пятой новости в топ-5
    - assert: |
        в той же вкладке открывается сюжет,
        в сюжете может быть видеоблок
    - do: запустить видео, если оно есть в сюжете (если нет, пропустить этот шаг)
    - assert: видео воспроизводится
    - do: посчитать количество сюжетов с видео из 5 открытых сюжетов
    - assert:  |
        в нескольких открытых в кейсе сюжетах из топ-5 есть видео,
        отсутствие видео во всех сюжетах топ-5 - баг

  позволяет скроллить страницу сюжета в пределах медиаблока [manual]:
    - tags:
      - rareCase
    - browsers:
      - ios-safari-9-touch
      - ios-safari-13-touch
      - android-yandex-browser-17-touch
    - reasonNotToAuto:
      - Необходима ручная проверка специфического скролла в области медиаблока
    - do: открыть любой сюжет с медиаблоком (если медиаблока нет, найти другой сюжет, где медиаблок присутствует)
    - do: скроллить страницу вверх/вниз в пределах медиаблока, область, на которой нужно скроллить помечена стрелками - https://jing.yandex-team.ru/files/vasekerka/scroll_mediablock.png
    - assert: страница скроллится

  содержит суммаризацию с фильтрацией нежелательных источников [manual]:
    - tags:
      - backend_news
      - smoke_zen
    - reasonNotToAuto:
      - Необходима ручная проверка фильтрации нежелательных источников
    - do: зайти в любой неспортивный сюжет, расскрыть (если не раскрыта) суммаризацию тапом по кнопке "Читаль далее"
    - do: запомнить, какие источники указаны у сниппетов, пример https://jing.yandex-team.ru/files/vasekerka/2021-08-10_13-40-22.png
    - do: зайти в настройки избранного и добавить 1-2 источника из шага 2 в нежелательные, закрыть окно и обновить страницу
    - assert: |
        при раскрытии суммаризации (если необходимо) верстка не едет,
        отображаются сниппеты только тех источников, которые НЕ добавлены в нежелательные,
        пример - https://jing.yandex-team.ru/files/vasekerka/2021-08-10_13-42-50.png
    - do: снова зайти в настройки избранного любым способом
    - do: добавить оставшиеся в суммаризации источники в нежелательные и обновить страницу
    - assert: |
        верстка не едет, показывается аннотация без суммаризации,
        внешний вид - https://jing.yandex-team.ru/files/vasekerka/2021-08-10_13-43-49.png,
        ВАЖНО (это не баг): если после обновления страницы все еще отображается суммаризация, нужно еще раз добавить источники из суммаризации в избранное,
        когда все источники из суммаризации добавлены в нежелательные - отображается аннотация без суммаризации

  содержит блок  "С чего все началось" в хвосте за флагом:
    - params:
        flags:
          - yxnews_add_origin=1
    - do: открыть страницу https://yandex.ru/news/story/a--e33ba3000031e824bbdfe4424dbfdf87?flags=yxnews_add_origin=1
    - screenshot: внешний вид соответствует скриншоту [origin-in-tail]

  содержит внешние ссылки в суммаризации:
    - params:
        flags:
          - yxneo_news_phone_story_external-link-in-summarization=1
    - do: открыть страницу https://yandex.ru/news/story/title--9cca8ed21295f1121a3a85a940318a5c?persistent_id=160143379&fan=1&flags=yxneo_news_phone_story_external-link-in-summarization=1
    - screenshot: внешний вид соответствует скриншоту [summarization-ext-link]

  содержит метку иноагента в заголовке:
    - do: открыть страницу https://yandex.ru/news/story/news/story/a--4a04f8615a1c581add205a03eb8ba8a3?persistent_id=162173445
    - screenshot: внешний вид соответствует скриншоту [foreign-agent-in-header]
    - do: нажать на стрелочку
    - assert: развенулось сообщение об иноагенте

  содержит метку иноагента в суммаризации:
    - do: открыть страницу https://yandex.ru/news/story/a--4a04f8615a1c581add205a03eb8ba8a3?persistent_id=162173445
    - assert: возле источника-иноагент отображается свернутая плашка со стрелочкой
    - do: нажать на стрелочку
    - assert: развенулось сообщение об иноагенте

  содержит метку иноагента в хвосте:
    - do: открыть страницу https://yandex.ru/news/story/a--d77160d9918e40ae2a82dc3b9fe2ce6b?persistent_id=162053093
    - do: промотать к источникам
    - assert: возле источника-иноагент отображается свернутая плашка со стрелочкой
    - do: нажать на стрелочку
    - assert: развенулось сообщение об иноагенте

  содержит объектный ответ в суммаризации, который открывается по клику:
    - params:
        flags:
          - yxneo_news_phone_story_entity-object-in-summarization=1
    - do: открыть страницу https://yandex.ru/news/story/news/story/a--2e7598f00f6a092e5a5fdfaab49404fb?flags=yxneo_news_phone_story_entity-object-in-summarization=1
    - screenshot: внешний вид соответствует скриншоту [entity-object-in-summarization]
    - do: нажать на любой объектный ответ в суммаризации
    - assert: открылся объектный ответ в выезжающем модальном окне
    - screenshot: внешний вид соответствует скриншоту [entity-object-in-summarization-opened]

  содержит объектный ответ в суммаризации, который открывается по клику и корректно отображается в темной теме:
    - params:
        flags:
          - yxneo_news_phone_story_entity-object-in-summarization=1
          - yxneo_news_phone_story_service-theme=dark
    - do: открыть страницу https://yandex.ru/news/story/news/story/a--2e7598f00f6a092e5a5fdfaab49404fb?flags=yxneo_news_phone_story_entity-object-in-summarization=1;yxneo_news_phone_story_service-theme=dark
    - screenshot: внешний вид соответствует скриншоту [entity-object-in-summarization-dark]
    - do: нажать на любой объектный ответ в суммаризации
    - assert: открылся объектный ответ в выезжающем модальном окне
    - screenshot: внешний вид соответствует скриншоту [entity-object-in-summarization-dark-opened]

  показывает первые два сниппета суммаризации при поделении сюжетом:
    - do: перейти в рубрику "Культура"
    - do: полистать рубрику до загрузки 2 порции
    - do: тапнуть в любой сюжет из второй порции (важно, чтобы сюжет не принадлежал топ-5 рубрики, поэтому открываем сюжет из второй порции)
    - assert: |
        в той же вкладке открывается страница сюжета,
        в сюжете присутствует суммаризация, внешний вид https://jing.yandex-team.ru/files/nightsonne/2021-09-24_19-41-57.png ,
        если в сюжете нет суммаризации, вернуться ко 2й порции карточек рубрики "Культура" и попробовать открыть другой сюжет
    - do: тапнуть на кнопку "Поделиться" рядом с блоком эмоджи внизу сюжета https://jing.yandex-team.ru/files/nightsonne/2021-09-24_19-43-19.png
    - assert: появилось нативное окно поделения
    - do: поделиться сюжетом через меню поделения в любом мессенджере, например, в Telegram
    - do: сравнить аннотацию в мессенджере и первые два блока суммаризации сюжета
    - assert: |
        в мессенджере под ссылкой на сюжет и заголовком присутствует аннотация,
        аннотация включает в себя первые 2 сниппета суммаризации сюжета,
        Обратите внимание! Суммаризация может не прорасти по многим причинам - если оказалось, что ее нет - попробуйте другой сюжет. Если у двух сюжетов ее нет - только тогда заводите баг,
        внешний вид для Telegram - https://jing.yandex-team.ru/files/nightsonne/2021-09-24_19-44-32.png ,
        если первый сниппет большой, второй может не отобразиться или отобразиться частично,
        аннотация может содержать ссылки на источник из суммаризации, если имя источника == доменному имени (например, справедливо для источника Lenta.ru),
        внешний вид для аннотации со ссылкой - https://jing.yandex-team.ru/files/nightsonne/2021-09-24_19-39-06.png

  содержит метку "Самое цитируемое" в хвосте:
    - do: открыть https://yandex.ru/news/story/a--7e64ac51d640f1c9a06eb2101262f585?persistent_id=167793959
    - assert: 2й источник в хвосте содержит метку "Самое цитируемое"

  не содержит рекламу для пользователей с подпиской Плюс:
    - do: открыть https://yandex.ru/news/story/a--050da104f517a6a266e68bf3e82ca642?flags=yxneo_news_story_disable-plus-users-advert=1
    - assert: реклама отсутствует

  содержит внешние ссылки в блоке суммаризации [manual]:
    - tags:
        - backend_news
        - smoke_zen
    - do: зайти в любой неспортивный сюжет, раскрыть (если не раскрыта) суммаризацию тапом по кнопке "Читать далее"
    - do: скроллить ленту сюжетов и в каждом тапать на кнопку "Читать далее", пока не попадется сюжет в суммаризации которого содержится ссылка на внешние первоисточники (внешний - это значит, что у нас не подключен как партнер и от него нет новостей на сервисе) - https://jing.yandex-team.ru/files/weberxks/IMG_7427%20%281%29.jpg
    - do: нажать на ссылку
    - assert: в новом окне браузера открылась статья от внешнего источника

  может содержать иконку турбо-страницы в блоке Подробнее о событии [manual]:
    - tags:
      - backend_news
    - Case Type: CH
    - reasonNotToAuto:
      - Данный кейс включает ХП
    - do: открыть выдачу сервиса на странице рубрики "Главное"
    - do: тапнуть по любому неспортивному сюжету из топ-5
    - assert: |
        открылся сюжет в той же вкладке,
        в сюжете есть блок "Подробннее о событии" с источникамим,
        рядом с источником присутствует иконка турбо-страницы в виде ракеты,
        пример внешнего вида - https://jing.yandex-team.ru/files/vasekerka/2022-03-11_18-17-35.png

  корректно отображает сюжет в темной теме:
    - do: открыть сюжет в темной теме
    - assert: отображается страница сюжета, все элементы отображены корректно

  корректно отображает попап настроек и попап статистики в темной теме:
    - do: открыть сюжет в темной теме и нажать на троеточие
    - assert: отображается попап настроек, все элементы отображены корректно
    - do: в попапе настроек кликнуть по "Статистика сюжета"
    - assert: отображается попап статистики сюжета, все элементы отображены корректно

  не содержит пустого поля официального комментария в ленте под 404:
    - do: открыть https://yandex.ru/news/404 и полистать ленту сюжетов под 404
    - assert: в сюжетах ленты нет пустого дива под офиц коммент

# 07.04.22 выяснили, что Фильтрация сейчас отключена, yxnews_save_dj_filter_to_yt = 0 - флаг на проде
#  не показывает просмотренные сюжеты в рекомендательной ленте [manual]:
#    - tags:
#      - backend_news
#    - do: авторизоваться на сервисе горячим пользователем, например, Ольгой Бузовой (инструкция https://wiki.yandex-team.ru/eva/testing/projects/nerpa/#loginyiparolidljatestovyxpolzovatelejj)
#    - do: зайти в любой неспортивный сюжет 
#    - do: проскролить к ленте "По вашим интересам" так, чтобы сюжет из этой ленты полностью был виден на экране 
#    - do: открыть рубрику “Общество” и перейти в любой сюжет из рубрики 
#    - do: проскроллить к ленте “По вашим интересам”
#    - assert: в ленте отсутствует сюжет, который вы видели на шаге 3

files:
  - features/news/story/story.phone.hermione.js
  - features/news/story/story.phone.hermione.e2e.js

tags:
  - neo
  - story

manager: glushneva

qa-engineer: a-groza

tlds:
  - ru
  - by
  - kz
  - uz
  - ua
  - com
