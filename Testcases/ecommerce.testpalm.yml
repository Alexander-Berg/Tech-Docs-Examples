feature: metrika-ecommerce

params:
  exp_flags:
    - turboforms_endpoint=https://test-turbo-forms.common.yandex.ru/
    - analytics-disabled=1

browsers:
  - ios-safari-12-touch
  - ios-safari-11-touch
  - ios-safari-10-touch
  - ios-safari-9-touch

specs:
  Страница листинга:
    beforeEach:
      - do: перейти на https://yandex.ru/turbo?stub=productspage/index-server-for-screens.json&exp_flags=analytics-disabled=0
    Показ страницы:
      - tech: отправился хит на счетчик метрики 45135375
    Отправка поискового запроса:
      - do: ввести текст в поле поиска
      - do: отправить поисковый запрос
      - tech: отправилась цель 'products-search-submit' на второй счётчик метрики 45135375
    Клик по категории:
      - do: нажать по ссылке любой категории
      - tech: отправилась цель 'open-category' на второй счётчик метрики 45135375
    Применение сортировки:
      - do: выбрать другой способ сортировки товаров в селекте
      - tech: отправилась цель 'sort-products' на второй счётчик метрики 45135375
    Клик по карточке товара:
      - do: нажать по любому товару в списке
      - tech: отправилась цель 'open-product-item' на второй счётчик метрики 45135375

  Страница фильтров:
    beforeEach:
      - do: перейти на https://yandex.ru/turbo?stub=productfilterspage/default.json&exp_flags=analytics-disabled=0
    Показ страницы:
      - tech: отправился хит на счетчик метрики 45135375
    Клик на кнопку применения фильтров:
      - do: нажать на кнопку «Показать товары»
      - tech: отправилась цель 'apply-filters' на счётчик метрики 45135375

  Страница карточки товара:
    beforeEach:
      - do: перейти на https://yandex.ru/turbo?stub=productpage/product-1-server-for-screens.json&exp_flags=analytics-disabled=0
    Показ страницы:
      - tech: отправился хит на счетчик метрики 45135375
    Клик по кнопке «Добавить в корзину»:
      - do: нажать на кнопку «Добавить в корзину»
      - tech: отправилась цель 'add-to-cart' на счётчик метрики 45135375
    Клик по кнопке «Перейти в корзину»:
      - do: нажать на кнопку «Добавить в корзину»
      - do: нажать на кнопку «Перейти в корзину», которая появилась на месте кнопки добавления в корзину
      - tech: отправилась цель 'open-cart-from-product' на счётчик метрики 45135375
    Клик по корзине в шапке:
      - do: нажать на кнопку с иконкой корзины в верхнем правом углу страницы
      - tech: отправилась цель 'open-cart-from-header' на счётчик метрики 45135375
    Клик по кнопке «Купить в 1 клик»:
      - do: нажать на кнопку «Купить в 1 клик»
      - tech: отправилась цель 'open-check-out-form' на счётчик метрики 45135375
    Отправка формы заказа и показ статуса успешной отправки заказа:
      - do: нажать на кнопку «Купить в 1 клик»
      - assert: открылось окно оформления заказа
      - do: заполнить обязательные поля формы
      - do: нажать на кнопку отправки формы
      - tech: отправилась цель 'send-check-out-form' на счётчик метрики 45135375
      - assert: появилось сообщение об успехе оформления заказа
      - tech: отправилась цель 'check-out-form-success' на счётчик метрики 45135375

  Страница корзины:
    beforeEach:
      - do: перейти на https://yandex.ru/turbo?stub=ecomcartpage/default.json&exp_flags=analytics-disabled=0
      - assert: на странице есть хотя бы один добавленный в корзину товар
      - do: если корзина пуста, то перейти в каталог, добавить любой товар в корзину и вернуться в корзину
    Показ страницы:
      - tech: отправился хит на счетчик метрики 45135375
    Открытие формы отправки заказа:
      - do: нажать на кнопку «Оформить заказ»
      - tech: отправилась цель 'open-check-out-form-from-cart' на счётчик метрики 45135375
    Отправка формы заказа с оплатой и показ статуса успешной отправки заказа:
      - do: нажать на кнопку «Оформить заказ»
      - assert: открылось окно оформления заказа
      - do: заполнить обязательные поля формы
      - do: нажать оплату "Картой онлайн"
      - do: нажать на кнопку отправки формы
      - tech: отправилась цель 'send-check-out-form-from-cart' на счётчик метрики 45135375
      - assert: появилось сообщение об успехе оформления заказа
      - tech: отправилась цель 'check-out-form-success-from-cart' на счётчик метрики 45135375

    Отправка формы заказа без оплаты и показ статуса успешной отправки заказа:
      - do: нажать на кнопку «Оформить заказ»
      - assert: открылось окно оформления заказа
      - do: заполнить обязательные поля формы
      - do: выбрать оплату "Наличными при получение"
      - do: нажать на кнопку отправки формы
      - tech: отправилась цель 'send-check-out-form-from-cart' на счётчик метрики 45135375
      - assert: появилось сообщение об успехе оформления заказа
      - tech: отправилась цель 'check-out-form-success-from-cart' на счётчик метрики 45135375

    Отправка формы заказа с оплатой и показ статуса провала отправки заказа:
      - do: нажать на кнопку «Оформить заказ»
      - assert: открылось окно оформления заказа
      - do: заполнить имя как «error» и остальные обязательные поля формы
      - do: выбрать оплату "Картой онлайн"
      - do: нажать на кнопку отправки формы
      - assert: появилось сообщение об ошибке оформления заказа
      - tech: отправилась цель 'check-out-form-fail-from-cart' на счётчик метрики 45135375

    Оформление заказа, изменение данных в форме:
      - do: Нажать кнопку 'Оформить заказ'
      - do: Поставить фокус в поле 'ФИО'
      - tech: Отправилась цель 'check-out-form-focus-field-name'
      - do: Поставить фокус в поле 'Телефон'
      - tech: Отправилась цель 'check-out-form-focus-field-customer_phone'
      - do: Поставить фокус в поле 'E-mail'
      - tech: Отправилась цель 'check-out-form-focus-field-customer_email'
      - do: Изменить "Способ доставки" на "Почтой, 500Р"
      - tech: Отправилась цель 'check-out-form-change-field-delivery'
      - do: Поставить фокус в поле 'Адресс дотавки'
      - tech: Отправилась цель 'check-out-form-focus-field-shipping_address'
      - do: Изменить "Способ оплаты" на "Наличными при получении"
      - tech: Отправилась цель 'check-out-form-change-field-payment_method'

    Оформление заказа, Кнопка "Оформить заказ" попала в видимую область:
      - do: Нажать кнопку 'Оформить заказ'
      - do: Пролистать до кнопки  "Оплатить" чтобы она попала в область видимости
      - tech: Отправилась цель 'check-out-form-submit-button-in-viewport'

    Оформление заказа, Сработала валидация:
      - do: Нажать кнопку 'Оформить заказ'
      - do: Нажать на кнопку "Оплатить" оставив поля пустыми чтобы сработала валидация
      - tech: Отправилась цель 'check-out-form-validation-error'

    Оформление заказа, Сработало автозаполнение с Blackbox:
      - do: залогиниться на yandex.ru
      - do: Нажать кнопку 'Оформить заказ'
      - assert: |
          осуществился переход к оформлению заказа
          в форме есть аватарка с именем пользователя
      - tech: Отправилась цель 'check-out-form-load-data-from-storage'

  С флагом, перекладывающим параметры метрики:
    Страница листинга:
      - params:
          exp_flags:
            - analytics-disabled=0
            - metrika-params-in-ym=1
      - do: перейти на https://yandex.ru/turbo?stub=productspage/index.json
      - tech: отправился хит на счетчик метрики 45135375
      - assert: параметр `test_param` лежит внутри __ym

  Прокидывание turbo_uid на внешние сайты:
    При переходе во внешнюю корзину из листинга:
      - do: перейти на https://yandex.ru/turbo?&text=logomebel.ru%2Fyandexturbocatalog%2F
      - do: нажать по кнопке "В корзину" на любом товаре
      - tech: открылась новая вкладка с внешним сайтом и в адресе присутствует параметр &turbo_uid

    При переходе во внешнюю корзину с карточки товара:
      - do: перейти на https://yandex.ru/turbo?text=https%3A%2F%2Flogomebel.ru%2Fstulya-na-metallokarkase%2Fstul-kreslo-sonata-komfort.html
      - do: нажать по кнопке "Добавить в корзину"
      - tech: открылась новая вкладка с внешним сайтом и в адресе присутствует параметр &turbo_uid

    При переходе из меню:
      - do: перейти на https://yandex.ru/turbo?text=https%3A%2F%2Fbetonproject.ru%2Fproducts%2Fks-10-9%3Fvrid%3D6596
      - do: нажать по кнопке бургер-меню в верхнем правом углу
      - do: нажать по первому пункту в появившемся меню
      - tech: открылась новая вкладка с внешним сайтом и в адресе присутствует параметр &turbo_uid

    При переходе из футера и turbo_uid из куки:
      - do: перейти на https://yandex.ru/turbo?text=https%3A%2F%2Fbetonproject.ru%2Fproducts%2Fks-10-9%3Fvrid%3D6596
      - do: нажать по ссылке "Полная версия" в футере страницы
      - tech: открылась новая вкладка с внешним сайтом и в адресе присутствует параметр &turbo_uid

files:
  - features/touch-phone/blocks/metrika/ecommerce.hermione.js

tags:
  - no_assessors
  - e-commerce

v-team: Turbo

manager: tanzwuta

qa-engineer: olga0321

tlds: none
