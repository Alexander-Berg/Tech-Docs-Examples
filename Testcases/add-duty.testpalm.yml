feature: Дежурства

specs:
  Положительные:
    1. Заполнение формы и отмена создания дежурства:
      - do: залогиниться под пользователем robot-internal-003
      - do: открыть страницу настроек дежурств (/services/zanartestservice007/duty/settings/new)
      - do: в поле "Название дежурства" указать "Тестинг"
      - do: в поле "Slug" указать "zanartestservice007"
      - do: в поле "Роль" указать "DevOps"
      - do: в поле "Роль на дежурстве" указать "Дежурный"
      - do: в поле "Одновременно дежурят" указать "2"
      - do: в поле "Начало дежурства" выбрать дату "17 июля 2019"
      - do: в поле "Длительность" указать "4"
      - do: в поле "Автоматически подтверждать смены за" указать "14"
      - do: проставить галочку "Не учитывать другие дежурства"
      - do: убрать галочку "Дежурить по праздникам"
      - do: убрать галочку "Дежурить по выходным"
      - screenshot: заполненная карточка с дежурством [duty-settings]
      - do: нажать "Отмена"
      - assert: произошёл редирект на календарь дежурств сервиса (/services/zanartestservice007/duty)

    2. Создание первого дежурства в сервисе с заполнением только обязательных полей и его последующее удаление:
      - automation: ABC-9971
      - tech: залогиниться под пользователем robot-internal-003
      - do: (PREPARE) открыть сервис "autotest-no-dutys" (/services/autotest-no-dutys-1512/)
      - do: (PREPARE) кликнуть на иконку карандашика рядом с надписью "Управляющие" 
      - screenshot: (PREPARE) карандашик рядом с надписью "Управляющие" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2013-03-35.png]
      - do: (PREPARE) в модалке "Редактирование управляющих" в поле "Добавить сотрудника" ввести свои имя и фамилию 
      - do: (PREPARE) под полем появился выпадающий список вариантов 
      - do: (PREPARE) выбрать в выпадающем списке себя 
      - assert: (PREPARE) в блоке "Управляющие" появился выбранный сотрудник 
      - do: (PREPARE) кликнуть на кнопку "Сохранить"
      - do: открыть график дежурств для сервиса "autotest-no-dutys" (/services/autotest-no-dutys-1512/duty/)
      - assert: на странице есть надпись "Расписание дежурств пока не настроено", пояснение "Создайте роли для дежурных, после чего настройте расписание дежурств для каждой роли" и кнопка "Добавить график дежурств"
      - screenshot: вид графика дежурств без единого дежурства [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2011-32-01.png]
      - do: кликнуть на кнопку "Добавить график дежурств"
      - assert: произошёл переход на страницу "Настройка графика дежурств" (/services/autotest-no-dutys-1512/duty/settings/new)   
      - do: в блоке "Общие" в поле "Название дежурства" указать "Первое дежурство"
      - do: в поле "Slug" указать "test"
      - do: в блоке "Длительность" в поле "Начало дежурства" выбрать сегодняшнюю дату
      - do: кликнуть на кнопку "Создать"
      - assert: |
           произошёл переход на страницу календаря дежурств (/services/autotest-no-dutys-1512/duty/)
           на странице пропала картинка-заглушка, вместо неё показана сетка графика с надписью "График создается" и кнопкой "Обновить страницу"
      - screenshot: создающийся график [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2016-34-05.png]
      - do: подождать около минуты и кликнуть на кнопку "Обновить страницу"
      - assert: страница обновилась, появился график дежурств
      - screenshot: внешний вид графика дежурств [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2011-39-00.png]
      - do: кликнуть на значок шестерёнки рядом с заголовком "Первое дежурство"
      - assert: произошёл переход на страницу "Настройка графика дежурств" (/services/autotest-no-dutys-1512/duty/settings/[id дежурства])
      - do: кликнуть на кнопку "Удалить" внизу страницы с настройками графика дежурств 
      - assert: появилась модалка "Вы уверены, что хотите удалить дежурство?"
      - screenshot: модалка удаления дежурства [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2011-41-55.png]
      - do: кликнуть в модалке на кнопку "Удалить" 
      - assert: |
             произошёл переход на страницу графиков дежурств (/services/autotest-no-dutys-1512/duty/)
             графиков на странице нет
      - screenshot: внешний вид страницы графиков дежурств [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2011-32-01.png]

    3. Создание графика дежурств с автоматическим порядком и его последующее удаление:
      - automation: ABC-10014
      - tech: залогиниться под пользователем robot-internal-003
      - do: (PREPARE) открыть сервис "Тест дежурств (автотесты)" (/services/duty_test/)
      - do: (PREPARE) кликнуть на иконку карандашика рядом с надписью "Управляющие" 
      - screenshot: (PREPARE) карандашик рядом с надписью "Управляющие" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2013-03-35.png]
      - do: (PREPARE) в модалке "Редактирование управляющих" в поле "Добавить сотрудника" ввести свои имя и фамилию 
      - do: (PREPARE) под полем появился выпадающий список вариантов 
      - do: (PREPARE) выбрать в выпадающем списке себя 
      - assert: (PREPARE) в блоке "Управляющие" появился выбранный сотрудник 
      - do: (PREPARE) кликнуть на кнопку "Сохранить"
      - do: открыть график дежурств для сервиса "Тест дежурств (автотесты)" (/services/duty_test/duty/)
      - assert: |
              отображено настроенное расписание,
              отображаются кнопки "Изменение расписания" и "+ Добавить график дежурств" под таб-меню
      - do: нажать на кнопку "+ Добавить график дежурств"
      - assert: произошёл переход на страницу "Настройка графика дежурств" (/services/duty_test/duty/settings/new)
      - do: в блоке "Общие" в поле "Название дежурства" указать "Дежурство"
      - do: в блоке "Общие" в поле "Slug" указать "test"
      - do: в блоке "Общие" в поле "Роль" указать "Консультант"
      - do: в блоке "Общие" в поле "Роль на дежурстве" указать "Дежурный"
      - do: в блоке "Общие" в поле "Одновременно дежурят" указать "1"
      - do: в блоке "Длительность" в поле "Начало дежурства" выбрать дату +10 дней от текущей даты
      - do: в поле "Длительность" указать "4"
      - do: в поле "Автоматически подтверждать смены за" указать "7"
      - do: проставить галочку "Не учитывать другие дежурства"
      - do: снять галочку "Дежурить по праздникам" 
      - do: снять галочку "Дежурить по выходным"
      - do: нажать кнопку "Создать"
      - assert: |
            произошёл переход на страницу календаря дежурств (/services/duty_test/duty),
            внизу страницы появилась сетка графика "Дежурство" с надписью "График создаётся" и кнопкой "Обновить страницу"
      - screenshot: строящийся график "Дежурство" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2016-39-22.png]
      - do: подождать около минуты и кликнуть на кнопку "Обновить страницу"
      - assert: страница обновилась, добавилось новое дежурство с названием "Дежурство"
      - do: кликнуть на значок шестерёнки рядом с заголовком "Дежурство"
      - assert: произошёл переход на страницу "Настройка графика дежурств" (/services/duty_test/duty/settings/[id дежурства])
      - do: кликнуть на кнопку "Удалить" внизу страницы с настройками графика дежурств 
      - assert: появилась модалка "Вы уверены, что хотите удалить дежурство?"
      - screenshot: модалка удаления дежурства [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2011-41-55.png]
      - do: кликнуть в модалке на кнопку "Удалить" 
      - assert: |
             произошёл переход на страницу графиков дежурств (/services/duty_test/duty/)
             графика "Дежурство" на странице среди графиков нет 

    4. Создание графика дежурств с определённым порядком:
      - automation: ABC-10015
      - tech: залогиниться под пользователем robot-internal-003
      - do: (PREPARE) открыть сервис "Тест дежурств 2" (/services/duty_test_2/)
      - do: (PREPARE) кликнуть на иконку карандашика рядом с надписью "Управляющие" 
      - screenshot: (PREPARE) карандашик рядом с надписью "Управляющие" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2013-03-35.png]
      - do: (PREPARE) в модалке "Редактирование управляющих" в поле "Добавить сотрудника" ввести свои имя и фамилию 
      - do: (PREPARE) под полем появился выпадающий список вариантов 
      - do: (PREPARE) выбрать в выпадающем списке себя 
      - assert: (PREPARE) в блоке "Управляющие" появился выбранный сотрудник 
      - do: (PREPARE) кликнуть на кнопку "Сохранить"
      - do: открыть вкладку "График дежурств" в таб меню на странице сервиса "Тест дежурств (автотесты)" (/services/duty_test_2/duty/)
      - assert: |
              отображено настроенное расписание,
              отображаются кнопки "Изменение расписания" и "+ Добавить график дежурств" под таб-меню
      - do: нажать на кнопку "+ Добавить график дежурств"
      - assert: произошёл переход на страницу "Настройка графика дежурств" (/services/duty_test_2/duty/settings/new)
      - do: в поле "Название дежурства" указать "Дежурство2"
      - do: в поле "Код" указать "test2"
      - do: в поле "Роль на дежурстве" указать "Дежурный"
      - do: в поле "Одновременно дежурят" указать "1"
      - do: ставим галочку в чекбокс "Определенный порядок участников"
      - assert: появился тумблер "Дежурят/Не дежурят" и список дежурных
      - screenshot: фрагмент списка дежурных [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2013-42-05.png]
      - do: в поле "Начало дежурства" выбрать дату -7 дней от текущей даты
      - do: снять галочку "Дежурить по праздникам"
      - assert: нет возможности поставить галочку в чекбокс "Не учитывать другие дежурства"
      - do: снять галочку "Показывать как отсутствие на Staff"
      - do: кликнуть на многоточие слева от имени и фамилии любого дежурного в части "Далее по очереди" и перетащить его в блок "Дежурит следующим"
      - assert: |
             дежурный, которого перетаскивали, оказался в блоке "Дежурит следующим"
             дежурный, который был в блоке "Дежурит следующим" стал первым в блоке "Далее по очереди"
      - do: кликнуть на многоточие слева от имени и фамилии любого дежурного в части "Далее по очереди" и поменять его местами с любым дежурным из этого же блока
      - assert: дежурные поменялись местами внутри блока "Далее по очереди"
      - do: нажать кнопку "Создать"
      - assert: |
            произошёл переход на страницу календаря дежурств (/services/duty_test_2/duty),
            внизу страницы появилась сетка графика "Дежурство2" с надписью "График создаётся" и кнопкой "Обновить страницу"
      - screenshot: строящийся график "Дежурство2" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2016-51-21.png]
      - do: подождать около минуты и кликнуть на кнопку "Обновить страницу"
      - assert: страница обновилась, добавилось новое дежурство с названием "Дежурство2"
      - do: (PREPARE) кликнуть на значок шестерёнки рядом с заголовком "Дежурство2"
      - assert: (PREPARE) произошёл переход на страницу "Настройка графика дежурств" (/services/duty_test_2/duty/settings/[id дежурства])
      - do: (PREPARE) кликнуть на кнопку "Удалить" внизу страницы с настройками графика дежурств 
      - assert: (PREPARE) появилась модалка "Вы уверены, что хотите удалить дежурство?"
      - screenshot: (PREPARE) модалка удаления дежурства [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-04-26%2011-41-55.png]
      - do: (PREPARE) кликнуть в модалке на кнопку "Удалить" 
      - assert: (PREPARE) |
             произошёл переход на страницу графиков дежурств (/services/duty_test_2/duty/)
             графика "Дежурство2" на странице среди графиков нет 

  Отрицательные:
    1. Незаполненные поля:
      - do: залогиниться под пользователем robot-internal-003
      - do: открыть страницу настроек дежурств (/services/zanartestservice007/duty/settings/new)
      - do: В поле "Название дежурства" поставить пробел
      - do: нажать "Сохранить"
      - assert: внизу карточки с дежурством появилось сообщение об ошибке
      - screenshot: текст ошибки валидации [duty-settings-error]

files:
  - test/features/desktop/duty/add-duty.hermione.js

priority: blocker

tags:
  - reviewed
