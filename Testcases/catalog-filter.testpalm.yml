feature: Фильтрация каталога сервисов

specs:
  beforeEach:
    - tech: Залогиниться под пользователем robot-internal-003

  Положительные:
    Применение фильтров:
      beforeEach:
        - do: открыть главную страницу тестового ABC (/)

      1. Комбинация фильтров:
        - screenshot: исходное состояние каталога [initial]
        - assert: в URL отсуствуют параметры фильтрации
        - do: в фильтре "Участник" кликнуть на предложенный под полем вариант "robot-internal-003"
        - do: в фильтре "Идеальность" поставить галочку в пункте "С проблемами"
        - screenshot: отображаются только сервисы с проблемами, в которых пользователь является частью команды [filtered]
        - assert: |
            в URL присутствует параметр isSuspicious=true,
            в URL присутствует параметр member=robot-internal-003,
            в URL отсуствуют параметры кроме приведенных выше
        - do: обновить страницу
        - screenshot: фильтрация после перехода по ссылке идентична простановке фильтров через интерфейс [filtered]

      2. Фильтр по названию:
        - assert: в URL отсутствует параметр search=котики
        - do: в поле фильтра "Название" ввести "котики"
        - assert: в URL присутствует параметр search=котики

      3. Фильтр по участнику:
        - assert: в URL отсутствует параметр member=robot-internal-003
        - do: в поле фильтра "Участник" ввести "robot-internal-003"
        - do: выбрать в сажесте "robot-internal-003"
        - assert: в URL присутствует параметр member=robot-internal-003

      4. Фильтр по руководителю:
        - assert: в URL отсутствует параметр owner=robot-internal-003
        - do: в поле фильтра "Руководитель" ввести "robot-internal-003"
        - do: выбрать в сажесте "robot-internal-003"
        - assert: в URL присутствует параметр owner=robot-internal-003

      5. Фильтр по подразделению:
        - assert: в URL отсутствует параметр department=1
        - do: в поле фильтра "Подразделение" ввести "яндекс"
        - do: выбрать в сажесте "Яндекс"
        - assert: в URL присутствует параметр department=1

      6. Фильтр по статусу сервиса:
        - do: в фильтре "Статус сервиса" снять галочку "Развивается"
        - assert: |
            в URL отсутствует параметр states=develop,
            в URL присутствует параметр states=supported,
            в URL отсутствует параметр states=closed,
            в URL присутствует параметр states=needinfo

      7. Фильтр по идеальности:
        - do: в фильтре "Идеальность" установить галочку "Идеальный"
        - assert: |
            в URL присутствует параметр isSuspicious=false,
            в URL отсутствует параметр isSuspicious=true

      8. Фильтр по внешним участникам:
        - do: в фильтре "Внешние участники" установить галочку "С внешними"
        - assert: |
            в URL присутствует параметр hasExternalMembers=true,
            в URL отсутствует параметр hasExternalMembers=false

      9. Фильтр по тегу:
        - assert: в URL отсутствует параметр tags=63
        - do: в поле фильтра "Теги" ввести "GDPR"
        - do: выбрать GDPR в саджесте
        - assert: в URL присутствует параметр tags=63

    Состояния каталога:
      10. Плашка отсутствия результатов поиска:
        - do: открыть главную страницу тестового ABC с фильтрацией по названию "catshug" (/?search=catshug)
        - screenshot: отображается сообщение "Ни один сервис не попадает под выбранные фильтры" [no-results]

    Сохранение фильтров:
      11. Сохранение фильтров:
        - do: открыть главную страницу тестового ABC (/)
        - assert: в URL отсуствует параметр member
        - do: в фильтре "Участник" кликнуть на предложенный под полем вариант "robot-internal-003"
        - do: открыть главную страницу тестового ABC (/)
        - assert: в URL присутствует параметр member=robot-internal-003

    Фильтры над деревом сервисов:
      12. Проставляем и сбрасываем фильтры:
        - automation: ABC-10812
        - do: открыть каталог сервисов АВС с предустановленными фильтрами (/?states=closed&search=автотесты)
        - screenshot: над списком сервисов есть лейблы с выбранными фильтрами (Название - autotest, Статус - Закрыт) и надпись "очистить все фильтры"; в списке показаны сервисы, статус которых - "Закрыт" и в названии которых есть слово "автотесты" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-05-25%2018-21-56.png]
        - do: кликнуть на крестик в лейбле "Название - автотесты"
        - assert: |
               лейбл "Название - автотесты" пропал
               лейбл "Статус - Закрыт" остался, рядом с ним есть надпись "очистить все фильтры"
               в списке показаны только сервисы в статусе "Закрыт"
        - do: кликнуть на все стрелочки рядом с названиями сервисов, чтобы свернуть дерево до верхнеуровневых сервисов
        - screenshot: свёрнутое дерево сервисов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-05-25%2018-26-15.png]
        - do: кликнуть на "очистить все фильтры"
        - assert: в URL параметры "states" и "search" не имееют значений
        - screenshot: над списком сервисов нет лейблов с фильтрами, нет надписи "очистить все фильтры", показаны все верхнеуровневые сервисы [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-05-25%2018-28-42.png]

files:
  - test/features/desktop/catalog/catalog-filter.hermione.js

priority: blocker

tags:
  - reviewed
