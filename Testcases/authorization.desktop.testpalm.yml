feature: Авторизация

import-steps:
    - tests/hermione/suites/desktop/shared-steps/backoffice.testpalm.steps.yml

tlds: ru

specs:

    Авторизация впервые логинится:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с аккаунта, привязанного к организации, но который еще ни разу не проходил процедуру регистрации в организации
        - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/tony-prots/Yandeks.Chaty_2019-06-04_13-40-25.png]
        - assert: открылась админка с модальным окном "Добро пожаловать в кабинет оператора"
        - do: нажать на Пользовательское соглашение
        - assert: в новой вкладке открылась страница https://yandex.ru/legal/dialogues_interface_termsofuse/
        - do: на странице админки нажать вне поля модального окна, чтобы закрыть его
        - assert: окно не закрылось
        - do: ввести любое имя
        - asserT: кнопка "Начать работу" стала кликабельной
        - do: нажать на кнопку
        - assert: модальное окно закрылось
        - do: обновить страницу
        - assert: модальное окно не появилось повторно

    Авторизация не привязан аккаунт:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с аккаунта, не привязанного ни к одной организации
        - assert: высветилась заглушка "Ваш аккаунт не привязан к организации"
        - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/tony-prots/Yandeks.Chaty_2019-06-04_14-08-28.png]

    Редирект с паспорта при смене аккаунта для входа в организацию:
       - automation: YDO-6833
       - tags: smoke
       - do: перейти по ссылке https://passport.yandex.ru/  и залогиниться под аккаунтом не привязанным ни к одной организации (ilon-mask69@yandex.ru / yandextop)
       - do: перейти в админку по ссылке https://yandex.ru/chat/business
       - assert: высветилась заглушка "Ваш аккаунт не привязан к организации"
       - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/sarkhan69/uhura_2019-09-09T16:56:57.910918.jpg]
       - do: нажать "сменить аккаунт"
       - do: зайти в аккаунт, привязанный к организации (rusalochkaariel@yandex.ru / Plutonium238)
       - assert: после залогина автоматически произошел переход в админку

    Авторизация позитивный:
       - automation: YDO-6833
       - do: перейти по ссылке https://passport.yandex.ru/
       - do: залогиниться под акканутом привязанным к организации(usalochkaariel@yandex.ru / Plutonium238)
       - do: перейти в админку по ссылке https://yandex.ru/chat/business
       - assert: вход совершен успешно, не требуется вводить имя и принимать пользовательское соглашение

    Вход в организацию, на которую только что было совершено переключение:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с привязанного к двум организациям аккаунта
        - assert: успешно произошел залогин в одну из организаций (организация 1)
        - do: нажать на шестеренку в левом нижнем углу
        - do: выбрать (кликнуть) ту организацию (организация 2), в которой сейчас не авторизован
        - assert: произошел переход в админку организации 2
        - do: закрыть вкладку с админкой
        - do: перейти в админку по ссылке https://yandex.ru/chat/business
        - assert: открылась админка организации 2

    Авторизация удаленный оператор:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с аккаунта оператора, удаленного из организации
        - assert: высветилась заглушка "Ваш аккаунт не привязан к организации"
        - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/tony-prots/Yandeks.Chaty_2019-06-04_14-08-28.png]

    Авторизация удаленный администратор:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с аккаунта оператора-администратора, удаленного из организации
        - assert: высветилась заглушка "Ваш аккаунт не привязан к организации"
        - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/tony-prots/Yandeks.Chaty_2019-06-04_14-08-28.png]

    Авторизация удален из одной из двух организаций:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с аккаунта оператора, добавленного в две организации, но удаленного из одной из них (орг 1)
        - assert: |
            вход совершен успешно
            отображается админка организации 2
        - do: нажать на иконку настроек в левом нижнем углу экрана
        - assert: в списке организаций не высвечивается орг1

    Авторизация удален из двух организаций:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с аккаунта оператора, удаленного из двух организаций (из всех своих организаций, которых больше 1)
        - assert: высветилась заглушка "Ваш аккаунт не привязан к организации"
        - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/tony-prots/Yandeks.Chaty_2019-06-04_14-08-28.png]

    Авторизация удален из двух, вернули в одну:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с аккаунта оператора (аккаунт 1), удаленного из двух организаций
        - assert: высветилась заглушка "Ваш аккаунт не привязан к организации"
        - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/tony-prots/Yandeks.Chaty_2019-06-04_14-08-28.png]
        - do: с аккаунта со статусом администратора (аккаунт 2) в любой из двух организаций нажать на иконку с двумя человечками внизу слева
        - do: добавить оператора в админку
        - do: с аккаунта оператора (аккаунт 1) перейти в админку по %ССЫЛКА%
        - assert: вход в админку совершен успешно

    Номер телефона не привязан:
        - automation: YDO-6833
        - do: перейти по ссылке https://yandex.ru/chat?build=chamb&guid=7162de39-4140-455f-9c2a-5966b6d4b4b8 в режиме инкогнито
        - assert: открылся диалог с организацией
        - do: написать и отправить произвольное сообщение организации
        - do: перейти в админку по ссылке https://yandex.ru/chat/business с аккаунта оператора, к которому не привязан номер телефона
        - do: перейти в Очередь
        - do: нажать на полученный диалог
        - do: нажать "Принять" в блоке справа
        - assert: в разделе "Диалоги", куда произошел переход, показывается контейнер чата
        - do: отправить сообщение в диалог
        - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/tony-prots/Yandeks.Chaty_2019-06-06_13-28-23.png]
        - assert: высветилась заглушка
        - do: ввести номер телефона
        - do: ввести полученный код
        - do: написать сообщение в диалог
        - assert: сообщение успешно отправилось

    Переход по ссылке организации в нужную организацию:
        - automation: YDO-6833
        - do: перейти в админку по ссылке https://yandex.ru/chat/business (ссылка должна вести на организацию 1) с аккаунта оператора, добавленного в две организации
        - assert: произошел вход в организацию 1
        - do: закрыть вкладку
        - do: в новой вкладке перейти в админку по ссылке https://yandex.ru/chat/business (ссылка должна вести на организацию 2)
        - assert: произошел вход в организацию 2
        - do: закрыть вкладку
        - do: перейти в админку по ссылке https://yandex.ru/chat/business (общая ссылка без уточнения организации)
        - assert: открылась админка организации 2

    Разлогин:
         - automation: YDO-6833
         - tags: smoke
         - do: перейти по сcылке https://passport.yandex.ru
         - do: залогиниться под аккаунтом chattest01 пароль serpserp
         - do: перейти по ссылке https://yandex.ru/chat/business
         - assert: вход произошел успешно, открылась админка
         - do: в левом нижнем углу кликнуть по иконке с изображением шестеренки
         - assert: открылось окно настроек
         - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/zaurkhutinaev/uhura_2019-09-09T17:01:18.720093.jpg]
         - do: кликнуть на кнопку "выйти" в окне настроек
         - assert: переход на главную страницу Яндекса

files: []

v-team: Uslugi

tags:
    - no_assessors
    - skip_manual_check
    - floyd
