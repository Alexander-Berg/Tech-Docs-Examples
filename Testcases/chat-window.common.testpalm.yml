feature: Окно чата

specs:

    beforeEach:
        - do: Перейти по ссылке https://passport.yandex.ru и авторизоваться.
        - assert: Авторизация прошла успешно.
        - do: В соседней вкладке открыть мессенджер.
        - assert: Открывается окно списка чатов.
        - do: В списке чатов открыть любой чат, который соответствует описанию из description.
        - assert: Чат открыт.

    У сообщений пользователя нет аватарок в приватном чате:
        - description: У пользователя есть приватный чат, в истории которого есть собственное сообщение (если такого сообщения нет - отправить собеседнику любое сообщение в чат).
        - do: Ввести в поле ввода текст и нажать на кнопку “Отправить” в чате из description.
        - assert: Текст введен и после набранное сообщение отправляется и отображается в окне чата.
        - do: Проверить, что справа от отправленного сообщения нет аватара.
        - assert: Справа от отправленного сообщения нет аватара.

    У сообщений собеседника нет аватарок в приватном чате:
        - tags: [advanced_smoke]
        - description: У пользователя есть приватный чат, в истории которого есть сообщение от другого пользователя (если такого сообщения нет - отправить другим пользователем любое сообщение в чат).
        - do: Посмотреть в окно чата и проверить, что слева от сообщений собеседника нет аватарок в чате из description.
        - assert: Слева от сообщений другого пользователя аватарок нет.

    У сообщений собеседника есть аватарка в групповом чате:
        - tags: [advanced_smoke, b2b]
        - description: У пользователя есть групповой чат, в истории которого есть сообщение от другого пользователя (если такого сообщения нет - отправить другим пользователем любое сообщение в чат)
        - do: Посмотреть в окно чата из description и проверить, что слева от сообщений собеседника есть аватар пользователя, который отправлял сообщение.
        - assert: Слева от сообщений другого пользователя есть аватар.

    У сообщений пользователя нет аватарки в групповом чате:
        - description: У пользователя в списке чатов есть групповые чаты.
        - do: Ввести в поле ввода текст и нажать на кнопку “Отправить” в чате из description.
        - assert: Текст введен и после набранное сообщение отправляется и отображается в окне чата.
        - do: Проверить, что справа от отправленного сообщения нет аватара.
        - assert: Справа от отправленного сообщения нет аватара.

    Отображается аватарка у собеседника и не отображается у пользователя в чате с оператором Jivosite[manual]:
        - automation:
        - description: |
              У авторизованного (неавторизованного) пользователя А есть чат с оператором JivoSite (с тестовой организацией).
              В чате есть сообщение от тестовой организации.
        - do: Отправить в чат текстовое сообщение.
        - assert: Отображается аватарка у собеседника и не отображается у пользователя.

    Для сообщений, отправленных пользователем, проставляется статус отправки[manual]:
        - automation:
        - description: У авторизованного пользователя есть приватный/групповой чат/чат с оператором JivoSite ( Для неавторизованного пользователя есть чат с оператором JivoSite).
        - do: В поле ввода сообщения ввести несколько символов и нажать кнопку "Отправить" в чате из description.
        - assert: |
              Сообщение успешно отправлено.
              В баллуне этого сообщения появилась одна галочка.

    Переписку можно проскроллить[manual]:
        - automation:
        - description: У авторизованного пользователя есть приватный/групповой чат/чат с оператором JivoSite ( Для неавторизованного пользователя есть чат с оператором JivoSite) с историей более 50 сообщений (если чата с достаточно длинной историей сообщений нет, то необходимо самому заполнить чат сообщениями, в идеале, общаясь с другим человеком или с ботом).
        - do: Попробовать проскроллить чат из description сверху внизу и снизу вверх.
        - assert: Чат проскролливается и видны предыдущие сообщения в чате.

    URL показывается с превью, если с бекенда пришли нужные данные[manual]:
        - automation:
        - description: |
              У авторизованного пользователя есть приватный/групповой чат/чат с оператором JivoSite ( Для неавторизованного пользователя есть чат с оператором JivoSite).
              В буфере обмена есть рабочий URL.
        - do: В поле сообщения вставить ссылку
        - assert: Спустя некоторое время над полем ввода появляется превью вставленной ссылки.
        - do: Отправить ссылку.
        - assert: В окне чата отображается превью ссылки.

    Не скроллит к непрочитанному сообщению которое пришло и мы находились в глубине истории[manual]:
        - tags: [b2b]
        - automation:
        - description: |
              Для прохождения кейса необходимо 2 аккаунта, 2-ым вспомогательным аккаунтом можно авторизоваться в другом браузере/на девайсе.
              Пользователь А - основной аккаунт, Пользователь Б - вспомогательный
              Между пользователями есть приватный (групповой) чат с историей в более 50 сообщений (если чата с достаточно длинной историей сообщений нет, то необходимо самому заполнить чат сообщениями).
        - do: Пользователем А поскроллить историю сообщений в чате из description.
        - assert: История сообщений скроллится.
        - do: Находясь в глубине истории, получить сообщение от пользователя Б.
        - assert: |
              Пользователь А получил сообщение от пользователя Б.
              Автоматического скролла к новому сообщению не происходит, позиция в истории чата сохранилась.

    Не пропадает аватарка и имя собеседника после технических сообщений в групповом чате[manual]:
        - automation:
        - description: |
              Для прохождения кейса необходимо 2 аккаунта, 2-ым вспомогательным аккаунтом можно авторизоваться в друом браузере/на девайсе.
              У авторизованного пользователя А есть групповой чат, в котором он являетесь администратором.
              У пользователя А в списке контактов есть Пользователь Б.
        - do: Пользователем А тапнуть/кликнуть ЛКМ на шапку чата в из description.
        - assert: Открылась карточка чата.
        - do: Нажать на "Участники"
        - assert: Открывается экран учатников
        - do: Нажать кнопку "Добавить".
        - assert: Открылось окно добавления участников.
        - do: Найти пользователя Б и тапнуть/кликнуть ЛКМ на него и нажать кнопку "Добавить"
        - assert: Пользователь Б был добавлен в чат
        - do: Открыть окно группового чата из description
        - assert: |
              Открылось окно группового чата.
              Видим следующее техническое сообщение - "Пользователь А добавил(а) пользователя Б".
        - do: Пользователем Б отправить сообщение в чат, в который его только что добавили.
        - assert: Сообщение отправлено и отображается в окне чата.
        - do: Пользоватеелм А проверить, что слева от сообщений пользователя Б есть его аватар.
        - assert: Слева от сообщения пользователя Б есть аватар.

    Для сообщений, отправленных пользователем, проставляется статус доставки, если собеседник их прочел[manual]:
        - automation:
        - description: |
              Для прохождения кейса необходимо 2 аккаунта, 2-ым вспомогательным аккаунтом можно авторизоваться в другом браузере/на девайсе.
              У авторизованного пользователя А есть приватный/групповой чат/чат с оператором JivoSite ( Для неавторизованного пользователя есть чат с оператором JivoSite), собеседником которого является пользователь Б, авторизованный на вспомогательном аккаунте.
        - do: Пользователем А в поле ввода сообщения ввести несколько символов и нажать кнопку “Отправить” в чате из description.
        - assert: |
              Сообщение успешно отправлено.
              В баллуне сообщения отображается одна галочка(так как сообщение не было прочитано)
        - do: Пользователем Б открыть чат с сообщением из предыдущего пункта от пользователя А.
        - assert: Сообщение получено.
        - do: Пользователем А проверить наличие двух галочек в баллуне сообщения.
        - assert: В баллуне сообщения пользователю Б отображаются две галочки (так как сообщение было прочитано).

    После обновления страницыы мессенджера история сообщений сохраняется[manual]:
        - tags: [b2b]
        - automation:
        - description: |
              Для прохождения кейса необходимо 2 аккаунта, 2-ым вспомогательным аккаунтом можно авторизоваться в другом браузере/на девайсе.
              У авторизованного пользователя А есть приватный / групповой чат, собеседником которого является пользователь Б, авторизованный на вспомогательном аккаунте.
        - do: Пользователем А в поле ввода сообщения ввести несколько символов и нажать кнопку “Отправить” в чате из description.
        - assert: Сообщение успешно отправлено
        - do: Пользователем Б открыть чат с сообщением из предыдущего пункта от пользователя А
        - assert: |
              Открыто окно чата
              Над полученным сообщением отображается иконка и имя отправителя
              Список истории сообщений проскроллен до низа
        - do: Открыть любой другой чат и затем отркыть чат из description
        - assert: История чата осталась прежней
        - do: Обновить страницу мессенджера
        - assert: |
              Страница была обновлена
              Открыто окно чата из description
              История ччата осталась прежней

    Получение сообщений в групповом чате[manual]:
        - automation:
        - description: |
              Для прохождения кейса необходимо 2 аккаунта, 2-ым вспомогательным аккаунтом можно авторизоваться в другом браузере/на девайсе.
              У авторизованного пользователя А есть групповой чат, собеседником которого является пользователь Б, авторизованный на вспомогательном аккаунте.
        - do: Пользователем А в поле ввода сообщения ввести несколько символов и нажать кнопку “Отправить” в чате из description.
        - assert: Сообщение успешно отправлено
        - do: Пользователем Б открыть чат с сообщением из предыдущего пункта от пользователя А
        - assert: |
              Открыто окно чата
              Над полученным сообщением отображается иконка и имя отправителя
              Список истории сообщений проскроллен до низа

    Получение сообщений в приватном чате[manual]:
        - automation:
        - description: |
              Для прохождения кейса необходимо 2 аккаунта, 2-ым вспомогательным аккаунтом можно авторизоваться в другом браузере/на девайсе.
              У авторизованного пользователя А есть приватный чат с пользоватлем Б
        - do: Пользователем А в поле ввода сообщения ввести несколько символов и нажать кнопку “Отправить” в чате из description.
        - assert: Сообщение успешно отправлено
        - do: Пользователем Б открыть чат с сообщением из предыдущего пункта от пользователя А
        - assert: |
              Открыто окно чата
              Над полученным сообщением отображается иконка и имя отправителя
              Список истории сообщений проскроллен до низа

    При тапе по превью URL открывается в браузере[manual]:
        - automation:
        - description: |
              У авторизованного пользователя есть приватный/групповой чат/чат с оператором JivoSite (Для неавторизованного пользователя есть чат с оператором JivoSite).
              В буфере обмена есть рабочий URL.
        - do: В поле сообщения вставить ссылку.
        - assert: В сообщении с ссылкой отображается превью спустя некоторое время.
        - do: Отправить сообщение.
        - assert: Сообщение отправлено
        - do: Тапнуть/Кликнуть ЛКМ по ссылке.
        - assert: Ссылка открывается Браузере.

    У сообщений пользователя отображается время отправки[manual]:
        - tags: [advanced_smoke, b2b]
        - automation:
        - description: |
              Время на телефоне/компьютере соответствует всемирному координируемому времени UTC (неважно, какой часовой пояс включен).
              У авторизованного пользователя есть приватный/групповой чат/чат с оператором JivoSite ( Для неавторизованного пользователя есть чат с оператором JivoSite)
        - do: В поле ввода сообщения ввести несколько символов и нажать кнопку “Отправить”.
        - assert: Сообщение успешно отправилось.
        - do: Посмотреть на время отправки (справа от галочки "отправлено").
        - assert: Дата отправки должна должна совпадать и соответствовать дате, выставленной на вашем устройстве.
        - do: Посмотреть на время отправки сообщения в списке чатов (справа от заголовка чата).
        - assert: Дата отправки должна должна совпадать и соответствовать дате, выставленной на вашем устройстве.

    При изменении часового пояса в настройках телефона/компьютера, время отправки новых сообщений соответствует новому часовому поясу[manual]:
        - automation:
        - description: |
              Время телефона соответствует всемирному координируемому времени UTC (неважно, какой часовой пояс включен).
              У авторизованного пользователя есть приватный/групповой чат/чат с оператором JivoSite ( Для неавторизованного пользователя есть чат с оператором JivoSite)
              Часовой пояс в настройках телефона/компьютера должен быть изменён (например, выбран Гонконг UTC+8).
        - do: В поле ввода ввести несколько символов и нажать кнопку "Отправить".
        - assert: Сообщение успешно отправлено.
        - do: Посмотреть на время отправленного сообщения.
        - assert: Время отправленного сообщения совпадает со временем, выставленном на телефоне/компьютере.

    В окне приватного чата отображается закрепленная дата[manual]:
        - automation:
        - description: |
              У авторизованного пользователя в списке чатов есть приватный чат с историей сообщений в несколько экранов
              История сообщений в чате в несколько дней
        - do: Начать скроллить историю чата
        - assert: В окне чата, в верху под шапкой чата, появилась закрепленная дата
        - do: Остановить скролл
        - assert: Через некоторое время закрепленная дата пропадает из окна чата

    В окне группового чата отображается закрепленная дата[manual]:
        - automation:
        - description: |
              У авторизованного пользователя в списке чатов есть групповой чат с историей сообщений в несколько экранов
              История сообщений в чате в несколько дней
        - do: Начать скроллить историю чата
        - assert: В окне чата, в верху под шапкой чата, появилась закрепленная дата
        - do: Остановить скролл
        - assert: Через некоторое время закрепленная дата пропадает из окна чата

    В окне канала отображается закрепленная дата[manual]:
        - automation:
        - description: |
              У авторизованного пользователя в списке чатов есть канал с историей сообщений в несколько экранов
              История сообщений в чате в несколько дней
        - do: Начать скроллить историю чата
        - assert: В окне чата, в верху под шапкой чата, появилась закрепленная дата
        - do: Остановить скролл
        - assert: Через некоторое время закрепленная дата пропадает из окна чата

    При скролле истории чата закрепленнаая дата меняется в зависимости от истории отпарвки сообщений[manual]:
        - tags: [b2b]
        - automation:
        - description: |
              У авторизованного пользователя в списке чатов есть приватный / групповой чат с историей сообщений в несколько экранов
              История сообщений в чате в несколько дней
        - do: Начать скроллить историю чата
        - assert: В окне чата, в верху под шапкой чата, появилась закрепленная дата
        - do: Остановить скролл
        - assert: Через некоторое время закрепленная дата пропадает из окна чата
        - do: Начать скролл истории чата, доскроллив до новой даты сообщений в окне чата
        - assert: В момент скролла истории и переход на новый день в окне чата сменилась закреплення дата

files:
    - tests/hermione/suites/messenger/chat-window/chat-window.common.hermione.ts

v-team: Chat

tlds: ru

tags:
    - yamb
    - y-team
