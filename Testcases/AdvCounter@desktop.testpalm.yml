feature: Счётчики учёта видимости рекламы

specs:
  premium:
    - do: получить выдачу по запросу 'пластиковые окна'
    - tech: в первом сниппете в первом блоке serp-adv__counter правильная yabs/count ссылка учёта видимости

  premium в распиле:
    - params:
        exp_flags:
          - init_meta=need_stream_pre_main_on_main_grouping=1,enable_inter_search=1,pre_main_report_doc_count=2
          - velocity_serplist_delimiter=1
    - do: получить выдачу по запросу 'купить квартиру в москве'
    - assert: на выдаче присутствуют 4 premium размещения
    - tech: в первом сниппете залогирован показ первых двух premium размещений
    - tech: в третьем сниппете залогирован показ остальных двух premium размещений

  halfpremium:
    Базовые проверки:
      - params:
          foreverdata: '1447433776'
      - do: получить выдачу по запросу 'foreverdata'
      - tech: во время загрузки страницы не был совершен запрос yabs-ссылки видимости halfpremium рекламы
      - do: доскроллить до зеркала первого спец.размещения
      - tech: все еще не совершен запрос yabs-ссылки видимости halfpremium рекламы
      - do: доскроллить до halfpremium спец.размещения, не являющегося зеркалом первого спец.размещения
      - tech: произошел отдельный запрос yabs-ссылки видимости halfpremium рекламы (без link_tail зеркала первого спец.размещения)
    Первая страница:
      Дёргается на загрузку:
        - do: получить выдачу по запросу 'пластиковые окна'
        - tech: проверить в Network, что счётчик сработал при начальной загрузке
        - tech: проверить, что в атрибуте data-vnl передаются верные ссылки на yabs счётчики
      Дёргается при скролле:
        - do: получить выдачу по запросу 'пластиковые окна'
        - tech: проверить в Network, что счётчик не сработал при начальной загрузке
        - do: доскроллить до сниппета над халфпремиумом
        - tech: проверить в Network, что счётчик не сработал
        - do: доскроллить до верхнего сниппета в халфпремиуме
        - tech: проверить в Network, что счётчик сработал
        - tech: проверить, что в атрибуте data-vnl передаются верные ссылки на yabs счётчики
      Проверить счётчики после аякс-перезапроса:
        - tags:
            - no_assessors
        - do: получить выдачу по запросу 'пластиковые окна'
        - do: кликнуть по кнопке 'Найти'
        - tech: проверить, что в атрибуте data-vnl передаются верные ссылки на yabs счётчики
        - do: доскроллить до верхнего сниппета в халфпремиуме
        - tech: проверить в Network, что старый счётчик не сработал
        - tech: проверить в Network, что сработал счётчик халф-премиума с этой страницы
    Вторая страница:
      Дёргается на загрузку:
        - do: получить выдачу по запросу 'пластиковые окна' на второй странице
        - tech: проверить в Network, что счётчик сработал при начальной загрузке
        - tech: проверить, что в атрибуте data-vnl передаются верные ссылки на yabs счётчики
      Дёргается при скролле:
        - do: получить выдачу по запросу 'пластиковые окна' на второй странице
        - tech: проверить в Network, что счётчик не сработал при начальной загрузке
        - do: доскроллить до верхнего сниппета в халфпремиуме
        - tech: проверить в Network, что счётчик сработал
        - tech: проверить, что в атрибуте data-vnl передаются верные ссылки на yabs счётчики

files:
  - src/features/AdvCounter/AdvCounter.test/AdvCounter@desktop.hermione.js

tags:
  - adv
  - counters
  - no_assessors
  - skip_e2e_check

v-team: Distribution

tlds: all
