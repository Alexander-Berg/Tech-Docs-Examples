feature: График дежурств

specs:
  beforeEach:
    - do: (PREPARE) запустить в Runner сценарий "scenario создание графика дежурства, его редактирование и удаление" (https://github.yandex-team.ru/pixel/abc-runner)

  Создание графика дежурства с работой по праздникам и выходным:
    - do: отправить запрос "Дежурство и в праздники, и в выходные" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201"
    - screenshot: ответ на запрос должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2021-12-23.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удаление дежурства" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201" и без тела
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Создание графика только с обязательными полями, его редактирование и удаление:
    - do: отправить запрос "api/v4/duty/schedules/. Только обязательные поля" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201"
    - screenshot: ответ на запрос "api/v4/duty/schedules/. Только обязательные поля" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2021-15-22.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "api/v4/history/ для создания графика дежурств" с токеном "robot-cat-leopold" 
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-15%2020-05-07.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Изменение дежурства - нельзя менять некоторые поля" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "400"
    - screenshot: ответ на запрос "Изменение дежурства - нельзя менять некоторые поля" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2021-16-10.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Изменение дежурства" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Изменение дежурства" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2021-16-57.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "api/v4/history/ для изменения графика дежурств" с токеном "robot-cat-leopold" 
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-15%2020-06-47.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удаление дежурства" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "204" и без тела 
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "api/v4/history/ для удаления графика дежурств" с токеном "robot-cat-leopold" 
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-15%2020-08-08.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Создание графика с ручным порядком:  
    - do: отправить запрос "api/v4/duty/schedules/. С ручным порядком" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201"
    - screenshot: ответ на запрос "api/v4/duty/schedules/. С ручным порядком" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2021-18-41.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удаление дежурства с ручным порядком" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "204" и без тела
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Создание графика с заполненным полем "Описание":
    - do: отправить запрос "api/v4/duty/schedules/. Поле "Описание"" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201"
    - screenshot: ответ на запрос "api/v4/duty/schedules/. Поле "Описание"" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2021-19-17.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удаление дежурства с описанием" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "204" и без тела
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Валидация создания дежурств с ручным порядком:
    - do: отправить запрос "Нельзя создать дежурство с ручным порядком, не указав список дежурных" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "400"
    - screenshot: ответ на запрос "Нельзя создать дежурство с ручным порядком, не указав список дежурных" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2021-20-17.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Нельзя изменить порядок дежурства с автоматического на ручной, не указав список дежурных" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "400"
    - screenshot: ответ на запрос "Нельзя изменить порядок дежурства с автоматического на ручной, не указав список дежурных" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2021-21-07.png]
    - do: кликнуть по табе "Test Results" в "Response" части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS

priority: blocker

files:
  - tests/unit/duty/api/test_schedule.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:abc:src/features/Duty/**
  - fitcher:plan:tests/unit/duty/api/test_schedule.py
