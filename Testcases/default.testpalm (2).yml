feature: Страница новостей

specs:
  aliases:
    - &StartCase
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок сниппета с названием 'Тестовая новостная станица — турбо'
      - assert: в новой вкладке открылась турбо страница с ракеткой в правом углу

  beforeEach:
    - do: при дальнейшей проверке указанных ожидаемых результатов обращайте внимание на любые некорректные на ваш взгляд поведения, основываясь на свой опыт использования web-приложений (например, сохранение позиции при переходах туда-обратно кнопками на устройстве, пустые экраны при переходах, кривая верстка, скачкИ элементов, плавность скролла, неработающая функциональность и т.п.)

  Загрузка страницы:
    - browsers:
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
    - params:
        foreverdata: '2310953522'
    - *StartCase
    - assert: загрузилась страница [https://jing.yandex-team.ru/files/olga0321/EVS_rassmotrit_vopros_o_narushenii_pravil_Evrovideniya_v_Kieve_posle_zaversheniya_konkursa_2018-08-28_10-53-18.png]

  Ссылка в тексте:
    - browsers:
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
    - params:
        foreverdata: '2310953522'
    - *StartCase
    - do: найти текстовый блок на странице
    - assert: на странице есть текстовый контент
    - tech: должен сработать серверный сечтчик на ссылку (/turbo/link)
    - assert: проверить работоспособность ссылки в тексте
    - tech: проверить клиентский счетчик в ссылке в тексте (/turbo/link)

  Ссылка на источник в шапке:
    - browsers:
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
    - params:
        foreverdata: '2310953522'
    - *StartCase
    - tech: должен сработать серверный счетчик (/turbo/header/link)
    - do: тапнуть на иконку или название источника в шапке в верхнем левом углу страницы
    - tech: должен сработать клиентский счетчик (/turbo/header/link)
    - assert: в новой вкладке открылся оригинальная версия статьи

  Кнопка перехода на источник:
    - browsers:
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
    - params:
        foreverdata: '2310953522'
    - *StartCase
    - tech: должен сработать серверный счетчик (/turbo/reference/button)
    - do: тапнуть по кнопке в конце статьи "Читать на "
    - tech: должен сработать клиентский счетчик (/turbo/reference/button)
    - assert: в новой вкладке открылся оригинальная версия статьи

  Страница должна содержать кастомный тайтл у статей:
    - tags: no_assessors
    - do: открыть не в ПП страницу '?text=sbp884d3ebc01a1bcf14a18df8eccc00acee1748997'
    - assert: проверить, что страница имеет тайтл 'Google (компания)'

  Страница должна содержать стандартный тайтл у статей:
    - tags: no_assessors
    - do: открыть в ПП страницу '?text=sbpdcb64180abcb385fee925f394a51f5e384325c59'
    - assert: проверить, что страница имеет тайтл 'Турбо-страница'

  Блок видео [manual]:
    - browsers:
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
    - automation: TURBO-699
    - params:
        foreverdata: '2310953522'
    - do: тестировать только на реальном девайсе, а не в Колхозе
    - *StartCase
    - do: найти на странице блок "Видео"
    - do: запустить проигрывание видео
    - assert: видео начнет воспроизводится
    - do: перемотать видео
    - assert: видео перемоталось
    - do: развернуть на весь экран при помощи нажатия на кнопку (на ios утройствах видео сразу открывается во весь экран,данную проверку не фейлить)
    - assert: видео развернулось на весь экран
    - do: остановить воспроизвдение видео
    - assert: воспроизведение приостановлено

  Блок рекламы [manual]:
    - browsers:
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
    - automation: TURBO-699
    - params:
        foreverdata: '2310953522'
    - *StartCase
    - do: найти рекламный баннер на странице (в начале под картинкой c текстовым заголоком)
    - assert: |
        рекламный баннер пристутсвует на странице
        реклама отображается корректно (вмещается в ширину экрана, не наезжает на текст и т.д.), анимация (если есть) не тормозит
    - do: кликнуть по рекламному баннеру
    - assert: в новой вкладке открылась рекламируемый сайт

  Должен менять домен в адресной строке при загрузке турбо-страницы:
    - browsers: android-yandex-browser-17-touch
    - params:
        foreverdata: '189351762'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета
    - assert: открылся оверлей с турбо-страницей
    - assert: в адресной строке отображается домен 'ru.wikipedia.org'

  Не должен менять домен в адресной строке, если страница открывается для превью (serp-preview=1):
    - browsers: android-yandex-browser-17-touch
    - do: перейти по адресу 'https://yandex.ru/turbo?yabro-override-domain-api=1&text=https%3A%2F%2Fru.wikipedia.org%2Fwiki%2FBMW&serp-preview=1'
    - assert: открылась турбо-страница
    - assert: в адресной строке отображается домен 'yandex.ru'

  Домен не меняется в адресной строке при передаче флага yabro-override-domain-disable:
    - tags: no_assessors
    - browsers: android-yandex-browser-17-touch
    - params:
        foreverdata: '189351762'
        exp_flags:
          - yabro-override-domain-disable=1
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета
    - assert: открылся оверлей с турбо-страницей
    - assert: в адресной строке отображается домен 'yandex.ru'

  Должен сохранять правило подмены домена в адресной строке при загрузке турбо-страницы:
    - browsers:
        - searchapp
        - android-pp-4.99-touch
        - android-pp-7-touch
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
    - params:
        foreverdata: '189351762'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета
    - assert: в Яндекс Браузере открылся оверлей с турбо-страницей (в остальных браузерах открывается новая вкладка)
    - assert: в адресной строке отображается домен 'ru.wikipedia.org'

  Не должен сохранять правило подмены домена в адресной строке при передаче флага yabro-override-domain-disable:
    - tags: no_assessors
    - params:
        foreverdata: '189351762'
        exp_flags:
          - yabro-override-domain-disable=1
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета
    - assert: открылся оверлей с турбо-страницей
    - assert: в адресной строке отображается домен 'yandex.ru'
    - tech: страница не содержит клиентских ошибок

  Нет клиентских ошибок если не доступно yaBro api overrideTabHost:
    - browsers:
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
    - params:
        foreverdata: '189351762'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета
    - assert: открылся оверлей с турбо-страницей
    - tech: страница не содержит клиентских ошибок

  Подменяет displayUrl на значение из turbopages_url:
    - automation: TURBOUI-3528
    - browsers:
        - android-yandex-browser-17-touch
        - ios-yandex-browser-17-touch
    - do: получить выдачу по запросу 'рецепт борща'
    - do: кликнуть по сниппету с турбо-страницей
    - assert: |
        открылся оверлей с турбо-страницей
        iframe ведет на yandex.ru/turbo
        в омнибоксе отображается хост источника
    - do: кликнуть в омнибокс
    - assert: отображается URL, ведущий на turbopages.org

  Отправляет postMessage с правилом подмены домена:
    - browsers:
        - android-yandex-browser-17-touch
        - ios-yandex-browser-17-touch
    - tags: no_assessors
    - params:
        test-id: '223259'
    - do: |
        залипнуть в 'test-id' на серпе
        перейти по адресу 'https://yandex.ru/search/touch/?text=%D0%BB%D0%B5%D0%BD%D1%82%D0%B0%20%D1%80%D1%83&lr=213'
        открыть любую страницу в оверлее
    - assert: открылся оверлей
    - tech: |
        отправился post-message с параметрами
        action — override-host
        displayHost — название хоста, который был открыт
        displayUrl — абсолютный адрес страницы, ведущий на turbopages.org
        cleanUrl — относительный адрес страницы

files:
  - features/pages/default/default.hermione.js

v-team: Turbo

manager: tanzwuta

qa-engineer: kleev, k0nratka

tlds: none
