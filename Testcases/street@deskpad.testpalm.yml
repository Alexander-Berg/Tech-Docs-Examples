feature: Колдунщик топонимов
type: Улица

params:
  rearr: EntitySearch_off
  # колдунщик топонимов отключен на стороне данных, этот флаг возвращает колдун
  srcparams: 'UPPER:rearr=scheme_Local/ToponymWizard/Enabled=1'

specs-integration:
  Наличие колдунщика:
    # TODO изменен запрос https://st.yandex-team.ru/SERP-63841
    - do: получить выдачу по запросу 'улица академика королёва на карте'
    - assert: на выдаче есть колдунщик
    - counter: /$page/$main/$result[@wizard_name="maps" and @subtype="text"]/route-form

specs:
  aliases:
    - &CheckMetrics
      - assertMetrics:
          - feature.web.wizards_common.maps_wizard.total.shows
          - feature.web.wizards_common.maps_wizard.total.external_clicks
          - feature.web.wizards_common.maps_wizard.total.dynamic_clicks
          - web.total_request_results_clicks
          - web.total_request_results_ext_clicks
          - web.total_request_results_dyn_clicks
          - web.total_request_results_main_column_clicks
          - web.total_request_results_main_column_ext_clicks
          - web.total_request_results_main_column_dyn_clicks
          - web.total_request_results_parallel_column_clicks
          - web.total_request_results_parallel_column_ext_clicks
          - web.total_request_results_parallel_column_dyn_clicks
          - web.tech_part_misc_click
          - web.total_request_count
          - daily.total_session_count
  beforeEach:
    - do: получить выдачу по запросу 'улица академика королёва'
  Проверить внешний вид, общие ссылки и счётчики колдунщика топонимов:
    - tags:
        - title
        - greenurl
        - maps
    - screenshot: на странице появляется колдунщик топонимов, его внешний вид [plain]
    - do: кликнуть на тайтл
    - assert: открылась новая вкладка с сервисом Яндекс.Карты, где проставлен поинт на улице из запроса
    - *CheckMetrics
  Должна отправляться форма со значением 'Откуда' из геолокации и типом маршурта 'На машине':
    - tags:
        - location
        - maps
        - route
        - input
        - suggest
    - do: кликнуть по кнопке геолокации в поле 'Откуда' под картой
    - assert: в поле 'Откуда' подставилось текущее местоположение
    - do: выбрать тип маршрута 'На машине' и нажать кнопку 'Проложить маршрут'
    - assert: |
        в открывшейся странице на карте начальная точка маршрута - текущее местоположение,
        в поле 'Откуда' прописано текущее местоположение,
        в блоке 'Маршруты' выбрано 'На машине',
  Должна отправляться форма со значением 'Куда', заданным вручную, и пустым полем 'Откуда':
    - tags:
        - maps
        - route
        - input
        - suggest
    - do: кликнуть на крестик в поле 'Куда'
    - assert: поле 'Куда' очистилось
    - do: указать адрес назначания в поле 'Куда', отличный от предустановленного и отправить форму
    - assert: |
        в открывшейся странице на карте конечная точка маршрута - выбранный адрес,
        в поле 'Куда' прописан выбранный адрес,
        в блоке 'Маршруты' выбрано 'Транспортом',
  Должна отправляться форма с типом маршурта 'На машине':
    - tags:
        - maps
        - route
        - input
    - do: кликнуть на крестик в поле 'Куда'
    - assert: поле 'Куда' очистилось
    - do: выбрать тип транспорта 'На машине'
    - do: кликнуть 'Проложить маршрут'
    - assert: в открывшейся странице в блоке 'Маршруты' выбрано 'На машине'

files:
  - features/adapter-maps/street@deskpad.hermione.js
  - features/adapter-maps/street@deskpad.hermione.e2e.js

tlds: all

v-team: VanillaGeo

regions:
  ru: 213
  by: 157
  kz: 163
  ua: 143

requests:
  ru: улица академика королёва

counter: /$page/$main/$result[@wizard_name="maps" and @subtype="text"]/route-form

tags:
  - reviewed
  - hasE2E
