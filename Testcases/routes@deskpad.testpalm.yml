feature: Колдунщик маршрутов

params:
  rearr: EntitySearch_off
  # колдунщик топонимов отключен на стороне данных, этот флаг возвращает колдун
  srcparams: 'UPPER:rearr=scheme_Local/ToponymWizard/Enabled=1'

specs-integration:
  Проверка наличия элементов:
    - do: получить выдачу по запросу 'построить маршрут'
    - assert: |
        появился колдунщик маршрутов,
        в колдунщике есть тайл,
        в колдунщике есть инпут 'Откуда' с кнопкой геолокации,
        в колдунщике есть инпут 'Куда' с кнопкой геолокации,
        в колдунщике есть переключатель типа транспорта,
        в колдунщике есть кнопка 'Проложить маршрут'

specs:
  aliases:
    - &CheckMetrics
      - assertMetrics:
          - feature.web.wizards_common.maps_wizard.total.shows
          - feature.web.wizards_common.maps_wizard.total.external_clicks
          - feature.web.wizards_common.maps_wizard.total.dynamic_clicks
          - web.total_request_results_clicks
          - web.total_request_results_ext_clicks
          - web.total_request_results_dyn_clicks
          - web.total_request_results_main_column_clicks
          - web.total_request_results_main_column_ext_clicks
          - web.total_request_results_main_column_dyn_clicks
          - web.total_request_results_parallel_column_clicks
          - web.total_request_results_parallel_column_ext_clicks
          - web.total_request_results_parallel_column_dyn_clicks
          - web.tech_part_misc_click
          - web.total_request_count
          - daily.total_session_count
  Внешний вид и основные проверки:
    beforeEach:
      - do: получить выдачу по запросу 'как добраться'
    Тайтл из данных репорта:
      - screenshot: на странице присутствует колдунщик маршрутов, его внешний вид [reportTitle]
    Проверить внешний вид, общие ссылки и счётчики колдунщика топонимов:
      - tags:
          - title
      - screenshot: на странице присутствует колдунщик маршрутов, его внешний вид [plain]
      - do: перейти по тайтлу колдунщика
      - assert: произошёл переход на страницу Яндекс.Карт с открытой формой построения маршрута
      - *CheckMetrics
    Проверка ввода и сабмита:
      - tags:
          - input
          - suggest
          - location
          - radiobutton
          - button
          - route
      - do: ввести 'КуТ' в поле 'Откуда' для появления саджеста
      - screenshot: появился саджест, его пример внешнего вида [suggest]
      - do: выбрать первый элемент в списке
      - assert: в поле 'откуда' вместо 'КуТ' указан адрес из выбранного саджеста
      - do: нажать на определитель геолокации в поле 'Куда'
      - assert: в поле 'Куда' отобразился адрес местонахождения пользователя
      - do: нажать на тип маршрута - На машине
      - assert: кнопка 'На машине' стала белой
      - do: нажать на кнопку 'Проложить маршрут'
      - assert: |
          в новой вкладке открылись Яндекс.Карты, в форме 'Маршрут' значения совпадают с ранее введенными,
          указан тип транспорта - на машине,
    Проверка при пустых полях:
      - tags:
          - radiobutton
          - button
          - route
      - do: при пустых полях 'Откуда' и 'Куда' переключиться с 'На транспорте' на 'На машине'
      - assert: настройка 'На машине' переключилась в белое положение
      - do: при пустых полях 'Откуда' и 'Куда' нажать на кнопку 'Проложить маршрут'
      - assert: |
          в новой вкладке открылись Яндекс.Карты с открытой пустой формой построения маршрута,
          Способ передвижения указан 'На транспорте',
          На карте отобразился город, в котором находится пользователь,
    Проверка при пустом поле Куда:
      - tags:
          - input
          - button
          - route
      - do: заполнить поле 'Откуда' значением Санкт-Петербург, поле 'Куда' оставить пустым, после чего нажать кнопку 'Проложить маршрут'
      - assert: |
          в новой вкладке открылись Яндекс.Карты с пустым полем 'Куда' и значением Санкт-Петербург в поле 'Откуда',
          К курсору прилеплен пин с точкой B (Куда),
          На карте отобразился пин с точкой А (Откуда) на городе Санкт-Петербург (возможно, придется уменьшить масштаб, чтобы увидеть пин)
    Проверка при пустом поле Откуда:
      - tags:
          - input
          - button
          - route
      - do: заполнить поле 'Куда' значением Казахстан, поле 'Откуда' оставить пустым, после чего нажать кнопку 'Проложить маршрут'
      - assert: в новой вкладке открылись Яндекс.Карты с пустым полем 'Откуда' и значением Казахстан в поле 'Куда'
    Проверка при дальних точках маршрута:
      - tags:
          - input
          - suggest
          - button
          - route
      - do: заполнить поля 'Откуда' значением Санкт-Петербург, а 'Куда' - Київ
      - assert: при заполнении появляется саджест с соответствующими вариантами
      - do: переключиться с 'На транспорте' на 'На машине'
      - assert: настройка 'На машине' переключилась в белое положение
      - do: нажать на кнопку 'Проложить маршрут'
      - assert: |
          в новой вкладке открылись Яндекс.Карты с заполненной формой, построенным маршрутом и его вариантами,
          Способ передвижения указан 'На машине',
    Проверка при близких точках маршрута с использованием номеров:
      - tags:
          - input
          - suggest
          - button
          - route
      - do: заполнить поле 'Откуда' значением 14-ый переулок
      - assert: появился саджест с 14-ым переулком в селе Иртыш
      - do: заполнить поле 'Куда' значением 15-ый переулок
      - assert: появился саджест с 15-ым переулком в селе Иртыш
      - do: нажать на кнопку 'Проложить маршрут'
      - assert: |
          в новой вкладке открылись Яндекс.Карты с заполненной формой построения маршрута,
          Присутствует построенный маршрут
    # Проверка отсутствия бага SERP-68082
    Проверка отправка формы в новом табе несколько раз:
      - do: нажать на кнопку 'Проложить маршрут'
      - assert: открылся новый таб с сервисом Яндекс.Карты
      - do: вернуться на выдачу с колдунщиком
      - do: нажать на кнопку 'Проложить маршрут'
      - assert: открылся ещё один таб с сервисом Яндекс.Карты
    a11y:
      - tags: no_assessors
      - assert: у переключателя типа маршрута должен быть атрибут aria-label
      - assert: у переключателя типа маршрута должна быть роль radiogroup
  Заполнение полей текстом из запроса "от до как добраться":
    beforeEach:
      - do: получить выдачу по запросу 'москва северодвинск как добраться'
      - assert: на странице присутствует колдунщик маршрута
    Внешний вид колдунщика с заполненными полями:
      - screenshot: внешний вид колдунщика с заполненными полями ОТ и ДО [filled-inputs-view]
    Текст из поля ОТ:
      - do: получить текст поля ОТ
      - assert: текст из поля ОТ соответствует строке "москва"
    Текст из поля ДО:
      - do: получить текст поля ДО
      - assert: текст из поля ДО соответствует строке "северодвинск"

files:
  - features/adapter-maps/routes@deskpad.hermione.js
  - features/adapter-maps/routes@deskpad.hermione.e2e.js

tlds: all

v-team: VanillaGeo

regions:
  ru: 213
  by: 157
  kz: 163
  ua: 143

requests:
  ru: как добраться
  by: как добраться дзержинского 5
  kz: как добраться до проспект абая
  ua: проїзд

counter: /$page/$main/$result[@wizard_name="route"]/title

tags:
  - reviewed
  - hasE2E
