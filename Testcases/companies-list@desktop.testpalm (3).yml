feature: Сети/Рубрики

specs-integration:
  beforeEach:
    - do: получить выдачу по запросу 'шоколадница москва'
    - assert: должен появиться колдунщик сети/рубрики в правой колонке
  Наличие элементов:
    - assert: |
        должен присутствовать заголовок,
        должены присутствовать фильтры,
        должна присутствовать карта,
        должна присутствовать карта
  Фильтрация списка:
    - do: кликнуть в первый фильтр
    - assert: |
        обновились пины на карте,
        обновились организации в списке

params:
  # выключаем срабатывание БК для асессоров
  rearr: scheme_Local/OrgWizard/MinCarouselSize=100

specs:
  beforeEach:
    - do: получить выдачу по запросу 'шоколадница москва' (kfc москва, бургер кинг москва, макдональдс москва)
    - screenshot: в правой колонке появился колдунщик сетей/рубрик, внешний вид (если колдунщика нет, попробовать альтернативный запрос из пункта выше) [https://jing.yandex-team.ru/files/sorokinda/Screen%20Shot%202021-11-25%20at%2013.07.58.png]
  Проверка ссылок и счетчиков:
    - label: geo-orgmn-list
    - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/sorokinda/Screen%20Shot%202021-11-25%20at%2013.07.58.png]
    - do: кликнуть по тайтлу колдунщика
    - assert: в соседней вкладке открылась страница Яндекс.Карт с запросом 'шоколадница москва' и несколькими пинами
    - tech: проверить счетчик в тайтле /parallel/result/snippet/companies/map/title
    - do: кликнуть по кнопке "На большую карту"
    - assert: в соседней вкладке открылась страница Яндекс.Карт запросом 'шоколадница москва' и несколькими пинами
    - tech: проверить счетчик на ссылке на большую карту /parallel/result/snippet/companies/map/goto-map
    - do: нажимать на стрелку 'вправо' в шоукейсе до тех пор, пока его содержимое не проскроллится до конца
    - do: кликнуть по ссылке 'Еще места'
    - assert: выдача перезагрузилась, появилась карусель организаций
    - tech: сработал счетчик path='/parallel/result/snippet/companies/map/more', vars='pos=*,wizard=true,-adapters=companies,-source=fake'
    - assertMetrics: '*'
  Проверка cкроллера:
    - do: кликнуть в правую кнопку скроллера
    - assert: |
        содержимоей шоукейса сдвинулось влево и появился новый минибейдж,
        появилась левая кнопка в скроллере
    - tech: проверить счётчик в правой кнопке скроллера parallel/result/snippet/companies/map/showcase/scroll_right
    - tech: проверить счётчик в левой кнопке скроллера /parallel/result/snippet/companies/map/showcase/scroll_left
    - tech: проверить счётчик на скролл тачпадом /parallel/result/snippet/companies/map/showcase/scroll
    - assertMetrics: '*'
  Проверка карты:
    - tags: smoke
    - assert: на карте красным пином обозначено расположение организации из первого минибейджа
    - do: навести курсор на второй минибейдж
    - assert: красный пин сменил местоположение и теперь указывает на расположение организации из второго минибейджа
    - do: зажать левой кнопкой мыши карту и сдвинуть ее сильно в сторону так, чтобы пины обновились
    - assert: на карте возникли новые пины, карточки под картой обновились
    - tech: сработал динамический счетчик path='/parallel/result/snippet/companies/map/drag', vars='wizard=true,-adapters=companies,action=dynamic_click,pos=*'
    - do: кликнуть в любой пин на карте
    - assert: карусель с карточками подскроллилась к выбранной на карте
    - tech: сработал динамический счетчик path='/parallel/result/snippet/companies/map/point', vars="wizard=true,-adapters=companies,action=dynamic_click,pos=*'
    - do: зажать левой кнопкой мыши карту и немного сдвинуть ее в любую сторону
    - assert: карточки под картой подскроллились к началу
    - assertMetrics: '*'
  Проверка ховеров:
    - assert: на карте выделен пин соответствующий первой карточке под картой
    - do: кликнуть по другому пину на карте
    - assert: |
        выбранный пин выделен,
        видна карточка, соответствующая выделенному пину
    - do: навести мышь на первую карточку в списке (на обасть картинки)
    - assert: |
        карточка, на которую навели мышь, подсветилась,
        соответствующий карточке пин на карте выделился
    - screenshot: внешний вид подсвеченной карточки [hover-thumb]
    - do: навести мышь на синий элемент (отзывы, номер телефона) первой карточки в списке
    - assert: синий элемент отреагировал на на курсор (подсветился красным)
    - screenshot: внешний вид подсвеченной карточки с курсором на заголовке [hover-title]
    - do: убрать мышь с карточек
    - assert: соответствующий пин остался выделен
    - do: кликнуть по выделенному пину на карте
    - assert: пин перестал быть выделенным
    - assertMetrics: '*'
  Проверка зума карты после клика в контролы:
    - do: кликнуть по кнопке увеличения зума '+'
    - assert: при нажатии кнопки '+' масштаб увеличивается
    - tech: сработал динамический счетчик path='/parallel/result/snippet/companies/map/zoom/plus', vars='wizard=true,-adapters=companies,action=dynamic_click,pos=*'
    - do: кликнуть по кнопке уменьшения зума '-'
    - assert: при нажатии кнопки '-' масштаб уменьшается
    - tech: сработал динамический счетчик path='/parallel/result/snippet/companies/map/zoom/minus', vars='wizard=true,-adapters=companies,action=dynamic_click,pos=*'
    - assertMetrics: '*'
  Проверка метки Я после клика в кнопку геолокации:
    - do: кликнуть по кнопке геолокации (возможно, потребуется разрешение браузеру для определения местоположения)
    - assert: на карте колдунщика появилась буква 'Я' в красном круге, обозначающая текущее местоположение пользователя
    - tech: сработал динамический счетчик path='/parallel/result/snippet/companies/map/location', vars='wizard=true,-adapters=companies,action=dynamic_click,pos=*'
    - assertMetrics: '*'
  Проверка попапа с ошибкой, если геолокация запрещена:
    - do: в настройках браузера запретить сообщать местонахождение и кликнуть по кнопке геолокации
    - assert: в колдунщике появляется всплывающее окно с сообщением о том, что определить местонахождение не удалось
    - assertMetrics: '*'
  Проверка попапа с ошибкой, если не удалось точно определить местоположение:
    - do: в настройках браузера разрешить сообщать местонахождение, затем отключить интернет и кликнуть по кнопке геолокации
    - assert: в колдунщике появляется всплывающее окно с сообщением о том, что определить точное местонахождение не удалось
  Без WizardPos в данных:
    - params:
        foreverdata: '1626693173'
    - do: получить выдачу по запросу 'кафе'
    - assert: |
        должен появиться колдунщик сети/рубрики
        в шапке колдунщика нет лишних ссылок на карты
        (внешний вид лишних ссылок https://jing.yandex-team.ru/files/melnikovatm/Лишние%20ссылки%20в%20оргмн.png)

files:
  - features/companies/list/companies-list@desktop.hermione.js
  - features/companies/list/companies-list@desktop.hermione.e2e.js

v-team: VanillaGeo

counter: /$page/$parallel/$result[@wizard_name="companies" and @subtype="map"]/composite/title

tags:
  - smoke_extended
  - reviewed
  - hasE2E

tlds: all
