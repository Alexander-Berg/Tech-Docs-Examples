feature: Добавление в команду

specs:
  beforeEach:
    - do: залогиниться под пользователем robot-internal-003
    - do: открыть страницу сервиса Мой тестовый сервис 007 (/services/zanartestservice007)
    - do: нажать кнопку добавления в команду

  Положительные:
    1. Добавление нового сотрудника с предложенной ролью (бессрочное):
      - screenshot: появилась форма добавления новых участников [add-member-form]
      - do: на форме добавления новых участников в поле добавления сотрудника ввести логин пользователя "user3371"
      - assert: появился выпадающий список вариантов, среди которых есть сотрудник "Арнольд Снеговой" с логином "user3371"
      - do: кликнуть на сотрудника с логином "user3371"
      - assert: |
              сотрудник выбран, появился в блоке "Роль"
              рубильник срока роли находится в положении "Бессрочно",
              установлена роль по умолчанию "DevOps"
      - do: нажать кнопку "Добавить"
      - assert: попап исчез
      - screenshot: появилась плашка "Запрошены роли" с добавленным пользователем [unapproved-user]

    2. Добавление нового сотрудника с предложенной ролью (до даты):
      - do: на форме добавления новых участников в поле добавления сотрудника ввести логин пользователя "user3371"
      - assert: появился выпадающий список вариантов, среди которых есть сотрудник "Арнольд Снеговой" с логином "user3371"
      - do: кликнуть на сотрудника с логином "user3371"
      - assert: сотрудник выбран, появился в блоке "Роль"
      - do: рубильник срока роли перевести в положение "до даты"
      - do: выбрать дату 14.07.2021
      - assert: установлена роль по умолчанию "DevOps"
      - do: нажать кнопку "Добавить"
      - assert: |
              попап исчез,
              плашка "Запрошены роли" с добавленным пользователем

    3. Добавление нового сотрудника с предложенной ролью (на срок):
      - do: на форме добавления новых участников в поле добавления сотрудника ввести логин пользователя "user3371"
      - assert: появился выпадающий список вариантов, среди которых есть сотрудник "Арнольд Снеговой" с логином "user3371"
      - do: кликнуть на сотрудника с логином "user3371"
      - assert: сотрудник выбран, появился в блоке "Роль"
      - do: рубильник срока роли перевести в положение "до даты"
      - do: в поле ввода дней вписать "7"
      - assert: установлена роль по умолчанию "DevOps"
      - do: нажать кнопку "Добавить"
      - assert: |
              попап исчез,
              плашка "Запрошены роли" с добавленным пользователем

    4. Добавление сотрудника с ограниченной ролью:
      - do: на форме добавления новых участников в поле добавления сотрудника ввести "Matroskin Cat"
      - assert: появился выпадающий список вариантов, среди которых есть сотрудник "Matroskin Cat"
      - do: кликнуть на сотрудника "Matroskin Cat"
      - assert: |
              сотрудник выбран, появился в блоке "Роль"
              в блоке "Роли" появилась заметка с текстом "У некоторых выбранных сотрудников ограничены права в системе «ABC для внешних пользователей». Они получат доступ к информации об этом и других сервисах, которая сейчас им недоступна."
              рядом с пользователем есть оранжевая иконка "Р2"
              по умолчанию в поле "Роль" указано "DevOps"
      - do: удалить значение из поля "Роль"
      - do: выбрать из выпадающего списка ролей роль "Аналитик"
      - screenshot: форма добавления в команду сотрудника с ограниченной ролью [add-user-P2]
      - do: навести курсор на иконку "Р2"
      - assert: появилась подсказка с текстом "У сотрудника «Ограниченная роль». Если его добавить, он увидит описание, состав команд и графики дежурств ВСЕХ сервисов."
      - do: нажать кнопку "Добавить"
      - assert: |
              попап исчез
              появилась плашка "Запрошены роли" с добавленным пользователем

    5. Добавление сотрудника с сильно ограниченной ролью:
      - do: на форме добавления новых участников в поле добавления сотрудника ввести "Bayun Cat"
      - assert: появился выпадающий список вариантов, среди которых есть сотрудник "Bayun Cat"
      - do: кликнуть на сотрудника "Bayun Cat"
      - assert: |
              сотрудник выбран, появился в блоке "Роль"
              в блоке "Роли" появилась заметка с текстом "У некоторых выбранных сотрудников ограничены права в системе «ABC для внешних пользователей». Они получат доступ к информации об этом и других сервисах, которая сейчас им недоступна."
              рядом с пользователем есть оранжевая иконка "Р3"
              по умолчанию в поле "Роль" указано "DevOps"
      - screenshot: форма добавления в команду сотрудника с сильно ограниченной ролью [add-user-P3]
      - do: кликнуть на иконку "Р3"
      - assert: появилась подсказка с текстом "У сотрудника «Сильно ограниченная роль». Если его добавить, он увидит описание и команду этого сервиса."
      - do: нажать кнопку "Добавить"
      - assert: |
              попап исчез
              появилась плашка "Запрошены роли" с добавленным пользователем

    6. Добавление сотрудника с заведением новой роли:
      - do: на форме добавления новых участников в поле добавления сотрудника ввести "Оксана Мидори"
      - assert: появился выпадающий список вариантов, среди которых есть сотрудник "Оксана Мидори"
      - do: кликнуть на сотрудника "Оксана Мидори"
      - assert: |
              сотрудник выбран, появился в блоке "Роль"
              рубильник срока роли находится в положении "Бессрочно",
              установлена роль по умолчанию "Заместитель руководителя сервиса"
      - do: кликнуть на крестик в поле с ролью "Заместитель руководителя сервиса"
      - assert: |
              поле очистилось, в нём появился плейсхолдер "Выберите роль"
              под полем появился выпадающий список с ролями
      - assert: внизу списка есть пункт "+ Добавить новую роль"
      - do: кликнуть на пункт "+ Добавить новую роль"
      - screenshot: появилась форма добавления новой роли [new-role-form]
      - do: кликнуть в форме на кнопку "Выберите функциональную группу"
      - assert: появился выпадающий список с функциональными группами
      - do: кликнуть на вариант "Аналитика"
      - assert: выпадающий список скрылся, выбран вариант "Аналитика"
      - do: в поле "Русское название роли" ввести "кастомная роль - (сегодняшние дата и время в формате дд-мм-гггг чч:мм)"
      - do: в поле "Английское название роли" ввести "custom role - (сегодняшние дата и время в формате дд-мм-гггг чч:мм)"
      - do: в поле "Код" ввести сегодняшнюю дату и время в формате "дд-мм-гггг-чч:мм"
      - do: кликнуть на кнопку "Создать"
      - assert: форма создания новой роли закрылась, в поле с названием роли написано "кастомная роль - (сегодняшние дата и время в формате дд-мм-гггг чч:мм)"
      - do: нажать кнопку "Добавить"
      - assert: |
              попап исчез
              появилась плашка "Запрошены роли" с добавленным пользователем "Оксана Мидори"
              у пользователя "Оксана Мидори" запрошена роль "кастомная роль - (сегодняшние дата и время в формате дд-мм-гггг чч:мм)"
      - do: (PREPARE) подождать, пока плашка "Запрошены роли" пропадёт и пользователь "Оксана Мидори" появится в списке команды
      - do: (PREPARE) удалить пользователя "Оксана Мидори" из команды


files:
  - test/features/desktop/roles/add-member.hermione.js

priority: blocker

tags:
  - reviewed
  - no_assessors
