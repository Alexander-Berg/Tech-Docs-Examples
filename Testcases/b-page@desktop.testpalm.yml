feature: Кука zmblt

specs:
  Отправка счетчиков и установка куки:
    Валидное количество дней:
      - do: получить выдачу по запросу 'еда' в Яндекс браузере
      - do: закрыть Яндекс браузер
      - do: получить выдачу по запросу 'еда' в любом браузере, кроме Яндекс Браузера
      - do: получить значение куки "yp"
      - do: сменить дату на компьютере на день вперед
      - do: получить выдачу по запросу 'еда' в любом браузере, кроме Яндекс Браузера
      - do: получить значение куки "yp"
      - assert: значение zmblt для куки "yp" увеличилось на 1
      - assert: значение zmbbr для куки "yp" имеет значение имя браузера:версия браузера (версия через "_" вместо ".")
      - tech: |
          сработал клиентский счетчик path='/tech/distr/zmblt/true' (в network 690.2292.3600.1100)
          vars содержат "-browser=имя браузера, -version=версия браузера" (версия через "_" вместо ".")
    Браузер удален:
      - do: получить выдачу по запросу 'еда' в Яндекс браузере
      - do: закрыть Яндекс браузер
      - do: удалить Яндекс браузер
      - do: получить выдачу по запросу 'еда' в любом браузере, кроме Яндекс Браузера
      - do: получить значение куки "yp"
      - assert: кука "yp" не содержит значение zmblt
      - tech: сработал клиентский счетчик path='/tech/distr/zmblt/deleted' (в network 690.2292.3600.3599)
    Декодер вернул null:
      - do: получить выдачу по запросу 'еда' в любом браузере, кроме Яндекс Браузера
      - tech: |
          сымитировать, что декодер вернул null, выполнив в консоли команды
          var bPage = $('.b-page');
          bPage.bem('b-page').delMod('js');
          window.Ya.F = {};
          Object.defineProperty(window.Ya.F, 'calibrate', { set: function(value) {}, get: function() { return function(font, callback) { callback(null) }} });
          bPage.bem('b-page').setMod('js', 'inited');
      - tech: получить значение куки "yp"
      - assert: кука "yp" не содержит значение zmblt
      - tech: сработал клиентский счетчик path='/tech/distr/zmblt/null' (в network 690.2292.3600.2216)

files:
  - features/b-page/b-page@desktop.hermione.js

v-team: Distribution

tags:
  - no_assessors
  - skip_e2e_check
  - cookie

tlds:
  - ru
