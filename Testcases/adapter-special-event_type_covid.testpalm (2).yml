feature: Специальные события
type: Коронавирус

specs:
  Внешний вид:
    - params:
        foreverdata: '451681522'
    - do: получить выдачу по запросу "foreverdata"
    - assert: получена выдача по указанному запросу
    - assert: на выдаче присутствует колдунщик коронавируса
    - screenshot: примерный внешний вид [plain]
  С картой за кнопкой:
    params:
      foreverdata: '1658003525'
    beforeEach:
      - do: получить выдачу по запросу 'foreverdata'
      - assert: на выдаче присутствует колдунщик коронавируса
    Внешний вид:
      - screenshot: внешний вид колдунщика [with-map]
    Проверка ссылки на карте:
      - do: нажать на картинку в таблице 'Карта'
      - assert: ссылка открылась в новой вкладке (в браузерах UC и MIUI открытие происходит в той же вкладке, это не является ошибкой)
      - tech: сработал счетчик '/wiz/special/event/sport/team/table/cell'
  С картой в виде отдельной таблицы:
    params:
      foreverdata: '2625231382'
    beforeEach:
      - do: получить выдачу по запросу 'foreverdata'
      - assert: на выдаче присутствует колдунщик коронавируса
    Внешний вид:
      - screenshot: внешний вид колдунщика [with-separate-map]
    Проверка ссылки на карте:
      - do: нажать на картинку в таблице 'Карта'
      - assert: ссылка открылась в новой вкладке (в браузерах UC и MIUI открытие происходит в той же вкладке, это не является ошибкой)
      - tech: сработал счетчик '/wiz/special/event/sport/team/table/cell'
  С картой без кнопки:
    params:
      foreverdata: '3060904849'
    beforeEach:
      - do: получить выдачу по запросу 'foreverdata'
      - assert: на выдаче присутствует колдунщик коронавируса
    Внешний вид:
      - screenshot: внешний вид колдунщика [map-without-button]
    Проверка ссылки на карте:
      - do: нажать на картинку в таблице 'Карта'
      - assert: ссылка открылась в новой вкладке (в браузерах UC и MIUI открытие происходит в той же вкладке, это не является ошибкой)
      - tech: сработал счетчик '/wiz/special/event/sport/team/table/cell'
  Гистограмма:
    params:
      foreverdata: '787514492'
    Гистограмма новых заболеваний:
      - do: получить выдачу по запросу 'foreverdata'
      - assert: |
          на выдаче присутствует колдунщик коронавируса
          в разделе "Как меняется ситуация?" присутствует гистограмма новых заболеваний
      - screenshot: внешний вид гистограммы [chart-delta]
      - do: нажать на любой столбец
      - assert: столбец выделился цветом, над ним появилась подпись со значением, а под ним - подпись с датой
      - screenshot: внешний вид гистограммы с выделенным столбцом [chart-delta-active]
    Гистограмма числа заболевших:
      - do: получить выдачу по запросу 'foreverdata'
      - assert: на выдаче присутствует колдунщик коронавируса
      - do: в разделе "Как меняется ситуация?" нажать на "Число заболевших"
      - assert: появилась гистограмма числа заболевших
      - screenshot: внешний вид гистограммы [chart-current]
      - do: нажать на любой столбец
      - assert: столбец выделился цветом, над ним появилась подпись со значением, а под ним - подпись с датой
      - screenshot: внешний вид гистограммы с выделенным столбцом [chart-current-active]
  Вертикальные карточки:
    params:
      foreverdata: '3510378121'
      user_time: '202005191600'
    beforeEach:
      - do: получить выдачу по запросу 'foreverdata'
      - assert: на выдачек присутствует колдунщик коронавируса
      - do: нажать на второй таб 'Новости'
      - assert: отобразилось содержимое таба
      - tech: сработал счетчик '/wiz/special/event/tabs'
    Внешний вид:
      - screenshot: внешний вид [tab-news]
    Проверка счетчиков:
      - do: нажать на верхнюю карточку
      - assert: открылась вкладка с новостью (новость может не соответствовать или отсутствовать - важен сам факт перехода по ссылке)
      - tech: сработал счетчик '/wiz/special/event/link'
      - tech: сработал баобаб счетчик '/$page/$main/$result/tabs/pane/tabs/pane/mushroom-card/link'
  Неработающий аякс:
    - params:
        foreverdata: '825983839'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: на выдачек присутствует колдунщик коронавируса
    - do: нажать на второй таб в колдунщике коронавируса
    - assert: |
        содержимое колдунщика обновилось
        видно сообщение об ошибке загрузки
    - screenshot: примерный внешний вид [tabs-api-error]
  Внешний вид при одном табе:
    - params:
        foreverdata: '3066056894'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: на выдачек присутствует колдунщик коронавируса
    - screenshot: примерный внешний вид [one-tab]

specs-integration:
  Проверка наличия элементов:
    - tags: smoke
    - do: получить выдачу по запросу 'коронавирус'
    - assert: на выдаче присутствует колдунщик коронавируса
    - assert: колдунщик имеет блок с новостями
    - assert: колдунщик имеет блок с гистограммой распространения
    - assert: колдунщик имеет табики
  Загрузка содержимого табов аяксом:
    - tags: smoke
    - do: получить выдачу по запросу 'коронавирус'
    - assert: на выдаче присутствует колдунщик коронавируса с табами
    - do: нажать на второй таб
    - assert: |
        содержимое колдунщика обновилось
        колдунщик содержит данные, соответствующие активному табику

tags:
  - covid

priority: high

counter: /$page/$main/$result[@wizard_name="special/event" and @subtype="coronavirus"]

files:
  - features/touch-phone/adapter-special-event/adapter-special-event_type_other/adapter-special-event_type_covid.hermione.js
  - features/touch-phone/adapter-special-event/adapter-special-event_type_other/adapter-special-event_type_covid.hermione.e2e.js

v-team: Freshness

tlds:
  - ru
