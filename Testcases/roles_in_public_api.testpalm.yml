feature: Public API

specs:
  Ручка roles в Public API:
    - do: запустить в Runner сценарий "Ручка roles в Public API" (https://github.yandex-team.ru/pixel/idm-runner)
    - do: отправить запрос "/roles без параметров" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: запрос "/roles без параметров" должен содержать поля примерно такого вида, как на скриншоте [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-37-44.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "/roles с фильтрацией по id" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: запрос "/roles с фильтрацией по id" должен содержать запись с id=13090809 [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-38-26.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "/roles. Чтение роли" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: запрос "/roles. Чтение роли" должен содержать запись с id=13090809 [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-39-33.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "/roles. Чтение несуществующей роли" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "404"
    - screenshot: запрос "/roles. Чтение несуществующей роли" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-40-01.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

priority: critical

files:
  - idm/tests/api/v1/test_role.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:idm_backend_palmsync:idm/tests/api/v1/test_role.py
  - fitcher:idm_backend_palmsync:idm/users/models.py
  - fitcher:idm_backend_palmsync:idm/users/constants/user.py
  - fitcher:idm_backend_palmsync:idm/tests/utils.py
  - fitcher:idm_backend_palmsync:idm/core/models/rolerequest.py
  - fitcher:idm_backend_palmsync:idm/core/models/role.py
