feature: Мои роли

specs:
  Мои роли. Таб "Группы":
    - do: запустить в Runner сценарий "Мои роли. Таб "Группы"" (https://github.yandex-team.ru/pixel/idm-runner)
    - do: отправить запрос "Мои роли. Мои группы. Активные непосредственные группы" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе на запрос "Мои роли. Мои группы. Активные непосредственные группы" поле "state" у "group" имеет значения "active" или "depriving" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-03%2016-26-09.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Мои роли. Мои группы. Всех активных групп больше, чем непосредственных" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Мои роли. Мои группы. Всех активных групп больше, чем непосредственных" должен содержать поля "state" со значением "active" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-03%2016-27-17.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Мои роли. Мои группы. Все неактивные группы" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Мои роли. Мои группы. Все неактивные группы" должен содержать поля "state" со значением "inactive" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-03%2016-29-11.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Мои роли. Группы. Фильтр по группе" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе на запрос "Мои роли. Группы. Фильтр по группе" поле "id" у "group" должно иметь значение 42935 или 29558 [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-03%2016-30-11.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Мои роли. Группы. Фильтр по типу группы. Wiki-группы" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе на запрос "Мои роли. Группы. Фильтр по типу группы. Wiki-группы" все поля "type" у "group" должны иметь значение "wiki" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-03%2016-31-35.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Мои роли. Группы. Фильтр по типу группы. Департамент и сервисные группы" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе на запрос "Мои роли. Группы. Фильтр по типу группы. Департамент и сервисные группы" все поля "type" у "group" должны иметь значения "department" или "service"  [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-03%2016-33-14.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Мои роли. Группы. Фильтр по типу группы. Департамент" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе на запрос "Мои роли. Группы. Фильтр по типу группы. Департамент" все поля "type" у "group" должны иметь значения "department" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-03%2016-34-08.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

priority: critical

files:
  - idm/tests/api/frontend/test_membership.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:idm-www:test/auto/my-roles-groups-tab/**
  - fitcher:idm-www:/test/e2e/my-roles-page/**
  - fitcher:idm-www:blocks/desktop/filters/**
  - fitcher:idm-www:blocks/desktop/table/**
  - fitcher:idm_backend_palmsync:idm/tests/api/frontend/test_membership.py
  - fitcher:idm_backend_palmsync:idm/core/constants/groupmembership.py
  - fitcher:idm_backend_palmsync:idm/core/constants/role.py
  - fitcher:idm_backend_palmsync:idm/core/constants/system.py
  - fitcher:idm_backend_palmsync:idm/core/models/role.py
  - fitcher:idm_backend_palmsync:idm/core/models/rolefield.py
  - fitcher:idm_backend_palmsync:idm/permissions/utils.py
  - fitcher:idm_backend_palmsync:idm/users/models.py
  - fitcher:idm_backend_palmsync:idm/tests/utils.py
