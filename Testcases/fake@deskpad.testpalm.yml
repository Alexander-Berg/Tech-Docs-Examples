feature: Колдунщик топонимов
type: Общие запросы (Карты мира, карта европы)

params:
  rearr: EntitySearch_off
  # колдунщик топонимов отключен на стороне данных, этот флаг возвращает колдун
  srcparams: 'UPPER:rearr=scheme_Local/ToponymWizard/Enabled=1'

specs-integration:
  Наличие колдунщика:
    - do: получить выдачу по запросу 'политическая карта мира'
    - assert: появился колдунщик с картой
    - counter: /$page/$main/$result[@wizard_name="maps" and @subtype="fake"]/title

specs:
  aliases:
    - &CheckMetrics
      - assertMetrics:
          - feature.web.wizards_common.maps_wizard.total.shows
          - feature.web.wizards_common.maps_wizard.total.external_clicks
          - feature.web.wizards_common.maps_wizard.total.dynamic_clicks
          - web.total_request_results_clicks
          - web.total_request_results_ext_clicks
          - web.total_request_results_dyn_clicks
          - web.total_request_results_main_column_clicks
          - web.total_request_results_main_column_ext_clicks
          - web.total_request_results_main_column_dyn_clicks
          - web.total_request_results_parallel_column_clicks
          - web.total_request_results_parallel_column_ext_clicks
          - web.total_request_results_parallel_column_dyn_clicks
          - web.tech_part_misc_click
          - web.total_request_count
          - daily.total_session_count
  beforeEach:
    - do: получить выдачу по запросу 'политическая карта мира'
  Проверить внешний вид, общие ссылки и счётчики колдунщика топонимов:
    - tags:
        - title
        - greenurl
    - screenshot: на странице появился колдунщик топонимов,его внешний вид [plain]
    - do: перейти по ссылке в тайтле
    - assert: осуществился переход на сервис Яндекс.Карты с картой мира
    - do: вернуться на страницу выдачи результатов и перейти по гринурлу
    - assert: осуществился переход на сервис Яндекс.Карты с картой мира
    - *CheckMetrics
  Проверка драга карты:
    - tags:
        - maps
    - browsers:
        notFor:
          - ipad
    - do: драгнуть карту
    - assert: карта двигается
    - *CheckMetrics
  Проверка контролов карты:
    - tags:
        - maps
        - zoom
    - do: нажать кнопку 'На большую карту'
    - assert: открылась новая вкладка с Яндекс.Картами
    - do: вернуться на страницу выдачи результатов и кликнуть по кнопке увеличения зума - +
    - assert: масштаб увеличился
    - do: кликнуть по кнопке уменьшения зума - '-'
    - assert: масштаб уменьшился
    - *CheckMetrics
  Проверка определения геолокации:
    - tags:
        - location
    - do: кликнуть по кнопке геолокации, разрешить браузеру сообщить местонахождение
    - assert: в колдунщике появился поинт местонахождения пользователя
  Проверка ошибки определения геолокации:
    - tags:
        - location
    - do: запретить браузеру сообщать местонахождение, кликнуть по кнопке геолокации
    - assert: местоположение пользователя не определилось, появился соответствующий ассерт

files:
  - features/adapter-maps/fake@deskpad.hermione.js
  - features/adapter-maps/fake@deskpad.hermione.e2e.js

tlds: all

v-team: VanillaGeo

regions:
  ru: 213
  by: 157
  kz: 163
  ua: 143

requests:
  ru: политическая карта мира

counter: /$page/$main/$result[@wizard_name="maps" and @subtype="fake"]/map/goto-map

tags:
  - reviewed
  - hasE2E
