feature: Hotels / Карусель
type: Отель в попапе

specs:
  beforeEach:
    - do: в режиме инкогнито получить выдачу по запросу 'отели в москве'
  Основные проверки:
    - tags:
        - showcase
        - thumb
        - popap
        - tabs
        - button
        - ajax
        - smoke
    - assert: над поисковой выдачей появилась карусель отелей во всю ширину экарана
    - do: кликнуть в первый отель в карусели
    - tech: |
        сработал счетчик на заголовке таба
        path='/parallel/result/wiz/companies/map/upper/showcase/item/thumb',
        vars='pos=upper,-adapters=companies,action=dynamic_click,-oid=*,-item=0,popup=open'
    - assert: показался попап, в который загрузилась подробная информация о выбранном отеле
    - do: кликнуть в таб "Номера"
    - tech: |
        сработал счетчик на заголовке таба
        path='/parallel/result/wiz/companies/travel_map/upper/tabs/list/showcase/item/popup/tabs',
        vars='pos=upper,-adapters=companies,action=dynamic_click,-oid=*,popup=inside,-item=1'
    # - screenshot: внешний вид таба с номерами [rooms]
    # добавится во время расскипа
    - do: кликнуть в таб "N отзывов"
    - tech: |
        сработал счетчик на заголовке таба
        path='/parallel/result/wiz/companies/map/upper/showcase/item/tabs',
        vars='pos=upper,-adapters=companies,action=dynamic_click,-oid=*,popup=inside'
    - assert: открылся таб с отзывами
    - screenshot: внешний вид таба с отзывами [reviews]
    - do: проскроллить таб до конца
    - tech: проверить счётчик /$page/$top/$result/modal-popup/modal-content-loader/content/company/tabs/reviews/reviews-loader/reviews
    - assert: загрузились дополнительные отзывы под теми, что были изначально
    - assertMetrics: '*'
  Синхронизация дат, проверка счетчиков:
    - tags:
        - showcase
        - thumb
        - popup
        - tabs
        - button
        - ajax
    - do: кликнуть во второй отель в карусели
    - assert: открылся попап, в который загрузилась подробная информация о выбранном отеле
    - do: кликнуть в таб "Номера"
    - tech: |
        сработал счетчик на заголовке таба
        path='/parallel/result/wiz/companies/travel_map/upper/tabs/list/showcase/item/popup/tabs',
        vars='pos=upper,-adapters=companies,action=dynamic_click,-oid=*,popup=inside,-item=1'
    - assert: открылся таб с формой поиска и каруселью номеров под формой
    - do: сменить дату выселения
    - tech: |
        сработал счетчик
        path='/$page/$top/$result/modal-popup/modal-content-loader/content/company/tabs/rooms/hotels-form/date-to/button'
    - do: выполнить поиск номеров, нажав кнопку "Выбрать номер"
    - tech: |
        сработал счетчик
        path='/tech/parallel/result/wiz/companies/travel_map/upper/tabs/list/showcase/item/popup/form/submit/'
        vars='pos=upper,-adapters=companies,action=dynamic_click,popup=inside'
    - assert: обновились предложения под формой поиска
    - do: кликнуть в таб "Про отель"
    - tech: |
        сработал счетчик на заголовке таба
        path='/parallel/result/wiz/companies/travel_map/upper/tabs/list/showcase/item/popup/tabs',
        vars='pos=upper,-adapters=companies,action=dynamic_click,-oid=*,popup=inside,-item=0'
    - assert: в попапе присутствует блок "Цены на номера"
    - assert: в попапе присутствует блок "Похожие отели"
    - do: кликнуть в первую карточку из похожих
    - tech: |
        сработал счетчик
        path = '/parallel/result/wiz/companies/travel_map/upper/tabs/list/showcase/item/popup/similar/topic'
        vars = 'pos=upper,wizard=true,-adapters=companies,action=dynamic_click,popup=open'
    - assert: обновилась информация об отеле
    - do: даты в форме совпадают с теми, что были выбраны на предыдущем шаге
    - assertMetrics: '*'
  Просмотрщик картинок в табе Фото:
    - tags:
        - showcase
        - thumb
        - popap
        - tabs
        - ajax
        - viewer
    - do: кликнуть в первую карточку отеля
    - tech: |
        сработал счетчик открытия попапа
        path = "/parallel/result/wiz/companies/travel_map/upper/tabs/list/showcase/item/topic/",
        vars="popup=open,action=dynamic_click,-oid=*,pos=upper,-subtype=carousel,
        -adapters=companies,-item=*"
    - assert: открылся попап с отелем на табе "Про отель"
    - do: кликнуть в таб "Фото"
    - tech: |
        сработал счетчик на заголовке таба
        path='/parallel/result/wiz/companies/map/upper/showcase/item/tabs',
        vars='pos=upper,-adapters=companies,action=dynamic_click,-oid=*,popup=inside,-item=*'
    - assert: открылся таб с фотографиями отеля
    - do: кликнуть в первую картинку
    - tech: |
        сработал счетчик открытия просмотрщика
        path='/parallel/result/wiz/companies/map/upper/showcase/item/viewer/open',
        vars='pos=upper,wizard=true,-adapters=companies,popup=inside,action=dynamic_click,-oid=*'
    - assert: открылся просмотрщик с увеличенной первой картинкой
    - do: кликнуть по стрелке "Вправо"
    - tech: |
        сработал счетчик скролла
        path='/parallel/result/wiz/companies/map/upper/showcase/item/viewer/right',
        vars='pos=upper,wizard=true,-adapters=companies,popup=inside,action=dynamic_click,-oid=*'
    - assert: |
        содержимое галереи под большой картинкой сдвинулось влево,
        содержимое отображаемой крайней левой картинки в галерее соответствует увеличенной картинке,
        на большой картинке появилась стрелка "Влево"
    - do: кликнуть по отображаемой крайней правой картинке в галерее
    - assert: |
        содержимое галереи сдвинулось влево до выбранной картинки,
        содержимое отображаемой крайней левой картинки в галерее соответствует увеличенной картинке
    - do: кликнуть по стрелке "Влево"
    - tech: |
        сработал счетчик скролла
        path='/parallel/result/wiz/companies/map/upper/showcase/item/viewer/left',
        vars='pos=upper,wizard=true,-adapters=companies,popup=inside,action=dynamic_click,-oid=*'
    - assert: |
        содержимое галереи под большой картинкой сдвинулось вправо,
        содержимое отображаемой крайней левой картинки в галерее соответствует увеличенной картинке
    - do: кликнуть по кнопке сворачивания просмотрщика в правом верхнем углу большой картинки
    - tech: |
        сработал счетчик закрытия просмотрщика
        path='/parallel/result/wiz/companies/map/upper/showcase/item/viewer/collapse',
        vars='pos=upper,wizard=true,-adapters=companies,popup=inside,action=dynamic_click,-oid=*'
    - assert: |
        просмотрщик закрылся,
        отображается содержимое таба "Фото"
    - assertMetrics: '*'

files:
  - features/companies/hotels/hotels-popup/hotels-carousel-popup@desktop.hermione.js

counter: /parallel/result/wiz/companies/travel_map/upper/tabs/list/showcase/item/popup/form/submit

tags:
  - skip_e2e_check

v-team: KotTeam

tlds: none
