feature: Спецсниппет завирусованности

params:
  foreverdata: '3281250725'

specs:
  params:
    rearr:
      - use_signed_download_urls=1
  beforeEach:
    - do: получить выдачу Поиска по запросу 'foreverdata'
    - assert: на выдаче есть сниппет завирусованного сайта
  Внешний вид:
    - screenshot: внешний вид сниппета соответствует скришноту [plain]
    - do: кликнуть/тапнуть на серую ссылку с предупреждением
    - screenshot: внешний вид сниппета соответствует скриншоту [expanded]
  Показать предупреждение при первом клике, при повторном – закрыть:
    Серая ссылка:
      - do: кликнуть/тапнуть на серую ссылку с предупреждением
      - assert: появился блок с предупреждением
      - do: повторно кликнуть/тапнуть на серую ссылку с предупреждением
      - assert: блок с предупреждением скрылся
      - counter: /$page/$main/$result[@features has "infected"]/warning
    Заголовок:
      - do: кликнуть/тапнуть на заголовок сниппета с предупреждением
      - assert: появился блок с предупреждением
      - do: повторно кликнуть/тапнуть на заголовок сниппета с предупреждением
      - assert: блок с предупреждением скрылся
      - counter: /$page/$main/$result[@features has "infected"]/title
    Гринурл:
      - do: кликнуть/тапнуть на гринурл сниппета с предупреждением
      - assert: появился блок с предупреждением
      - do: повторно кликнуть/тапнуть на гринурл сниппета с предупреждением
      - assert: блок с предупреждением скрылся
      - counter: /$page/$main/$result[@features has "infected"]/path/urlnav
  Корректность ссылок и счётчиков:
    - tech: проверить счётчик на серой ссылке с предупреждением
    - do: кликнуть/тапнуть на серую ссылку с предупреждением
    - assert: появился блок с предупреждением
    - do: кликнуть на ссылку 'Чем угрожает этот сайт'
    - assert: |
        ссылка 'Чем угрожает этот сайт' ведет на страницу  'yandex.ru/...' (yandex.[by/ua/..] для других доменов)
        c подробной информацией о вредоносности сайта
    - tech: проверить счётчик на ссылке 'Чем угрожает этот сайт'
    - do: кликнуть на ссылку 'Посмотреть сохранённую безопасную копию'
    - assert: ссылка 'Посмотреть сохранённую безопасную копию' ведет на 'http://hghltd.yandex.net/yandbtm'
    - tech: проверить счётчик на ссылке 'Посмотреть сохранённую безопасную копию'
    - do: кликнуть на ссылку 'Всё равно перейти на эту страницу'
    - assert: |
        атрибут href ссылки 'Всё равно перейти на эту страницу' содержит адрес 'infected.cepera.ru',
        ссылка 'Всё равно перейти на эту страницу' ведёт на http://infected.cepera.ru/ (переход может блокироваться браузером)

specs-integration:
  beforeEach:
    - params:
        foreverdata: '907301074'
    - do: получить выдачу Поиска по запросу 'foreverdata'
    - assert: на выдаче есть сниппет завирусованного сайта
  Показать предупреждение при первом клике, при повторном – закрыть серая ссылка:
    - counter: /$page/$main/$result[@features has "infected"]/more
    - do: кликнуть/тапнуть на серую ссылку с предупреждением
    - assert: появился блок с предупреждением
    - do: повторно кликнуть/тапнуть на серую ссылку с предупреждением
    - assert: блок с предупреждением скрылся
  Показать предупреждение при первом клике, при повторном – закрыть заголовок:
    - counter: /$page/$main/$result[@features has "infected"]/more
    - do: кликнуть/тапнуть на заголовок сниппета с предупреждением
    - assert: появился блок с предупреждением
    - do: повторно кликнуть/тапнуть на заголовок сниппета с предупреждением
    - assert: блок с предупреждением скрылся
  Показать предупреждение при первом клике, при повторном – закрыть гринурл:
    - counter: /$page/$main/$result[@features has "infected"]/more
    - do: кликнуть/тапнуть на гринурл сниппета с предупреждением
    - assert: появился блок с предупреждением
    - do: повторно кликнуть/тапнуть на гринурл сниппета с предупреждением
    - assert: блок с предупреждением скрылся

files:
  - features/infected/infected@deskpad.hermione.js
  - features/infected/infected@deskpad.hermione.e2e.js

v-team: Turbo

counter: /$page/$main/$result[@features has "infected"]/safedcopy

tlds:
  - ru
  - ua
  - by
  - kz

priority: high

tags:
  - reviewed
