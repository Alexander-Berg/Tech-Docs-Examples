feature: Объектный ответ
type: Шторка жалоб

specs-integration:
  Проверка жалобщика:
    - do: получить выдачу по запросу 'мадонна'
    - assert: |
        на выдаче есть карточка объектного ответа,
        в карточке объектного ответа есть футер,
        в футере присутствует ссылка "Сообщить об ошибке"
    - do: нажать на ссылку "Сообщить об ошибке"
    - assert: Открылось модальное окно с жалобщиком

aliases:
  - &base
    - params:
        data_filter: entity-search
    - do: получить выдачу по запросу 'skype'
    - assert: на выдаче присутствует футер карточки ОО
    - assert: в футере карточки ОО присутсвует ссылка "Сообщить об ошибке"
    - do: кликнуть на ссылку "Сообщить об ошибке"
    - assert: открылось модально окно
  - &metrics
    - params:
        data_filter: entity-search
    - do: получить выдачу по запросу 'skype'
    - assert: на выдаче присутствует футер карточки ОО
    - assert: в футере карточки ОО присутсвует ссылка "Сообщить об ошибке"
    - do: нажать на ссылку "Сообщить об ошибке"
    - tech: сработал счётчик /$page/$parallel/$result/FeedbackFooter/abuse
    - assert: появилось модальное окно обратной связи
    - do: ввести в поле "Сообщение" Сделайте редизайн!
    - do: нажать на кнопку "Отправить"
    - tech: сработал счётчик /$page/$parallel/$result/FeedbackFooter/feedback-submit
    - assert: появился диалог ввода email

specs:
  Внешний вид:
    Закрытие модального окна по крестику:
      - *base
      - do: нажать на крестик в правом верхнем углу модального окна
      - assert: модальное окно должно закрыться

    Первая страница:
      - *base
      - screenshot: внешний вид первой страницы [plain]

    Загрузка картинки:
      - *base
      - do: нажать на "Прикрепить фото илил видео"
      - do: загрузить картинку image.png
      - assert: картинка загрузилась
      - screenshot: внешний вид [plain]

    Загрузка видео:
      - *base
      - do: нажать на "Прикрепить фото илил видео"
      - do: загрузить видео video.png
      - assert: картинка загрузилось
      - screenshot: внешний вид [plain]

    Загрузка картинки и видео:
      - *base
      - do: нажать на "Прикрепить фото илил видео"
      - do: загрузить картинку image.png
      - assert: картинка загрузилась
      - do: нажать на "Прикрепить фото илил видео"
      - do: загрузить видео video.png
      - assert: видео загрузилось
      - screenshot: внешний вид [plain]

    Загрузка неверного типа файла:
      - *base
      - do: нажать на "Прикрепить фото илил видео"
      - do: хагрузить файл wrong.ttt
      - assert: появилось предупреждение ".ttt не подходит. Можно прикрепить только фото или видео"
      - screenshot: внешний вид [plain]

    Первая страница с выбором чекбоксов:
      - *base
      - do: нажать на первый чекбокс "Картинка не подходит"
      - do: нажать на третий чекбокс "Ошибка в фактах под описанием"
      - screenshot: внешний вид чекбокс листа [plain]

    Вторая страница, без ввода email:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - screenshot: внешний вид содержимого модального окна [plain]

    Вторая страница, с вводом email:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - do: ввести в поле "Адрес почты" "hello@ya.ru"
      - screenshot: внешний вид содержимого модального окна [plain]

    Переход на предыдущий экран по стрелке "обратно":
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: появилась форма ввода адреса электронной почты
      - do: нажать на стрелку "обратно"
      - assert: пояивлась предыдущая страница
      - screenshot: внешний вид предыдущей страницы [back_to_slide_1]

    Третья страница:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: появилась форма ввода адреса электронной почты
      - screenshot: внешний вид содержимого модального окна [plain]
      
    Четвертая страница, без ввода email:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: появилась форма ввода адреса электронной почты
      - do: нажать на кнопку "Пропустить"
      - assert: повиялась сообщение "Спасибо за обращение"

    Четвертая страница, с вводом email:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: появилась форма ввода адреса электронной почты
      - do: нажать на кнопку "Пропустить"
      - assert: появилось сообщение "Спасибо за обращение"

    Ввод неправильного email:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - do: ввести в поле "Адрес почты" "hello"
      - assert: появилось сообщение об ошибке "Неправильный адрес"
      - screenshot: внешний вид содержимого модального окна [email]

    Дизейбл по снятию галки с политики конфиденциальности:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: появилась форма ввода адреса электронной почты
      - do: нажать на чекбокс "согласен с политикой конфиденциальности"
      - assert: кнопка "Отправить" стала не активна
      - screenshot: Внешний вид шторки [plain]

  Базовые проверки:
    С вводом email:
      - *metrics
      - do: ввести в поле "Адрес почты" "hello@ya.ru"
      - do: нажать на кнопку "Продолжить"
      - tech: сработал счётчик /$page/$parallel/$result/FeedbackFooter/feedback-sended

    Без ввода email:
      - *metrics
      - do: нажать на кнопку "Пропустить"
      - tech: сработал счётчик /$page/$parallel/$result/FeedbackFooter/feedback-sended

    Изменение email:
      - *metrics
      - do: ввести в поле "Адрес почты" "hello@ya.ru"
      - do: нажать на кнопку "Продолжить"
      - tech: сработал счётчик /$page/$parallel/$result/FeedbackFooter/feedback-sended
      - assert: появился диалог подтверждения email
      - do: нажать на кнопку "Изменить email"
      - tech: сработал счётчик /$page/$parallel/$result/FeedbackFooter/change-email

    Ссылка и счетчик на политику конфиденциальности:
      - *metrics
      - assert: появилась ссылка "политикой конфиденциальности"
      - do: нажать на ссылку "политикой конфиденциальности"
      - tech: сработал счётчик /$page/$parallel/$result/FeedbackFooter/confidential
      - assert: по ссылке в новой вкладке открылась страница https://yandex.ru/legal/confidential/

  Внешний вид футера:
    - do: получить выдачу по запросу 'skype'
    - assert: на выдаче присутствует футер карточки ОО
    - screenshot: внешний вид футера карточки ОО [plain]
  
  В табе Отзывы:
    - do: получить выдачу по запросу 'Интерстеллар отзывы'
    - assert: В табе отзывов присутствует футер ОО 

  Доступность:
    При открытии жалобщика фокус стоит на элементе внутри окна:
      - *base
      - assert: Фокус экранной читалки стоит на крестике справа сверху
    При вводе почты фокус стоит на элементе внутри окна:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: Фокус экранной читалки стоит на кнопке перехода на следующий экран
    На последнем экране фокус стоит на элементе внутри окна:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - do: ввести в поле "Адрес почты" "hello@ya.ru"
      - do: нажать на кнопку "Продолжить"
      - assert: фокус экранной читалки стоит на кнопке "Закрыть"
    Диалоговое окно связано с заголовком:
      - *base
      - assert: экранная читалка озвучила открытие окна и прочитала заголовок "Что не так в этом ответе?"
      - tech: у элемента с role=dialog аттрибут "aria-labelledby" совпадает с аттрибутом "id" у заголовка h1

files:
  - src/features/EntityFeedback/EntityFeedback.test/EntityFeedback@desktop.hermione.js
  - src/features/EntityFeedback/EntityFeedback.test/EntityFeedback@desktop.hermione.e2e.js

v-team: OO

tlds: all
