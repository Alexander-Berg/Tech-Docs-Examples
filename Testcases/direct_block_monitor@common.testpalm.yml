feature: Мониторинг блокировщиков рекламы

specs:
  Варианты скрытия:
    beforeEach:
      - params:
          exp_flags:
            - direct_block_monitor=1
            - direct_block_monitor_mode=vanilla
            - direct_block_monitor_retry_count=10
            - direct_block_monitor_retry_timeout=1000
            - direct_block_monitor_serp_item=1
            - direct_block_monitor_premium=1
            - direct_block_monitor_halfpremium=1
          foreverdata: '1920706603'
      - do: получить выдачу по запросу "foreverdata"
      - assert: на странице присутствует поисковая выдача
      - tech: сработали серверные счётчики
          - path='$page[@tech@direct_block_monitor_server@premium=3]'
          - path='$page[@tech@direct_block_monitor_server@serp_item=20]'
          - path='$page[@tech@direct_block_monitor_server@halfpremium=5]'
      - tech: сработал клиентский tech-счётчик на корневом узле с type=direct_block_monitor_client
    Без вырезания:
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client без поля hidden
    Collapsed:
      - do: вырезать первый сниппет с помощью стиля display=none
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'collapsed'
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = serp_item:'collapsed'
    Hidden:
      - do: вырезать первый сниппет с помощью стиля clip='rect(0 0 0 0)'
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'hidden'
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = serp_item:'collapsed'
    Transparent:
      - do: вырезать первый сниппет с помощью стиля opacity=0
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'transparent'
    Non interactive:
      - do: вырезать первый сниппет с помощью стиля pointer-events=none
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'noninteractive'
    Collapsed + Hidden:
      - do: вырезать первый сниппет с помощью стиля position=absolute,width=0,height=0,padding=0,visibility='hidden'
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'collapsed','hidden'
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'collapsed','hidden'
    Detached:
      - do: удалить первый сниппет из DOM-дерева
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'detached',...
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = serp_item:'detached',...
    Shifted:
      - do: вырезать первый сниппет с помощью стиля position:absolute top:-99999px
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'shifted',...
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = serp_item:'shifted',...
  Варианты отслеживания:
    Inline:
      - params:
          exp_flags:
            - direct_block_monitor=1
            - direct_block_monitor_mode=inline
            - direct_block_monitor_retry_count=10
            - direct_block_monitor_retry_timeout=1000
            - direct_block_monitor_premium=1
          foreverdata: '1920706603'
      - do: получить выдачу по запросу "foreverdata"
      - assert: на странице присутствует элемент поисковая выдача
      - tech: сработал серверный счётчик path='$page[@tech@direct_block_monitor_server@premium=1]'
      - do: вырезать ТГ с помощью стиля display=none
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'collapsed'
    Asset:
      - params:
          exp_flags:
            - direct_block_monitor=1
            - direct_block_monitor_mode=asset
            - direct_block_monitor_retry_count=10
            - direct_block_monitor_retry_timeout=1000
            - direct_block_monitor_premium=1
          foreverdata: '1920706603'
      - do: получить выдачу по запросу "foreverdata"
      - assert: на странице присутствует элемент поисковая выдача
      - tech: сработал серверный счётчик path='$page[@tech@direct_block_monitor_server@premium=1]'
      - do: вырезать ТГ с помощью стиля display=none
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'collapsed'
    Vanilla:
      - params:
          exp_flags:
            - direct_block_monitor=1
            - direct_block_monitor_mode=vanilla
            - direct_block_monitor_retry_count=10
            - direct_block_monitor_retry_timeout=1000
            - direct_block_monitor_premium=1
          foreverdata: '1920706603'
      - do: получить выдачу по запросу "foreverdata"
      - assert: на странице присутствует элемент поисковая выдача
      - tech: сработал серверный счётчик path='$page[@tech@direct_block_monitor_server@premium=1]'
      - do: вырезать ТГ с помощью стиля display=none
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = premium:'collapsed'
  Отключение форматов:
    Отключение Premium:
      - params:
          exp_flags:
            - direct_block_monitor=1
            - direct_block_monitor_mode=asset
            - direct_block_monitor_retry_count=10
            - direct_block_monitor_retry_timeout=1000
            - direct_block_monitor_serp_item=1
          foreverdata: '1920706603'
      - do: получить выдачу по запросу "foreverdata"
      - assert: на странице присутствует элемент поисковая выдача
      - tech: сработал серверный счётчик path='$page[@tech@direct_block_monitor_server@serp_item=20]'
      - do: вырезать ТГ с помощью стиля display=none
      - tech: сработал клиентский tech-счётчик type=direct_block_monitor_client c полем hidden = serp_item:'collapsed'

files:
  - features/direct_block_monitor/direct_block_monitor@common.hermione.js

v-team: Distribution

tags:
  - no_assessors

tlds: all
