feature: Управление DNS

description: |
  Preconditions.
  Для выполнения тестов нужно иметь аккаунт администратора организации c подтвержденным доменом.
  Если у вас нет такого аккаунта следуйте инструкции по его созданию, иначе пропустите.

import-steps:
  - tests/hermione/shared-steps/registration.testpalm.steps.yml

aliases:
  - &Del
      - do: нажать на кнопку в виде корзины на строке с добавленной записью
      - assert: Появилось окно "Уверены, что хотите удалить DNS-запись?"
      - do: нажать кнопку "Удалить"
      - screenshot: отображается сообщение о том, что запись удалена [notification-del]
      - do: нажать на крестик на сообщении
      - assert: запись удалилась
      - screenshot: вкладка управления ДНС без записи [dns-del]

  - &Edit
    - do: нажать на кнопку в виде карандаша на строке с добавленной записью
    - assert: открылось окно с предзаполненной формой
    - screenshot: внешний вид заполненной формы [form-edit]
    - do: в поле "Хост" ввести "test2.host"
    - do: нажать кнопку "Обновить"
    - screenshot: отображается сообщение о том, что запись обновлена [notification-edit]
    - do: нажать на крестик на сообщении
    - assert: данные в таблице обновились
    - screenshot: вкладка управления ДНС с обновленной записью [dns-edit]

  - &AddEditDel
    - screenshot: внешний вид заполненной формы [form-filled]
    - do: нажать на кнопку "Создать"
    - screenshot: отображается сообщение о том, что запись создана [notification]
    - do: нажать на крестик на сообщении
    - assert: запись добавилась
    - screenshot: вкладка управления ДНС с добавленной записью [dns]
    - *Edit
    - *Del

specs:
  beforeEach:
    - do: авторизоваться под администратором организации c подтвержденным доменом или зарегистрироваться
    - attach: Регистрация организации с промо коннекта с подтверждением домена
    - do: перейти по ссылке с подтвержденным доменом, вида {{CONNECT_HOST}}/portal/services/webmaster/test.auto.connect-test.tk

  Положительные:
    1. Внешний вид страницы домена:
      - screenshot: вид страницы домена с пустой вкладкой управления ДНС [plain]
    2. А-запись добавляется, редактируется и удаляется:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: выбрать Тип записи "A"
      - screenshot: внешний вид незаполненной формы [form-plain]
      - do: |
          в поле "Хост" ввести "test.host",
          в поле "Значение записи" ввести "1.2.3.4"
          в поле "TTL" ввести "1233"
      - *AddEditDel
    3. CNAME добавляется, редактируется и удаляется:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: выбрать Тип записи "CNAME"
      - screenshot: внешний вид незаполненной формы [form-plain]
      - do: |
          в поле "Хост" ввести "test.host",
          в поле "Значение записи" ввести "1.2.3.4"
          в поле "TTL" ввести "1233"
      - *AddEditDel
    4. AAAA добавляется, редактируется и удаляется:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: выбрать Тип записи "AAAA"
      - screenshot: внешний вид незаполненной формы [form-plain]
      - do: |
          в поле "Хост" ввести "test.host",
          в поле "Значение записи" ввести "1:2:3:4:5:6:7:8"
          в поле "TTL" ввести "1233"
      - *AddEditDel
    5. TXT-запись добавляется, редактируется и удаляется:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: выбрать Тип записи "TXT"
      - screenshot: внешний вид незаполненной формы [form-plain]
      - do: |
          в поле "Хост" ввести "test.host",
          в поле "Значение записи" ввести "testtesttest"
          в поле "TTL" ввести "1233"
      - *AddEditDel
    6. NS-запись добавляется, редактируется и удаляется:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: выбрать Тип записи "NS"
      - screenshot: внешний вид незаполненной формы [form-plain]
      - do: |
          в поле "Хост" ввести "test.host",
          в поле "Значение записи" ввести "testtesttest"
          в поле "TTL" ввести "1233"
      - *AddEditDel
    7. MX-запись добавляется, редактируется и удаляется:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: выбрать Тип записи "MX"
      - screenshot: внешний вид незаполненной формы [form-plain]
      - do: |
          в поле "Хост" ввести "test.host",
          в поле "Значение записи" ввести "testtesttest"
          в поле "Приоритет" ввести "1"
          в поле "TTL" ввести "1233"
      - screenshot: внешний вид заполненной формы [form-filled]
      - do: нажать на кнопку "Создать"
      - assert: запись добавилась
      - screenshot: вкладка управления ДНС с добавленной записью [dns]
      - *Edit
      - *Del
    8. SRV-запись добавляется, редактируется и удаляется:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: выбрать Тип записи "SRV"
      - screenshot: внешний вид незаполненной формы [form-plain]
      - do: |
          в поле "Хост" ввести "test.host",
          в поле "Значение записи" ввести "testtesttest"
          в поле "Приоритет" ввести "1"
          в поле "Вес" ввести "2"
          в поле "Порт" ввести "80"
          в поле "TTL" ввести "1233"
      - screenshot: внешний вид заполненной формы [form-filled]
      - do: нажать на кнопку "Создать"
      - assert: запись добавилась
      - screenshot: вкладка управления ДНС с добавленной записью [dns]
      - *Edit
      - *Del

  Отрицательные:
    1. Сохранение пустой формы:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: выбрать любой Тип записи
      - do: нажать кнопку "Создать"
      - screenshot: отображаются ошибки около незаполненных обязательных полей [errors]
    2. Отмена сохранения формы:
      - do: нажать кнопку "Добавить DNS-запись"
      - assert: открылось окно с формой "Новая DNS-запись"
      - do: нажать кнопку "Отменить"
      - assert: окно с формой создания dns-записи закрылось

files:
  - tests/hermione/suites/domain/dns.js

priority: blocker

tlds:
 - ru
 - com

tags:
  - smoke_test_assessors
  - regression
  - smoke_test
  - reviewed
  - smoke_test_mini
