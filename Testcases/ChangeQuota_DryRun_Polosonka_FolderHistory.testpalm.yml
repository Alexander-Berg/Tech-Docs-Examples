feature: "Dispenser: Квоты"

specs:
  beforeEach:
    - do: залогиниться под пользователем 'robot-abc-002'
    - do: открыть страницу '/services/postman_add_roles/folders?lang=ru'
    - do: нажать на ячейку таблицы с названием фолдера
    - assert: появился сайдбар
    - do: нажать на кнопку 'Изменить квоту' возле аккаунта "esenin2809211513"
    - assert: появилась форма спуска квот
  Добавление нового ресурса:
    - do: нажать на кнопку "+ Добавить ресурс"
    - assert: появился выпадающий список "Ресурс"
    - screenshot: выпадающий список "Ресурс" [https://jing.yandex-team.ru/files/sergeyzxc/uhura_2021-09-28T16%3A49%3A50.098104.png]
    - do: кликнуть по выпадающему списку и выбрать ресурс "Socrates ssd"
    - assert: отобразился баланс, больший нуля. Спущено=0. Аллоцировано = 0.
    - screenshot: новый добавленный ресурс [https://jing.yandex-team.ru/files/sergeyzxc/uhura_2021-09-28T16%3A50%3A56.658611.png]
    - do: нажать на кнопку "Отмена"
    - assert: форма спуска квот закрылась
  DryRun и полосонька:
    - do: для ресурса "Socrates hdd" кликнуть по выпадающему списку с юнитом ресурса и выбрать GiB
    - assert: значение в поле "Спущено" пересчиталось
    - do: в поле "Дельта" ввести значение "-323500"
    - assert: |
            в строке "Сейчас" все значения перечеркнуты,
            появилась строка "Станет", значения в поле "Баланс" и "Спущено" равны,
            между строками "Сейчас" и "Станет" появилось отрицательное значение из поля "Дельта"
    - screenshot: новое значение баланса [https://jing.yandex-team.ru/files/sergeyzxc/uhura_2021-09-28T16%3A53%3A18.602019.png]
    - do: нажать на кнопку 'Изменить квоту'
    - assert: |
            форма спуска квот закрылась,
            появилась плашка на зеленом фоне с текстом "Квоты успешно обновлены"
    - do: закрыть сайд бар, нажав на крестик в правом верхнем углу сайдбара
    - assert: |
            сайдбар закрылся,
            "полосонька" на против ресурса "Socrates hdd" на половину окрашена в синий и серый цвета
    - screenshot: полосонька окрашена в синий и серый цвета [https://jing.yandex-team.ru/files/sergeyzxc/uhura_2021-09-28T16%3A54%3A34.157040.png]
    - do: нажать на ячейку таблицы с названием фолдера
    - do: нажать на кнопку 'Изменить квоту' возле аккаунта "esenin2809211513"
    - do: для ресурса "Socrates hdd" кликнуть по выпадающему списку с юнитом ресурса и выбрать GiB
    - do: в поле "Спущено" ввести значение "647000"
    - do: нажать на кнопку 'Изменить квоту'
    - assert: |
            форма спуска квот закрылась,
            появилась плашка на зеленом фоне с текстом "Квоты успешно обновлены",
    - do: закрыть сайд бар, нажав на крестик в правом верхнем углу сайдбара
    - assert: |
            сайд бар закрылся,
            "полосонька" на против ресурса "Socrates hdd" полностью окрашена в синий цвет
  История изменений:
    - do: кликнуть по табу "История изменений" в верхней части сайдбара
    - assert: отображена история фолдера и первая запись содержит информацию о спуске квоты на ресурс "Socrates hdd"
    - screenshot: история фолдера [https://jing.yandex-team.ru/files/sergeyzxc/uhura_2021-09-28T16%3A55%3A39.557852.png]

files: []

priority: blocker

tags:
  - reviewed
  - no_assessors
