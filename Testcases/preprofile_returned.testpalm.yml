feature: Внешняя анкета
type: Препрофайл наниматора/Бывший сотрудник

description: |
    запросить права суперпользователя для сервиса staff
    открыть страницу https://staff.test.yandex-team.ru/preprofile/create/outstaff/
    заполнить все обязательные поля
    заполнить поле 'Логин' логином бывшего сотрудника
    в поле 'Тип кандидата' выбрать 'Вернувшийся'
    в поле 'Подразделение' выбрать подразделение outstaff (пример 'Команда поддержки бизнеса')
    на странице https://staff.test.yandex-team.ru/proposal/ выбрать указанное ранее подразделение и установить там себя заместителем руководителя и выполнить заявку
    клик 'Сохранить' на странице создания анкеты и после этого появится кнопка 'Создать внешнюю анкету'
    клик на кнопку 'Создать внешнюю  анкету'
    в анкете появится поле 'Ссылка на внешнюю анкету' с созданной ссылкой
    после отправки анкеты на странице стаффовской анкеты отобразились ранее введенные данные и статус стал 'Заполнено кандидатом'
    для вывода сотрудника на стафф необходимо нажать на кнопку в препрофайле стаффа 'Утвердить и отправить'
    после этого дождаться статуса 'Готов к выводу', тогда появится кнопка 'Вывести на стафф'
    клик на кнопку 'Вывести на стафф', у препрофайла должен стать статус 'Выведен'
    проверить пророс ли номер электронной подписи или нет можно пройдя по ссылке https://staff.test.yandex-team.ru/admin/django_intranet_stuff/staff/
    найти по ссылке выведенного сотрудника и зайти на его страницу
    если телефон не должен прорасти, то в разделе 'Staff phones' рядом с введенным ранее телефоном не должна стоять галочка 'For digital sign'

specs:
  beforeEach:
    - do: открыть страницу https://femida-ext.test.yandex-team.ru/hire/preprofiles/<id_анкеты> (если правки на стенде, надо указывать доменную часть стенда)
    - assert: |
        открылась анкета препрофайла
        поле 'Логин' задисейблено
    - screenshot: пример внешнего вида [external_questionnaire_form]
  Проверка обязательных полей:
    - do: клик на кнопку 'Отправить'
    - screenshot: под всеми обязательными полями вывелись ошибки [external_questionnaire_form_errors]
  Отправка анкеты:
    - do: заполнить поле 'Фамилия'
    - do: заполнить поле 'Имя'
    - do: заполнить поле 'Фамилия латиницей'
    - do: заполнить поле 'Имя латиницей'
    - do: выбрать значение в поле 'Фото'
    - do: заполнить поле 'Дата рождения'
    - do: выбрать значение в поле 'Пол'
    - do: заполнить поле 'Контактный телефон'
    - do: заполнить поле 'Личный email'
    - do: выбрать значение в поле 'Дата выхода на работу'
    - do: выбрать значение в поле 'Гражданство'
    - assert: |
        появилось поле 'Паспорт'
        появилось поле 'СНИЛС' (если выбрано гражданство 'Российское')
        появилось поле 'Адрес проживания'
    - do: заполнить поле 'Адрес проживания'
    - do: поставить галочку в поле согласия передачи персональных данных
    - screenshot: пример внешнего вида заполненной анкеты [external_questionnaire_form_filled]
    - do: клик на 'Отправить'
    - screenshot: выдало сообщение с благодарностью [external_questionnaire_form_success]

tags:
  - reviewed

priority: critical

browsers:
  - yandex-browser-desktop
  - firefox-desktop
  - safari-desktop

files:
  - tests/hermione/suites/desktop/external_profiles/preprofile_returned/preprofile_returned.hermione.js
