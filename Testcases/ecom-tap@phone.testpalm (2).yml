feature: Ecom-tap

params:
  exp_flags:
    - turbo-app-any-ua=1
    - analytics-disabled=1

specs:
  Отдает валидный манифест:
    - tags: no_assessors
    - do: перейти на страницу https://yandex.ru/turbo/spideradio.github.io/n/yandexturbocatalog/?manifest=1&no-assets=1
    - assert: вернулся корректный манифест

  Полный чекаут корзины:
    - tags: no_assessors #убрать тег после расскипывания TURBOUI-5039
    - do: открыть страницу https://yandex.ru/turbo/ymturbo.t-dir.com/s/catalog/slippers/slippers-favorite-sport/?product_id=214
    - screenshot: внешний вид соответствует скриншоту [initial-product-page]
    - do: кликнуть по кнопке добавить в корзину
    - screenshot: внешний вид соответствует скриншоту [product-page-item-added]
    - do: кликнуть по кнопке перейти в корзину
    - screenshot: внешний вид соответствует скриншоту [cart-page]
    - do: нажать на кнопку оформить заказ
    - screenshot: внешний вид соответствует скриншоту [cart-form-page]
    - do: заполнить поле ФИО текстом "test"
    - do: нажать на поле ввода телефона
    - assert: открылась цифровая клавиатура
    - do: ввести "+7 800 800 80 80"
    - do: нажать на поле ввода email
    - assert: открылась клавиатура, включающая значок '@'
    - do: заполнить поле email "call@example.ru"
    - do: выбрать вторую опцию доставки
    - do: заполнить поле адрес "Адрес доставки"
    - screenshot: внешний вид соответствует скриншоту [cart-form-page-filled]
    - do: выбрать способ оплаты наличными и нажать кнопку отправить
    - screenshot: внешний вид соответствует скриншоту [success-payment]

  Корзина, которая уже была отправлена:
    - tags:
        # ошибки есть только в темпларе
        no_assessors
    - do: открыть страницу https://yandex.ru/turbo/ymturbo.t-dir.com/s/catalog/slippers/slippers-favorite-sport/?product_id=214
    - do: кликнуть по кнопке добавить в корзину
    - do: кликнуть по кнопке перейти в корзину
    - do: нажать на кнопку оформить заказ
    - do: заполнить поля - 'имя already-sent', 'телефон +7 800 800 80 80', 'email call@example.ru', выбрать вторую опцию доставки, в поле адрес доставки заполнить 'Адрес доставки'
    - screenshot: внешний вид соответствует скриншоту [cart-form-page-filled]
    - do: нажать кнопку отправить
    - screenshot: внешний вид соответствует скриншоту [already-sent-form]

  Корзина с ошибками:
    - tags:
        # ошибки есть только в темпларе
        no_assessors
    - do: открыть страницу https://yandex.ru/turbo/ymturbo.t-dir.com/s/catalog/slippers/slippers-favorite-sport/?product_id=214
    - do: кликнуть по кнопке добавить в корзину
    - do: кликнуть по кнопке перейти в корзину
    - do: нажать на кнопку оформить заказ
    - do: заполнить поля - 'имя error', 'телефон +7 800 800 80 80', 'email call@example.ru', выбрать вторую опцию доставки, в поле адрес доставки заполнить 'Адрес доставки'
    - screenshot: внешний вид соответствует скриншоту [cart-form-page-filled]
    - do: нажать кнопку отправить
    - screenshot: внешний вид соответствует скриншоту [error-form]

  Paymentapi, успешно:
    - tags:
        # мокается payment_api
        no_assessors
    - do: открыть страницу https://yandex.ru/turbo/ymturbo.t-dir.com/s/catalog/slippers/slippers-favorite-sport/?product_id=214&mock_payment_requests=1
    - do: кликнуть по кнопке добавить в корзину
    - do: кликнуть по кнопке перейти в корзину
    - do: нажать на кнопку оформить заказ
    - do: заполнить поля - 'имя name', 'телефон +7 800 800 80 80', 'email call@example.ru', выбрать вторую опцию доставки, в поле адрес доставки заполнить 'Адрес доставки'
    - do: нажать кнопку оплатить
    - screenshot: внешний вид соответствует скриншоту [success-payment]

  Paymentapi, неудачно:
    - tags:
        # мокается payment_api
        no_assessors
    - do: открыть страницу https://yandex.ru/turbo/ymturbo.t-dir.com/s/catalog/slippers/slippers-favorite-sport/?product_id=214&mock_payment_requests_throw=1
    - do: кликнуть по кнопке добавить в корзину
    - do: кликнуть по кнопке перейти в корзину
    - do: нажать на кнопку оформить заказ
    - do: заполнить поля - 'имя name', 'телефон +7 800 800 80 80', 'email call@example.ru', выбрать вторую опцию доставки, в поле адрес доставки заполнить 'Адрес доставки'
    - do: нажать кнопку оплатить
    - screenshot: внешний вид соответствует скриншоту [fail-payment]

  Paymentapi, отмена:
    - tags:
        # мокается payment_api
        no_assessors
    - do: открыть страницу https://yandex.ru/turbo/ymturbo.t-dir.com/s/catalog/slippers/slippers-favorite-sport/?product_id=214&mock_payment_requests_throw_not_started=1
    - do: кликнуть по кнопке добавить в корзину
    - do: кликнуть по кнопке перейти в корзину
    - do: нажать на кнопку оформить заказ
    - do: заполнить поля - 'имя name', 'телефон +7 800 800 80 80', 'email call@example.ru', выбрать вторую опцию доставки, в поле адрес доставки заполнить 'Адрес доставки'
    - do: нажать кнопку оплатить
    - screenshot: внешний вид соответствует скриншоту [cancel-payment]

  Подскролл на морде:
    - do: открыть страницу https://yandex.ru/turbo/spideradio.github.io/n/yandexturbocatalog/main/?morda=1&ecommerce_main_page_preview=1
    - screenshot: логотип и поле поиска отображаются корректно [cover]
    - do: поскроллить страницу вниз, пока шапка не начнет скрываться
    - screenshot: логотип и поле поиска плавно скрываются [cover-scrolled]
    - do: перезагрузить страницу
    - do: поскроллить страницу вверх, до начала
    - screenshot: логотип и поле поиска полностью отображаются [cover-reload]

  Быстрый заказ:
    # в тесте корзина очищается локальным флагом
    - do: открыть страницу https://yandex.ru/turbo/ymturbo.t-dir.com/s/catalog/slippers/slippers-favorite-sport/?product_id=214
    - do: нажать на кнопку "Корзина" в нижней навигационной панели
    - do: убедиться, что в корзине нет товаров, если есть, то удалить все товары из корзины
    - do: нажать на кнопку "Каталог" в нижней навигационной панели
    - do: открыть любую карточку товара
    - do: нажать кнопку 'Быстрый заказ'
    - screenshot: внешний вид соответствует скриншоту [order-form]
    - tech: был запрос в ручку '/shopping-cart/', в которым был задан параметр `sk`
    - do: в поле 'ФИО' ввести 'Иванов Павел Васильевич'
    - do: в поле 'Телефон' ввести '+7 800 800 80 80'
    - do: в поле 'E-mail' ввести 'call@example.ru'
    - do: в поле 'Адрес доставки' ввести 'Адрес доставки'
    - screenshot: внешний вид соответствует скриншоту [order-form-filled]
    - do: нажать кнопку 'Отправить'
    - screenshot: внешний вид соответствует скриншоту [order-success]
    - tech: был запрос в ручку '/shopping-cart/final/', в которым был задан параметр `sk`

  Переход в корзину:
    По кнопке уже добавленного товара:
      - do: открыть страницу https://yandex.ru/turbo/spideradio.github.io/s/rnd/2lum7hf3?product_id=202
      - do: кликнуть на "Добавить в корзину"
      - assert: товар добавился в корзину, и "Добавить в корзину" изменилось на "Перейти в корзину"
      - do: перезагрузить страницу
      - do: дождаться, когда появится конопка "Перейти в корзину"
      - do: нажать "Перейти в корзину"
      - assert: произошел переход в корзину

  Селекторы с длинным текстом корректно отрисовываются:
    - tags: no_assessors
    - do: открыть страницу https://yandex.ru/turbo/super01.ru/s/products/kostium-kharli-kvin-otryad-samoubiits?product_id=9783-1
    - screenshot: селектор выглядит корректно [select]

  Магазин без внешней и внутренней корзины:
    Нет кнопок добавления в корзину в карусели товаров на главной странице:
      - do: открыть страницу https://yandex.ru/turbo/zenbox.ru/n/yandexturbocatalog/main/?ecommerce_main_page_preview=1&morda=1
      - assert: на странице есть карусель с карточками товаров
      - assert: на карточках товаров нет кнопок "В корзину"

    Нет кнопок добавления в корзину на листинге:
      - do: открыть страницу https://yandex.ru/turbo/zenbox.ru/n/yandexturbocatalog/?category_id=9&category_count=176
      - assert: на карточках товаров нет кнопок "В корзину"

    Нет кнопки добавления в корзину на странице товара:
      - do: открыть страницу https://yandex.ru/turbo/zenbox.ru/s/product/smartfon-xiaomi-mi-10-8128-gb-zelenyy-01482?product_id=790
      - assert: на странице товара нет кнопки "Добавить корзину"

  Presearch:
    Главная страница:
      - params:
          exp_flags:
            - turbo-app-presearch-enabled=1
      - do: открыть страницу https://yandex.ru/turbo/spideradio.github.io/n/yandexturbocatalog/main/
      - screenshot: логотип и поле поиска отображаются корректно [cover]
      - do: поскроллить страницу вниз, пока шапка не начнет скрываться
      - screenshot: логотип и поле поиска плавно скрываются [cover-scrolled]

    Каталог:
      - params:
          exp_flags:
            - turbo-app-presearch-enabled=1
      - do: открыть страницу https://yandex.ru/turbo/super01.ru/n/yandexturbocatalog/?category_id=12&category_count=6
      - screenshot: логотип и поле поиска отображаются корректно [cover]
      - do: поскроллить страницу вниз, пока шапка не начнет скрываться
      - screenshot: логотип и поле поиска плавно скрываются [cover-scrolled]

specs-integration:
  Сервис открывается:
    - do: открыть страницу https://yandex.ru/turbo/spideradio.github.io/n/yandexturbocatalog/
    - assert: открылась страница каталога

  Открытие страницы листинга:
    - do: открыть страницу https://yandex.ru/turbo/super01.ru/n/yandexturbocatalog/?category_id=13292
    - assert: открылась страница категории
    - do: поскроллить страницу вниз
    - assert: на странице подгрузились новые товары

  Главная:
    Список категорий:
      - do: открыть страницу https://yandex.ru/turbo/spideradio.github.io/n/yandexturbocatalog/main/?morda=1&ecommerce_main_page_preview=1
      - assert: на странице есть список категорий

    Баннер:
      - do: открыть страницу https://yandex.ru/turbo/spideradio.github.io/n/yandexturbocatalog/main/?morda=1&ecommerce_main_page_preview=1
      - assert: на странице есть баннер

    Товары со скидками:
      - do: открыть страницу https://yandex.ru/turbo/spideradio.github.io/n/yandexturbocatalog/main/?morda=1&ecommerce_main_page_preview=1
      - assert: на странице есть блок товаров со скиндками

    Горизонтальные галереи товаров:
      - do: открыть страницу https://yandex.ru/turbo/spideradio.github.io/n/yandexturbocatalog/main/?morda=1&ecommerce_main_page_preview=1
      - assert: на странице есть галереи "Популярные товары" и "Выгодно сегодня"

files:
    - __tests__/ecom-tap@phone.hermione.e2e.js
    - __tests__/ecom-tap@phone.hermione.js

tlds: ru

v-team: Turbo

tags:
  - ecom-tap
