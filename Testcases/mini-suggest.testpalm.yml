feature: Пословный саджест

specs:
  beforeEach:
    - do: получить выдачу по запросу 'авиасейлс'
    - do: нажать на поле ввода запроса
    - screenshot: открылся саджест (запрос может отличаться) [mini-suggest/endings-44-{{PLATFORM}} >> plain]
  Типы подсказок:
    Пословные подсказки:
      - tags: winphone7
      - do: кликнуть в первую подсказку в саджесте (в серой рамке)
      - assert: |
          поисковой строке к изначальному запросу добавился текст подсказки через пробел
          саджест по-прежнему открыт, подсказки в нем обновлены
      - do: повернуть устройство в горизонтальное положение
      - screenshot: саджест перестроился по всей ширине экрана, видно все подсказки (запрос может отличаться) [mini-suggest/endings/horizontal-48-{{PLATFORM}} >> plain]
    Длинный запрос не изменяет инпут [manual]:
      - automation: SERP-74697
      - tags: no_assessors
      - do: ввести длинный запрос 'lorem ipsum dolor sit amet consectetur adipiscing elit sed diam nonummy'
      - assert: |
          длинный текст в инпуте поисковой стрелки не перепрыгивает на новую строку и расширяет инпут, когда заканчивается место.
          длинный текст в саджесте повторяет текст запроса и не выходит за пределы экрана, а переносится по словам, если не вмещается
      - screenshot: открытый саджест с длинным текстом [mini-suggest/fulltext-46-{{PLATFORM}} >> plain]
    Навигационная подсказка:
      - tags: winphone7
      - assert: в саджесте есть блок с крупным заголовком и зеленой ссылкой (если нет - попробуйте ввести альтернативные запросы 'музыка яндекс','сбербанк')
      - assert: текст заголовка ссылки обрезается троеточием если не вмещается в экран
      - do: кликнуть на заголовок с зеленой ссылкой (в саджесте)
      - assert: в новой вкладке открылся выбранный сайт
    Адаптация под ширину экрана очень длинной навигационной подсказки [manual]:
      - automation: SERP-74697
      - tags: no_assessors
      - do: вернуться на выдачу и ввести много а на английской раскладке, пока не появится длинная ссылка в саджесте
      - assert: зеленая ссылка в саджесте должна обрезаться троеточием ближе к концу экрана
      - screenshot: скриншот с длинным урлом [mini-suggest/long-url-47-{{PLATFORM}} >> plain]
    Фактовая подсказка:
      - do: нажать крестик в поисковой строке
      - do: начать вводить запрос на 'погода в мо'
      - screenshot: в саджесте появилась фактовая подсказка (про погоду в Москве с иконкой погоды или просто количеством градусов) [mini-suggest/facts-45-{{PLATFORM}} >> plain]
      - do: нажать на подсказку о погоде в Москве
      - assert: |
          загружается новая страница с выдачей
          в поисковой строке теперь запрос - 'погода в москве'
          саджест закрылся
    Полнотекстовая подсказка:
      - tags: no_assessors
      - do: восстановить запрос 'погода в мо'
      - tech: блок mini-suggest__item_type_fulltext должен присутствовать
      - assert: в саджесте есть полнотекстовая подсказка (напр. 'погода в москве' или погода в москве на завтра, подсказки без серых плашек)
      - do: кликнуть в полнотекстовую подсказку
      - assert: страница перезагрузилась, показывается выдача по запросу из полнотекстовой подсказки
  Манипуляции:
    При перезапросе текст элемента подставляется в url:
      - do: нажать на любую из предложенных подсказок (в серой рамке)
      - do: нажать кнопку 'Найти' поисковой формы
      - assert: страница перезагрузилась с новым запросом
      - tech: параметр text в урле – это изначальный запрос + текст первого элемента саджеста
      - assert: саджест закрыт
    Клик вне блока - саджест должен скрыться:
      - do: нажать на любую часть экрана вне саджеста
      - assert: саджест закрыт
    Клик на крестик и повторный ввод 1 символа - саджест должен скрыться и появиться:
      - do: нажать крестик в поисковой строке
      - assert: |
          поле ввода очистилось
          саджест закрылся
      - do: ввести один симовол, например '1'
      - assert: саджест снова открылся
    Backspace - подсказки обновляются:
      - do: нажать на первую из предложенных подсказок (в серой рамке)
      - do: нажать 1 раз backspace на клавиатуре (удалить последний символ)
      - assert: элементы саджеста обновились
  Счетчики:
    Время total_input_time и since_first_change должны быть больше 0:
      - tags: no_assessors
      - do: изменить запрос на 'погода '
      - do: кликнуть в кнопку 'Найти'
      - do: дождаться загрузки страницы
      - tech: должен отправиться запрос с маской '/clck/jclck/dtype=stred/pid=0/cid=2873/path=granny-touch'
      - tech: в запросе параметр total_input_time >= 0
      - tech: в запросе параметр since_first_change >= 0
    При перезапросе проклеивается один и тот же suggest_reqid:
      - tags: no_assessors
      - do: изменить запрос на 'погода '
      - do: кликнуть в кнопку 'Найти'
      - do: дождаться загрузки страницы
      - tech: должен отправиться запрос с маской '/clck/jclck/dtype=stred/pid=0/cid=2873/path=granny-touch'
      - tech: в запросе параметр suggest_reqid одинаковый по значению с параметром suggest_reqid новой страницы
    Содержит правильный suggest_reqid в запросах к ручке саджеста и в счетчиках:
      - do: изменить запрос на "rwus"
      - do: набрать символ на клавиатуре "s"
      - do: кликнуть в кнопку "Найти"
      - assert: страница перезагрузилась с новым запросом
      - assert: получена выдача по указанному запросу
      - tech: должны отправиться запросы с масками 'part=rwuss' и 'cid=2873'
      - tech: в запросах с масками 'part=rwuss' и 'cid=2873' параметры suggest_reqid одинаковые по значению
    Содержит верное количество запросов/ответов:
      - tags: no_assessors
      - do: изменить запрос на 'погода'
      - do: удалить два последних символа
      - tech: должен отправиться запрос с маской '/clck/jclck/dtype=stred/pid=0/cid=2873/path=granny-touch'
      - tech: в запросе параметр 1 <= cchd <= 3
      - tech: в запросе параметр 6 <= rsp <= 8
      - tech: в запросе параметр 6 <= rqs <= 8
      - tech: в запросе параметр 6 <= rndr <= 8
    Содержит верное количество пустых ответов:
      - tags: no_assessors
      - do: изменить запрос на 'rwusqsd'
      - do: удалить два последних символа
      - tech: должен отправиться запрос с маской '/clck/jclck/dtype=stred/pid=0/cid=2873/path=granny-touch'
      - tech: в запросе параметр 2 <= ersp <= 4
    Содержит количество кликов на саджест:
      - tags: no_assessors
      - do: изменить запрос на 'погода'
      - do: кликнуть в первую пословную подсказку
      - do: дождаться появления новых подсказок
      - do: кликнуть в первую пословную подсказку
      - do: дождаться появления новых подсказок
      - do: кликнуть в первую пословную подсказку
      - tech: должен отправиться запрос с маской '/clck/jclck/dtype=stred/pid=0/cid=2873/path=granny-touch'
      - tech: в запросе параметр clks = 3
    При удалении и вводе state должен быть равен edit:
      - tags: no_assessors
      - do: изменить запрос на 'погода '
      - do: кликнуть в первую пословную подсказку
      - do: удалить 3 символа, включая пробел
      - do: добавить 3 символа 'ода'
      - do: кликнуть в кнопку 'Найти'
      - tech: должен отправиться запрос с маской '/clck/jclck/dtype=stred/pid=0/cid=2873/path=granny-touch'
      - tech: запрос содержит подстроку 'path=granny-touch.edit.p0.nah_not_used.button_by_mouse'

files:
# - features/touch-phone/mini-suggest.autogenerated.hermione.js
  - hermione/test-suites/touch-phone/mini-suggest.hermione.js

tags:
  - suggest
  - smoke
  - smoke_extended
  - head
  - reviewed

v-team: Suggest_Freshness

browsers:
  - iphone
  - chrome-phone

tlds: none
