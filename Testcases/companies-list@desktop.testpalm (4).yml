feature: Сети/Рубрики
type: Фильтры списка организаций

specs-integration:
  Проверка наличия фильтров:
    - do: получить выдачу по запросу 'кафе'
    - assert: появился колдунщик сети/рубрики
    - assert: колдунщик содержит не меньше одного фильтра

params:
  # выключаем срабатывание БК для асессоров
  srcparams: GEOV:rearr=scheme_Local/Geoupper/ViewTypeForBornedSerp=orgmn_right
  serp-reload-from: 'companies'

specs:
  beforeEach:
    - do: получить выдачу по запросу 'аптеки'
    - screenshot: внешний вид колдунщика сетей/рубрик [org-list-new-with-filters >> plain]
  Проверка работы фильтров:
    - tags:
        - button
        - maps
    - label: org-list-new-with-filters
    - screenshot: внешний вид колдунщика сетей/рубрик [plain]
    - do: нажать на вторую кнопку в фильтрах (над картой)
    - tech: сработал динамический счетчик /parallel/result/snippet/composite/filters/open_now
    - assert: |
        кнопка фильтра стала нажатой (темнее),
        количество пинов на карте изменилось
    - do: повторно нажать на вторую кнопку в фильтрах (над картой)
    - assert: |
        кнопка фильтра вернулась в исходное положении (светлая),
        количество пинов на карте изменилось
    - assertMetrics: '*'
  Проверка удаления выбранного пина с карты при фильтрации:
    - do: кликнуть на фильтр Круглосуточно (или Открыто)
    - assert: |
        список организаций обновился,
        пины на карте обновились,
        выделенный до фильтрации пин удалился с карты
  Работа геолокации в фильтрах:
    - tags:
        - button
        - maps
        - location
    - do: нажать на кнопку  'Рядом со мной' (возможно потребуется разрешить браузеру доступ к местоположению)
    - tech: сработал динамический счетчик /parallel/result/composite/filters/distance
    - assert: |
        кнопка фильтра стала нажатой (темнее),
        пины на карте изменились после применения фильтра,
        на карте отображается иконка местоположения пользователя
    - assertMetrics: '*'
  Проверка сообщения о невозможности определить геолокацию:
    - tags:
        - button
        - maps
        - location
    - do: запретить определение местоположения в браузере
    - assert: попап под кнопкой 'Рядом со мной' c сообщением о необходимости включения определения местоположения отсуствует
    - do: нажать на кнопку 'Рядом со мной'
    - assert: |
        появился попап под кнопкой 'Рядом со мной' c сообщением о необходимости включения определения местоположения,
        точки на карте не изменились после применения фильтра
    - assertMetrics: '*'
  Проверка пустого ответа:
    - tags:
        - maps
    - do: переместить центр карты в область, где нет пинов
    - assert: на карте пины отсутствуют
    - screenshot: под картой появилось сообщение 'Ничего не нашлось. Уточните запрос или измените масштаб карты.'[not-found]

files:
  - features/companies/list/filters/companies-list@desktop.hermione.js
  - features/companies/list/filters/companies-list@desktop.hermione.e2e.js

v-team: VanillaGeo

counter: /$page/$parallel/$result[@wizard_name="companies" and @subtype="map"]/composite/text_filter

tags:
  - hasE2E

tlds: all
