feature: Hotels / Колдунщик одной организации
type: Стандартный вид

counter: /$page/$main/$result[@wizard_name="companies" and @subtype="travel_company"]/composite/hotels-form/submit

specs:
  beforeEach:
    - do: получить выдачу по запросу 'отель Космос Москва'(если оферов нет необходимо попробовать ВСЕ альтернативные запросы) _ALTERNATIVE_SEARCH_QUERIES_
    - assert: в выдаче присутствует карточка отеля
    - assert: в карточке отеля есть врезка с поиском номеров
  Проверка наличия табиков в карточке отеля:
    - tags:
        - 1org
        - tabs
    - assert: присутствует табик «Про отель»
    - assert: присутствует табик «Номера»
    - assert: присутствует табик «N отзывов», где N — количество отзывов
    - assert: присутствует табик «Номера»
    - assert: присутствует табик «Фото»
  Внешний вид врезки поиска номеров:
    - tags:
        - no_assessors
    - label: hotel-rooms-inset-{{BROWSER_TYPE}}
    - screenshot: внешний вид врезки [hotel-rooms-inset]
  Общие проверки:
    - tags:
        - 1org
        - sideblock
        - filters
        - popup
        - smoke
        - pp_new_core
    - do: кликнуть на заголовок врезки 'Предложения партнеров'
    - assert: открылся оверлей с открытым табом "Номера"
    - assert: в оверлее есть фильтры, результаты поиска и похожие отели
    - do: кликнуть на селект с количеством гостей
    - assert: открылся попап с выбором количества гостей
    - do: кликнуть напротив взрослых кнопку 'плюс'
    - do: нажать на кнопку 'Назад' в браузере (В поисковом приложении нажать Отмена)
    - assert: попап с выбором количества гостей закрылся
    - do: нажать на кнопку 'Назад' в браузере (В поисковом приложении нажать на кнопку 'Назад' в интерфейсе)
    - assert: оверлей с поиском номеров закрылся
    - do: кликнуть по любому оферу партнера в первой карточке номера
    - assert: произошел переход на сайт партнера
    - assertMetrics:
        - feature.web.wizards_common.orgs_wiz_main.total.shows
        - feature.web.wizards_common.orgs_wiz_main.total.external_clicks
        - feature.web.wizards_common.orgs_wiz_main.total.dynamic_clicks
        - web.total_request_count
        - daily.total_session_count
  Проверка формы врезки поиска номеров:
    - tags:
        - 1org
        - popup
        - button
        - submit
        - filters
        - datasync
        - sideblock
    - do: кликнуть на селект с количеством гостей
    - assert: открылся попап с выбором количества гостей
    - do: кликнуть напротив взрослых кнопку 'плюс'
    - do: кликнуть напротив взрослых кнопку 'минус'
    - screenshot: внешний вид попапа [hotel-rooms-inset-changed]
    - do: кликнуть на кнопку 'Сохранить'
    - assert: попап с выбором количества гостей закрылся
    - do: кликнуть на кнопку 'Показать цены' в форме врезки
    - assert: открылся оверлей с открытым табом "Номера"
    - assert: в оверлее есть фильтры
    - assert: значения фильтров с выдачи пробросились в фильтры овереля
    - assertMetrics:
        - feature.web.wizards_common.orgs_wiz_main.total.shows
        - feature.web.wizards_common.orgs_wiz_main.total.external_clicks
        - feature.web.wizards_common.orgs_wiz_main.total.dynamic_clicks
        - web.total_request_count
        - daily.total_session_count
  Проверяем внешний вид похожих:
    - do: проскроллить колдунщик до раздела похожих отелей
    - assert: у похожих отелей есть название, рейтинг, адрес, цена (либо статус "Уточните цену" или "Нет номеров")
  Проверка оффера в сайдблоке отеля:
    - tags:
        - 1org
        - submit
        - sideblock
        - smoke
    - do: кликнуть по кнопке 'Показать цены' в форме поиска номеров
    - assert: открылся сайдблок на вкладке "номера"
    - assert: запустился поиск номеров
    - assert: отобразились результаты поиска
    - do: кликнуть по любому оферу любого номера
    - assert: произошел переход на партнёрский сайт
  Тайтл филиалов в сайдблоке:
    - tags:
        - 1org
        - sideblock
    - do: кликнуть по кнопке 'Все филиалы'
    - assert: |
        открылся сайдблок
        в заголовке сайдблока написано "Radisson Hotels"
  Нажатие на кнопку выбрать номер с ценой и без цены:
    - tags:
        - 1org
        - sideblock
        - hotels-form
        - submit
    - do: кликнуть в таб 'Про отель'
    - assert: открылся сайдблок с информацией об отеле
    - assert: кнопка "Выбрать номер" под галереей фото содержит цену
    - screenshot: примерный вид кнопки [booking-button-with-price]
    - do: в блоке 'Предложения партнеров' установить дату выезда с большим временным промежутком от даты заезда (2 месяца или больше)
    - do: кликнуть в "Показать цены" в форме поиска номеров
    - assert: открылся таб Номера
    - assert: показался список Похожих отелей
    - do: кликнуть в первый отель в списке
    - assert: открылся сайдблок с информацией об отеле
    - assert: в кнопке "Выбрать номер" под галереей фото отсутствует цена, надпись расположена посередине кнопки
    - screenshot: примерный вид кнопки [booking-button-without-price]
  Кнопки выбора номеров подсвечиваются при скроле:
    - assert: |
        на странице присутствует кнопка "Выбрать номер" под галереей фото
        кнопка подсвечена желтым
    - do: проскроллить страницу до тех пор, пока вверху не окажется форма поиска номеров
    - assert: кнопка "Показать цены" в форме поиска номеров подсвечена желтым
    - do: проскроллить страницу до тех пор, пока вверху не окажется кнопка "Все предложения"
    - assert: кнопка "Все предложения" подсвечена желтым
  Клик в "Все предложения" со сменой даты открывает таб "Номера" с новой датой:
    - do: кликнуть в таб 'Про отель'
    - assert: открылся сайдблок
    - do: в блоке "Предложения партнеров" поменять дату и нажать "Показать цены"
    - assert: открылся таб "Номера" в сайдблоке c офферами на новую дату
    - do: кликнуть на таб "Про отель"
    - assert: открылся таб "Про отель" в сайдблоке
    - do: проскроллить страницу до блока "Предложения партнеров" и кликнуть в ссылку "Все предложения"
    - assert: открылся таб "Номера" в сайдблоке c офферами на новую дату
  Услуги отеля:
    - tags:
        - 1org
        - sideblock
        - tabs
    - assert: |
        появился колдунщик отеля
        в колдунщике есть список услуг отеля
    - do: нажать на "Все услуги отеля"
    - assert: открылся сайдблок отеля на вкладке "Услуги"
    - screenshot: примерный внешний вид [features-tab]
    - do: переключиться на вкладку "Про отель" (может потребоваться пролистать список вкладок)
    - assert: на вкладке "Про отель" есть развернутый список услуг (может потребоваться пролисать информацию об отеле)
    - assertMetrics: '*'
  В сайдблоке с картой есть похожие отели:
    - tags:
        - 1org
        - map
        - pin
        - sideblock
    - do: получить выдачу по запросу 'гостиница космос москва'
    - assert: на странице присутствует колдунщик отеля
    - do: кликнуть в превью карты в колдунщике отеля
    - assert: открылся сайдблок с картой, на карте присутствует один красный пин c информацией об отеле внизу экрана и несколько синих
    - screenshot: примерный внешний вид карты с пинами [map-overlay]
  Табы на выдаче:
    Сайдблок с номерами открывается с выдачи:
      - do: кликнуть в таб "Номера"
      - assert: открылся таб "Номера в сайдблоке"
    Сайдблок с отзывами открывается с выдачи:
      - do: кликнуть в таб "N отзывов"
      - assert: открылся сайдблок на табе "N отзывов"
    Сайдблок с фото открывается с выдачи:
      - do: кликнуть в таб "Фото"
      - assert: открылся таб "Фото" в сайдблоке
    Сайдблок с услугами открывается с выдачи:
      - do: кликнуть в таб "Услуги"
      - assert: открылся таб "Услуги" в сайдблоке
  Ссылка Яндекс.Путешествия в подвале колдунщика:
    - do: кликнуть в ссылку "Яндекс.Путешествия" в подвале колдунщика
    - assert: открылся промо сайт Яндекс.Путешествия на блоке "Как подключить Путешествия"
  Динамическое обновление результатов и похожих:
    Основные проверки:
      - tags:
          - 1org
          - hotels-form
          - sideblock
          - spinner
          - offers
          - datasync
      - do: в блоке 'Предложения партнеров' сменить даты заселения и выселения, а также количество гостей
      - do: нажать на кнопку 'Показать цены'
      - assert: |
          открылся оверлей с открытым табом 'Номера',
          в табе отобразились предложения и блок 'Похожие отели',
          данные в форме 'Предложения партнеров' совпадают с выбранными на предыдущем шаге
      - do: кликнуть в первую карточку из 'Похожих мест'
      - assert: |
          открылся сайдблок с выбранным отелем,
          данные в форме 'Предложения партнеров' совпадают с выбранными на предыдущем шаге,
          присутствует блок 'Похожие отели'
      - do: нажать на кнопку 'Назад'
      - do: перейти во вкладку 'Про отель'
      - do: нажать на первую карточку из результатов поиска
      - assert: произошел переход на сайт партнера
      - do: вернуться обратно
      - do: нажать на кнопку 'Назад'
      - do: кликнуть во вторую карточку из 'Похожих'
      - assert: |
          открылся сайдблок с выбранным отелем,
          данные в форме 'Предложения партнеров' совпадают с выбранными на предыдущем шаге
      - do: нажать на кнопку 'Назад'
      - do: нажать на первую карточку из результатов поиска
      - assert: произошел переход на сайт партнера
      - assertMetrics: '-'
    Внешний вид:
      - tags:
          - 1org
          - submit
          - sideblock
          - spinner
          - offers
      - do: нажать на кнопку 'Выбрать номер'
      - assert: |
          открылся оверлей с открытым табом 'Номера',
          в табе 'Номера' отображается спиннер, обозначающий поиск результатов,
          после исчезновения спиннера отобразились предложения,
          под предложениями есть блок 'Похожие отели'
      - screenshot: внешний вид офферов [list-in-number-tab]
      - screenshot: внешний вид похожих [similar-in-number-tab]
      - assertMetrics: '-'
    Внешнешний вид при ненайденных предложениях:
      - tags:
          - 1org
          - hotels-form
          - submit
          - error
          - tabs
      - do: в блоке 'Предложения партнеров' сменить дату выселения (найти даты, когда все номера заняты) и выбрать побольше гостей
      - do: нажать на кнопку 'Показать цены'
      - assert: |
          открылся оверлей с открытым табом 'Номера',
          в табе 'Номера' отображается спиннер, обозначающий поиск результатов,
          после исчезновения спиннера отобразилось сообщение об отсутствии предложений,
          под сообщением присутствует блок 'Похожие отели'
      - screenshot: внешний вид [error-and-similar]
      - do: перейти во вкладку 'Про отель'
      - assert: в блоке 'Предложения партнеров' есть сообщение об отсутствии предложений, присутствует блок 'Похожие отели'
      - do: нажать на кнопку 'Назад'
      - assert: в блоке 'Предложения партнеров' есть сообщение об отсутствии предложений, присутствует блок 'Похожие отели'
      - assertMetrics: '-'
    Изменение цены на кнопке:
      - tags:
          - 1org
          - dates
          - hotels-form
          - submit
          - sideblock
      - do: изменить дату выезда на более позднюю, чем указано в форме
      - do: нажать на кнопку 'Показать цены'
      - assert: открылся оверлей с открытым табом 'Номера'
      - do: |
          запомнить цену первого предложения
          закрыть оверлей, кликнув в стрелку назад в левом верхнем углу
      - assert: |
          оверлей закрылся
          цена на желтой кнопке совпадает с ценой первого предложения в оверлее
      - assertMetrics: '-'
    Клик в Похожие cо сменой даты открывает похожий отель в сайдблоке с новой датой:
      - do: кликнуть в таб 'Про отель'
      - assert: открылся сайдблок
      - do: проскроллить страницу до самого низа и кликнуть в любой отель из раздела "Похожие"
      - assert: открылась страница похожего отеля в сайдблоке
      - do: кликнуть в стрелку Назад
      - assert: сайдблок похожего отеля закрылся, открылся отель из первоначального запроса внизу страницы
      - do: проскроллить страницу наверх до раздела "Предложения партнеров", поменять дату в форме и нажать "Показать цены"
      - assert: открылся таб "Номера" в сайдблоке
      - do: кликнуть на таб "Про отель"
      - assert: открылся таб "Про отель" в сайдблоке
      - do: проскроллить страницу до самого низа и кликнуть в любой отель из раздела "Похожие"
      - assert: открылась страница похожего отеля в сайдблоке
      - do: проскроллить страницу до блока "Предложения партнеров"
      - assert: дата в форме новая
  Цены на номера:
    beforeEach:
      - do: получить выдачу по запросу 'Хаятт Ридженси Екатеринбург' _ALTERNATIVE_SEARCH_QUERIES_
      - assert: на выдаче есть колдунщик отеля
      - assert: в колдунщике есть блок "Предложения партнеров"
    Внешний вид на выдаче:
      - tags:
          - 1org
          - hotels-form
          - smoke
      - screenshot: внешний вид блока "Предложения партнеров" [hotels-form-on-serp]
    Кнопка "Все предложения" открывает таб Номера:
      - tags:
          - 1org
          - hotels-form
          - sideblock
      - do: кликнуть по кнопке "Все предложения" в блоке "Предложения партнеров"
      - assert: открылся сайдблок отеля на вкладке Номера

specs-integration:
  beforeEach:
    - do: получить выдачу по запросу 'гостиница космос москва' _ALTERNATIVE_SEARCH_QUERIES_
    - assert: появился колдунщик 1org с блоком поиска номеров
  В колдунщике присутствуют необходимые элементы:
    - tags:
        - hotels-form
        - 1org
        - submit
        - offers
        - smoke
    - assert: |
        блок поиска номеров содержит тайтл,
        блок поиска номеров содержит фильтр выбора даты заселения,
        блок поиска номеров содержит фильтр выбора даты выселения,
        блок поиска номеров содержит фильтр выбора количества гостей,
        блок поиска номеров содержит кнопку 'Показать цены',
        блок поиска номеров содержит список с предложениями
  В сайдблоке на табе Номера присутствуют необходимые элементы:
    - tags:
        - 1org
        - sideblock
        - hotels-form
        - offers
    - do: кликнуть в кнопку "Выбрать номер"
    - assert: |
        открылся сайдблок на вкладке номера
        сайдблок содержит форму поиска номеров,
        сайдблок содержит список номеров
  В сайдблоке с картой присутствуют необходимые элементы:
    - tags:
        - no_assessors
    - do: кликнуть в карту
    - assert: открылся сайдблок с картой сайдблок содержит желтую кнопку "Выбрать номер"

files:
  - features/companies/hotels/hotel@touch-phone.hermione.js
  - features/companies/hotels/hotel@touch-phone.hermione.e2e.js

v-team: KotTeam

tags:
  - hasE2E

browsers:
  notFor:
    - searchapp-phone

tlds: all
