feature: Добавление и удаление управляющего

specs:
  beforeEach:
    - do: (PREPARE) запустить в Runner в директории "Front" сценарий "Добавление и удаление управляющего" (https://github.yandex-team.ru/pixel/abc-runner)
    - do: (PREPARE) проверить, что robot-cat-leopold является руководителем в сервисе с id=3922 (/services/postman_servise_for_patch/)
    - do: (PREPARE) проверить, что robot-spike-spiegel не является управляющим в сервисе с id=3922 (/services/postman_servise_for_patch/)  
 
  Добавление и удаление управляющего:
    - do: отправить запрос "Добавить управляющего" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201" 
    - screenshot: ответ на запрос должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2010-56-54.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Узнать id управляющего для удаления" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2010-58-07.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удаление управляющего" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "204" и без тела
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Пользователь с ограниченной ролью не может запросить роль управляющего:
    - do: отправить запрос "Ограниченная роль" с токеном "robot-cat-matroskin"
    - assert: пришёл ответ со статусом "403" и телом "Your permissions are not enough"
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"    

  Пользователь с сильно ограниченной ролью не может запрость роль управляющего:
    - do: отправить запрос "Сильно ограниченная роль" с токеном "robot-cat-bayun"
    - assert: пришёл ответ со статусом "403" и телом "Your permissions are not enough"
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"  

priority: blocker

files:
  - tests/unit/services/api/test_responsibles.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:abc:src/blocks/desktop/service-responsible-editor/**
  - fitcher:abc:src/blocks/desktop/service-responsible-member/**
  - fitcher:plan:tests/unit/services/api/test_responsibles.py

