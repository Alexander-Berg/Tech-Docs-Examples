feature: Объектный ответ
type: Карусель
description: кнопка "Избранного" может отсутствовать - это не баг.

counter: /$page[@ui="touch"]/$main/$result[@wizard_name="entity_search"]/carousel

specs-integration:
  Присутствует на странице:
    - tags:
      - smoke
      - pp_new_core
    - counter: /$page[@ui="touch"]/$main/$result[@wizard_name="entity_search"]/carousel/showcase/item
    - do: получить выдачу по запросу «стражи галактики актеры» _ALTERNATIVE_SEARCH_QUERIES_
    - assert: на выдаче есть карусель объектов
    - assert: в карусели есть элементы
    - assert: в карусели есть заголовок

specs:
  Проверка внешнего вида:
    - do: получить выдачу по запросу 'Стражи галактики часть 2 актеры' и кликнуть в любой элемент плитки (в любого актера)
    - assert: на выдаче есть карусель
    - screenshot: внешний вид [plain]

  Проверка внешнего вида на большой ширине:
    - do: получить выдачу по запросу 'Стражи галактики часть 2 актеры' и кликнуть в любой элемент плитки (в любого актера)
    - assert: на выдаче есть карусель
    - screenshot: внешний вид на ширине 800px [plain]

  Проверка внешнего вида в середине выдачи:
    - params:
        foreverdata: '1312383743'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: на выдаче есть карусель
    - screenshot: пример внешнего вида карусели [plain]

  Проверить ссылки и счетчики:
    - do: получить выдачу по запросу 'Стражи галактики часть 2 актеры' и кликнуть в любой элемент плитки (в любого актера)
    - assert: на выдаче есть карусель
    - tech: должен сработать счётчик показа карусели
    - do: проверить ссылку на тумбе первого элемента
    - assert: |
        произошел перезапрос серпа и обновилась выдача
        на выдаче есть список с актерами

  Проверить счетчик на свайп карусели:
    - do: получить выдачу по запросу 'Стражи галактики часть 2 актеры' и кликнуть в любой элемент плитки (в любого актера)
    - assert: на выдаче есть карусель
    - do: свайпнуть карусель влево
    - assert: карусель скроллится
    - tech: сработал динамический счетчик
    - tech: в счётчике присутсвует атрибут baobab-event-json с event, равным scroll, и behaviour, равным {type=dynamic}

  Проверка карусели при перезадаче запроса:
    - browsers:
        notFor:
          - searchapp-phone
    - tags:
        - smoke_extended
        - pp_new_core
    - do: получить выдачу по запросу 'Стражи галактики часть 2 актеры' и кликнуть в любой элемент плитки (в любого актера)
    - assert: на выдаче есть карусель
    - do: сделать аякс-перезапрос с текстом 'Лучшие фильмы'
    - assert: появилась новая карусель

  Проверить карусель с разными типами картинок (часть 1):
    - do: получить выдачу по запросу 'США' с параметром &ento=0zH4sIAAAAAAAAAx2Pz3KbMBjEZzqdHnrsqU_RCGESc-h0AkLYDsJFSEbWDawEbIRN_Qcwr9Njpw_YW0WOq9V-v93Pn863_tGef_nzUV-u3y668c_E90sKpKhA8Ovk7yy3UwvdS9YuZDbvEuhaxZHeX7nXFfvnZrX3RmGrNof6rQj1qNCpz3hF1UGjGHkyxRiqgMCUO4vk4EmGV0dWxzYJ-l6OHoksDHNOqQoc9GJ0ilftmqslCYbN5BMLAxkoTLAmXGwQE9XK-L7Jd0avKVj2DCmqMh3wRtUUEMOndAcctOZ6ndznxqdHc49zIUFil30mZJojjcjkj3XPcJXmgelneBLuehbo4zuvqR0KVivTd2by031EMQasJoPhj7xpJw3XnJzNPkSQRyYtA-KYPDQ8lDTVvmB8yDbKlpCYTFVTODyaTZdca6GgkoWW47ZWGQmxiEMV5zV2GI-D975Tf1xN-7zX59PBLzd3mQ1aVctcNu69EJvLlll2nl1bAYd2Z9O3XeiOuaBtAWcvP5MTVqEGRcjTOPYrED0ktzj0QPSU3PaIlir0wRYll9h3l7H_AKJZCSKWdFd_ANuOVq5vmXcXRIJWsfkbld-_fvj978ff_2AeiB48AgAA
    - screenshot: пример внешнего вида [spain]
    - assert: на выдаче есть карусель
    - do: получить выдачу по запросу 'Гильермо дель Торо' с параметром &ento=0oEhBydXcxMDM4NTczLWFzc29jGAIxOsx8
    - screenshot: пример внешнего вида [toro]
    - assert: на выдаче есть карусель
    - assertMetrics:
        - daily.total_session_count
        - web.total_request_count
        - web.total_click_count
        - web.total_all_click
        - web.abandonment
        - web.tech_part_misc_click
        - all.total_dynamic_click_count
        - feature.web.wizards_common.entity_search_wizard_main.total.clicks

  Проверить карусель с разными типами картинок (часть 2):
    - do: получить выдачу по запросу 'Logan' с параметром &ento=0oEhBydXcxMDU1ODUwLWFzc29jGAICiGKy
    - screenshot: пример внешнего вида [logan]
    - assert: на выдаче есть карусель
    - do: получить выдачу по запросу 'Лабрадор ретривер' с параметром &ento=0oEg9ydXcxMjYwMjktYXNzb2MYAo2Obp4
    - screenshot: пример внешнего вида [labrador]
    - assert: на выдаче есть карусель
    - assertMetrics:
        - daily.total_session_count
        - web.total_request_count
        - web.total_click_count
        - web.total_all_click
        - web.abandonment
        - web.tech_part_misc_click
        - all.total_dynamic_click_count
        - feature.web.wizards_common.entity_search_wizard_main.total.clicks

  Проверить карусель с разными типами картинок (часть 3):
    - do: получить выдачу по запросу 'Пабло Пикассо произведения' с параметром &ento=0oEg1ydXcyNTY3OS1wcm9qGAK3S5_N
    - screenshot: пример внешнего вида [picasso]
    - assert: на выдаче есть карусель
    - do: получить выдачу по запросу 'Гарри Поттер и философский камень (книга)' с параметром &ento=0oEg9ydXcyMzI3MTgtYXNzb2MYAlT2roY
    - screenshot: пример внешнего вида [harry-potter]
    - assert: на выдаче есть карусель
    - do: получить выдачу по запросу 'пираты карибского моря фильм 2003' с параметром &ento=0oEhBydXczMDEzODIyLWFzc29jGALkg-F6
    - screenshot: пример внешнего вида [pirates-of-caribbean]
    - assert: на выдаче есть карусель
    - assertMetrics:
        - daily.total_session_count
        - web.total_request_count
        - web.total_click_count
        - web.total_all_click
        - web.abandonment
        - web.tech_part_misc_click
        - all.total_dynamic_click_count
        - feature.web.wizards_common.entity_search_wizard_main.total.clicks

  Отображение карусели в альбомной ориентации:
    - do: получить выдачу по запросу 'Стражи галактики часть 2 актеры' и кликнуть в любой элемент плитки (в любого актера)
    - assert: на выдаче есть карусель
    - do: повернуть устройство в альбомную ориентацию
    - screenshot: внешний вид [plain]

  Логирование my_ugc:
    - params:
        foreverdata: '3519841758'
    - tags: no_assessors
    - do: получить выдачу по запросу 'foreverdata'
    - assert: на выдаче есть карусель
    - tech: сработал счетчик path='/$page[@tech@entity-ugc-empty=1]'

  Внешний вид попапа с выставлением оценки:
    - params:
        foreverdata: '1312383743'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        на выдаче присутствует темная карусель с фильмами
        у первого фильма присутствует персональный рейтинг
    - do: кликнуть по персональному рейтингу
    - assert: открылся попап с выставлением оценки фильму
    - screenshot: внешний вид [plain]

  Карусель без списка "смотрите также":
    - do: получить выдачу по запросу 'кино'
    - assert: на выдаче присутствует темная карусель с фильмами
    - screenshot: внешний вид [plain]

  Проверка отсутствия спиннера, если нет объектов для дозагрузки:
    - do: получить выдачу по запросу 'фильмы про такси'
    - assert: на выдаче присутствует темная карусель с фильмами
    - do: пролистать карусель до последнего элемента
    - assert: спинер не появился (и не мелькал)

  es_context в карусели:
      - tags: no_assessors
      - params:
          srcrwr: 'ENTITYSEARCH:yourmary.sas.yp-c.yandex.net:10001:10000000'
      - do: получить выдачу по запросу 'фильмы'
      - assert: на выдаче есть карусель фильмов
      - tech: в урле первой карточки есть параметр es_context
      - do: проскроллить карусель вправо до конца
      - assert: элементы дозагрузились
      - tech: в запросе на дозагрузку отсутствует параметр es_context
      - tech: у первого дозагруженного элемента новый параметр es_context

  Книги:
    Фильтры в карусели книг:
      - tags:
        - smoke
        - pp_new_core
      - do: получить выдачу по запросу 'книги'
      - assert: на выдаче присутствует карусель с книгами и фильтры
      - do: выбрать в фильтре жанр "приключения"
      - assert: список книг обновился в соответствии с выбранным фильтром
      - do: повернуть телефон в горизонтальную ориентацию
      - assert: отобржаются фильтры книг (их кол-во может отличаться от скриншота - это не баг)
      - screenshot: примерный внешний вид фильтров [plain]

    Дозагрузка по скроллу:
      - tags:
        - pp_new_core
      - do: получить выдачу Поиска по запросу 'книги 2019' ('книги 2018', 'книги пушкина')
      - assert: на выдаче появилась темная карусель с книгами
      - screenshot: примерный внешний вид [plain]
      - do: проскроллить карусель вправо до конца
      - assert: элементы дозагрузились

    Компактный вид:
      - do: получить выдачу Поиска по запросу 'Безмолвный пациент Алекс Михаэлидес книга' с параметром &ento=0oCgxsdHIwNDA3Mzg0NDUSZ2xzdC5zbG1DaXNLQkhSbGVIUVNJMmxmZVdWaGNqb3lNREU1SUNZbUlITmZiM1I1Y0dVNlZHVjRkQzlDYjI5clFHOXVDaGNLQlhKbGJHVjJFZzVtYjNKdGRXeGhQV052YlcxdmJnPT0YAkIP0LrQvdC40LPQuCAyMDE5jQGtkQ;collapsed
      - assert: на выдаче появилась темная карусель с книгами
      - screenshot: примерный внешний вид [plain]

    Лейбл бесплатно:
    - tags:
        - oo_books
    - do: получить выдачу по запросу "книги пушкина" ("книги для детей", "классика зарубежной литературы")
    - assert: |
        на выдаче присутствует карусель с книгами
        на некоторых карточках присутствует лейбл "Бесплатно"
    - screenshot: примерный внешний вид [plain]

  Подкасты:
    Дозагрузка по скроллу:
      - do: получить выдачу Поиска по запросу 'подкасты'
      - assert: на выдаче появился вертикальный список с подкастами
      - do: развернуть один из элементов списка и нажать кнопку "Подробнее"
      - assert: произошел перезапрос, на выдаче появилась темная карусель с подкастами
      - screenshot: примерный внешний вид [plain]
      - do: проскроллить карусель вправо до конца
      - assert: элементы дозагрузились
    Компактный вид:
      - do: получить выдачу Поиска по запросу 'ТЕД на русском TED подкаст' с параметром &ento=0oCgt5YW00OTA5MTg4MhJvbHN0LnNsbUNpQUtCSFJsZUhRU0dITmZiM1I1Y0dVNlRYVnphV012VUc5a1kyRnpkRUJ2Ymdvb0NnVnlaV3hsZGhJZlptOXliWFZzWVQwMU5UQklNVEF5TURCUE5VVlNPRE0zVkZSRVEwOVJNQT09GAJCENC_0L7QtNC60LDRgdGC0YsMxzOd;collapsed
      - assert: на выдаче появилась компактная темная карусель с подкастами
      - screenshot: примерный внешний вид [plain]

  Игры:
    Дозагрузка по скроллу:
      - do: получить выдачу Поиска по запросу 'список игр на sony playstation 4' ('игры 2018', 'игры 2017')
      - assert: на выдаче появилась темная карусель с играми
      - screenshot: примерный внешний вид [plain]
      - do: проскроллить карусель вправо до конца
      - assert: элементы дозагрузились
    Компактный вид:
      - do: получить выдачу Поиска по запросу 'Metro Exodus' с параметром &ento=0oCgpydXc2OTY1NjE3Ep8BbHN0LnNsbUNsY0tCSFJsZUhRU1QzTmZiM1I1Y0dVNlUyOW1kQzlXYVdSbGIwZGhiV1ZBYjI0Z0ppWWdhVjk1WldGeU9qSXdNVGtnSmlZZ2FWOXRiMkpwYkdWZloyRnRaVG93SUNZbUlHbGZZbkp2ZDNObGNsOW5ZVzFsT2pBS0Z3b0ZjbVZzWlhZU0RtWnZjbTExYkdFOVkyOXRiVzl1GAJCDdC40LPRgNGLIDIwMTneDToh;collapsed
      - assert: на выдаче появилась темная карусель с играми
      - screenshot: примерный внешний вид [plain]

  Перенос в wizplaces:
    Фильмы:
      - tags:
          - oo_films
      - do: получить выдачу по запросу "что посмотреть" ("фильмы") &ento=0oCgpydXc4NTYxMDU5Egtsc3QucmVjZmlsbRgCVgTTYg
      - assert: на выдаче присутствует карусель с фильмами
      - screenshot: примерный внешний вид [plain]

    Книги:
      - tags:
          - oo_books
      - do: получить выдачу по запросу "что почитать" ("детские книги", "классика зарубежной литературы") &ento=0oCgpydXc2OTg4Mjg1Emhsc3Quc2xtQ2pJS0JIUmxlSFFTS25OZloyVnVjbVU2WVd4c1gyZGxibkpsY3lBbUppQnpYMjkwZVhCbE9sUmxlSFF2UW05dmEwQnZiZ29SQ2dWeVpXeGxkaElJWm05eWJYVnNZVDA9PRgCYk9lqw
      - assert: на выдаче присутствует карусель с книгами
      - screenshot: примерный внешний вид [plain]

    Актеры:
      - do: получить выдачу по запросу "Мартин Фримен" с параметром &ento=0oCgpydXcyNzE0Mzk1EhBydXcyNzI2NjUyOmFzc29jGAJSIdCt0L3QtNGA0Y4g0KHQutC-0YLRgkFuZHJldyBTY290dA5-f00;theme=mjolk
      - assert: на выдаче присутствует карусель с актерами
      - screenshot: примерный внешний вид [plain]

files:
  - features/touch-phone/z-entity-search/carousel/carousel.hermione.js
  - features/touch-phone/z-entity-search/carousel/carousel.hermione.e2e.js

v-team: OO

tags:
  - hasE2E
  - oo_lists

tlds: [ru, by, kz, ua]
