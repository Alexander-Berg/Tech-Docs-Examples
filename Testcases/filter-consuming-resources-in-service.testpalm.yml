feature: Фильтрация ресурсов
type: Страница ресурсов сервиса

specs:
  beforeEach:
    - tech: залогиниться под пользователем robot-abc-002
    - do: открыть страницу ресурсов сервиса "Автотест фронтенда для сервиса с уникальным названием24" в табличном представлении (/services/frontend-test_service-with-parent24/resources/?layout=table)
    - assert: загрузился список ресурсов сервиса

  Фильтрация потребляемых ресурсов:
    1. Значения фильтров по умолчанию:
      - automation: ABC-10985
      - screenshot: в правой части есть фильтры, галочки проставлены только в блоке "Статус" напротив пунктов "Запрошен", "Подтвержден, "Выдается", "Выдан" [https://jing.yandex-team.ru/files/pixel/Screenshot_2021-06-28%20Автотест%20фронтенда%20для%20сервиса%20с%20уникальным%20названием24%20—%20Ресурсы%20ABC.png]

    2. Фильтрация по поставщику с учётом вложенных сервисов со сбросом фильтров:
      - automation: ABC-10985
      - do: в фильтрах в блоке "Поставщики и типы" поставить галочку напротив поставщика "Баланс"
      - assert: |
              галочка проставилась, 
              в URL появились параметры "supplier=196" и "type=341"
              список ресурсов обновился, 
              показаны ресурсы поставщика "Баланс"
      - screenshot: отфильтрованные ресурсы поставщика "Баланс" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2018-09-05.png]
      - do: в фильтрах поставить галочку напротив пункта "Показывать ресурсы вложенных сервисов"
      - assert: |
              галочка проставилась, 
              в URL появился параметр "with_childs=true",
              список ресурсов обновился, появился ещё один ресурс Баланса из вложенного сервиса (у него нет многоточия для раскрытия меню)
      - screenshot: список ресурсов с ресурсами вложенного сервиса [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2018-11-38.png]
      - do: кликнуть на надпись "сбросить" под пунктом "Показывать ресурсы вложенных сервисов"
      - assert: |
              галочка напротив пункта "Показывать ресурсы вложенных сервисов" снялась, 
              в блоке "Поставщики и типы" галочка напротив поставщика "Баланс" осталась,
              в URL пропал параметр "with_childs=true",
              список ресурсов обновился, ресурс Баланса из вложенного сервиса пропал из списка     
      - do: в нижней части блока "Поставщики и типы" в фильтрах кликнуть на надпись "сбросить"      
      - assert: |
              галочка в блоке "Поставщики и типы" напротив ресурса "Баланс" снялась, 
              в URL пропали параметры "supplier=196" и "type=341"
              список ресурсов обновился, показаны все ресурсы сервиса 

    3. Фильтрация по типам внутри поставщика:
      - automation: ABC-10985
      - do: в фильтрах в блоке "Поставщики и типы" кликнуть на направленную вниз стрелочку напротив поставщика "Паспорт"
      - screenshot: стрелочка изменила направление вверх, показаны типы поставщика "Паспорт" - "TVM приложение", "OAuth API", "HistoryDB API" и "Пользовательские данные" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2019-12-46.png]
      - do: поставить галочку напротив пункта "HistoryDB API"
      - assert: |
             появилась галочка напротив пункта "HistoryDB API",
             в URL появились параметры "supplier=14" и "type=89",
             список ресурсов обновился, в нём показаны ресурсы поставщика "Паспорт" типа "HistoryDB API"
      - screenshot: список ресурсов после фильтрации [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2019-15-59.png]
      - do: в нижней части блока "Поставщики и типы" в фильтрах кликнуть на надпись "сбросить"      
      - assert: |
              галочка в блоке "Поставщики и типы" напротив ресурса "HistoryDB API" снялась, 
              в URL пропали параметры "supplier=14" и "type=89",
              список ресурсов обновился, показаны все ресурсы сервиса 

    4. Фильтрация по тегам и сброс фильтра:
      - automation: ABC-10985
      - do: в блоке "Теги ресурсов" поставить галочку напротив тега "Для автотестов на фильтры"
      - do: в блоке "Теги ресурсов" поставить галочку напротив тега "Для "HistoryDB API""
      - assert: |
            галочки проставились напротив тегов "Для автотестов на фильтры" и "Для "HistoryDB API"",
            в URL появились параметры "tag=304" и "tag=131", 
            список ресурсов обновился, показаны только ресурсы с тегами "Для автотестов на фильтры" и/или "Для "HistoryDB API""
      - screenshot: отфильтрованный список ресурсов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2019-38-18.png]
      - do: в фильтрах в блоке "Теги ресурсов" кликнуть на надпись "сбросить"
      - assert: |
            галочки снялись напротив тегов "Для автотестов на фильтры" и "Для "HistoryDB API"",
            в URL пропали параметры "tag=304" и "tag=131", 
            список ресурсов обновился, показаны все ресурсы сервиса

    5. Фильтрация по категории типов и сброс фильтра:
      - automation: ABC-10985
      - do: в фильтрах в блоке "Категория типов" кликнуть в поле "Выберите категорию"
      - screenshot: появился выпадающий список с доступными категориями [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2019-42-26.png]
      - do: кликнуть на вариант "Безопасность"
      - assert: |
             в поле подставилось значение "Безопасность",
             в URL появился параметр "category=5",
             список ресурсов обновился, показаны только ресурсы с типом "Безопасность"
      - screenshot: отфильтрованные ресурсы с типом "Безопасность" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2020-02-11.png]
      - do: в фильтрах в блоке "Категория типов" кликнуть на надпись "сбросить"
      - assert: |
             значение "Безопасность" исчезло из поля, вместо него появился плейсхолдер "Выберите категорию",
             в URL пропал параметр "category=5",
             список ресурсов обновился, показаны все ресурсы сервиса  

    6. Фильтрация по статусам и сброс фильтра:
      - automation: ABC-10985
      - do: в фильтрах в блоке "Статус" снять галочку напротив статуса "Выдан"
      - do: в фильтрах в блоке "Статус" поставить галочку напротив статуса "Ошибка"
      - assert: | 
             галочки стоят напротив статусов "Запрошен", "Подтвержден", "Выдается" и "Ошибка", 
             в URL есть параметры "state=requested", "state=approved", "state=granting" и "state=error", 
             список ресурсов обновился, в нём показаны только те ресурсы, которые находятся в статусах "Запрошен", "Подтвержден", "Выдается" или "Ошибка"
      - screenshot: отфильтрованный по статусам список ресурсов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2019-52-03.png]
      - do: в фильтрах в блоке "Статус" кликнуть на надпись "сбросить"
      - assert: |
             напротив статуса "Ошибка" галочка снялась, 
             напротив статуса "Выдан" галочка появилась, 
             галочки напротив статусов "Запрошен", "Подтвержден" и "Выдается" остались, 
             в URL есть параметры "state=requested", "state=approved", "state=granting" и "state=granted", параметр "state=error" пропал, 
             список ресурсов обновился, в нём показаны только те ресурсы, которые находятся в статусах "Запрошен", "Подтвержден", "Выдается" или "Выдан"

    7. Выбор нескольких фильтров и сброс всех по кнопке:
      - automation: ABC-10985
      - do: в фильтрах в блоке "Теги ресурсов" поставить галочку напротив тега "Продакшен"
      - do: в блоке "Поставщики и типы" поставить галочку напротив поставщика "YP"
      - do: в блоке "Категория типов" выбрать вариант "Аккаунты"
      - do: в блоке "Статусы" кликнуть на пункт "Все статусы"
      - screenshot: в фильтрах стоят галочки напротив тега "Продакшен", поставщика "YP" и его типа "Квота"; в категории типов выбраны "Аккаунты"; в блоке "Статус" не стоит ни одной галочки [https://jing.yandex-team.ru/files/pixel/Screenshot_2021-06-28%20Автотест%20фронтенда%20для%20сервиса%20с%20уникальным%20названием24%20—%20Ресурсы%20ABC%281%29.png]
      - assert: |
             список ресурсов обновился, показаны ресурсы YP в статусах "Выдан" и "Устарел",
             в URL есть параметры "tag=61", "supplier=2604", "type=164" и "category=6"
      - screenshot: отфильтрованные ресурсы [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2020-11-01.png]
      - do: кликнуть на кнопку "Сбросить все фильтры" внизу страницы
      - assert: |
             в фильтрах остались галочки только в блоке "Статус" напротив статусов "Запрошен", "Подтвержден", "Выдается" и "Выдан",
             в URL пропали параметры "tag=61", "supplier=2604", "type=164" и "category=6", 
             список ресурсов обновился, показаны все ресурсы сервиса

files: []

priority: normal

tags:
  - reviewed
  - no_assessors
