feature: Приглашение пользователя

aliases:
  - &open_invite_form
    - do: переходим в админку по ссылке {{CONNECT_HOST}}/portal/admin
    - do: нажимаем кнопку "+ Добавить" в футере корневого отдела
    - do: выбираем пункт "Пригласить сотрудников" в выпадающем меню
    - assert: открылся попап "Пригласить сотрудников в организацию"

specs:
  beforeEach:
    - do: авторизоваться под учеткой администратора, логин adm2@yandex.ru пароль EDW-pv8-K27-xTC
  Положительные:
    1. Доступность формы "Пригласить сотрудников в организацию" с дашборда:
      - do: переходим на дашборд по ссылке {{CONNECT_HOST}}/portal/home
      - do: нажимаем "+ Добавить сотрудника" на плитке "Админка"
      - assert: |
          выполнился переход в админку
          открылся попап "Пригласить сотрудников в организацию"
      - screenshot: скриншот попапа "Пригласить сотрудников в организацию" [invite-form]
    2. Доступность формы "Пригласить сотрудников в организацию" в админке:
      - *open_invite_form
    3. Приглашение по единому инвайту:
      - *open_invite_form
      - do: если переключатель "Включить доступ по ссылке" серого цвета, нажать на переключатель
      - assert: |
          переключатель желтого цвета
          рядом с переключателем ссылка инвайта, пример ссылки https://connect-portal-test.crowdtest.yandex.ru/invites/?code=a0e04cf8456c4e348fffadd472285c7b
      - screenshot: скриншот попапа "Пригласить сотрудников в организацию" с включенным инвайтом [active-invite-form]
      - do: перейти по ссылке инвайта
      - assert: открылась страница "Выберите аккаунт, чтобы присоединиться к организации <название организации>"
      - screenshot: скриншот страницы "Выберите аккаунт, чтобы присоединиться к организации" [select-account]
      - do: выбираем из списка логин текущей учётки админа "adm2"
      - do: нажимаем кнопку "Подключить"
      - screenshot: появилось сообщение "Пользователь уже состоит в организации" [already-in-org-error]
      - do: выбираем пункт "+ Другой аккаунт"
      - do: проходим регистрацию в паспорте
      - assert: после регистрации перекидывает обратно на форму "Выберите аккаунт, чтобы присоединиться к организации"
      - do: выбираем из списка только что созданного в паспорте пользователя
      - do: нажимаем кнопку "Подключить"
      - assert: выполнился переход по ссылке {{CONNECT_HOST}}/portal/home
    4. Приглашение по email:
      - *open_invite_form
      - do: в поле "Электронные адреса сотрудников" ввести несколько email вида login@yandex.ru
      - do: нажимаем кнопку "Готово"
      - assert: |
          попап закрылся
          появилась нотификация "Приглашения отправлены."
  Отрицательные:
    1. Закрытие формы по нажатию на крестик:
      - *open_invite_form
      - do: нажимаем на крестик в верхнем правом углу формы
      - assert: попап закрылся
    2. Ввод некорректного электронного адреса:
      - *open_invite_form
      - do: в поле "Электронные адреса сотрудников" вводим некорректный email, пример login.ru
      - do: нажимаем кнопку "Готово"
      - screenshot: попап открыт, появилось сообщение "Укажите корректный адрес почты." [invalid-email-error]
    3. Ссылка недействительного инвайта:
      - do: перейти по ссылке инвайта {{CONNECT_HOST}}/portal/invites/?code=InvalidInviteCode
      - screenshot: открылась страница с текстом ошибки "Ссылка недействительна." [invalid-code-error]

files:
  - tests/hermione/suites/user/invites.js

priority: critical

tlds:
  - ru
  - com

tags:
  - smoke_test_assessors
  - regression
  - smoke_test
  - reviewed
  - smoke_test_mini
