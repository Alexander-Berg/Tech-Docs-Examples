feature: Фильтрация ресурсов
type: Общая страница ресурсов

specs:
  beforeEach:
    - tech: залогиниться под пользователем robot-abc-001
    - do: открыть страницу "Ресурсы" (/resources/)

  Фильтрация на общей странице ресурсов:
    1. Значения фильтров по умолчанию:
      - automation: ABC-10999
      - screenshot: в правой части есть фильтры, галочки проставлены только в блоке "Статус" напротив пунктов "Запрошен", "Подтвержден, "Выдается", "Выдан" [https://jing.yandex-team.ru/files/pixel/Screenshot_2021-06-30%20Ресурсы%20ABC.png]

    2. Фильтрация по поставщикам и типам:
      - automation: ABC-10999
      - do: в фильтрах в блоке "Поставщики и типы" поставить галочку напротив пункта "YT"
      - assert: |
            пункт "YT" раскрылся, появился подпункт "Аккаунт", напротив обоих стоит галочка, 
            в URL появились параметры "supplier=470" и "type=28", 
            список ресурсов обновился, показаны только те, у которых поставщик - "YT" и тип - "Аккаунт"
      - screenshot: отфильтрованные ресурсы [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2013-16-44.png]
      - do: в блоке "Поставщики и типы" кликнуть на надпись "сбросить"
      - assert: |
            пункт "YT" свернулся обратно, подпункт "Аккаунт" пропал, напротив "YT" галочка снялась, 
            в URL пропали параметры "supplier=470" и "type=28", 
            список ресурсов обновился, показаны ресурсы всех поставщиков
    
    3. Фильтрация по категории типов:
      - automation: ABC-10999
      - do: в блоке "Категория типов" кликнуть в поле "Выберите категорию"
      - assert: появился выпадающий список с доступными категориями
      - do: кликнуть на вариант "GDPR"
      - assert: |
            в поле ввода подставилось значение "GDPR", 
            в URL появился параметр "category=73",
            список ресурсов обновился, показаны те, у которых категория типа - "GDPR"
      - screenshot: отфильтрованный список ресурсов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2013-23-38.png] 
      - do: в блоке "Категория типов" кликнуть на надпись "сбросить"
      - assert: |
            поле ввода в блоке "Категория типов" очистилось, 
            в URL пропал параметр "category=73",
            список ресурсов обновился, показаны ресурсы из разных категорий          
    
    4. Фильтрация по потребителю с учтётом вложенных сервисов:
      - automation: ABC-10999
      - do: в поле "Потребитель" ввести значение "3838"
      - assert: появился выпадающий список с названиями сервисов
      - do: кликнуть на вариант "Автотестовый сервис"
      - assert: |
            в поле "Потребитель" подставилось значение "Автотестовый сервис", 
            в фильтрах появился ещё один - "Показывать ресурсы вложенных сервисов",
            в URL появился параметр "service=3838",
            список ресурсов обновился, показаны только те, у которых в столбце "Потребитель" указан "Автотестовый сервис"
      - do: поставить галочку в фильтр "Показывать ресурсы вложенных сервисов"
      - assert: |
            в фильтре "Показывать ресурсы вложенных сервисов" проставилась галочка, 
            в URL появился параметр "with_childs=true",
            список ресурсов обновился, показаны ресурсы для сервиса "Автотестовый сервис" и его дочерних сервисов
      - screenshot: отфильтрованный список ресурсов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2013-33-54.png]
      - do: кликнуть в блоке "Потребитель" на надпись "сбросить"
      - assert: |
            в поле "Потребитель" снялась галочка, 
            фильтр "Показывать ресурсы вложенных сервисов" исчез,
            в URL пропали параметры "service=3838" и "with_childs=true",
            список ресурсов обновился, показаны ресурсы разных сервисов

    5. Фильтрация по тегам ресурсов:
      - automation: ABC-10999
      - do: в фильтрах в блоке "Теги ресурсов" поставить галочку напротив тега "Продакшен"
      - do: в фильтрах в блоке "Теги ресурсов" поставить галочку напротив тега "Тестинг"
      - assert: |
            галочки проставились у тегов "Продакшен" и "Тестинг",
            в URL появились параметры "tag=61" и "tag=87",
            список ресурсов обновился, показаны в списке ресурсы, у которых есть теги "Продакшен" или "Тестинг"
      - do: кликнуть в блоке "Теги ресурсов" на надпись "сбросить"
      - assert: |
            галочки снялись у тегов "Продакшен" и "Тестинг",
            в URL пропали параметры "tag=61" и "tag=87",
            список ресурсов обновился, показаны в списке ресурсы с разными тегами или без них

    6. Фильтрация по статусам:
      - automation: ABC-10999
      - do: в фильтрах в блоке "Статус" снять галочку у статуса "Подтвержден"
      - do: в фильтрах в блоке "Статус" снять галочку у статуса "Выдается"
      - do: в фильтрах в блоке "Статус" снять галочку у статуса "Выдан"
      - do: в фильтрах в блоке "Статус" поставить галочку у статуса "Ошибка"
      - assert: |
             блоке "Статус" проставлены галочки только у статусов "Запрошен" и "Ошибка",
             в URL появились параметры "state=requested" и "state=error",
             список ресурсов обновился, показаны те ресурсы, которые находятся в статусе "Запрошен" или "Ошибка"
      - do: в блоке "Статус" кликнуть на надпись "сбросить"
      - assert: |
             блоке "Статус" галочки проставлены только у статусов "Запрошен", "Подтвержден", "Выдается" и "Выдан",
             галочка напротив статуса "Ошибка" снялась,
             в URL есть параметры "state" только со значениями "requested", "approved", "granting" и "granted", 
             список ресурсов обновился, показаны те ресурсы в статусах "Запрошен", "Подтвержден", "Выдается" и "Выдан"      

    7. Фильтрация по нескольким параметрам и сброс всех фильтров:
      - automation: ABC-10999
      - do: в блоке "Поставщики и типы" кликнуть на направленную вниз стрелочку у поставщика "Паспорт"
      - screenshot: раскрылся список типов ресурсов для поставщика "Паспорт" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2013-59-11.png]
      - do: поставить галочку напротив типа "TVM-приложение"
      - do: в блоке "Категория типов" выбрать категорию "Безопасность"
      - do: в блоке "Потребитель" ввести "Мой тестовый сервис 020 (автотесты)"
      - do: выбрать из выпадающего списка сервис "Мой тестовый сервис 020 (автотесты)"
      - do: в блоке "Теги ресурсов" поставить галочку напротив тега "Стейбл"
      - do: в блоке "Статус" кликнуть на пункт "Все статусы"
      - screenshot: внешний вид заполненных фильтров [https://jing.yandex-team.ru/files/pixel/Screenshot_2021-06-30%20Ресурсы%20ABC%281%29.png]
      - assert: |
            в URL есть параметры "supplier=14", "type=54", "category=5", "service=2262" и "tag=91, 
            список ресурсов обновился, показаны только те, которые подходят под указанные фильтры 
      - screenshot: отфильтрованные ресурсы [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2014-04-48.png]
      - do: кликнуть на кнопку "Сбросить все фильтры"
      - assert: |
            в фильтрах "Поставщики и типы" снялись галочки, 
            фильтры "Категория типов" и "Потребитель" очистились, 
            в тегах ни один не отмечен галочками,
            галочки проставлены только в блоке "Статус" напротив пунктов "Запрошен", "Подтвержден, "Выдается", "Выдан",
            в URL пропали параметры "supplier=14", "type=54", "category=5", "service=2262" и "tag=91, 
            список ресурсов обновился, показаны те ресурсы в статусах "Запрошен", "Подтвержден", "Выдается" и "Выдан"  

files: []

priority: normal

tags:
  - reviewed
  - no_assessors
