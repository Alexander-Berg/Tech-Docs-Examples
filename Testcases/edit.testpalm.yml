feature: Редактирование пользователя

aliases:
  - &open_edit_form
    - do: переходим в админку по ссылке "{{CONNECT_HOST}}/portal/admin"
    - do: открываем карточку доменного сотрудника с почтой вида login@domen.ru, пример "{{CONNECT_HOST}}/portal/admin/users/1130000002675430"
    - do: нажимаем три точки в верхнем правом углу карточки
    - assert: появилось меню с пунктами "Редактировать информацию", "Управление алиасами", "Изменить пароль", "Заблокировать пользователя", "Сделать администратором", "Удалить"
    - do: выбираем пункт "Редактировать информацию"
    - assert: карточка сотрудника перешла в состояние редактирования, появилась возможность редактировать поля, "крестик" и кнопка "Сохранить"
  - &success_edit
    - do: нажать кнопку "Сохранить"
    - assert: |
        форма редактирования закрылась
        появилась нотификация "Информация о пользователе обновлена"

specs:
  beforeEach:
    - do: авторизоваться под учеткой администратора, логин ad12@yandex.ru пароль 8Vb-dqR-KkK-vuM
  Положительные:
    1. Форма редактирования доменного сотрудника:
      - *open_edit_form
      - assert: |
          поле "Фамилия*" можно редактировать
          поле "Имя*" можно редактировать
          поле "Отчество" можно редактировать
          поле "Должность" можно редактировать
          поле "Язык" можно выбрать из выпадающего списка языков
          поле "Часовой пояс" можно выбрать из выпадающего списка часовых поясов
          поле "Дата рождения" можно редактировать и выбрать месяц из выпадающего списка
          поле "Пол" можно выбрать одни из вариантов
          поле "Почта" задезейблено, редактировать нельзя
          поле "Staff" задезейблено, редактировать нельзя
          под полем "Staff" есть кнопка "+Добавить поле"
          поле "Отдел" можно редактировать
      - screenshot: скриншот формы редактирования сотрудника [edit-form]
    2. Редактирование обязательных полей в карточке доменного сотрудника:
      - *open_edit_form
      - do: нажать на элементы для очистки полей "крестик" в обязательных полях "Фамилия" и "Имя"
      - assert: поля "Фамилия" и "Имя" стали пустыми
      - do: ввести новые данные в полях "Фамилия" и "Имя"
      - *success_edit
      - assert: в карточке сотрудника отображаются новые значения "Фамилия" и "Имя"
    3. Редактирование необязательных полей в карточке доменного сотрудника:
      - *open_edit_form
      - do: |
          в поле "Отчество" редактируем или заполняем если было пусто
          в поле "Должность" редактируем или заполняем если было пусто
          в поле "Язык" выбираем любой язык из списка
          в поле "Часовой пояс" выбираем любой часовой пояс из списка
          в поле "Дата рождения" редактируем дату, год и выбираем из списка месяц
          в поле "Пол" выбираем пол
      - *success_edit
      - assert: в карточке сотрудника отображаются новые значения в ранее заполненных полях
    4. Редактирование поля "Отдел" в карточке доменного сотрудника:
      - *open_edit_form
      - do: в поле отдел нажать на крестик рядом с "Все сотрудники"
      - assert: значение "Все сотрудники" удалилось
      - do: ввести в поле значение "Тест"
      - assert: появился саджест с отделом "Тест"
      - do: выбрать отдел "Тест" из саджеста
      - *success_edit
      - assert: |
          в карточке сотрудника отображается новый отдел
          сотрудник переместился в отдел "Тест"
      - *open_edit_form
      - do: в поле отдел нажать на крестик рядом с "Тест"
      - assert: значение "Тест" удалилось
      - do: ввести в поле значение "Все сотрудники"
      - assert: появился саджест с отделом "Все сотрудники"
      - do: выбрать отдел "Все сотрудники" из саджеста
      - *success_edit
      - assert: |
          в карточке сотрудника отображается новый отдел
          сотрудник переместился в отдел "Все сотрудники"
    5. Добавление и редактирование дополнительных полей по кнопке "+ Добавить" в карточке доменного сотрудника:
      - *open_edit_form
      - do: нажать на "+ Добавить" под полем "Staff"
      - assert: появилось дополнительное поле ввода и выпадающий список с возможными данными
      - do: |
          выбрать значение из выпадающего списка "Телефон"
          ввести в поле ввода номер телефона, проверки на формат ввода телефона нет
      - *success_edit
      - assert: в карточке сотрудника появилось новое поле
      - *open_edit_form
      - do: ввести в поле "Телефон" новое значение
      - *success_edit
      - assert: в карточке сотрудника отображается новое значение
  Отрицательные:
    1. Закрытие формы редактирования по нажатию на крестик:
      - *open_edit_form
      - do: нажать на "крестик" в правом верхнем углу формы
      - assert: карточка сотрудника вернулась в состояние просмотра
    2. Проверка валидации при незаполненных обязательных полях:
      - *open_edit_form
      - do: нажать на элементы для очистки полей "крестик" в обязательных полях "Фамилия" и "Имя"
      - assert: поля "Фамилия" и "Имя" стали пустыми
      - do: нажать кнопку "Сохранить"
      - assert: |
          под полем "Фамилия*" отображается сообщение "Нужно указать фамилию сотрудника."
          под полем "Имя*" отображается сообщение "Вы забыли указать имя."
      - screenshot: скриншот формы где отображаются сообщения около незаполненных обязательных полей [validation]
    3. Проверка валидации даты рождения:
      - *open_edit_form
      - do: изменить дату рождения на 30 февраля 1999
      - do: нажать кнопку "Сохранить"
      - assert: над кнопкой "Сохранить" появилась красная надпись "Некорректная дата."
      - screenshot: скриншот формы с ошибкой [errors]
      - do: изменить дату рождения на 15 июля 2021(при тестировании указываем еще не наступивший год)
      - do: нажать кнопку "Сохранить"
      - assert: над кнопкой "Сохранить" появилась красная надпись "Некорректная дата."
    4. Отсутсвие возможности редактирования карточки портального сотрудника:
      - do: переходим в админку по ссылке "{{CONNECT_HOST}}/portal/admin"
      - do: открываем карточку портального сотрудника с почтой вида login@yandex.ru, пример "{{CONNECT_HOST}}/portal/admin/users/4035500652"
      - do: нажимаем три точки в верхнем правом углу карточки
      - assert: появилось меню с пунктами "Сделать администратором" и "Удалить", пункта "Редактировать информацию" нет

files:
  - tests/hermione/suites/user/edit.js

priority: normal

tlds:
  - ru
  - com

tags:
  - smoke_test_assessors
  - regression
  - smoke_test
  - reviewed
  - smoke_test_mini
