feature: Товарная галерея

specs-integration:
  Проверка наличия:
    - tags:
      - smoke
      - pp_new_core
    - do: получить выдачу по запросу 'купить принтер' _ALTERNATIVE_SEARCH_QUERIES_
    - assert: первым результатом поисковой выдачи является товарная галерея
    - counter: /$page/$main/$result/marketCarousel

specs:
  Экстралинки:
    params:
      foreverdata: '2055513564'

    beforeEach:
      - do: получить выдачу по запросу 'foreverdata'
      - assert: |
          в выдаче есть товарная галлерея,
          обращаем внимание не на сами картинки, а на их наличие, картинки могут быть любые
      - do: нажать на кнопку рядом с заголовком колдунщика

    Выпадающее меню:
      - tags: smoke_extended
      - assert: появилось меню из двух пунктов «Пожаловаться» и «Условия подключения»
      - screenshot: внешний вид [extralinks]
    Пожаловаться:
      - tags: smoke_extended
      - assert: текст первой кнопки должен быть «Пожаловаться»
    Условия подключения:
      - tags: smoke_extended
      - do: нажать на пункт «Условия подключения»
      - assert: |
          в новой вкладке открылась страница по адресу
          https://yandex.ru/support/direct/dynamic-text-ads/product-gallery.html
  По типу карточки:
    Оферы Директа:
      - params:
          foreverdata: '511054513'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея (только директовые оферы)
      - assert: у рекламной галереи есть плавающий шильдик "реклама"
      - assert: у карточек Директа в рекламной галерее гринурл это название магазина
      - screenshot: внешний вид [direct-offers]
    Лейбл слева от тайтла в карусели:
      - tags: smoke
      - params:
          foreverdata: '479506246'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея
      - assert: в тайтле рекламной галереи справа есть рекламный лейбл (на узких экранах лейбл может смещаться на карточку галереи - не баг)
      - screenshot: внешний вид [direct-lable-right]
    Оферы Маркета:
      - tags: no_assessors
      - params:
          foreverdata: '3943098408'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея (оферная)
      - assert: у рекламной галереи нет плавающего шильдика "реклама"
      - assert: у карточек Маркета в рекламной галерее гринурл это "Яндекс.Маркет"
      - screenshot: внешний вид [market-offers]
    Старая цена в офере директа:
      - params:
          foreverdata: '3125445034'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея
      - assert: в первой карточке галереи присутствует старая цена
      - screenshot: внешний вид [direct-offers-old-price]
    Оферы Маркета. Внешний вид с дисклеймерами:
      - tags: no_assessors
      - params:
          foreverdata: '2009316186'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея
      - assert: у карточек Маркета (карточки с тележкой Маркета) в рекламной галерее есть дисклеймеры
      - screenshot: внешний вид [market-offers-with-disclaimers]
    Неявные модели Маркета:
      - tags: no_assessors
      - params:
          foreverdata: '3113079982'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея (неявная)
      - assert: у рекламной галереи нет плавающего шильдика "реклама"
      - assert: у карточек Маркета в рекламной галерее гринурл это "Яндекс.Маркет"
      - screenshot: внешний вид [market-implicit-models]
    Модели Маркета:
      - tags: no_assessors
      - params:
          foreverdata: '3147147520'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея (модельная)
      - assert: у рекламной галереи нет плавающего шильдика "реклама"
      - assert: у карточек Маркета в рекламной галерее гринурл это "Яндекс.Маркет"
      - screenshot: внешний вид [market-models]
    Офер Директа + Оферы Маркета:
      - params:
          foreverdata: '3363883224'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея (директовые и маркетные оферы)
      - assert: у рекламной галереи есть плавающий шильдик "реклама"
      - assert: у карточек Директа в рекламной галерее гринурл это название магазина
      - assert: у карточек Маркета в рекламной галерее гринурл это "Яндекс.Маркет"
      - screenshot: внешний вид [direct-offers]

    Карусель должна отображаться, если пришло 2 директовых оффера без маркетных офферов:
      - params:
          foreverdata: '156200853'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея с двумя офферами
      - screenshot: внешний вид [direct-min-offers]

    Карусель не должна отображаться, если пришел 1 директовый оффер без маркетных офферов:
      - params:
          foreverdata: '3361771829'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи отсутствует рекламная галерея

    Декодирование спец символов в названии директового оффера:
      - params:
          foreverdata: '3617967145'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: |
          в результатах поисковой выдачи присутствует рекламная галерея (только директовые оферы)
          в названии оффера используются « и », а не их коды (&laquo;) и (&raquo;)
      - screenshot: внешний вид 1-ого оффера [direct-offer-decoded]

  Неявная:
    Проверка счетчиков:
      - tags: no_assessors
      - params:
          foreverdata: '3316108464'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в результатах поисковой выдачи присутствует рекламная галерея
      - do: кликнуть на картинку карточки
      - assert: переход на yabs.yandex.ru
      - tech: сработал счетчик '/$page/$top/$result/marketCarousel/scroller/productCard/thumb'
      - do: кликнуть на область под картинкой карточки (кликабельный оверлей поверх всех остальных ссылок)
      - tech: сработал счетчик '/$page/$top/$result/marketCarousel/scroller/productCard/linkOverlay'
      - assert: переход на yabs.yandex.ru

  Проверка атрибутов логирования:
    - tags: no_assessors
    - params:
        foreverdata: '3617967145'
    - do: получить выдачу по запросу 'foreverdata'
    - tech: |
        сработал счетчик '/$page/$main/$result/marketCarousel/scroller/productCard' для 1-ого элемента карусели
        в аттрибутах счетчика указан "type"="adv"

  Подтверждение видимости на клиенте:
    tags: no_assessors

    prefetch=0:
      - browsers: chrome-phone
      - params:
          foreverdata: '1191664293'
      - do: получить выдачу по запросу 'foreverdata'
      - tech: в html нет serp-bk-counter'ов внутри товарной галереи

    prefetch=1:
      - params:
          foreverdata: '1191664293'
          prefetch: '1'
      - do: получить выдачу по запросу 'foreverdata'
      - tech: в html внутри товарной галереи присуствует четыре serp-bk-counter элемента
      - tech: в html присутствует serp-bk-counter элемент с 'bk848484(https://yabs.yandex.ru/hitcount)'
      - tech: второй serp-bk-counter элемент содержит 'bk848484(https://yabs.yandex.ru/count/LINKHEAD~1=LINKTAIL~1)'
      - tech: третий serp-bk-counter элемент содержит 'bk848484(https://yabs.yandex.ru/count/LINKHEAD~1=LINKTAIL~2)'
      - tech: четвертый serp-bk-counter элемент содержит 'bk848484(https://yabs.yandex.ru/count/LINKHEAD~1=LINKTAIL~3)'

  С дисклеймером:
    Дисклеймер в тултипе в гринурле:
      - tags: smoke
      - params:
          foreverdata: '1130659148'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: на выдаче есть товарная галерея с хотя бы одной карточкой товара, возле гринурла которой есть иконка информации
      - screenshot: карточка товара со значком информации в гринурле [greenurl-disclaimer]
      - do: нажать на значок информации
      - assert: появился тултип с дисклеймером
      - tech: сработал счетчик '/$page/$main/$result/marketCarousel/scroller/productCard/greenUrlDisclaimer'
      - screenshot: галерея товаров с раскрытым тултипом [greenurl-disclaimer-tooltip]
      - do: нажать на значок информации
      - assert: тултип скрылся
      - do: нажать на значок информации
      - assert: появился тултип с дисклеймером
      - do: проскроллить страницу
      - assert: тултип пропал
    Работает на технологиях Яндекса:
      - tags: smoke
      - params:
          foreverdata: '3585820438'
      - do: получить выдачу по запросу 'foreverdata'
      - assert: на выдаче есть товарная галерея с хотя бы одной карточкой товара, возле гринурла которой есть иконка информации
      - screenshot: карточка товара со значком информации в гринурле [gallery-item-business-unit]
      - do: нажать на значок информации
      - assert: появился тултип с дисклеймером
      - tech: сработал счетчик '/$page/$main/$result/marketCarousel/scroller/productCard/greenUrlBusinessUint'
      - screenshot: галерея товаров с раскрытым тултипом [gallery-greenurl-business-unit-tooltip]
      - do: нажать на значок информации
      - assert: тултип скрылся
      - do: нажать на значок информации
      - assert: появился тултип с дисклеймером
      - do: проскроллить страницу
      - assert: тултип пропал

files:
  - src/features/Market/Market.features/MarketCarousel/MarketCarousel.test/MarketCarousel@touch-phone.hermione.js
  - src/features/Market/Market.features/MarketCarousel/MarketCarousel.test/MarketCarousel@touch-phone.hermione.e2e.js

v-team: ECOM

tlds: all

tags:
  - ecom
  - tgallery
