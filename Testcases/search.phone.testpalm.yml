feature: Поиск Яндекс.Новостей

specs-integration:
  содержит рекламу:
    - tags:
      - advert
      - backend_news
      - brow_only
    - do: в поисковой строке ввести "котики"
    - assert: происходит переход на страницу поиска по новостям с выдачей по запросу
    - assert: под рубрикатором есть рекламный блок top
    - do: проскроллить страницу вниз до конца
    - assert: перед футером отображается не менее 2х карточек и рекламный блок, может присутствовать кнопка "Больше результатов"

  сохраняет настройки поиска при смене поиского запроса:
    - do: в поисковой строке ввести "котики" и тапнуть "Найти"
    - assert: |
        происходит переход на страницу с выдачей поиска по новостям,
        результаты сгруппированы по сюжетам,
        в фильтре выделены пункты "За все время" и "По релевантности", включена опция "Группировать по сюжетам",
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_15-58-00.png
    - do: тапнуть по фильтру "За все время" и выбрать значение "3 дня"
    - assert: |
        значение фильтра меняется на "3 дня",
        страница поиска перезагружается, поисковой запрос остается в поисковом инпуте,
        на странице отображаются результаты за последние 3 дня
        в группе фильтров выделен фильтр "3 дня"
    - do: изменить запрос, написав в поисковой строке "кот"
    - assert:  |
        страница перезагружается,
        в выдаче отображаются документы за выбранный период,
        в списке фильтров отображается тот же период, который вы выбирали ранее

  корректно отображается и исправляет опечатки:
    - do: перейти по ссылке https://yandex.ru/news/search?text=Hjccbz
    - assert: страница открылась
    - assert: в поисковой строке отображаено значение "Россия"
    - assert: отображается сообщение "Показаны результаты по запросу «Россия». Искать вместо этого «Hjccbz»"
    - assert: отображаются карточки с результатами поиска
    - assert: есть карточки, в которых "Россия" выделено жёлтым
    - do: тапнуть кнопку "Больше результатов"
    - assert: ниже появилась вторая страница с результатами
    - do: тапнуть на сообщение с предложением искать другой текст
    - assert: пропало сообщение с предложением искать другой текст
    - assert: в поисковой строке отображаено значение "Hjccbz"

  корректно отображается в случае пустого результата:
    - do: перейти по ссылке https://yandex.ru/news/search?text=фдлырофвыajhsdgha
    - assert: страница открылась
    - assert: на странице присутствует кнопка "Расширенный поиск"

specs:
  имеет внешний вид:
    - tags:
      - backend_news
      - brow_only
    - do: в поисковой строке ввести "Трамп заявил"
    - assert: |
        происходит переход на страницу поиска по новостям,
        присутствует шапка новостей, общепортальный рубрикатор, рекламный блок,
        ниже отображаются фильтры и выдача по поисковому запросу,
        слова из запроса встречаются в выдаче в разных формах (например, произошли/произошел как на скрине),
        внешний вид - https://jing.yandex-team.ru/files/vasekerka/2021-08-04_13-43-34.png,
        запрос НЕ должен быть траурным (если будет траурная выдача - рекламы сверху не будет)
    - do: поскроллить страницу вниз
    - do: тапнуть по любому сюжету (не источнику!)
    - assert: |
        произошел переход на страницу сюжета в новой вкладке,
        запрос в поисковой строке очистился

  позволяет перейти в старый поиск по прямой ссылке [manual]:
    - tags:
      - backend_news
    - Case Type: CH
    - reasonNotToAuto:
      - Нет возможности автоматизировать проверку на странице нерпы + ХП
    - do: перейти в старый поиск по прямой ссылке https://newssearch.yandex.ru/yandsearch?text=Путин&rpt=nnews2&grhow=clutop&nsbr=1
    - assert: |
        открывается старая версия поиска,
        вертска не едет, элементы не наезжают друг на друга,
        под поисковой строкой отображается дисклеймер "Данная версия поиска по новостям перестает поддерживаться. Новая версия доступна по адресу https://newssearch.yandex.ru/news/search",
        (ссылка в дисклеймере не кликабельна - это ОК, заводить баг не нужно!)
        внешний вид - https://jing.yandex-team.ru/files/vasekerka/2021-08-04_14-31-39.png
    - do: проскроллить вниз страницы к футеру
    -  assert: |
        над футером отображается реклама, а над рекламой отображается дисклеймер "Старый поиск по новостям включает сообщения только за последние 3 дня"?
        внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-08-31_20-23-16.png,
        дисклеймер кликабелен, по клику на дисклеймер в той же вкладке открывается страница нового поиска,

  содержит сюжеты и документы по запросу:
    - tags:
      - smoke
      - backend_news
      - brow_only
    - do: в поисковой строке ввести "котики" и кликнуть "Найти"
    - assert: |
        происходит переход на страницу поиска по новостям,
        в поиске могут встречаться карточки сюжетов и карточки документов,
        карточка документа содержит иконку источника, заголовок, аннотацию, название источника и время обновления,
        карточка сюжета содержит заголовок, название источника и время обновления,
        ниже отображается документ (или несколько) по сюжету и ссылка "Посмотреть еще",
        подсвечиваются совпадения по словам в заголовках и аннотациях,
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2020-10-12_18-13-09.png

  выделяет посещенные ссылки на источник серым цветом:
    - do: этот кейс нужно пройти в обычной вкладке браузера, не в Инкогнито
    - do: после перехода по ссылке на залипание из рана в поисковой строке ввести "котики" и кликнуть "Найти"
    - assert: происходит переход на страницу поиска по новостям
    - do: кликнуть по карточке документа
    - assert: |
        в новой вкладке происходит переход на сайт источника,
        в урле присутствуют параметры utm_source=yxnews, utm_medium=mobile,
        в урле присутствует параметр utm_referrer=https%3A%2F%2Fyandex.ru%2Fnews%2Fsearch%3Ftext
    - do: вернуться к поиску по новостям, найти карточку посещенного документа
    - assert: цвет тайтла посещенного документа закрасился в серый (не будет работать в Инкогнито)

  выделяет посещенные ссылки на сюжет серым цветом:
    - do: этот кейс нужно пройти в обычной вкладке браузера, не в Инкогнито
    - do: в поисковой строке ввести "котики" и кликнуть "Найти"
    - assert: происходит переход на страницу поиска по новостям
    - do: найти карточку сюжета
    - do: тапнуть по заголовку сюжета
    - assert: в новой вкладке открывается страница соответствующего сюжета на Яндекс.Новостях
    - do: вернуться к поиску по новостям, найти карточку посещенного сюжета
    - assert: цвет тайтла посещенного сюжета закрасился в серый (не будет работать в Инкогнито)

  открывает список всех источников из поиска по кнопке Посмотреть еще:
    - do: в поисковой строке ввести "котики" и кликнуть "Найти"
    - assert: происходит переход на страницу поиска по новостям
    - do: найти карточку сюжета с кнопкой "Посмотреть еще"
    - do: клик по "Посмотреть еще"
    - assert: в новой вкладке открывается страница cо списком всех источников по сюжету

  для сущностей поиска, открытых в новом табе ПП (андроид), в урл прокидывает utm_referrer:
    - do: открыть вертикаль новостей тапом по иконке в бендере ПП
    - assert: открыта вертикаль новостей
    - do: в поисковой строке ввести "котики" и кликнуть "Найти"
    - assert: происходит переход на страницу поиска по новостям
    - do: тап по любому заголовку сюжета в выдаче поиска
    - assert: |
        в новом табе ПП открывается страница сюжета,
        в урле есть метка utm_referrer
    - do: вернуться к сюжету и тапнуть по любому документу
    - assert: |
        в новом табе ПП открывается страница источника,
        в урле есть метка utm_referrer
    - do: вернуться к сюжету и тапнуть по кнопке "Посмотреть еще"
    - assert: |
        в новом табе ПП открывается страница инстори,
        в урле есть метка utm_referrer

  подгружает выдачу по кнопке Больше результатов:
    - tags:
      - smoke
      - backend_news
      - brow_only
      - smoke_zen
    - do: в поисковой строке ввести "предложил" и кликнуть "Найти"
    - assert: происходит переход на страницу поиска по новостям с выдачей по запросу
    - do: проскроллить страницу вниз до конца
    - assert: перед футером присутствует кнопка "Больше результатов" (если кнопки нет, ввести другой запрос)
    - do: тапнуть по кнопке "Больше результатов"
    - assert: |
        кнопка меняется на спиннер, подгружается вторая страница поиска по тому же запросу,
        между страницами есть разделитель с номером страницы,
        внешний вид https://jing.yandex-team.ru/files/nightsonne/2020-08-28_15-42-15.png

  обрабатывает опечатки ввода:
    - tags:
        - backend_news
        - brow_only
        - smoke_zen
    - do: в поисковой строке ввести 'путен'
    - assert: |
        происходит переход на страницу поиска по новостям,
        в поисковой строке отборажается 'путин',
        перед первой карточкой выдачи присутствует плашка опечаточника,
        выдача соответствует запросу путин,
        внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-07-30_15-01-14.png
    - do: тапнуть по плашке опечаточника
    - assert: |
        страница поиска обновляется,
        в поисковой строке отображается 'путен',
        выдача соответствует запросу путен (могут быть другие формы слова, например 'путный')

  не ломается при пустом запросе:
    - tags:
        - backend_news
        - brow_only
        - smoke_zen
    - do: в поисковой строке не вводить запрос, тапнуть Найти
    - assert: |
        происходит переход на страницу поиска по новостям,
        отображается надпись Задан пустой поисковый запрос и кнопка На главную,
        ниже отображается рекламный блок, под ним располагается футер,
        внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-04-19_17-59-25.png
    - do: тапнуть по кнпке На главную
    - assert: произошел переход на главную страницу Яндекс.Новостей

  позволяет перейти к расширенному поиску:
    - tags:
        - backend_news
        - brow_only
    - do: в поисковой строке ввести "абракадабрадабрадабра" и нажать на кнопку "Найти"
    - assert: |
        происходит переход на страницу поиска по новостям,
        отображается надпись "Новостей по вашему запросу не найдено",
        кнопка "Расширенный поиск",
        ссылка "На главную",
        ниже отображается рекламный блок, под ним располагается футер,
        внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2021-04-19_18-00-11.png
    - do: тапнуть по кнопке "Расширенный поиск"
    - assert: происходит переход в Яндекс.Поиск с выдачей по запросу (выдача может быть пустой)
    - do: вернуться на страницу поиска Яндекс.Новостей
    - assert: произошел переход на вкладку Новости, результаты поиска не найдены

  позволяет корректно переходить по истории запросов в браузере [manual]:
    - tags:
      - search
      - smoke_zen
    - reasonNotToAuto:
      - Нет возможности автоматизировать проверку результатов перехода по истории
    - do: тапнуть по поисковой строке
    - do: ввести поисковый запрос "Россия" и нажать кнопку "Найти"
    - assert: произошёл переход в поиск Яндекс.Новостей по указанному запросу
    - do: еще раз тапнуть по поисковой строке
    - do: стереть первый запрос, ввести поисковый запрос "Европа" и нажать кнопку "Найти"
    - assert: произошёл переход в поиск Яндекс.Новостей по указанному запросу
    - do: вернуться назад тапом по аппаратной или браузерной кнопке "Назад"
    - assert: в строке инпута отображается первый запрос - "Россия"
    - do: тапнуть по строке инпута
    - assert: в строке инпута отображается все тот же первый запрос - "Россия"

  перенаправляет пользователя на домен newssearch.yandex.ru из поиска в других сервисах [manual]:
    - reasonNotToAuto:
      - Нет возможности автоматизировать переход из другого сервиса
    - tags:
        - backend_news
    - do: после перехода на тестовый стенд тапнуть по логотипу "Яндекс" в шапке
    - assert: происходит переход на главную страницу Яндекса в той же вкладке
    - do: тапнуть на поисковую строку и ввести поисковый запрос "котики"
    - assert: в той же вкладке получаем выдачу по запросу в поиске Яндекса
    - do: тапнуть на таб "Новости" в таббаре https://jing.yandex-team.ru/files/nightsonne/2020-11-11_16-51-09.png
    - assert: |
        в той же вкладке открывается выдача на сервисе Новости по тому же запросу
        в адресной строке домен newssearch.yandex.ru,
        в адресной строке присутствует параметр text=котики. В некоторых браузерах кириллица может быть эндокодирована, параметр может быть вида: text=%D0%9A%D0%BE%D1%82%D0%B8%D0%BA%D0%B8. Это НЕ БАГ!

  корректно отображает фильтры с сортировкой по хронологии:
    - params:
        flags:
          - yxneo_phone_search_sortbydate-disclaimer=1
    - do: перейти по ссылке https://newssearch.yandex.ru/news/search?text=котики&sortby=date&flags=yxneo_phone_search_sortbydate-disclaimer=1
    - assert: откроется страница поиска, новости отсортированы по хронологии, начиная от самой свежей
    - screenshot: внешний вид фильтров соответствует скриншоту [filter]

  корректно отображает фильтр без группировки по сюжетам:
    - tags:
      - backend_news
    - do: в поисковой строке ввести "котики" и тапнуть "Найти"
    - assert: |
        происходит переход на страницу с выдачей поиска по новостям,
        результаты сгруппированы по сюжетам,
        в фильтре выделены пункты "За все время" и "По релевантности", включена опция "Группировать по сюжетам",
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_15-58-00.png
    - do: тапнуть по переключателю "Группировать по сюжетам"
    - assert: |
        переключатель становится серым,
        страница поиска перезагружается, поисковой запрос остается в поисковом инпуте,
        все результаты разбиты на отдельные документы, внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_16-02-52.png ,
        опция "Группировать по сюжетам" выключена

  корректно отображает фильтр для периода без группировки по сюжетам:
    - tags:
      - backend_news
    - do: в поисковой строке ввести "котики" и тапнуть "Найти"
    - assert: |
        происходит переход на страницу с выдачей поиска по новостям,
        результаты сгруппированы по сюжетам,
        в фильтре выделены пункты "За все время" и "По релевантности", включена опция "Группировать по сюжетам",
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_15-58-00.png
    - do: тапнуть по переключателю "Группировать по сюжетам"
    - assert: |
        переключатель становится серым,
        страница поиска перезагружается, поисковой запрос остается в поисковом инпуте,
        все результаты разбиты на отдельные документы, внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_16-02-52.png ,
        опция "Группировать по сюжетам" выключена
    - do: тапнуть по фильтру "За все время" и выбрать значение "3 дня"
    - assert: |
        значение фильтра меняется на "3 дня",
        страница поиска перезагружается, поисковой запрос остается в поисковом инпуте,
        на странице отображаются результаты за последние 3 дня
        в группе фильтров выделен фильтр "3 дня"

  не отображает опцию группировки по сюжетам при сортировке по хронологии:
    - tags:
      - backend_news
      - smoke_zen
    - do: в поисковой строке ввести "котики" и тапнуть "Найти"
    - assert: |
        происходит переход на страницу с выдачей поиска по новостям,
        результаты сгруппированы по сюжетам,
        в фильтре выделены пункты "За все время" и "По релевантности", включена опция "Группировать по сюжетам",
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_15-58-00.png
    - do: тапнуть на фильтр выбора сортировки "По релевантности" и выбрать опцию "По хронологии"
    - assert: |
        страница поиска перезагружается, поисковой запрос остается в поисковом инпуте,
        выдача новостей отображается в хронологическом порядке,
        в фильтрах выбрана опция  "По хронологии",
        кнопка группировки по сюжетам не кликабельна,
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_17-39-03.png

  позволяет получить выдачу за сегодня:
    - tags:
      - backend_news
    - do: в поисковой строке ввести "котики" и тапнуть "Найти"
    - assert: |
        происходит переход на страницу с выдачей поиска по новостям,
        (если результат выдачи пустой - поискать по любому другому широкому запросу),
        результаты сгруппированы по сюжетам,
        в фильтре выделены пункты "За все время" и "По релевантности", включена опция "Группировать по сюжетам",
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_15-58-00.png
    - do: тапнуть по фильтру "За все время" и выбрать опцию "Сегодня" в списке фильтров
    - assert: |
        страница поиска перезагружается, поисковой запрос остается в поисковом инпуте,
        на странице отображаются документы за сегодняшний день (дата сюжетов может быть любой, нас интересует именно дата документов - https://jing.yandex-team.ru/files/kossakovskaya/2021-12-16_18-12-23.png),
        в группе фильтров выделен фильтр "Сегодня"

  позволяет получить выдачу за неделю:
    - tags:
      - backend_news
    - do: в поисковой строке ввести "котики" и тапнуть "Найти"
    - assert: |
        происходит переход на страницу с выдачей поиска по новостям,
        результаты сгруппированы по сюжетам,
        в фильтре выделены пункты "За все время" и "По релевантности", включена опция "Группировать по сюжетам",
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_15-58-00.png
    - do: тапнуть по фильтру "За все время" и выбрать опцию "Неделя" в списке фильтров
    - assert: |
        страница поиска перезагружается, поисковой запрос остается в поисковом инпуте,
        на странице отображаются результаты за последнюю неделю (проверить, подгрузив 3-4 страницы по кнопке "Больше результатов"),
        в группе фильтров выделен фильтр "Неделя"

  корректно отображает календарь выбора периода выдачи:
    - do: в поисковой строке ввести "котики" и тапнуть "Найти"
    - assert: |
        происходит переход на страницу с выдачей поиска по новостям,
        результаты сгруппированы по сюжетам,
        в фильтре выделены пункты "За все время" и "По релевантности", включена опция "Группировать по сюжетам",
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_15-58-00.png
    - do: тапнуть по пункту "За все время" и выбрать опцию "Период" в списке фильтров
    - assert: |
        основной фон страницы чуть затемняется,
        в модальном окне появляется календарь с неактивной кнопкой "Применить"
    - do: полистать месяцы кнопками < и >
    - assert: |
        месяцы корректно переключаются,
        в будущих месяцах числа недоступны для выбора, отображаются светло-серым шрифтом
    - do: тапнуть на любую дату в текущем месяце
    - assert: |
        дата выделяется,
        кнопка "Применить" остается недоступной
    - do: тапнуть на любую другую дату в текущем месяце
    - assert: |
        вторая дата выделяется, отображается выделенный период,
        кнопка "Применить" становаится кликабельной
    - do: тапнуть вне календаря
    - assert: |
        календарь закрылся,
        выбран фильтр "За всё время"

  позволяет получить выдачу за выбранный период:
    - tags:
      - backend_news
      - smoke_zen
    - do: в поисковой строке ввести "котики" и тапнуть "Найти"
    - assert: |
        происходит переход на страницу с выдачей поиска по новостям,
        результаты сгруппированы по сюжетам,
        в фильтре выделены пункты "За все время" и "По релевантности", включена опция "Группировать по сюжетам",
        внешний вид - https://jing.yandex-team.ru/files/nightsonne/2021-11-25_15-58-00.png
    - do: тапнуть по пункту "За все время" и выбрать опцию "Период" в списке фильтров
    - assert: |
        основной фон страницы чуть затемняется,
        в модальном окне появляется календарь с неактивной кнопкой "Применить"
    - do: выбрать в календаре любой период и кликнуть "Применить"
    - assert: |
        страница перезагружается,
        в фильтре отображен выбранный период в виде интервала дат
    - do: пролистать выдачу (если выдача пустая, выбрать другой период, кликнув на опцию "Период")
    - assert: |
        в выдаче документы за выбранный период,
        обратите внимание! возможно расхождение в рамках +/-2 часа
    - do: нажать кнопку "Назад" в браузере
    - assert: |
        выбранный ранее период в виде интервала дат сбрасывается,
        отображается кнопка "За всё время",
        в инпуте запроса отображается тот же текст, что и был введен ранее

  корректно отображается в темной теме:
    - do: открыть страницу поиска в темной теме https://newssearch.yandex.ru/news/search?text=котики&flags=yxneo_news_phone_search_service-theme%3Ddark
    - assert: страница отображается в темном цвете
    - do: ввести в саджесте "кот"
    - assert: саджест отобразился в темном цвете

  перенаправляет пользователя на домен newssearch.yandex.ru из поиска в других сервисах с сохранением темной темы в ПП [manual]:
    - reasonNotToAuto:
      - Нет возможности автоматизировать переход из другого сервиса
    - tags:
        - pp_only
        - smoke_zen
    - browsers:
        - ios-pp-3.2-touch
    - do: темная тема в ios будет работать только для российских пользователей. Если вы не из России - пропустите кейс.
    - do: обратите внимание! Кейс нужно выполнять только в пп на ios! android категорически НЕ ПОДХОДИТ. Пропустите, пожалуйста, кейс, если у вас нет возможности выполнить его на ios
    - do: перед выполнением кейса обязательно необходимо включить темную тему на устройстве (как это можно сделать, описано в инструкции - https://wiki.yandex-team.ru/eva/testing/projects/nerpa/#nastrojjkatemnojjtemynaustrojjstveios). Если темная тема у вас уже включена, то ничего больше делать не нужно, просто выполняйте кейс далее
    - do: после перехода на тестовый стенд тапнуть по логотипу "Яндекс" в шапке
    - assert: происходит переход на главную страницу Яндекса в той же вкладке. Обратите Внимание! Цвет темы на главной странице не имеет значения в данном кейсе
    - do: тапнуть на поисковую строку и ввести поисковый запрос "котики"
    - assert: в той же вкладке получаем выдачу по запросу в поиске Яндекса
    - do: тапнуть на таб "Новости" в таббаре https://jing.yandex-team.ru/files/nightsonne/2020-11-11_16-51-09.png
    - assert: |
        в той же вкладке открывается выдача на сервисе Новости по тому же запросу,
        в адресной строке домен newssearch.yandex.ru,
        цвет страницы поиска - темный,
        внешний вид - https://jing.yandex-team.ru/files/kossakovskaya/2022-01-25_14-41-18.png

files:
  - features/news/search/search.phone.hermione.js
  - features/news/search/search.phone.hermione.e2e.js

tags:
  - neo
  - search

manager: suholet

qa-engineer: a-groza

tlds:
  - ru
  - by
  - kz
  - uz
  - ua
  - com
