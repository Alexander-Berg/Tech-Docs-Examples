feature: Форма создания сервиса

specs:
  beforeEach:
    - do: Залогиниться под пользователем robot-internal-003

  aliases:
    - &testCases
        - do: открыть форму создания сервиса тестового ABC (/create-service/?lang=${lang})
        - screenshot: появился первый шаг визарда [first-step]
        - do: заполнить поле "Slug" значением "test-01"
        - do: нажать кнопку "Далее"
        - sсreenshot: появились ошибки валидации полей "Название", "Название на английском языке" и "Slug" [invalid-first-step]
        - do: заполнить поле "Название" значением "Тест-01"
        - do: заполнить поле "Название на английском языке" значением "Test-01"
        - do: выбрать предложенное значение поля "Slug"
        - do: ввести в поле "Руководитель" текст "roma-vat"
        - do: выбрать предложенное значение "Роман Ватютов"
        - assert: ошибки валидации скрылись
        - do: заполнить поле "Родитель" значением "orange" и выбрать его в списке саджеста
        - do: заполнить поле "Теги" значением "MARTY" и выбрать его в списке саджеста
        - screenshot: заполненный первый шаг [completed-first-step]
        - do: нажать кнопку "Далее"
        - screenshot: появился второй шаг визарда [second-step]
        - do: заполнить поле "На русском" значением "Тестовое описание"
        - do: заполнить поле "На английском" значением "Test description"
        - screenshot: заполненный второй шаг [completed-second-step]
        - do: нажать кнопку "Далее"
        - screenshot: предпросмотр [preview]

  Положительные:
    Создание сервиса(ru):
      - params:
          lang: ru
      - *testCases

    Создание сервиса(en):
      - params:
          lang: en
      - *testCases

    Создание сервиса без указания родительского сервиса:
      - do: открыть форму создания сервиса (/create-service)
      - do: ввести в поле "Название" уникальное название сервиса, например, "Тест фронтенда-14-09-11-45"
      - do: ввести в поле "Название на английском" уникальное название сервиса, например, "Frontend test-14-09-11-45"
      - do: убрать курсор из поля "Название на английском", кликнув на любое свободное место на форме
      - assert: под полем "Slug" появилась надпись "Например" с предложенным слагом
      - do: кликнуть на предложенный в строке "Например" слаг
      - assert: предложенное значение подставилось в поле "Slug"
      - do: ввести в поле "Руководитель" текст "roma-vat"
      - do: выбрать предложенное значение "Роман Ватютов"
      - screenshot: вид заполненного первого шага формы [first-step-no-parent] 
      - do: кликнуть на кнопку "Далее"
      - assert: произошёл переход на второй шаг визарда - "Описание"
      - do: в поле "На русском" ввести "**Тест !!wiki!!-разметки** --test--"
      - do: в поле "На английском" ввести "((http://www.yandex.ru Яндекс))"
      - screenshot: вид заполненной формы на втором шаге [completed-second-step-no-parent]
      - do: кликнуть на кнопку "Далее"
      - assert: произошёл переход на третий шаг визарда - "Предпросмотр"
      - screenshot: напротив пунктов бокового меню "Основная информация" и "Описание" стоят зелёные галочки, в правой части перечислены поля с данными о сервисе, все поля, кроме "Родитель" и "Теги" заполнены [preview-no-parent]
      - do: кликнуть на кнопку "Отправить"
      - assert: произошёл переход на страницу сервиса (/services/frontend_test_14_09_11_45)
      - screenshot: поле "Описание" заполнено [service-description-field] 

    Подсказка потенциальных родителей нового сервиса:
      - do: открыть форму создания сервиса (/create-service)
      - do: ввести в поле "Руководитель" значение "zomb-prj-204"
      - assert: под полем появился выпадающий список с пользователем "The Kitty"
      - do: кликнуть по варианту "The Kitty"
      - screenshot: поле "Руководитель" заполнилось значением "The Kitty", под полем "Родитель" появились названия сервисов [suggested-parent]

    При переключении между шагами визарда введённые данные сохраняются:
      - do: открыть форму создания сервиса (/create-service)
      - do: ввести в поле "Руководитель" значение "zomb-prj-204"
      - assert: под полем появился выпадающий список с пользователем "The Kitty"
      - do: кликнуть по варианту "The Kitty"
      - assert: поле "Руководитель" заполнилось значением "The Kitty"
      - do: ввести в поле "Название" значение "Тест шагов визарда"
      - do: ввести в поле "Название на английском" значение "Wizard steps test"
      - do: ввести в поле "Slug" значение "wizard-steps-test"
      - do: кликнуть на кнопку "Далее"
      - assert: произошёл переход на второй шаг визарда - "Описание"
      - do: в поле "На русском" ввести "тестовое описание"
      - do: кликнуть на кнопку "Назад", расположенную в правом нижнем углу
      - assert: произошёл переход на первый шаг визарда
      - screenshot: поле "Название" заполнено значением "Тест шагов визарда", поле "Название на английском" заполнено значением "Wizard steps test", поле "Slug" заполнено значением "wizard-steps-test", поле "Руководитель" заполнено значением "The Kitty", рядом с пунктом "Описание" появился восклицательный знак [back-to-first-step]
      - do: в боковом меню кликнуть на пункт "Описание"
      - assert: произошёл переход на второй шаг визарда - "Описание"
      - screenshot: поле "На русском" заполнено, поле "На английском" обведено красной рамкой, под полем отображается ошибка - "Это поле не должно быть пустым" [back-to-second-step]

files:
  - test/features/desktop/service-creation/create-service.hermione.js

priority: blocker

tags:
  - reviewed
  - no_assessors
