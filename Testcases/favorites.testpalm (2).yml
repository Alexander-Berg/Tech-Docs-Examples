feature: Объектный ответ
type: Кнопка избранного
description: флажок может не прокраситься сразу, попробуйте подождать и обновить страницу. Если так и нет прокраса, то это не баг, а данные шалят, заскипайте в таком случае тест. !!Если нет коллекции "Мои фильмы"/"Мои сериалы", то добавьте в другую или создайте новую.!!
counter: /$page/favorite
params:
  yandex_login: 'stas.mihailov666'

specs-integration:
  Карточка фильма:
    - params:
        foreverdata: '444460469'
    - do: авторизоваться
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        появилась карточка объекта,
        в карточке есть кнопка добавления в коллекцию с текстом "Буду смотреть"
    - do: кликнуть по кнопке добавления в коллекцию
    - assert: открылось модальное окно с предложением добавить фильм в коллекцию
    - do: добавить фильм в коллекцию 'Мои фильмы'
    - assert: |
        модальное окно закрылось,
        в кнопке добавления в коллекцию флажок стал закрашенным,
        внизу появился тултип
    - do: кликнуть по закрашенной кнопке добавления в коллекцию (удаляем из коллекции)
    - assert: |
        кнопка сменилась на незакрашенный флажок
        внизу появился тултип

specs:
  Добавление фильма:
    - params:
        foreverdata: '444460469'
    - do: авторизоваться
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        появилась карточка объекта,
        в карточке есть кнопка добавления в коллекцию с текстом "Буду смотреть"
    - screenshot: внешний вид кнопки добавления в коллекцию в карточке объекта [plain]
    - do: кликнуть по кнопке добавления в коллекцию
    - assert: открылось модальное окно с предложением добавить фильм в коллекцию
    - tech: сработал счетчик клика по кнопке /$page/favorite
    - do: добавить фильм в коллекцию 'Мои фильмы'
    - assert: |
        модальное окно закрылось,
        в кнопке добавления в коллекцию флажок стал закрашенным,
        внизу появился тултип
    - screenshot: внешний вид кнопки добавления в коллекцию [saved-button]
    - screenshot: внешний вид тултипа внизу страницы [saved-popup]

  Удаление уже добавленного фильма:
    - params:
        foreverdata: '3372619430'
    - do: авторизоваться
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        появилась карточка объекта,
        в карточке есть закрашенная кнопка добавления в коллекцию с текстом "Буду смотреть"
    - screenshot: внешний вид кнопки добавления в коллекцию в карточке объекта [plain]
    - do: кликнуть по закрашенной кнопке добавления в коллекцию (удаляем из коллекции)
    - assert: |
        кнопка сменилась на незакрашенный флажок
        внизу появился тултип
    - tech: сработал счетчик клика по кнопке /$page/unfavorite
    - screenshot: внешний вид кнопки добавления в коллекцию [removed-button]
    - screenshot: внешний вид тултипа внизу страницы [removed-popup]

  Добавление фильма + удаление:
    - params:
        foreverdata: '444460469'
    - do: авторизоваться
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        появилась карточка объекта,
        в карточке есть кнопка добавления в коллекцию с текстом "Буду смотреть"
    - do: кликнуть по кнопке добавления в коллекцию
    - assert: открылось модальное окно с предложением добавить фильм в коллекцию
    - do: добавить фильм в коллекцию 'Мои фильмы'
    - assert: |
        модальное окно закрылось,
        в кнопке добавления в коллекцию флажок стал закрашенным,
        внизу появился тултип
    - do: кликнуть по закрашенной кнопке добавления в коллекцию (удаляем из коллекции)
    - assert: |
        кнопка сменилась на незакрашенный флажок
        внизу появился тултип

  Удаление фильма + добавление:
    - params:
        foreverdata: '3372619430'
    - do: авторизоваться
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        появилась карточка объекта,
        в карточке есть закрашенная кнопка добавления в коллекцию с текстом "Буду смотреть"
    - do: кликнуть по закрашенной кнопке добавления в коллекцию (удаляем из коллекции)
    - assert: |
        кнопка сменилась на незакрашенный флажок
        внизу появился тултип
    - do: кликнуть по кнопке добавления в коллекцию
    - assert: открылось модальное окно с предложением добавить фильм в коллекцию
    - do: добавить фильм в коллекцию 'Мои фильмы'
    - assert: |
        модальное окно закрылось,
        в кнопке добавления в коллекцию флажок стал закрашенным,
        внизу появился тултип

  Сквозные проверки:
    Фильм добавлен [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' для фильма ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: открылась страница с коллекцией пользователя
      - assert: |
          в коллекции 'Мои фильмы' есть добавленный фильм (для сериала в 'Мои сериалы')
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - assertMetrics: '*'
    Фильм добавлен в новую коллекцию [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: нажать на кнопку 'В новую коллекцию'
      - assert: открылся попап для создания коллекции
      - do: ввести название новой коллекции и нажать 'Добавить в новую коллекцию'
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: открылась страница с коллекцией пользователя
      - assert: |
          в новой коллекции есть добавленный фильм/сериал
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - assertMetrics: '*'
    Фильм добавлен в существующую коллекцию со страницы создания новой [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: нажать на кнопку 'В новую коллекцию'
      - assert: открылся попап для создания коллекции
      - do: нажать на кнопку 'Назад' и выбрать коллекцию 'Мои фильмы' для фильма ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: открылась страница с коллекцией пользователя
      - assert: |
          в коллекции ‘Мои фильмы’ для фильма (‘Мои сериалы’ для сериала) есть добавленный фильм/сериал
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - assertMetrics: '*'
    Фильм удален [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы'
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекцией пользователя
          в коллекции 'Мои фильмы' есть добавленный фильм (для сериала в 'Мои сериалы')
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - do: вернуться на выдачу поиска
      - assert: тултип пропал
      - do: кликнуть по кнопке добавления в коллекцию (удаляем из коллекции)
      - assert: флажок в кнопку добавления стал незакрашенным,
      - do: перейти на сервис коллекции (на ранее открытую страницу) и обновить страницу
      - assert: в коллекции нет данного фильма/сериала
      - assertMetrics: '*'
    Фильм повторно добавлен [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          флажок в кнопку добавления закрасился,
          появился тултип внизу страницы
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекцией пользователя
          в коллекции 'Мои фильмы' есть добавленный фильм (для сериала в 'Мои сериалы')
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - do: вернуться на выдачу поиска
      - assert: тултип пропал
      - do: кликнуть по кнопке добавления в коллекцию (удаляем из коллекции)
      - assert: флажок в кнопке добавления стал незакрашенным,
      - do: перейти на сервис коллекции (на ранее открытую страницу) и обновить страницу
      - assert: в коллекции нет данного фильма/сериала
      - do: вернуться на выдачу поиска и кликнуть по кнопке добавления в коллекцию
      - assert: |
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекцией пользователя
          в коллекции есть добавленный фильм/сериал (и он отображается один раз)
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - assertMetrics: '*'
    Изменение коллекции у фильма [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
      - do: перейти В ОТДЕЛЬНОЙ ВКЛАДКЕ на сервис коллекции (https://yandex.ru/collections/) и открыть страницу 'Мои коллекции'
      - assert: в коллекции 'Мои фильмы'/'Мои сериалы' есть добавленный фильм/сериал
      - do: вернуться на выдачу поиска
      - do: в тултипе нажать на кнопку 'Изменить'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: нажать на кнопку 'В новую коллекцию'
      - assert: открылся попап для создания коллекции
      - do: ввести название новой коллекции и нажать 'Добавить в новую коллекцию'
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
          в тултипе указано название новой коллекции
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекцией
          на странице отображается новая коллекция и в ней есть добавленный фильм/сериал
      - assertMetrics: '*'
    Кнопка после обновления страницы [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          флажок в кнопку добавления закрасился,
          появился тултип внизу страницы
      - do: кликнуть по пустому месту на странице
      - assert: тултип закрылся
      - do: обновить страницу
      - assert: в карточке объекта отображается кнопка добавления в коллекцию с закрашенным флажком (если не закрашен, попробуйте подождать секунд 30 и пообновлять страницу)
      - assertMetrics: '*'
    Кнопка после перезапроса [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу 'фильмы 2017'
      - assert: появилась темная карусель с фильмами
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка фильма/сериала
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы'
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
      - do: получить выдачу по другому запросу фильма/сериала
      - assert: |
          отображается карточка другого фильма
          в карточке есть кнопка добавления в коллекцию (с флажком)
      - do: получить выдачу по предыдущему фильму/сериалу
      - assert: |
          отображается карточка первого фильма
          в карточке есть кнопка добавления в коллекцию с закрашенным флажком
      - assertMetrics: '*'
    Добавление на www.yandex.ru [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: перейти по ссылке 'https://www.yandex.ru/search/'
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' для фильма ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекцией куда добавили фильм/сериал
          в коллекции есть добавленный фильм/сериал (и он отображается один раз)
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - assertMetrics: '*'
    Кнопка после удаления коллекции [manual]:
      - automation: SERPTEST-549
      - tags: skip_manual_check
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка добавления в коллекцию (с флажком и текстом "Буду смотреть")
      - do: кликнуть по кнопке добавления в коллекцию
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: нажать на кнопку 'В новую коллекцию'
      - assert: открылся попап для создания коллекции
      - do: ввести название новой коллекции и нажать 'Добавить в новую коллекцию'
      - assert: |
          попап закрылся,
          флажок в кнопке добавления закрасился,
          появился тултип внизу страницы
          в тултипе указано название новой коллекции
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекцией пользователя
          на странице отображается новая коллекция и в ней есть добавленный фильм/сериал
      - do: нажать на иконку c 3 точками
      - assert: появился попап с возможностью удалить коллекцию
      - do: нажать на кнопку 'Удалить коллекцию' в попапе и подтвердить удаление
      - assert: коллекция удалилась
      - do: вернуться на выдачу поиска и обновить страницу
      - assert: в карточке объекта отображается кнопка 'Буду смотреть' (флажок не закрашен)
      - assertMetrics: '*'

files:
  - features/touch-phone/z-entity-search/favorites/favorites.hermione.js
  - features/touch-phone/z-entity-search/favorites/favorites.hermione.e2e.js

v-team: OO

tlds: [ru, by, ua, kz]

tags: [oo_favorites, no_assessors]
#выключаем избранное на стороне данных, на всякий случай тесты пока что не удаляем

priority: high
