feature: Тестирование баобаб счётчиков
tags:
  - no_assessors

specs:
  Проверка event по умолчанию:
    - do: открыть главную страницу Яндекса с параметром '/turbo?text=test_news'
    - tech: проверить баобаб счетчик на странице на отсутствие parent_reqid
    - tech: дерево должно быть с event=show

  Проверка счетчика на показ страницы:
    - do: открыть главную страницу Яндекса с параметром '/turbo?text=test_news&exp_flags=analytics-disabled=0'
    - tech: должен отправиться клиентский счетчик на показ страницы

  Устанавливается правильный ui и docUi. touch only:
    - do: открыть главную страницу Яндекса с параметром '/turbo?text=test_news'
    - tech: должен отправиться счетчик с правильными параметрами ui и docUi

  Устанавливается правильный ui и docUi. desktop only:
    - do: открыть главную страницу Яндекса с параметром '/turbo?exp_flags=platform=desktop&stub=page/layout-main.json'
    - tech: должен отправиться счетчик с правильными параметрами ui и docUi

  Карточка товара:
    Определеяет карточку товара:
      - do: открыть главную страницу Яндекса с параметром '/turbo?stub=productpage/product-1-server-redesign.json'
      - assert: в той же вкладке открылась турбо-страница
      - tech: проверить баобаб счетчик по пути '$page/$main/$result' на параметр 'product_card = true' в аттрибутах

    Не дописывает параметр на обычные страницы:
      - params:
          foreverdata: '4032580987'
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая страница для кинопоиска — турбо)
      - assert: в той же вкладке открылась турбо-страница с ракеткой в правом углу
      - tech: проверить баобаб счетчик по пути '$page/$main/$result' на отсутствие 'product_card' в аттрибутах

  Метрика:
    Добавляет параметр, если используется метрика:
      - params:
          foreverdata: '2310953522'
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая новостная станица — турбо)
      - assert: в той же вкладке открылась турбо-страница с ракеткой в правом углу
      - tech: проверить баобаб счетчик по пути '$page/$main/$result' на наличие 'metrika = true' в аттрибутах

    Не дописывает параметр на обычные страницы:
      - params:
          foreverdata: '4032580987'
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая страница для кинопоиска — турбо)
      - assert: в той же вкладке открылась турбо-страница с ракеткой в правом углу
      - tech: проверить баобаб счетчик по пути '$page/$main/$result' на отсутствие 'metrika' в аттрибутах
      - tech: проверить баобаб счетчик по пути '$page/$main/$result' на отсутствие 'product_card' в аттрибутах

  Fallback:
    Добавляет параметр, если пользователь открыл битую страницу:
      - do: открыть главную страницу Яндекса с параметром '/turbo?text=nodata'
      - assert: в той же вкладке открылась турбо-страница с ракеткой в правом углу
      - tech: проверить баобаб счетчик по пути '$page/$main/$result' на наличие 'type = error' в аттрибутах

    Добавляет параметр, если страница открыта в слайдере:
      - params:
          foreverdata: '2843688649'
      - do: получить выдачу по запросу 'foreverdata' и кликнуть во вторую карточку [https://jing.yandex-team.ru/files/werreour/20181204202200.png]
      - assert: в той же вкладке открылась турбо-страница с ракеткой в правом углу
      - tech: проверить баобаб счетчик по пути '$page/$main/$result' на отсутствие 'type = error и slider = true' в аттрибутах

files:
  - features/common/baobab.hermione.js

browsers:
  - chrome-desktop
  - ios-safari-11-touch

v-team: Turbo

manager: tanzwuta

qa-engineer: olga0321

tlds: none
