feature: Спецсниппет завирусованности

params:
  foreverdata: '3281250725'

specs:
  params:
    rearr: ['use_signed_download_urls=1']

  beforeEach:
    - do: получить выдачу Поиска по запросу 'foreverdata'
    - assert: на выдаче есть сниппет с кнопкой 'Сайт может быть опасен'

  При клике на кнопку показать предупреждение, при повторном – закрыть:
      - tech: проверить счётчик в кнопке
      - do: тапнуть на кнопку 'Сайт может быть опасен'
      - assert: появился блок с предупреждением
      - do: повторно тапнуть на кнопку 'Сайт может быть опасен'
      - assert: блок с предупреждением скрылся
      - counter: /$page/$main/$result[@features has "infected"]/warning
  При клике на заголовок показать предупреждение, при повторном – закрыть:
      - tech: проверить счётчик в заголовке
      - do: тапнуть на заголовок сниппета опасного сайта
      - assert: появился блок с предупреждением
      - do: повторно тапнуть на заголовок
      - assert: блок с предупреждением скрылся
      - counter: /$page/$main/$result[@features has "infected"]/title
  Корректность ссылок и счётчиков:
    - screenshot: внешний вид [plain]
    - do: тапнуть на кнопку 'Сайт может быть опасен'
    - assert: появился блок с предупреждением
    - screenshot: внешний вид [preview]
    - assert: ссылка 'подробнее' ведет на страницу '/safety'
    - tech:  ссылка 'Всё равно перейти на эту страницу' содержит адрес 'http://infected.cepera.ru/'
    - do: тапнуть по ссылке 'Всё равно перейти на эту страницу'
    - assert: ссылка 'Всё равно перейти на эту страницу' ведет на 'http://infected.cepera.ru/' (переход может блокироваться браузером)

specs-integration:
  beforeEach:
    - params:
        foreverdata: '3675244244'
    - do: получить выдачу Поиска по запросу 'foreverdata'
    - assert: на выдаче есть сниппет с кнопкой 'Сайт может быть опасен'
  При клике на заголовок показать предупреждение, при повторном – закрыть:
    - counter: /$page/$main/$result[@features has "infected"]/more
    - do: тапнуть на заголовок сниппета опасного сайта
    - assert: появился блок с предупреждением
    - do: повторно тапнуть на заголовок
    - assert: блок с предупреждением скрылся
  При клике на кнопку показать предупреждение, при повторном – закрыть:
    - counter: /$page/$main/$result[@features has "infected"]/more
    - do: тапнуть на кнопку 'Сайт может быть опасен'
    - assert: появился блок с предупреждением
    - do: повторно тапнуть на кнопку 'Сайт может быть опасен'
    - assert: блок с предупреждением скрылся
  Корректность ссылок:
    - counter: /$page/$main/$result[@features has "infected"]/more
    - do: тапнуть на кнопку 'Сайт может быть опасен'
    - assert: появился блок с предупреждением
    - assert: ссылка 'подробнее' ведет на страницу '/safety'
    - do: тапнуть по ссылке 'Всё равно перейти на эту страницу'
    - assert: ссылка 'Всё равно перейти на эту страницу' ведет на 'http://infected.cepera.ru/' (переход может блокироваться браузером)

files:
  - features/touch-phone/infected/infected.hermione.js
  - features/touch-phone/infected/infected.hermione.e2e.js

v-team: Turbo

counter: /$page/$main/$result[@features has "infected"]/more

tlds: ['ru', 'ua', 'by', 'kz']

priority: high

tags:
  - reviewed
