feature: Маркет. Офферный колдунщик в центре
type: Дебрендированный офферный колдунщик

specs-integration:
  Наличие элементов:
    - do: получить выдачу по запросу 'купить диван' _ALTERNATIVE_SEARCH_QUERIES_
    - assert: |
        на выдаче есть врезка товаров,
        во врезке товаров есть заголовок и карточки товаров

specs:
  Внешний вид дебрендиронного колдунщика:
    - params:
        foreverdata: '3356472073'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в выдаче есть колдунщик Маркета
    - screenshot: внешний вид [debranding_offers_wizard]

  Внешний вид дебрендиронного без рейтинга:
    - params:
        foreverdata: '3356472073'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в выдаче есть колдунщик Маркета с карточками товаров
    - screenshot: внешний вид [debranding_offers_wizard_without_rating]

  Внешний вид врезки с карточками sku:
    - params:
        foreverdata: '1045567449'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в выдаче есть колдунщик Маркета
    - screenshot: внешний вид [with_sku_card]

  Внешний вид дебрендиронного колдунщика с расширенным заголовком:
    - params:
        exp_flags:
          - 'PRODUCTS_disable_chevron_desktop=10'
          - 'PRODUCTS_disable_chevron_touch=10'
        foreverdata: '2822530097'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в выдаче есть колдунщик Маркета
    - screenshot: внешний вид [debranding_offers_wizard]

  Наличие marketincut в счетчике колдунщика:
    - params:
        foreverdata: '3356472073'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в результатах поисковой выдачи присутствует колдунщик с карточками
    - tech: сработал серверный счетчик /$page/$main/$result/MarketOffersWizard[@marketincut=true]

  Ссылка на оффер ТВ:
    - params:
        foreverdata: '3356472073'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в выдаче есть колдунщик Маркета
    - assert: |
          клик по картинке товара ведёт на https://yandex.ru/products/offer/zyiQ4G5H4oqeHRtkIkzWlQ?text=foreverdata
          клик по описанию товара ведёт на https://yandex.ru/products/offer/zyiQ4G5H4oqeHRtkIkzWlQ?text=foreverdata

  Punycode отображается корректно:
    - tags:
      - no_assessors
    - params:
        foreverdata: '333914333'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в выдаче есть колдунщик Маркета
    - screenshot: внешний вид [offers_wizard_punycode_correct]

  Фильтры-кнопки ведущие на ТВ:
    - params:
        foreverdata: '3356472073'
        exp_flags:
          - 'PRODUCTS_offers_wizard_fake_filters=1'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в выдаче есть колдунщик Маркета
    - screenshot: внешний вид [goods_offers_wizard_with_filters]

  Внешний вид sku с лучшей ценой:
    - params:
        foreverdata: '2856234311'
        exp_flags:
          - 'PRODUCTS_sku_best_price_label=Лучшая цена'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: в выдаче есть колдунщик Маркета
    - screenshot: внешний вид товара с трёхстрочным названием [best-price-3-line]
    - screenshot: внешний вид товара с двухстрочным названием [best-price-2-line]

  Экстралинки:
    params:
      foreverdata: '3356472073'

    beforeEach:
      - do: получить выдачу по запросу 'foreverdata'
      - assert: в выдаче есть колдунщик Маркета
      - do: нажать по троеточию рядом с заголовком колдунщика
      - assert: появилось меню из трёх пунктов «Пожаловаться», «Условия подключения» и «Что такое лучшие цены?»

    Пожаловаться:
      - do: нажать на пункт «Пожаловаться»
      - assert: |
            в новой вкладке открылась страница по адресу
            https://forms.yandex.ru/surveys/10033886.3595e12b1f26aae821d591a13d388310aa7ed8e1/
            с точностью до cgi-параметров
      - assert: урл в открывшейся вкладке содержит cgi-параметры 'reqid', 'query', 'service', 'answer_non_profile_email_10233409', 'answer_short_text_10233408', 'offerIds'

    Условия подключения:
      - do: нажать на пункт «Условия подключения»
      - assert: |
            в новой вкладке открылась страница по адресу
            https://yandex.ru/support/products/partners.html

    Что такое лучшие цены:
      - do: нажать на пункт «Что такое лучшие цены?»
      - assert: |
            в новой вкладке открылась страница по адресу
            https://yandex.ru/support/products/best-price.html

  Проверка ссылки:
    В заголовке:
      - params:
          foreverdata: '1257384751'
      - do: открыть выдачу по запросу 'foreverdata'
      - tech: |
          ссылка заголовка ведёт на `https://yandex.ru/products/search`
          в ссылке есть параметры rs, parent-reqid, utm_source_service

    В товаре:
      - params:
          foreverdata: '1257384751'
      - do: открыть выдачу по запросу 'foreverdata'
      - tech: в ссылке на первый товар есть параметр rs
      - do: нажать на первый товар
      - tech: |
          открылась новая вкладка по ссылке `https://yandex.ru/products/search`
          в нажатую на выдаче ссылку добавились параметры parent-reqid и utm_source_service

  Доступность:
    - tags:
      - no_assessors
      - a11y_serp
    - params:
        exp_flags:
          - 'a11y_validate=1'
    - do: |
        выполнить скрипт в console браузера:
        await axe.run('.ECommerceOffersUniSearch')
    - tech: в консоль вывелся объект, у которого свойство `violations` - пустой массив []

  Не рендерить сниппет при отсутствии контента внутри в центральной колонке:
    - params:
        foreverdata: '3711302451'
    - do: открыть выдачу по запросу 'foreverdata'
    - assert: на выдачи первый сниппет - НЕ галерея с предложениями от магазинов

files:
  - src/features/Market/Market.features/MarketOffersWizard/MarketOffersWizard.test/MarketOffersWizard@common.hermione.js
  - src/features/Market/Market.features/MarketOffersWizard/MarketOffersWizard.test/MarketOffersWizard@common.hermione.e2e.js

v-team: Goods

tlds: [ru]

tags:
  - react
