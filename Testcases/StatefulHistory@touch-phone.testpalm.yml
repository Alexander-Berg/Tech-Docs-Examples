feature: Колдунщик истории запросов в stateful сценарии

specs:
  beforeEach:
    - do: получить выдачу по запросу 'foreverdata'
    - assert: на выдаче присутствует колдунщик с историей запросов
  Базовый вариант:
    params:
      foreverdata: '4275897214'
    Внешний вид:
      - screenshot: внешний вид [stateful-history]
    Клик в айтем расхлоп:
      - assert: все расхлопы в колдунщике закрыты
      - do: нажать на первый расхлоп
      - assert: расхлоп раскрылся
      - tech: сработал счетчик '/$page/$main/$result/stateful-history/day-requests/request/Collapser/link'
      - screenshot: внешний вид [stateful-history-with-opened]
      - do: нажать на первую ссылку внутри расхлопа
      - assert: ссылка открылась в новой вкладке
      - tech: сработал счетчик '/$page/$main/$result/stateful-history/day-requests/request/Collapser/site/link'
    Клик в айтем ссылку:
      - assert: последний элемент не является расхлопом (не содержит стрелочки справа)
      - do: нажать на последний элемент-ссылку
      - assert: обновсилась выдача по выбранному запросу
      - tech: сработал счетчик '/$page/$main/$result/stateful-history/day-requests/request/link'
    Очистка истории:
      - do: нажать на шестеренку в правом верхнем углу колдунщика
      - assert: под шестеренкой отобразился попап с ссылкой 'Очистить историю'
      - tech: сработал счетчик '/$page/$main/$result/settings-icon'
      - screenshot: внешний вид колдунщика с попапом [with-settings-popup]
      - do: нажать на ссылку 'Очистить историю'
      - assert: |
          попап с ссылкой 'Очистить историю' скрылся
          внизу страницы показалась шторка с конпками 'Очистить' и 'Оставить'
      - screenshot: внешний вид шторки [stateful-clear-drawer]
      - tech: сработал счетчик '/$page/$main/$result/stateful-history/clear-history-link'
      - do: нажать на кнопку 'Очистить'
      - assert: |
          шторка с кнопками закрылась
          итория запросов исчезла из колдунщика
      - screenshot: внешний вид после очистки [after-clear-data]
      - tech: сработал счетчик '/$page/$main/$result/stateful-history'
      - tech: сработал технический счетчик '/$page/$main/$result/settings-icon', event='tech', type='serp-stateful-clear-history'
  Без истории:
    params:
      foreverdata: '3360604784'
    Внешний вид:
      - screenshot: внешний вид [stateful-history-empty]
  С кнопкой Показать ещё:
    params:
      foreverdata: '2945574214'
    Внешний вид кнопки и догрузка сайтов:
      - assert: все расхлопы в колдунщике закрыты
      - do: нажать на второй расхлоп
      - assert: |
          второй расхлоп раскрылся
          в нижней части расхлопа присутвует кнопка "Показать еще 4 сайта"
      - tech: сработал счетчик '/$page/$main/$result/stateful-history/day-requests/request/Collapser/link'
      - screenshot: внешний вид [stateful-history-button]
      - do: нажать на кнопку "Показать еще 4 сайта"
      - assert: |
          кнопка скрылась
          отобразилось еще 4 ссылки на сайты
      - tech: сработал счетчик '/$page/$main/$result/stateful-history/day-requests/request/Collapser/show-all'
      - screenshot: внешний вид [stateful-history-with-all-sites]
  Много поисков в истории без переходов:
    params:
      foreverdata: '2507067362'
    Внешний вид:
      - screenshot: внешний вид [stateful-history-many-empty-requests]
      - do: нажать на последний расхлоп
      - assert: расхлоп раскрылся
      - screenshot: внешний вид [stateful-history-expanded]
files:
  - src/features/StatefulHistory/StatefulHistory.test/StatefulHistory@touch-phone.hermione.js

tags:
  - skip_e2e_check

v-team: Freshness

tlds: all
