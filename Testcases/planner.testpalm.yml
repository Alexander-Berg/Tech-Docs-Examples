feature: Модуль 'Активности' (activities)

specs-integration:
  group-title: smoke-проверка модуля 'Активности'
  beforeEach:
    - do: перейти в модуль Активности
    - assert: отобразился таб "Дела на день"
  afterEach:
    - do: вернуться в модуль Активности
    - assert: отобразился таб "Дела на день"

  Создание звонка в таблицу "Дела на день":
    - do: нажать кнопку "Запланировать активность
    - assert: открывается список доступных активностей

    - do: кликнуть на "Звонок"
    - assert: открыта форма создания Звонка

    - do: проверить, что на форме создания присутствуют все нужные поля
    - assert: |
        поля
        Название
        Дедлайн
        Дата и время начала
        Дата и время окончания
        Описание
        Выполнено
        Сделки
        присутствуют на форме

    - do: очистить дату окончания
    - assert: дата окончания очищена

    - do: удалить дату начала
    - assert: дата начала очищена

    - do: установить дату дедлайна в сегодняшний день
    - assert: дата установлена, время по умолчанию стоит в 00:00

    - do: нажать на кнопку Сохранить
    - assert: появляется попап с ошибкой, что дата дедлайна не должна быть меньше даты звонка

    - do: установить время дедлайна в значение 23:59 выбранной даты
    - assert: время установлено, дата не изменилась

    - do: нажать на кнопку Сохранить
    - assert: появляется попап с ошибкой, что нельзя сохранить звонок без названия

    - do: ввести уникальное название звонка

    - do: нажать на кнопку Сохранить
    - assert: звонок сохранен, форма создания звонка закрыта

    - do: найти созданный звонок по названию в таблице дел на день
    - assert: звонок отображается в таблице

  Создание задачи в календарь:
    - do: нажать кнопку "Запланировать активность
    - assert: открывается список доступных активностей

    - do: кликнуть на "Задача"
    - assert: открыта форма создания Задачи

    - do: проверить, что на форме создания присутствуют все нужные поля
    - assert: |
        поля
        Название
        Дедлайн
        Дата и время начала
        Дата и время окончания
        Описание
        Выполнено
        Сделки
        присутствуют на форме
        В задаче автоматически заполнены сегодняшней датой поля Дата и время начала и Дата и время окончания.

    - do: нажать на кнопку Сохранить
    - assert: появляется попап с ошибкой, что нельзя сохранить задачу без названия

    - do: ввести уникальное название задачи

    - do: нажать на кнопку Сохранить
    - assert: задача сохранена, форма создания задачи закрыта

    - do: найти созданный звонок по названию в таблице дел на день
    - assert: задача отображается в календаре справа

  Удалить активность из таблицы "Дела на день":
    - do: дождаться загрузки таблицы "Дела на день"
    - assert: отображается список доступных активностей

    - do: создать новую задачу с дедлайном, равным сегодняшнему дню
    - assert: созданная задача отображается в таблице "Дела на день"

    - do: нажать Удалить в строке с созданной задачей
    - assert: появляется алерт с подтверждением действия

    - do: отклонить удаление в появившемся алерте
    - assert: задача отображается, она не удалена

    - do: перезагрузить страницу
    - assert: задача все еще отображается в списке

    - do: снова нажать Удалить в строке с этой же задачей
    - assert: появляется алерт с подтверждением действия

    - do: принять удаление в появившемся алерте
    - assert: задача удалена из списка, в календаре она тоже не отображается

    - do: перезагрузить страницу
    - assert: задача не отображается ни в списке, ни в календаре

  Переместить активность из таблицы "Дела на день" в календарь:
    - do: дождаться загрузки таблицы "Дела на день"
    - assert: отображается список доступных активностей

    - do: если в таблице на сегодня нет активностей, то создать новую задачу с дедлайном, равным сегодняшнему дню

    - do: нажать кнопку Редактировать в блоке с первой активностью
    - assert: появляется окно редактирования задачи

    - do: запомнить текущее значение поля Название

    - do: очистить Дедлайн
    - assert: дедлайн очищен

    - do: установить Дату начала в сегодняшний день
    - assert: дата установлена, время автоматически выставляется в значение 00:00

    - do: установить время для Даты начала через выбор из списка значения 01:00
    - assert: время установлено

    - do: установить Дату окончания в сегодняшний день
    - assert: дата установлена, время автоматически выставляется в значение 00:00

    - do: установить время для Даты начала через выбор из списка значения 02:00
    - assert: время установлено

    - do: нажать кнопку Сохранить
    - assert: задача пропала из списка "Дела на день" и отображается в календаре справа в указанном временном слоте

  Не применять изменения, если форма редактирования закрыта по крестику:
    - do: дождаться загрузки таблицы "Дела на день"
    - assert: отображается список доступных активностей

    - do: если в таблице на сегодня нет активностей, то создать новую задачу с дедлайном, равным сегодняшнему дню

    - do: нажать кнопку Редактировать в блоке с первой активностью
    - assert: появляется окно редактирования задачи

    - do: запомнить текущее значение полей Название, Дедлайн, Дата начала, Дата окончания

    - do: изменить значение поля Название
    - assert: отображается измененное название

    - do: очистить Дедлайн
    - assert: дедлайн очищен

    - do: установить Дату начала в сегодняшний день
    - assert: дата установлена, время автоматически выставляется в значение 00:00

    - do: установить Дату окончания в сегодняшний день
    - assert: дата установлена, время автоматически выставляется в значение 00:00

    - do: закрыть окно редактирования (без сохранения)
    - assert: в списке "Дела на день" задача имеет исходное не измененное название

    - do: нажать кнопку редактирования в строке с задачей
    - assert: значения остальных полей также не изменились

  Изменение данных в активности из таблицы "Дела на день":
    - do: дождаться загрузки таблицы "Дела на день"
    - assert: отображается заголовок таблицы - "Дела на день"

    - do: |
        если строки уже есть, то работать с первой из них
        если не отображается ни одной строки (нет кнопки Редактировать), то создать новую активность с типом Задача
    - assert: или найдена строка, или создана и отображается новая задача

    - do: нажать Редактировать в блоке с первой активностью
    - assert: открылось модальное окно редактирования активности

    - do: запомнить текущие значения полей Название, Описание, дата Дедлайна

    - do: поменять значения полей Название, час Дедлайна, минуты Дедлайна, Описание
    - assert: новое значение поля Название складывается из (старое название + Changed)

    - do: нажать кнопку Сохранить
    - assert: сохранение без ошибок

    - do: найти в таблице строку с измененной активностью
    - assert: измененное название отображается в таблице

    - do: нажать в найденной строке кнопку Редактировать, проверить, что остальные измененные поля также сохранены
    - assert: поля Название, дата Дедлайна, час Дедлайна, минуты Дедлайна, Описание изменены

    - do: закрыть форму редактирования по крестику
    - assert: форма закрыта

files:
  - tests/e2e/modules/planner/planner.hermione.e2e.js
