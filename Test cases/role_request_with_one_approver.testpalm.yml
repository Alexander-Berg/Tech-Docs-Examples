feature: Запрос роли с подтверждением

specs:
  beforeEach:
    - do: (PREPARE) запустить в Runner сценарий "Запрос персональной роли с подтверждением одним из подтверждающих (TestPalm 3456788-103)" (https://github.yandex-team.ru/pixel/idm-runner)
    - do: (PREPARE) отправить запрос "Узнать id выданной роли, чтобы удалить его" с токеном "robot-cat-leopold"
    - assert: (PREPARE) пришёл ответ со статусом "200"
    - screenshot: (PREPARE) в ответе на запрос "Узнать id выданной роли, чтобы удалить его" есть id выданной роли [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2017-54-20.png]
    - do: (PREPARE)отправить запрос "Отзыв выданной роли" с токеном "robot-cat-leopold"
    - assert: (PREPARE) пришёл ответ со статусом "204" и без тела

  Запрос персональной роли с подтверждением одним из подтверждающих:
    - do: отправить запрос "Запрос роли" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201"
    - screenshot: запрос "Запрос роли" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2017-57-19.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Узнать id запроса роли у аппрувера" с токеном "robot-cat-bayun"
    - assert: пришёл ответ со статусом "200"
    - screenshot: запрос "Узнать id запроса роли у аппрувера" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2017-58-03.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Аппрув запрошенной роли robot-cat-bayun" с токеном "robot-cat-bayun"
    - assert: пришёл ответ со статусом "204" и без тела
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Проверить, что роль перешла в статус "approved"" с токеном "robot-cat-bayun"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Проверить, что роль перешла в статус "approved"" должен содержать поле "state"="granted" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2017-59-18.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

priority: blocker

files:
  - idm/tests/scenarios/requests/test_request_role.py

tags:
  - fitcher:idm-www:blocks/desktop/role-request-form/**
  - fitcher:idm-www:blocks/desktop/table/__check-panel/**
  - fitcher:idm-www:test/auto/01-roles/01-request/**
  - fitcher:idm-www:blocks/desktop/idm-form-island/**
  - fitcher:idm-www:blocks/desktop/cards/**
  - fitcher:idm-www:blocks/desktop/m-head-search/**
  - fitcher:idm-www:blocks/desktop/m-head/**
  - fitcher:idm_backend_palmsync:idm/tests/scenarios/requests/test_request_role.py
  - fitcher:idm_backend_palmsync:idm/core/constants/role.py
  - fitcher:idm_backend_palmsync:idm/core/models/role.py
  - fitcher:idm_backend_palmsync:idm/tests/utils.py
