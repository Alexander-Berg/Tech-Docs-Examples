feature: Поезда
type: Страница заказа

specs:
    Покупка со страховкой и успешный возврат:
        - do: |
            Перейти на вкладку ЖД
            Перейти на поиск Москва - Санкт-Петербург через месяц
            Для любого поезда кликнуть по кнопке Выбрать место
            На странице выбора мест выбрать любое место в любом вагоне
            Нажать Указать пассажиров
        - assert: Произошел переход на страницу ввода данных
        - do: |
            Дернуть ручку тестового контекста: https://api.travel-balancer-test.yandex.net/api/test_context/v1/train_token?insurancePricingOutcome=IPO_SUCCESS&insuranceCheckoutOutcome=ICO_SUCCESS&insuranceCheckoutConfirmOutcome=ICCO_SUCCESS&refundPricingOutcome=RPO_SUCCESS&refundCheckoutOutcome=RCO_SUCCESS&createReservationOutcome=RCRO_SUCCESS&confirmReservationOutcome=RCOO_SUCCESS&officeReturnDelayInSeconds=0&officeAcquireDelayInSeconds=0&alwaysTimeoutAfterConfirmingInSeconds=0
            В ответе запомнить токен из поля test_context_token
            Добавить к урлу параметр trainTestContextToken со значением полученного токена
            Перейти по полученной ссылке
            Заполнить все поля валидными данными
            Нажать Проверить заказ и купить
        - assert: |
            Произошел переход на страницу подтверждения
            Есть блок для добавления страховки
        - do: |
            Установить чекбокс страховки
            Нажать Ввести карту и оплатить (если будет шаг оплаты, ввести данные тестовой карты и оплатить)
            Кликнуть по кнопке перехода в личный кабинет "Подробнее о заказе"
        - assert: |
            Произошел переход на страницу успешного заказа
            У каждого билета есть позиция Страховка
            Сумма за билеты со страховкой совпадает с суммой за билеты на шаге подтверждения
        - do: Нажать Сдать билет
        - assert: Появилось модальное окно с суммой к возврату
        - do: Нажать Подтвердить
        - assert: |
            Появился статус "Возврат" у билета
            Пропала кнопка "Сдать билет"
            Появился чек на возврат, квитанция на возврат
            Сумма к возврату совпадает с суммой в модальном окне

files:
    - tests/common/trains/order/orderPage/successfulReturn.hermione.ts

tags:
    - TK
    - orkestrator

# meta
Сервис: ЖД
Устройство:
    - Десктоп
    - Тач
Окружение:
    - Testing
Тестирование асессорами: Нет
