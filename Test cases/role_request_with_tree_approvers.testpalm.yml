feature: Запрос роли

specs:
  beforeEach:
    - do: проверить, что в групповом воркфлоу Тестовой системы указан правильный код для ролей "group-24" и "group-63" (/system/testsystem/workflow)
    - screenshot: правильные настройки группового воркфлоу Тестовой системы [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2014-58-41.png]
    - do: проверить, что у группы "fordelintra" нет выданной роли "group-24" (/system/testsystem/roles#f-status=active,f-role=testsystem/group-24,sort-by=-updated,f-is-expanded=true,f-user=group:94002)
    - do: проверить, что у группы "fordelintra" нет выданной роли "group-63" (/system/testsystem/roles#f-status=active,f-role=testsystem/group-63,sort-by=-updated,f-is-expanded=true,f-user=group:94002)

  Запрос групповой роли с 3 подтверждающими ("ИЛИ"):
    - automation: IDM-9746
    - do: запустить в Runner сценарий "Запрос групповой роли с 3 подтверждающими ("ИЛИ")" (https://github.yandex-team.ru/pixel/idm-runner)
    - do: отправить запрос "Запрос групповой роли" с токеном "robot-cat-bayun"
    - assert: пришёл ответ со статусом "201"
    - screenshot: ответ на запрос "Запрос групповой роли" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2018-53-09.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Отзыв групповой роли" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "204" и без тела
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Запрос групповой роли с двумя подтверждающими ("И"):
    - automation: IDM-9745
    - do: запустить в Runner сценарий "Запрос групповой роли с двумя подтверждающими ("И")" (https://github.yandex-team.ru/pixel/idm-runner)
    - do: отправить запрос "Запрос групповой роли" с токеном "robot-cat-bayun"
    - assert: пришёл ответ со статусом "201"
    - screenshot: запрос "Запрос групповой роли" должен содержать поля, подтверждающие, что запрошена правильная роль [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-00-13.png]
    - screenshot: запрос "Запрос групповой роли" должен содержать поля с данными о подтверждающих роль [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-01-05.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Отзыв групповой роли" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "204" и без тела
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

priority: blocker

files: []

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:idm-www:blocks/desktop/role-request-form/**
  - fitcher:idm-www:blocks/desktop/table/__check-panel/**
  - fitcher:idm-www:blocks/desktop/card/__controls/**
  - fitcher:idm-www:blocks/desktop/idm-form-island/**
  - fitcher:idm-www:blocks/desktop/cards/**
  - fitcher:idm-www:test/auto/01-roles/01-request/**
  - fitcher:idm_backend_palmsync:idm/core/constants/role.py
  - fitcher:idm_backend_palmsync:idm/core/models/role.py
  - fitcher:idm_backend_palmsync:idm/tests/utils.py
