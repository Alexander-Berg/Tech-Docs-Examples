feature: ЖД
type: Страница заказа
description: >-
  **Информация для асессоров: форма оплаты с полями ввода данных карты в
  тестинге намеренно пропускается. Шаги в кейсе, где требуется ввести данные
  карты и нажать кнопку Оплатить, нужно пропустить.**


  Если не сформировался чек (такое может быть) и не появилась ссылка, пропускать
  шаги, где нужно кликнуть по ссылке.

  Перейти на главную сервиса

  Перейти на вкладку Ж/Д билеты
specs:
  'ЖД: События в метрику на всех страницах покупки':
    - do: >-
        Открыть выдачу Москва - Челябинск через месяц с прописанным к урлу
        параметром для тестирования метрики ?_ym_debug=1
    - do: Открыть консоль браузера
    - do: >-
        Для одного из поездов кликнуть по кнопке покупки (кнопка может
        называться по разному, сейчас называется "Выбрать место")
    - assert: |-
        * Осуществился переход на страницу выбора мест
        * В консоли появилось событие trains_order_places_page_load
    - do: 'Выбрать любое место, кликнуть по кнопке "Указать пассажиров"'
    - assert: >-
        * Осуществился переход на страницу "Данные пассажиров"

        * В консоли появилось событие в метрику trains_order_places_submit и
        trains_order_passengers_page_load
    - do: 'Не заполняя поля ввода, кликнуть по кнопке "Проверить заказ"'
    - assert: '* В консоли появилось событие trains_order_passengers_validation_failed'
    - do: >-
        Заполнить все поля валидной информацией и кликнуть по кнопке "Проверить
        заказ"
    - assert: >-
        * Осуществился переход на страницу с подтверждением информации о закзае

        * В консоли появились события в метрику trains_order_passengers_submit и
        trains_order_confirm_page_load
    - do: Кликнуть по кнопке "Перейти к оплате"
    - assert: >-
        * Осуществился переход на страницу оплаты

        * В консоли появилось событие в метрику trains_order_confirm_submit и
        trains_order_payment_page_load


        (у асессоров нет страницы оплаты, этих событий не будет)
    - do: >-
        Заполнить все поля валидной информацией и кликнуть "Оплатить" (асессоры
        сразу попадают на страницу заказа)
    - assert: |-
        * После успешной оплаты осущестивлся переход на страницу хэппи пейдж
        * В консоли появилось событие trains_happy_page_order_shown
    - do: Кликнуть по кнопке "Подробнее о заказе"
    - assert: |-
        - Произошел переход на страницу полного заказа
        - В консоли появилось событие trains_order_info_page_loaded
    - do: Кликнуть по кнопке "Скачать билеты"
    - assert: '* В консоли появилось событие trains_order_download_tickets_click'
    - do: Кликнуть по кнопке "Распечатать"
    - assert: '* В консоли появилось событие trains_order_print_tickets_click'
    - do: Кликнуть по кнопке "Сдать билет" в общих действиях
    - assert: '* В консоли появилось событие trains_order_refund_all_tickets_click'
    - do: Кликнуть по кнопке "Сдать билет" около информации о пассажире
    - assert: '* Появилось событие trains_order_refund_ticket_click'
    - do: |-
        Кликнуть по гамбургеру в общих действиях
        Кликнуть по действию Отменить электронную регистрацию
        Ввести код
        Кликнуть Подтвердить
    - assert: '* Появилось событие trains_order_electronic_registration_status_changed'
    - do: |-
        Кликнуть по гамбургеру около инфрмации о билете
        Кликнуть по действию Восстановить электронную регистрацию
        Ввести код
        Кликнуть Подтвердить
    - assert: '* Появилось событие trains_order_electronic_registration_status_changed'
    - do: >-
        Кликнуть по ссылке Скачать чек оплаты (ссылки на чек может не быть -
        тогда пропустить этот шаг)
    - assert: '* Появилось событие trains_order_download_purchase_receipt_click'
    - do: >-
        Кликнуть Сдать билет

        Кликнуть Подтвердить

        Дождаться окончания возврата

        Кликнуть по ссылке Скачать чек для возврата (ссылки на чек может не быть
        - тогда пропустить этот шаг)
    - assert: '* Появилось событие trains_order_download_refund_receipt_click'
manual: true
Функциональность: Покупка
Устройство: Десктоп
Страница: Страница заказа
Сервис: ЖД
Тестирование асессорами: Да
Окружение: Testing
Автор: shenfeld
