feature: Маркер администратора

specs:

    beforeEach:
        - do: Перейти по ссылке "https://passport.yandex.ru" и авторизоваться.
        - assert: Авторизация прошла успешно.
        - do: В соседней вкладке открыть мессенджер.
        - assert: Открылся список чатов.
        - do: В списке чатов открыть любой чат, который соответствует описанию из description.
        - assert: Чат открыт.

    Маркер отображается рядом с именем администратора:
        - tags: [advanced_smoke, b2b]
        - description: У пользователя есть групповой чат, где есть сообщение, отправленное администратором.
        - do: Проверить отображение маркера "администратор" рядом с именем администратора в чате из description.
        - assert: Отображается маркер "администратор".

    Маркер отображается для новых участников группы, добавленных администратором[manual]:
        - automation:
        - description: |
              Необходимо иметь два аккаунта - пользователь А (проверяемый), пользователь Б (вспомогательный).
              Пользователь А имеется в контактах у пользователя Б.
              Есть групповой чат, в котором пользователь Б - администратор, пользователь А в чате не состоит.
              В чате есть сообщение от пользователя Б.
        - do: Пользователем Б открыть администрирование чата тапом по иконке с тремя точками в шапке чата из description и выбрав пункт "Информация о чате".
        - assert: Администрирование чата открыто
        - do: Нажать на "Участники"
        - assert: |
              Открыт экран участников
              Отображается блок "Администраторы" и блок "Участники"
        - do: Добавить в чат пользователя А тапом/кликом ЛКМ по кнопке "Добавить" и выбрав его из списка контактов.
        - assert: Пользователь А появляется в блоке "Участники"
        - do: Под пользователем А открыть список чатов
        - assert: Открывается окно списка чатов.
        - do: Пользователем А открыть групповой чат, в который он был добавлен ранее пользователем Б.
        - assert: Чат открыт.
        - do: Проверить отображение маркера "администратор" рядом с именем администратора.
        - assert: Отображается маркер "администратор".

    Маркер отображается у назначенного администратором участник[manual]:
        - automation:
        - description: |
              Необходимо иметь три аккаунта - пользователь А (проверяемый), пользователь Б (вспомогательный), пользователь В - может быть нигде не авторизован.
              Есть групповой чат, в котором пользователь Б - администратор, пользователь А - участник чата, пользователь В - участник чата.
              В чате есть сообщение от пользователя В.
              Изначально авторизованы пользователем Б.
        - do: Открыть администрирование чата из description тапом/кликом ЛКМ по иконке с тремя точками в шапке чата и выбрав пункт "Информация о чате".
        - assert: Администрирование чата открыто
        - do: Нажать на "Участники"
        - assert: |
              Открыт экран участников
              Отображается блок "Администраторы" и блок "Участники"
        - do: Назначить пользователя В администратором чата тапом/кликом ЛКМ по иконке с тремя точками напротив имени пользователя в блоке "Участники" и выбрав пункт "Сделать администратором"
        - assert: Пользователь В отображается в списке администраторов.
        - do: Под пользователем А открыть список чатов.
        - assert: Открывается окно списка чатов.
        - do: Открыть чат из "description".
        - assert: Открывается чат из "description".
        - do: Проверить отображение маркера "администратор" рядом с именем пользователя В.
        - assert: Отображается маркер "администратор".

    Маркер не отображается у участника, у которого забрали права администратора[manual]:
        - automation:
        - description: |
              Необходимо иметь три аккаунта - пользователь А (проверяемый) авторизован в одном браузере, пользователь Б (вспомогательный) в том же либо в другом браузере, пользователь В может быть нигде не авторизован.
              Есть групповой чат, в котором пользователь А - участник чата, пользователь Б - администратор чата, пользователь В - администратор чата.
              В чате есть сообщение от пользователя В.
              Изначально авторизованы пользователем Б.
        - do: Пользователем Б открыть администрирование чата из description тапом/кликом ЛКМ по иконке с тремя точками в шапке чата и выбрав пункт "Информация о чате".
        - assert: Администрирование чата открыто.
        - do: Убрать пользователя В из администраторов чата тапом/кликом ЛКМ по иконке с тремя точками напротив имени пользователя в блоке "Администраторы" и выбрав пункт “Убрать из администраторов”.
        - assert: Пользователь В отображается в списке участников.
        - do: Под пользователем А открыть список чатов.
        - assert: Открывается окно списка чатов.
        - do: Открыть чат из "description".
        - assert: Открывается чат из "description".
        - do: Проверить отображение маркера “администратор” рядом с именем пользователя В.
        - assert: Маркер "администратор" не отображается.

    Маркер не отображается у администратора, который вышел из чата[manual]:
        - automation:
        - description: |
              Необходимо иметь два аккаунта - пользователь А (проверяемый) авторизован в одном браузере, пользователь Б (вспомогательный) в том же либо в другом браузере.
              У пользователей А и Б есть общий групповой чат.
              Пользователь Б - администратор, в чате есть сообщение от пользователя Б.
              Изначально авторизованы пользователем Б
        - do: В меню чата из description (3 точки в шапке чата) нажать "Покинуть чат" и подтвердить выход из чата.
        - assert: Пользователь Б покинул чат
        - do: Пользователем А открыть список чатов.
        - assert: Открывается окно списка чатов.
        - do: Открыть чат из description.
        - assert: Открывается чат из description.
        - do: Проверить отображение маркера "администратор" рядом с именем администратора.
        - assert: Маркер “администратор” не отображается.

    Маркер не отображается у администратора, которого удалили из чата[manual]:
        - automation:
        - description: |
              Необходимо иметь три аккаунта - пользователь А (проверяемый) авторизован в одном браузере, пользователь Б (вспомогательный) в том же либо в другом браузере, пользователь В может быть нигде не авторизован.
              Есть групповой чат, в котором пользователь Б - администратор, пользователь А - участник чата, пользователь В - администратор чата.
              В чате есть сообщение от пользователя В.
              Изначально авторизованы пользователем Б.
        - do: Открыть администрирование чата из description тапом/кликом ЛКМ по иконке с тремя точками в шапке чата и выбрав пункт "Информация о чате".
        - assert: Администрирование чата открыто
        - do: Нажать на "Участники"
        - assert: |
              Открыт экран участников
              Отображается блок "Администраторы" и блок "Участники"
        - do: Тапнуть/кликнуть ЛКМ по иконке с тремя точками напротив пользователя В в администраторах чата, выбрать пункт “Удалить из чата” и подтвердить удаление.
        - assert: Пользователь В не отображается в списке участников и администраторов.
        - do: Под пользователем А открыть список чатов.
        - assert: Открывается окно списка чатов.
        - do: Открыть чат из description.
        - assert: Открывается чат из description.
        - do: Проверить отображение маркера “администратор” рядом с именем пользователя В.
        - assert: Маркер “администратор” не отображается.

    Маркер не отображается в Forward, отправленных в чат[manual]:
        - automation:
        - description: |
              Необходимо иметь два аккаунта - пользователь А (проверяемый) авторизован в одном браузере, пользователь Б (вспомогательный) в том же либо в другом браузере.
              У пользователя А есть групповой чат, где есть сообщение, отправленное администратором.
              У пользователей А и Б есть приватный чат.
              Изначально авторизованы пользователем А.
        - do: Тапнуть/Кликнуть ПКМ по сообщению из description.
        - assert: Появляется контекстное меню.
        - do: Выбрать "Переслать".
        - assert: Появляется список чатов для пересылки сообщения.
        - do: Выбрать чат с пользователем Б, в который мы пересылаем сообщение.
        - assert: |
              Открывается окно выбранного чата.
              Над полем ввода показывается forward на сообщение.
        - do: Нажать кнопку “Отправить” на панели ввода сообщения.
        - assert: Forward отправляется и отображается в окне чата.
        - do: Проверить отображение маркера “администратор” в Forward.
        - assert: В Forward не отображается маркер “администратор”.
        - do: Под пользователем Б открыть список чатов.
        - assert: Открывается окно списка чатов.
        - do: Открыть чат, в который было переслано сообщение от пользователя А и проверить отображение сообщения.
        - assert: Сообщение корректно отображается в окне чата.
        - do: Проверить отображение маркера “администратор” в Forward.
        - assert: В Forward не отображается маркер “администратор”.

    Маркер не отображается в Reply[manual]:
        - automation:
        - description: |
              Необходимо иметь два аккаунта - пользователь А (проверяемый) авторизован в одном браузере, пользователь Б (вспомогательный) в том же либо в другом браузере.
              У пользователей А и Б есть групповой чат, где есть сообщение, отправленное администратором.
              Изначально авторизованы пользователем А.
        - do: Тапнуть/Кликнуть ПКМ по сообщению из description.
        - assert: Появляется контекстное меню.
        - do: Выбрать “Ответить”.
        - assert: Над полем ввода показывается reply на сообщение.
        - do: Проверить отображение маркера "администратор" в плашке.
        - assert: В плашке Reply не отображается маркер “администратор”.
        - do: В поле ввода ввести несколько символов и нажать кнопку "Отправить" на панели ввода сообщения.
        - assert: Reply отправляется и отображается в окне чата.
        - do: Проверить отображение маркера “администратор” в Reply.
        - assert: В Reply не отображается маркер “администратор”.
        - do: Под пользователем Б открыть чат из description.
        - assert: Открывается чат из description.
        - do: Проверить отображение маркера “администратор” в Reply.
        - assert: В Reply не отображается маркер “администратор”.

    Маркер не отображается в технических сообщениях[manual]:
        - automation:
        - description: |
              Необходимо иметь два аккаунта - пользователь А (проверяемый) авторизован в одном браузере, пользователь Б (вспомогательный) - администратор - в том же или в другом браузере.
              У пользователей А и Б есть групповой чат, в котором есть как минимум одно сообщение.
        - do: Пользователем Б закрепить сообщение, которое есть в истории чата
        - assert: Отображается техническое сообщение
        - do: Пользователем А открыть групповой чат, который описан в description.
        - assert: Чат открыт.
        - do: Проверить отображение маркера “администратор” в техническом сообщении.
        - assert: В техническом сообщении не отображается маркер “администратор”.

    Маркер отображается при переходе по инвайт-ссылке[manual]:
        - automation:
        - description: |
              Необходимо иметь два аккаунта - пользователь А авторизован в одном браузере, пользователь Б - в другом браузере.
              Есть групповой чат в истории которого есть сообщения от пользователя Б, в котором пользователь Б - администратор, пользователь А в чате не состоит.
              В настройках чата включен «Доступ по ссылке».
              Между пользователями А и Б есть приватный чат.
        - do: Пользователем Б открыть администрирование группового чата из description тапом/кликом ПКМ по иконке с тремя точками в шапке чата и выбрав пункт "Информация о чате".
        - assert: |
              Администрирование чата открыто.
              Переключатель "Публичная ссылка" включен.
              Есть кнопка "Скопировать ссылку".
        - do: Тапнуть/Кликнуть ЛКМ по кнопке "Скопировать ссылку".
        - assert: Появилось сообщение "Ссылка скопирована".
        - do: Открыть приватный чат с пользователем А.
        - assert: Чат открыт.
        - do: Вставить в поле ввода скопированную ссылку.
        - assert: В поле ввода отображается инвайт ссылка.
        - do: Нажать по кнопке “Отправить” справа от поля ввода.
        - assert: Сообщение отправилось и отображается в окне чата.
        - do: Пользователем А зайти в чат с инвайт ссылкой от пользователя Б.
        - assert: Открылось окно чата, в нем отображается сообщение с инвайт ссылкой от пользователя Б.
        - do: Нажать по инвайт ссылке в сообщении.
        - assert: |
              Произошел переход в групповой чат, созданный пользователем Б.
              Доступна кнопка “Присоединиться”.
        - do: Проверить отображение маркера "администратор" рядом с именем администратора.
        - assert: Отображается маркер "администратор".
        - do: Тапнуть по кнопке "Присоединиться".
        - assert: Появилась панель ввода, доступна отправка сообщений.
        - do: Проверить отображение маркера "администратор" рядом с именем администратора.
        - assert: Отображается маркер "администратор".

    Маркер не отображается у участника группы, который не является администратором:
        - description: |
              Для прохождения кейса необходимо 2 аккаунта, 2-ым вспомогательным аккаунтом можно авторизовываться в этом же браузере.
              Между пользователями Б (не администратор) и А есть общий групповой чат.
              Изначально авторизованы пользователем Б.
        - do: Отправить любое сообщение в чат из description.
        - assert: Сообщение отправляется и отображается в окне чата.
        - do: Пользователем А проверить отображение маркера "администратор" у пользователя Б.
        - assert: Маркер "администратор" не отображается у участника группы.

    Маркер отображается у администратора в поиске по чату[manual]:
        - automation:
        - description: У пользователя есть групповой чат, где есть сообщение, отправленное администратором.
        - do: Тапнуть/Кликнуть ЛКМ по значку поиска по чату в чате из description.
        - assert: Отображается поле поиска вверху окна чата.
        - do: Ввести в поле поиска текст сообщения из description.
        - assert: |
              Введенное слово отображено в поле поиска.
              Под шапкой чата отображена панель с количеством совпадений.
              Чат проскроллил к самому свежему результату поиска (если результат поиска находится в пределах просматриваемого экрана - то подскролл не происходит).
              Отображенный результат поиска временно выделен.
        - do: Проверить отображение маркера "администратор" рядом с именем администратора.
        - assert: Отображается маркер "администратор".

    Маркер корректно отображается, если имя администратора не помещается на экране[manual]:
        - automation:
        - description: |
              У пользователя есть групповой чат, где есть сообщение, отправленное администратором с длинным именем.
              Имя администратора не помещается на экране.
        - do: Проверить отображение маркера "администратор" рядом с именем администратора.
        - assert: |
              Имя администратора обрезается многоточием.
              Маркер "администратор" не накладывается на имя администратора.

    Маркер не отображается в нотификациях[manual]:
        - automation:
        - description: |
              Для прохождения кейса необходимо 2 аккаунта, вторым вспомогательным аккаунтом можно авторизоваться в веб/в ферме/на втором девайсе.
              Пользователь А (проверяемый) - участник группового чата - авторизован в первом браузере, пользователь Б (вспомогательный) - администратор - в другом браузере/на девайсе.
              Между пользователями есть групповой чат, в котором включены уведомления.
              Изначально авторизованы пользователем А.
        - do: В другом браузере/девайсе пользователем Б в групповом чате отправить сообщение.
        - assert:  |
              Сообщение отправляется.
              Пользователь А получает уведомление вверху экрана.
        - do: Проверить отображение маркера "администратор" рядом с именем администратора.
        - assert: В нотификации не отображается маркер "администратор".

files:
    - tests/hermione/suites/messenger/chat-window/admin-token-display.common.hermione.ts

v-team: Chat

tlds: ru

tags:
    - yamb
    - y-team
