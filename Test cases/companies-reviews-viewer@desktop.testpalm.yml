feature: Отзывы на Серпе
type: Просмотрщик отзывов организации

specs-integration:
  Наличие отзывов:
    - do: получить выдачу поиска по запросу 'кафе пушкин'
    - assert: в правой колонке есть карточка одной организации
    - assert: в карточке одной организации есть врезка отзывов
    - do: кликнуть на таб отзывов
    - assert: открылся попап с отзывами

specs:
  Внешний вид:
    - do: получить выдачу по запросу "кафе пушкин"
    - assert: |
        на странице присутствует колдунщик организации в правой колонке
        загрузились отзывы организации
    - do: нажать на таб "Отзывы"
    - assert: открылся попап просмотрщика отзывов
    - assert: в попапе загрузились отзывы
    - screenshot: внешний вид [plain]
  Точки входа:
    beforeEach:
      - do: получить выдачу по запросу "кафе пушкин"
      - assert: |
          на странице присутствует колдунщик организации в правой колонке
          загрузились отзывы организации
    Таб "Отзывы":
      - do: нажать на таб "Отзывы"
      - assert: открылся попап просмотрщика отзывов
    Заголовок "Отзывы ∙ {N}":
      - do: нажать на заголовок блока отзывов
      - assert: открылся попап просмотрщика отзывов
    Текст отзыва:
      - do: нажать на текст первого отзыва
      - assert: открылся попап просмотрщика отзывов
    Ссылка "Читать все отзывы":
      - do: нажать на элемент ссылку "Читать все отзывы"
      - assert: открылся попап просмотрщика отзывов
    Аспект отзывов:
      - do: нажать на любой признак доверия
      - assert: открылся попап просмотрщика отзывов
  Проверка счётчиков:
    beforeEach:
      - do: получить выдачу по запросу "кафе пушкин"
      - assert: |
          на странице присутствует колдунщик организации в правой колонке
          загрузились отзывы организации
      - do: кликнуть в таб "отзывы"
      - assert: открылся попап с отзывами
    afterEach:
      - assertMetrics: 
        - web.part_all_click_without_baobab
    RUM счетчики:
      - tags:
          - no_assessors
      - tech: |
          проверить наличие счётчика '/tech/perf/delta'
          с counterId='companies_reviews_react_load_view_default'
    Клик в "Ещё" и выбор первого пункта:
      - do: кликнуть в таб "Ещё"
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/tabs-menu/more'
      - do: кликнуть в первый элемент выпадающего меню
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/tabs-menu'
    Просмотр фото аспекта:
      - do: кликнуть в таб "Еда"
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/tabs-menu'
      - do: кликнуть в фото
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/scroller/photo'
      - do: нажать на крестик закрытия просмотрщика фото
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/viewer/close'
      - do: проскроллить список фото
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/scroller'
    Сортировка отзывов:
      - do: кликнуть в селектор "по умолчанию"
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/reviewsSelect/select/button'
      - do: кликнуть во второй элемент выпадающего меню
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/reviewsSelect/select/menu-item'
    Читать целиком/скрыть отзыв:
      - do: кликнуть в "Читать целиком" у отзыва
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/review-item/cut/more'
      - do: кликнуть в "Скрыть" у расзвёрнутого отзыва
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/review-item/cut/hide'
    Ссылка на автора отзыва:
      - do: кликнуть в имя автора отзыва
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/review-item/review-author/author'
    Кнопка написания отзыва:
      - do: кликнуть в кнопку "написать отзыв"
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/login-button'
    Закрытие попапа:
      - do: кликнуть в крестик закрфтия попапа
      - tech: сработал счётчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/close'
    Лайки в отзывах:
      - do: кликнуть на лайк в первом отзыве
      - assert: лайк выставился
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/review-item/reactions/like'
      - do: кликнуть на дизлайк в первом отзыве
      - assert: выставился дизлайк
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/review-item/reactions/dislike'
    Фото в отзывах:
      - do: кликнуть на фото в первом отзыве
      - assert: открылся просмотрщик фото
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/review-item/scroller/photo-viewer'
      - do: кликнуть на кнопку закрыть в просмотрщике фото
      - assert: просмотрщик фото закрылся
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/reviews-viewer/tabs-panes-modal/reviews-page/review-item/viewer/close'
  Дозагрузка отзывов:
    - do: получить выдачу по запросу "кафе пушкин"
    - assert: |
        на странице присутствует колдунщик организации в правой колонке
        загрузились отзывы организации
    - do: кликнуть в таб "отзывы"
    - assert: открылся попап с отзывами
    - do: проскроллить попап с отзывами до конца
    - assert: загрузились новые отзывы
  Нет отзывов:
    - do: получить выдачу по запросу "гастроном андреевский шейнкмана 55 екатеринбург"
    - assert: на странице присутствует колдунщик организации в правой колонке
    - do: кликнуть в таб "отзывы"
    - assert: открылся попап с отзывами
    - screenshot: пример внешнего вида [plain]
  Доступность отзывов:
    - tags:
      - no_assessors
    - do: получить выдачу по запросу "кафе пушкин"
    - assert: |
        на странице присутствует колдунщик организации в правой колонке
        загрузились отзывы организации
    - do: кликнуть в таб "отзывы"
    - assert: открылся попап с отзывами
    - tech: у оценки отзыва должен быть атрибут aria-label
    - tech: у реакций отзыва должен быть атрибут aria-label, role=radio и aria-checked
    - assert: |
        каждый отзыв выделен рамкой при фокусе
        имя автора, уровень, оценка и дата отзыва корректно зачитаны
        отзыв пользователя зачитывается до кнопки 'Ещё'
        отзыв может быть кликнут по клавише Enter
    - do: с помощью клавиши tab перейти к кнопкам в карточке отзывов
    - assert: |
        зачитано название блока: 'Реакция пользователей'
        кнопки лайков/дизлайков выделены рамкой при фокусе
        наименование элемента кнопка лайков/дизлайков корректно зачитано со статусом Нажата/НЕ нажата
        кол-во лайков/дизлайков корректно зачитано
        кнопка комментатора выделена рамкой при фокусе
        наименование элемента кнопка корректно зачитано
        кол-во комментариев корректно зачитано

files:
  - src/features/ReviewsViewer/ReviewsViewer.test/companies/companies-reviews-viewer@desktop.hermione.js
  - src/features/ReviewsViewer/ReviewsViewer.test/companies/companies-reviews-viewer@desktop.hermione.e2e.js

v-team: VanillaGeo

tags:
  - A11y_serp
  - react

tlds: all
