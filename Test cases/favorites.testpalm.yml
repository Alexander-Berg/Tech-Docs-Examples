feature: Объектный ответ
type: Кнопка избранного
counter: /$page/$parallel/$result[@wizard_name="entity_search"]/favorite
params:
  yandex_login: 'stas.mihailov666'

specs:
  Карточка фильма:
    - params:
        foreverdata: '647705043'
    - do: авторизоваться
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        в правой колонке появилась карточка объекта,
        в карточке есть кнопка 'В избранное'
    - screenshot: внешний вид кнопки 'В избранное' в карточке объекта [plain]
    - do: навести курсор на кнопку и подождать примерно 2-3 секунды
    - assert: появился браузерный тултип с надписью 'В избранное'
    - do: кликнуть по кнопке 'В избранное'
    - assert: открылся попап с предложением добавить фильм в избранное
    - screenshot: внешний вид попапа [modal]
    - tech: сработал счетчик клика по кнопке /$page/$parallel/$result[@wizard_name="entity_search"]/favorite
    - do: добавить фильм в коллекцию 'Мои фильмы'
    - assert: |
        попап закрылся,
        кнопка сменилась на 'В избранном',
        появился тултип (небольшой попап с хвостиком) рядом с кнопкой
    - screenshot: внешний вид кнопки 'В избранном' и тултипа рядом [saved]
    - do: навести курсор на кнопку и подождать примерно 2-3 секунды
    - assert: появился браузерный тултип с надписью 'Удалить из коллекции'
    - do: кликнуть по кнопке 'В избранном' (удаляем из коллекции)
    - assert: |
        кнопка сменилась на 'В избранное',
        тултип закрылся
    - do: кликнуть по кнопке 'В избранное'
    - assert: появился тултип рядом с кнопкой с процессом добавления
    - screenshot: внешний вид кнопки 'В избранное' и тултипа рядом [saving]
    - do: подождать пока процесс добавления не закончится
    - assert: |
        кнопка сменилась на 'В избранном',
        содержимое тултипа сменилось в состояние успешного добавления
    - screenshot: внешний вид кнопки 'В избранном' и тултипа рядом [saved-again]
    - assertMetrics: '*'
  Фильм изначально добавлен в коллекцию:
    - params:
        foreverdata: '2603911986'
    - do: авторизоваться
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        в правой колонке появилась карточка объекта,
        в карточке есть кнопка 'В избранном'
    - screenshot: внешний вид кнопки 'В избранном' в карточке объекта [plain]
    - do: кликнуть по кнопке 'В избранном' (удаляем из коллекции)
    - assert: кнопка сменилась на 'В избранное'
    - tech: сработал счетчик клика по кнопке /parallel/result/snippet/entity_search/object-badge/buttons/unfavorite
    - do: кликнуть по кнопке 'В избранное' (добавляем в коллекцию)
    - assert: открылся попап с предложением добавить фильм в коллекцию
    - do: добавить фильм в коллекцию 'Мои фильмы'
    - assert: |
        попап закрылся,
        кнопка сменилась на 'В избранном',
        появился тултип (небольшой попап с хвостиком) рядом с кнопкой
    - screenshot: внешний вид кнопки тултипа [tooltip]
    - do: ресайзим экран, проверяем открытие тултипа вверх
    - screenshot: внешний вид кнопки тултипа [tooltip-top]
    - assertMetrics: '*'
  Кнопка с текстом:
    - do: авторизоваться и получить выдачу по запросу 'эйфелева башня'
    - assert: |
        в правой колонке появилась карточка объекта,
        в карточке есть кнопка с текстом 'В избранное'
    - screenshot: внешний вид [button-text]
    - assertMetrics: '*'
  Сквозные проверки:
    Фильм добавлен [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          в правой колонке появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' для фильма ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: открылась страница с коллекциями пользователя
      - assert: |
          в коллекции 'Мои фильмы' есть добавленный фильм (для сериала в 'Мои сериалы')
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - assertMetrics: '*'
    Фильм удален [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          в правой колонке появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы'
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекциями пользователя
          в коллекции 'Мои фильмы' есть добавленный фильм (для сериала в 'Мои сериалы')
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - do: вернуться на выдачу поиска
      - assert: тултип пропал
      - do: кликнуть по кнопке 'В избранном' (удаляем из коллекции)
      - assert: кнопка сменилась на 'В избранное'
      - do: перейти на сервис коллекции (на ранее открытую страницу) и обновить страницу
      - assert: в коллекции нет данного фильма/сериала
      - assertMetrics: '*'
    Фильм повторно добавлен [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          в правой колонке появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекциями пользователя
          в коллекции 'Мои фильмы' есть добавленный фильм (для сериала в 'Мои сериалы')
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - do: вернуться на выдачу поиска
      - assert: тултип пропал
      - do: кликнуть по кнопке 'В избранном' (удаляем из коллекции)
      - assert: кнопка сменилась на 'В избранное'
      - do: перейти на сервис коллекции (на ранее открытую страницу) и обновить страницу
      - assert: в коллекции нет данного фильма/сериала
      - do: вернуться на выдачу поиска и кликнуть по кнопке 'В избранное'
      - assert: |
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекциями пользователя
          в коллекции есть добавленный фильм/сериал (и он отображается один раз)
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - assertMetrics: '*'
    Изменение коллекции у фильма [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          в правой колонке появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: перейти на сервис коллекции (https://yandex.ru/collections/) и открыть страницу 'Мои коллекции'
      - assert: в коллекции 'Мои фильмы'/'Мои сериалы' есть добавленный фильм/сериал
      - do: вернуться на выдачу поиска
      - do: в тултипе нажать на кнопку 'Изменить'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: в попапе нажать на пункт 'Добавить новую коллекцию'
      - assert: в попапе отображаются поля для ввода названия и информации о коллекции
      - do: заполнить поля и нажать на кнопку 'Добавить новую коллекцию'
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
          в тултипе указано название новой коллекции
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекциями пользователя
          на странице отображается новая коллекция и в ней есть добавленный фильм/сериал
      - assertMetrics: '*'
    Кнопка после обновления страницы [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          в правой колонке появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: кликнуть по пустому месту на странице
      - assert: тултип закрылся
      - do: обновить страницу
      - assert: в карточке объекта отображается кнопка 'В избранном'
      - assertMetrics: '*'
    Кнопка после аякс-перезапроса [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: авторизоваться
      - do: получить выдачу по запросу 'фильмы 2017'
      - assert: появилась темная карусель с фильмами
      - do: нажать на плитку в карусели
      - assert: |
          произошел аякс-перезапрос
          под каруселью отображается карточка фильма
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы'
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на плитку c другим фильмом в карусели
      - assert: |
          произошел аякс-перезапрос
          под каруселью отображается карточка другого фильма
          в карточке есть кнопка 'В избранное'
      - do: нажать на плитку с предыдущим фильмом
      - assert: |
          произошел аякс-перезапрос
          под каруселью отображается карточка фильма
          в карточке есть кнопка 'В избранном'
      - assertMetrics: '*'
    Добавление на www.yandex.ru [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: перейти по ссылке 'https://www.yandex.ru/search/'
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          в правой колонке появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои фильмы' для фильма ('Мои сериалы' для сериала)
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекциями пользователя
          в коллекции есть добавленный фильм/сериал (и он отображается один раз)
          если в коллекции фильма/сериала нет - пообновляйте страницу, должен появиться
      - assertMetrics: '*'
    Кнопка после удаления коллекции [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: авторизоваться
      - do: получить выдачу по запросу фильма/сериала
      - assert: |
          в правой колонке появилась карточка объекта (если не появилась попробуйте найти другой фильм/сериал)
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: в попапе нажать на пункт 'Добавить новую коллекцию'
      - assert: в попапе отображаются поля для ввода названия и информации о коллекции
      - do: заполнить поля и нажать на кнопку 'Добавить новую коллекцию'
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
          в тултипе указано название новой коллекции
      - do: нажать на кнопку 'Перейти' в тултипе
      - assert: |
          открылась страница с коллекциями пользователя
          на странице отображается новая коллекция и в ней есть добавленный фильм/сериал
      - do: нажать на иконку 'карандаш' для редактирования коллекции
      - assert: появился попап для редактирования коллекции
      - do: нажать на кнопку 'Удалить коллекцию' в попапе и подтвердить удаление
      - assert: коллекция удалилась
      - do: вернуться на выдачу поиска и обновить страницу
      - assert: в карточке объекта отображается кнопка 'В избранное'
      - assertMetrics: '*'
    Кнопка у книги после аякс-перезапроса [manual]:
      - automation: SERPTEST-549
      - tags: [for_assessors, skip_manual_check]
      - do: авторизоваться
      - do: получить выдачу по запросу 'гарри поттер книга'
      - assert: появилась карточка книги в правой колонке
      - do: кликнуть по кнопке 'В избранное'
      - assert: открылся попап с предложением добавить фильм/сериал в коллекцию
      - do: выбрать коллекцию 'Мои книги' (если такой нет, то выбрать любую другую или создать новую)
      - assert: |
          попап закрылся,
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на плитку (одну из книг) в списке 'Смотрите также' в карточке
      - assert: |
          произошел аякс-перезапрос
          появилась карусель
          под каруселью отображается карточка книги
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: |
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на плитку c другой книгой в карусели
      - assert: |
          произошел аякс-перезапрос
          под каруселью отображается карточка другой книги
          в карточке есть кнопка 'В избранное'
      - do: кликнуть по кнопке 'В избранное'
      - assert: |
          кнопка сменилась на 'В избранном',
          появился тултип (небольшой попап с хвостиком) рядом с кнопкой
      - do: нажать на плитку с предыдущей книгой
      - assert: |
          произошел аякс-перезапрос
          под каруселью отображается карточка фильма
          в карточке есть кнопка 'В избранном'

files:
  - features/desktop/z-entity-search/favorites/favorites.hermione.js

v-team: OO

tags: [oo_favorites, no_assessors]
#выключаем избранное на стороне данных, на всякий случай тесты пока что не удаляем

tlds: [ru, by, kz, ua]
