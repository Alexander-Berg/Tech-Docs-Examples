feature: Объектный ответ
type: Карта
description: тест необходимо проходить НЕ в режиме инкогнито.
counter: /$page/$main/$result[@wizard_name="entity_search"]/gallery/scroller/row/map/thumb

specs-integration:
  beforeEach:
    - do: получить выдачу по запросу 'эйфелева башня' (альтернативные запросы 'биг бен', 'барселона')
    - assert: появился Объектный ответ
  На странице:
    - tags: ['smoke', 'pp_new_core']
    - assert: в ОО есть карта
    - do: кликнуть на карту
    - assert: открылся оверлей с картой

specs:
  beforeEach:
    - do: получить выдачу по запросу 'московский кремль'
    - screenshot: появилась карточка объектного ответа (количество и названия табов могут отличаться) [z-entity-search/map-{{PLATFORM}}-{{BROWSER_TYPE}} >> map]
  Карта на выдаче:
    - assert: в карточке объекта есть карта
    - tech: href содержит 'https://maps.yandex.ru//', в ссылке карты есть параметры &source=entity_search, &text=, &ll=, &z=
    - do: тапнуть по карте в карточке объекта
    - screenshot: открылся оверлей с картой [overlay-map]
    - tech: проверить, сработал ли счётчик по клику на карту /$page/$main/$result/gallery/scroller/row/map/thumb[@behaviour@type="dynamic"]
    - assert: |
        на карте в оверлее стоит пин, отмечающий местонахождение объекта,
        на карте в оверлее есть кнопки изменения зума ('+' и '-'),
        на карте в оверлее есть кнопка для определения местоположения
    - do: кликнуть по кнопке уменьшения зума ('-')
    - tech: проверить, сработал ли счётчик /$subresult/overlay-wrapper/content/side-block-single-point-map/map/round-button[@type="zoomout" and @behaviour@type="dynamic"]
    - assert: масштаб карты уменьшился
    - do: кликнуть по кнопке увеличения зума ('+')
    - tech: проверить, сработал ли счётчик /$subresult/overlay-wrapper/content/side-block-single-point-map/map/round-button[@type="zoomin" and @behaviour@type="dynamic"]
    - assert: масштаб карты увеличился
    - do: кликнуть по кнопке определения местоположения
    - tech: проверить, сработал ли счётчик /$subresult/overlay-wrapper/content/side-block-single-point-map/map/round-button[@type="userlocation" and @behaviour@type="dynamic"]
    - assert: карта обновилась, на ней отображается точка местоположения пользователя
    - assertMetrics:
      - daily.total_session_count
      - web.total_request_count
      - web.total_click_count
      - web.total_all_click
      - web.abandonment
      - web.tech_part_misc_click
      - all.total_dynamic_click_count
      - feature.web.wizards_common.entity_search_wizard_main.total.clicks
  Карта в альбомной ориентации:
    - label: z-entity-search/map-{{PLATFORM}}-{{BROWSER_TYPE}}
    - screenshot: внешний вид [map]
    - do: повернуть устройство в альбомную ориентацию
    - assert: внешний вид [plain]
    - assertMetrics:
      - daily.total_session_count
      - web.total_request_count
      - web.total_click_count
      - web.total_all_click
      - web.abandonment
      - web.tech_part_misc_click
      - all.total_dynamic_click_count
      - feature.web.wizards_common.entity_search_wizard_main.total.clicks

files:
  - features/touch-phone/z-entity-search/map/map.hermione.js
  - features/touch-phone/z-entity-search/map/map.hermione.e2e.js

v-team: OO

tags:
  - smoke_extended
  - reviewed
  - hasE2E
  - oo_map

tlds: ['ru', 'ua', 'by', 'kz', 'fr', 'com.tr', 'com']

