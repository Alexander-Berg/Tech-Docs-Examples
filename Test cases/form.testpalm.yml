feature: Форма

params:
  exp_flags:
    - turboforms_endpoint=https://test-turbo-forms.common.yandex.ru/
    - analytics-disabled=1

browsers:
  - ios-safari-12-touch
  - ios-safari-11-touch
  - ios-safari-10-touch
  - ios-safari-9-touch

specs:
  aliases:
    - &StartTestForm
      - do: перейти по ссылке https://yandex.ru/turbo?stub=form/default-3.json
      - assert: на странице есть форма 
    - &StartForm
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая cтраница для Формы — турбо)
      - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
    - &StartFromValidation
      - do: перейти по ссылке https://yandex.ru/turbo?stub=form/validation.json
      - assert: на странице есть форма 

  beforeEach:
    - do: при дальнейшей проверке указанных ожидаемых результатов обращайте внимание на любые некорректные на ваш взгляд поведения, основываясь на свой опыт использования web-приложений (например, сохранение позиции при переходах туда-обратно кнопками на устройстве, пустые экраны при переходах, кривая верстка, скачкИ элементов, плавность скролла, неработающая функциональность и т.п.)

  Основные проверки:
    - *StartTestForm
    - tech: не должно быть клиентских ошибок

  Очистка инпута:
    - *StartTestForm
    - do: в первое поле ввода с заголовком "Инлайновая форма" ввести любое значение
    - assert: появился крестик внутри поля
    - do: нажать на крестик внутри поля ввода
    - assert: поле ввода очистилось

  Ошибка при отправке:
    - automation: TURBO-689
    - params:
        foreverdata: '3038786675'
    - *StartForm
    - do: Заполнить все поля формы и нажать на кнопку
    - assert: Появилось сообщение об ошибке

  Валидация формы:
    - *StartFromValidation
    - do: нажать на кнопку "Отправить"
    - assert: поля выделились красным цветом и появилась надпись "обязательное поле" как на примере [form/validation-41-{{PLATFORM}} >> plain]
    - do: ввести "*123" в поле "Телефон" (!обязательно ввести знак звездочки перед 123)
    - assert: выделение поля красным цветом осталось и появилась надпись "Номер телефона указан неверно"
    - do: ввести "ИванИван" в поле "Имя"
    - assert: |
        выделение поля красным цветом осталось и появилась надпись "Максимальное количество символов в тексте 6"
        внешний вид аналогичен примеру [form/validation/messages-42-{{PLATFORM}} >> plain]
    - do: ввести "7987654321" в поле "Телефон"
    - assert: надпись и выделение поля "Телефон" исчезли
    - do: ввести "Иван" в поле "Имя"
    - asssert: выделение и надпись поля "Имя" исчезли
    - do: нажать на кнопку "Отправить"
    - assert: открылась новая вкладка по адресу "https://ya.ru/?phone=7987654321&name=Иван" (в яндекс браузере значение "Иван" может быть представлено в виде символов - это ок)

  Отправка postMessage при валидации форм:
    - *StartFromValidation
    - do: нажать на кнопку "Отправить"
    - assert: поля выделились красным цветом, перехода на другую страницу не было
    - do: ввести "7987654321" в поле "Телефон"
    - do: ввести "Ivan" в поле "Имя"
    - do: нажать на кнопку "Отправить"
    - assert: открылась новая вкладка по адресу "https://ya.ru?phone=7987654321&name=Ivan"

  Форма ajax на странице:
    beforeEach:
      - do: получить выдачу по запросу ‘тест’ и кликнуть в заголовок первого сниппета (название заголовка Тестовая cтраница для Test_form-ajax_manual — турбо)
      - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
      - do: ввести "+79780000000" в поле "Телефон"
      - do: ввести "Ivan" в поле "Имя"

    Отправка:
      - params:
          foreverdata: '2912176211'
      - tags: no_assessors
      - do: нажать на кнопку "Отправить"
      - assert: вместо формы заявки появляется сообщение об успешной отправки формы
      - screenshot: внешний вид аналогичен примеру [plain]

    Отправка в горизонтальной ориентации:
      - params:
          foreverdata: '2912176211'
      - tags: no_assessors
      - do: сменить ориентацию на альбомную
      - do: нажать на кнопку "Отправить"
      - assert: вместо формы заявки появляется сообщение об успешной отправки формы
      - screenshot: внешний вид аналогичен примеру [plain]

  Форма ajax в модальном окне:
    beforeEach:
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая cтраница для Test_form-ajax_modal_manual — турбо)
      - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
      - do: нажать на кнопку "Открой модальное окно"

    Отправка:
      - params:
          foreverdata: '679364369'
      - tags: no_assessors
      - do: ввести "+79780000000" в поле "Телефон"
      - do: ввести "Ivan" в поле "Имя"
      - do: нажать на кнопку "Отправить"
      - assert: вместо формы заявки появляется сообщение об успешной отправки формы
      - assert: в модальном окне присутствует кнопка "Закрыть"
      - screenshot: внешний вид аналогичен примеру [plain]

    Проверка кнопки Закрыть:
      - params:
          foreverdata: '679364369'
      - do: нажать на кнопку "Закрыть"
      - assert: модальное окно закрылось

    Проверка кнопки Закрыть на экране "Заявка отправлена":
      - params:
          foreverdata: '679364369'
      - tags: no_assessors
      - do: ввести "+79780000000" в поле "Телефон"
      - do: ввести "Ivan" в поле "Имя"
      - do: нажать на кнопку "Отправить"
      - assert: вместо формы заявки появляется сообщение об успешной отправки формы
      - assert: в модальном окне присутствует кнопка "Закрыть"
      - do: нажать на кнопку "Закрыть"
      - assert: модальное окно закрылось

    Проверка закрытия по таймеру:
      - params:
          foreverdata: '679364369'
      - tags: no_assessors
      - do: ввести "+79780000000" в поле "Телефон"
      - do: ввести "Ivan" в поле "Имя"
      - do: нажать на кнопку "Отправить"
      - assert: вместо формы заявки появляется сообщение об успешной отправки формы
      - assert: модальное окно закрылось через несколько секунд

    Отправка в горизонтальной ориентации:
      - params:
          foreverdata: '679364369'
      - tags: no_assessors
      - do: сменить ориентацию на альбомную
      - do: ввести "+79780000000" в поле "Телефон"
      - do: ввести "Ivan" в поле "Имя"
      - do: нажать на кнопку "Отправить"
      - assert: вместо формы заявки появляется сообщение об успешной отправки формы
      - assert: в модальном окне присутствует кнопка "Закрыть"
      - screenshot: внешний вид аналогичен примеру [plain]

  Дефолтная форма с параметром target_in_separate_tab:
    Сабмитится в той же вкладке:
      - do: открыть страницу https://yandex.ru/turbo?stub=form/same-tab.json
      - assert: на странице есть форма
      - do: нажать "Отправить"
      - assert: в той же вкладке открылась страница https://yandex.ru/turbo?text=test_news
    В iframe открывается в новой вкладке:
      - browsers:
          notFor:
            - searchapp
      - params:
          foreverdata: '86974714'
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая cтраница для Form с target для отдельной вкладки — турбо)
      - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
      - assert: на странице есть форма
      - do: нажать "Отправить"
      - assert: в новой вкладке открылась страница https://yandex.ru/turbo?text=test_news

tags:
  - e-commerce

files:
# - features/blocks/form/form.ex-gemini.hermione.js
  - features/blocks/form/form.hermione.js

v-team: Turbo

manager: tanzwuta

qa-engineer: spv

tlds: none
