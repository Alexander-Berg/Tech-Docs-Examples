feature: Hotels / Колдунщик одной организации
type: Маршрутный попап

specs:
  aliases:
    - &OpenModal
      - do: кликнуть в кнопку 'Маршрут'
      - assert: открылось модальное окно с вариантами построения маршрута (маршрутный попап)
      - screenshot: внешний вид [route-popup-{{SET_NAME}} >> plain]
  beforeEach:
    - do: получить выдачу по запросу 'Мета Москва'
    - assert: должен появиться колдунщик 1орг
  Внешний вид:
    - label: route-popup-{{SET_NAME}}
    - *OpenModal
    - screenshot: внешний вид [plain]
    - tech: сработал динамический счетчик /$page/$main/$result/composite/actions/route-button[@action = "route" and @behaviour@type = "dynamic"]
  Проверка закрытия и повторного открытия:
    - *OpenModal
    - do: кликнуть в паранджу (вне содержимого модального окна)
    - assert: маршрутный попап закрылся
    - do: кликнуть по кнопке 'Маршрут'
    - assert: открылся маршрутный попап
    - do: кликнуть по крестику закрытия модального окна в верхнем правом углу
    - assert: маршрутный попап закрылся
    - do: кликнуть в таб 'Про отель'
    - assert: открылся оверлей с карточкой отеля
    - do: кликнуть по кнопке 'Маршрут' в оверлее
    - assert: открылся маршрутный попап
    - do: кликнуть 'Назад' на устройстве
    - assert: маршрутный попап закрылся
    - do: кликнуть 'Назад' на устройстве
    - assert: оверлей с карточкой отеля закрылся
    - do: кликнуть по кнопке 'Маршрут'
    - assert: открылся маршрутный попап
  Нажатие на кнопку для построения маршрута для пешехода:
    - *OpenModal
    - do: кликнуть в кнопку 'Пешком'
    - assert: должен открыться оверлей с построенным маршрутом
    - tech: должен сработать динамический счетчик
    - assertMetrics: '*'
  Нажатие на кнопку для построения маршрута для автомобиля:
    - *OpenModal
    - do: кликнуть в кнопку 'На машине'
    - assert: должен открыться оверлей с построенным маршрутом
    - tech: должен сработать динамический счетчик
    - assertMetrics: '*'
  Нажатие на кнопку для построения маршрута общественным транспортом:
    - *OpenModal
    - do: кликнуть в кнопку 'Общественным транспортом'
    - assert: должен открыться оверлей с построенным маршрутом
    - tech: должен сработать динамический счетчик
    - assertMetrics: '*'
  Нажатие на кнопку для приложения Навигатор:
    - tags:
        - appmetrica
    - *OpenModal
    - do: кликнуть в кнопку 'Навигатор'
    - assert: проверям ссылку на аппметрику
    - tech: должен сработать статичный счетчик
    - assertMetrics: '*'
  Нажатие на кнопку для приложения Карты (ios, android):
    - tags:
        - appmetrica
    - browsers:
        - iphone
        - chrome-phone
    - *OpenModal
    - do: кликнуть в кнопку 'Карты'
    - assert: проверям ссылку на аппметрику
    - tech: должен сработать статичный счетчик
    - assertMetrics: '*'
  Нажатие на кнопку для приложения Такси (ios):
    - tags:
        - appmetrica
    - browsers: iphone
    - *OpenModal
    - do: кликнуть в кнопку 'Такси'
    - assert: проверям ссылку на аппметрику
    - tech: должен сработать статичный счетчик
    - assertMetrics: '*'
  Нажатие на кнопку для приложения Такси (chrome-phone):
    - tags:
        - appmetrica
    - browsers: chrome-phone
    - do: кликнуть в кнопку 'Такси'
    - assert: проверям ссылку на аппметрику
    - tech: должен сработать статичный счетчик
    - assertMetrics: '*'
  Проверка открытия маршрутного попапа после клика "Назад" на устройстве:
    - *OpenModal
    - do: кликнуть по крестику в правом верхнем углу модального окна
    - assert: модальное окно закрылось
    - do: кликнуть в таб 'Про отель'
    - assert: открылся сайдблок с расширенной информацией по организации
    - do: тапнуть по кнопке 'Маршрут'
    - assert: появилось модальное окно с выбором типа транспорта
    - do: кликнуть 'Назад' на устройстве
    - assert: модальное окно закрылось
    - do: кликнуть 'Назад' на устройстве
    - assert: сайдблок с расширенной информацией закрылся
    - do: тапнуть по кнопке 'Маршрут'
    - assert: появилось модальное окно с выбором типа транспорта
    - assertMetrics: '*'
  Сообщение об ошибке при отключенном интернете:
    - do: отключить соединение с интернетом (перевести телефон в Авиарежим)
    - do: кликнуть в кнопку 'Маршрут'
    - assert: появляется сообщение с ошибкой 'Извините, произошла ошибка, попробуйте ещё раз'
    - do: установить соединение с интернетом
    - *OpenModal

files:
  - features/companies/hotels/route-popup/route-popup@touch-phone.hermione.js

v-team: KotTeam

counter: /$page/$main/$result[@wizard_name="companies" and @subtype="travel_company"]/composite/actions/route-button

# features/touch-phone/companies/companies-one.hermione.e2e.js
tags:
  - button
  - popup
  - overlay
  - route
  - skip_e2e_check

tlds: all

priority: high
