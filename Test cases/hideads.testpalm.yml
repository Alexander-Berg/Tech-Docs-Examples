feature: Борьба с блокировщиками

params:
  exp_flags: hideads=1
  foreverdata: '4202406061'

specs:
  Маскировка рекламы:
    beforeEach:
      - do: включить adguard
      - do: получить выдачу по запросу 'foreverdata'
      - assert: рекламный сниппет должен быть вырезан блокировщиком
    Cсылки должны измениться c yabs на jsredir:
      - do: обновить страницу
      - tech: все ссылки объявлений именились c yabs на jsredir
    Установилась кука yp со значением los.1:
      - do: обновить страницу
      - tech: у рекламного сниппета должен отсутствовать селектор serp-adv-item
      - assert: рекламный сниппет должен присутствовать и выгдядеть как органика
      - tech: установилась кука yp со значением los.1
    Проверка счетчика мониторинга:
      - do: обновить страницу
      - tech: должен сработать счетчик мониторинга path=690.1132
    Сравнение селектора с органикой:
      - do: обновить страницу
      - tech: селектор рекламы не должен отличаться от органики
    Сниманием маскировку после двух отрицательных тестов на блокировщик:
      - do: выключить adguard
      - do: обновить страницу
      - tech: у рекламного сниппета должен отсутствовать селектор serp-adv-item
      - assert: рекламный сниппет должен присутствовать и выгдядеть как органика
      - do: обновить страницу
      - tech: у рекламного сниппета должен отсутствовать селектор serp-adv-item
      - assert: рекламный сниппет должен присутствовать и выгдядеть как органика
      - do: обновить старницу
      - tech: у рекламного сниппета должен присутствовать селектор serp-adv-item
      - assert: рекламный сниппет должен присутствовать и выгдядеть как органика

  Отключение маскировки &exp_flags=nomoney:
    Кука los выставляется:
      - params:
          exp_flags: nomoney=1
      - do: получить выдачу по запросу 'foreverdata'
      - tech: установилась кука yp со значением los.1
      - assert: реклама вырезалась блокировщиком рекламы
    При включённом hideads реклама не маскируется:
      - params:
          exp_flags:
            - nomoney=1
            - hideads=1
      - do: получить выдачу по запросу 'foreverdata'
      - assert: реклама вырезалась блокировщиком рекламы

  Внешний вид:
    При маскировке рекламы:
      - params:
          exp_flags:
            - hideads=1
            - direct_naked_label=null
      - do: получить выдачу по запросу 'foreverdata'
      - screenshot: пример внешнего вида рекламного сниппета [hideads]
      - assert: на выдаче присутствует рекламный сниппет с лейблом в виде изображения
    При маскировке рекламы с nomoney=1:
      - params:
          exp_flags:
            - hideads=1
            - nomoney=1
      - do: получить выдачу по запросу 'foreverdata'
      - screenshot: пример внешнего вида рекламного сниппета [nomoney]
      - assert: на выдаче присутствует рекламный сниппет с обычным лейблом
  Повторный вызов inquire:
    browsers:
      notFor:
        - ios-pad-group
        - android-pad-group
    Установилась кука yp со значением los.1:
      - params:
          foreverdata: '3450195293'
      - do: выключить/не включать adblock
      - do: очистить куку yp со значением los.1
      - do: получить выдачу по запросу ‘foreverdata’
      - do: успеть выполнить следующее действие менее чем за 3 секунды
      - tech: |
          скрыть рекламные сниппеты, выполнив в консоли команды
          "[1, 2, 3, 14, 15, 16, 17].forEach(index => { document.querySelector('.serp-item:nth-of-type(' + index + ')').setAttribute('style', 'display:none;'); });"
      - assert: рекламные блоки скрылись
      - tech: кука los.1 выставлена

files:
  - features/desktop/serp-adv/hideads.hermione.js

v-team: Distribution

tags:
  - reviewed
  - smoke_extended
  - skip_e2e_check
  - adv
  - adblock
  - cookie
  - no_assessors

tlds: all
