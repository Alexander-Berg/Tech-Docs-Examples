feature: Hotels / Колдунщик многих организаций
type: Стандартный вид

specs-integration:
  beforeEach:
    - do: получить выдачу по запросу 'отели в москве'
    - assert: появился колдунщик оргмн
  Содержит необходимые элементы:
    - tags:
        - high_priority
    - assert: присутствует форма выбора дат и гостей
    - assert: присутствуют отели
  Открывает сайдблок:
    - do: клинуть в карту
    - assert: открылся сайдблок с картой

specs:
  beforeEach:
    - do: получить выдачу по запросу 'отели в москве'
    - assert: появился колдунщик списка отелей
  Сайдблок с картой:
    Внешний вид формы:
      - tags:
          - orgmn
          - map
          - sideblock
          - hotels-form
          - switch
          - offers
          - high_priority
      - do: тапнуть в карту
      - assert: открылся сайдблок с картой
      - do: тапнуть в тайтл сайдблока
      - assert: появилась форма выбора дат и гостей
      - screenshot: внешний вид сайдблока в режиме карты [side-block-map-list-with-filters-map]
      - do: тапнуть по переключателю "Карта/Список"
      - assert: карта скрылась, появился список отелей
      - screenshot: внешний вид сайдблока в режиме списка [side-block-map-list-with-filters-list]
      - assertMetrics: '-'
    Проверка тайтла в режиме карты:
      - tags:
          - orgmn
          - map
          - sideblock
          - hotels-form
      - do: тапнуть в карту
      - assert: открылся сайдблок с картой
      - assert: в тайтле сайдблока указаны даты из формы
      - screenshot: внешний вид тайтла сайдблока [side-block-map-list-title]
      - do: тапнуть в тайтл сайдблока
      - assert: появилась форма выбора дат и гостей
      - assert: в тайтле сайдблока указан текст поискового запроса
      - screenshot: внешний вид тайтла сайдблока [side-block-map-list-title-with-filters]
      - do: снова тапнуть в тайтл сайдблока
      - assert: форма выбора дат и гостей скрылась, в тайтле указаны даты из формы
      - assertMetrics: '-'
    Проверка тайтла в режиме списка:
      - tags:
          - orgmn
          - sideblock
          - hotels-form
      - do: тапнуть по тайтлу колдунщика
      - assert: открылся сайдблок со списком отелей
      - assert: присутствует форма выбора дат и гостей
      - assert: в тайтле сайдблока указан текст поискового запроса
      - screenshot: внешний вид тайтла сайдблока [side-block-map-list-title]
      - do: проскролить список чтобы форма перестала быть видна
      - assert: в тайтле сайдблока указаны даты из формы
      - screenshot: внешний вид тайтла сайдблока [side-block-map-list-title-scrolled]
      - do: тапнуть в тайтл сайдблока
      - assert: список проскролился вверх. Форма видна над списком
      - assertMetrics: '-'
    Проверка формы:
      - tags:
          - orgmn
          - sideblock
          - hotels-form
          - dates
          - submit
          - datasync
          - high_priority
      - assert: присутствует форма выбора дат и гостей
      - do: поменять дату выезда на 1-2 дня вперед
      - assert: обновился список предложений отелей
      - do: кликнуть в тайтл колдунщика
      - assert: открылся сайдблок со списком отелей
      - assert: присутствует форма выбора дат и гостей
      - assert: значения полей в форме соответствуют выбранным на поисковой выдаче
      - do: установить другие значения в форме
      - assert: появился прогрессбар
      - assert: прогрессбар скрылся, список отелей обновился
      - do: тапнуть в произвольный отель из списка
      - assert: открылся сайдблок 1 отеля
      - assert: в сайдблоке присутствует форма выбора дат и гостей
      - assert: значения полей в форме соответствуют выбранным в сайдблоке со списком
      - assertMetrics: '*'
    Галерея в сайдблоке скроллится:
      - do: кликнуть в тайтл колдунщика
      - assert: открылся сайдблок с карточками отелей
      - do: в любом из отелей проскроллить галерею фото до конца
      - assert: |
          галерея проскроллилась
          в конце галерее присутствует кнопка 'Еще N фотографии'
      - screenshot: внешний вид [more-photos-button]
    Клик в миниатюру карты в галерее сайдблока:
      - do: кликнуть в тайтл колдунщика
      - assert: открылся сайдблок с карточками отелей
      - do: в любом из отелей проскроллить галерею фото до конца
      - assert: галерея проскроллилась
      - do: кликнуть в миниатюру карты в конце галереи
      - assert: открылась карта в сайлдблоке с информацией об отеле в нижней части экрана
    # возможно, где-то есть дубликат
    Появляется спиннер в сайдблоке после нажатия кнопки "Показать еще":
      - do: кликнуть в тайтл
      - assert: открылся сайдблок с карточками отелей
      - do: проскроллить список до самого конца
      - assert: появилась кнопка "Показать еще"
      - do: кликнуть в кнопку "Показать еще"
      - assert: загрузились новые отели
      - do: проскроллить список до конца
      - assert: появился спиннер, за ним подгрузились новые отели
    В пине и карточке пина цена меняется после сабмита:
      - do: кликнуть в миниатюру карты
      - assert: открылась карта с пинами в сайдблоке
      - do: кликнуть в дату в заголовке карты
      - assert: развернулась форма с датой, количеством взрослых и кнопкой "Найти отель"
      - do: поменять дату на +1 ночь и кликнуть в "Найти отель"
      - assert: пины обновились, цены на них увеличились
  Календарь в сайдблоке:
    Логика выбора дат:
      - tags:
          - hotels-form
          - orgmn
          - calendar
      - assert: в выдаче есть отельная форма
      - do: кликнуть в выбор даты
      - assert: |
          открылся календарь в сайдблоке
          один день в календаре выделен
          выделенная в календаре дата стоит в первом пикере в верхней части календаря
      - do: выбрать диапазон дат, кликнув в дату начала и окончания периода
      - assert: |
          даты в пикерах в верхней части календаря соответствуют выбранным в календаре
          снизу появилась кнопка "Выбрать"
      - do: запомнить выбранные даты и кликнуть "Выбрать"
      - assert: |
          календарь закрылся
          в отельной форме указаны выбранные даты
      - do: снова кликнуть в выбор даты
      - assert: |
          открылся календарь в сайдблоке
          в календаре выделен выбранный ранее диапазон дат
          даты в пикерах в верхней части календаря соответствуют выбранным ранее
      - do: выбрать первую дату позже ранее выбранной даты выселения
      - assert: |
          выбранный день подсветился жёлтым
          выбранная дата проставилась в дату заезда
          дата выезда сбросилась
      - do: выбрать вторую дату раньше первой даты
      - assert: |
          вторая дата стала датой заезда, первая дата перенеслась в дату выезда
          снизу появилась кнопка "Выбрать"

files:
  - features/companies/hotels/hotels@touch-phone.hermione.js
  - features/companies/hotels/hotels@touch-phone.hermione.e2e.js

counter: /$page/$main/$result[@wizard_name="companies" and @subtype="travel_map"]

v-team: KotTeam

tlds: none
