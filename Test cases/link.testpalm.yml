feature: Link

specs:
  aliases:
    - &CheckAnchorLink
      - assert: открывается турбо-страница
      - do: кликнуть по ссылке "ссылка до первого анкора"
      - assert: страница не перезагрузилась и переместилась к заголовку "Заголовок — первый анкор"
      - do: кликнуть по ссылке "ссылка до второго анкора"
      - assert: страница не перезагрузилась и переместилась к аккордеону. Первый спойлер "Первый спойлер, второй анкор" открылся
      - do: кликнуть по ссылке "ссылка до третьего анкора"
      - assert: страница не перезагрузилась и переместилась к жирному тексту "сюда ведет ссылка третьего анкора"
      - do: кликнуть по ссылке "ссылка до четвертого анкора"
      - assert: |
          страница не перезагрузилась и переместилась к заголовку "Четвертый анкор — в самом конце"
          подгрузилась страница бесконечной ленты
      - do: пролистать вниз до ссылки "related - ссылка до первого анкора" и кликнуть по ней
      - assert: страница не перезагрузилась и переместилась к заголовку "related - Заголовок — первый анкор"
      - do: кликнуть по ссылке "related - ссылка до второго анкора"
      - assert: страница не перезагрузилась и переместилась к аккордеону. Первый спойлер "related - Первый спойлер, второй анкор" открылся
      - do: кликнуть по ссылке "related - ссылка до третьего анкора"
      - assert: страница не перезагрузилась и переместилась к жирному тексту "related - сюда ведет ссылка третьего анкора"
      - do: кликнуть по ссылке "related - ссылка до четвертого анкора"
      - assert: страница не перезагрузилась и переместилась к заголовку "related - Четвертый анкор — в самом конце"

  Обычный режим:
    - params:
        foreverdata: '914691499'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая станица для test_link_default — турбо)
    - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
    - screenshot: внешний вид ссылки соответствует примеру [plain]

  Проверка ссылок:
    - params:
        foreverdata: '1240287546'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая станица для test_link — турбо)
    - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
    - do: кликнуть по ссылке
    - assert: открылась новая вкладка по адресу "https://yandex.ru"

  Проверка ссылок телефона:
    - params:
        foreverdata: '4089458087'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая станица для Link/tel — турбо)
    - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
    - do: кликнуть по ссылке
    - assert: происходит звонок по указанному номеру или происходит переход в раздел Звонки с введенным номером (поведение может меняться в зависимости от девайса)

  Проверка ссылок почты:
    - params:
        foreverdata: '3708172536'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая станица для Link/mailto — турбо)
    - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
    - do: кликнуть по ссылке
    - assert: открылся почтовый клиент по умолчанию с заполненным полем получателя

  Проверка, что ссылки почты меняют указанный target:
    - params:
        foreverdata: '1244378362'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая станица для test_link_mailto_blank — турбо)
    - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
    - do: кликнуть по ссылке
    - assert: открылся почтовый клиент по умолчанию с заполненным полем получателя (или открылся перечень почтовых сервисов - это ок)

  Проверка работы с анкорами:
    - do: открыть главную страницу поиска, удалить все параметры кроме yandex.ru и добавить в адресную строку к URL '/turbo?stub=page/anchor-infinite-1.json'
    - *CheckAnchorLink

  Проверка работы с анкорами в iframe:
    - params:
        foreverdata: '623197124'
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая страница для блока ссылки с анкором — турбо)
    - *CheckAnchorLink
    - do: нажать кнопку назад в вверхнем левом углу
    - assert: страница турбо закрылась, видно поисковую выдачу

  Проверка открытия аккордеона при загрузке страницы:
    - do: открыть главную страницу Поиска, удалить все параметры кроме yandex.ru и добавить в адресную строку к URL '/turbo?stub=page/anchor-infinite-1.json#anchor-2'
    - assert: |
        в поле видимости находится аккордеон
        в самом верху страницы находится заголовок "Первый спойлер, второй анкор"

  Проверка игнорирования target=_self для внешней ссылки:
    - do: открыть главную страницу Поиска, удалить все параметры кроме yandex.ru и добавить в адресную строку к URL '/turbo?stub=link/out-link-target-self.json'
    - assert: на странице есть ссылка
    - tech: аттрибут ссылки target=_blank
    - do: кликнуть на ссылку
    - assert: ссылка открылась в новой вкладке

  Проверка валидности ссылок турбо-в-турбо:
    - do: открыть главную страницу Поиска, удалить все параметры кроме yandex.ru и добавить в адресную строку к URL '/turbo?stub=link/turbo-or-not-turbo.json'
    - assert: Все ссылки после заголовка "Это турбо в турбо" и до заголовка "А это не турбо-в-турбо" открываются в текущей вкладке (куда они ведут не важно)
    - assert: Все ссылки после заголовка "А это не турбо-в-турбо" открываются в новой вкладке (куда они ведут не важно)

  Проверка выставления noopener:
    - do: открыть главную страницу Поиска, удалить все параметры кроме yandex.ru и добавить в адресную строку к URL '/turbo?stub=link/link-types.json'
    - tech: первые две ссылки имеют аттрибуты "target=_blank" и "rel=noopener"
    - tech: вторые две ссылки имеют аттрибуты "target=_self" и не имеют аттрибута rel
    - tech: оставшиеся ссылки имеют аттрибуты "target=_parent" и не имеют аттрибута rel

  Проверка Baobab счетчиков:
    - tags: no_assessors
    - do: открыть страницу https://yandex.ru/turbo?stub=link/link-types.json&exp_flags=validate_counters=1
    - tech: сработал счетчик event "show", по пути $page.$main.$result в children отправился массив элементов link
    - tech: в каждом элементе link есть поле attrs с аттрибутом url равным url ссылки и аттрибутом turbo равным 0 для обычных ссылок и 1 для турбированных ссылок

files:
  - features/blocks/link/link.hermione.js

v-team: Turbo

tlds: none
