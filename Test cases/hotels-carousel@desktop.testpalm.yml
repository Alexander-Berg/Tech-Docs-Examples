feature: Hotels / Карусель

specs-integration:
  Проверка наличия фильтров и карусели:
    - tags:
        - carousel
        - filters
    - do: получить выдачу по запросу 'отели в алуште'
    - assert: появилась карусель отелей
    - assert: колдунщик содержит отельные фильтры
    - assert: под фильтрами есть карусель с отелями

specs:
  Внешний вид карусели и прогресс-бара:
    - label: geo-hotels-carousel
    - tags:
        - carousel
        - showcase
        - thumb
        - button
        - ajax
        - smoke
    - do: получить выдачу по запросу 'отели в алуште'
    - screenshot: над поисковой выдачей появилась карусель отелей во всю ширину экрана [carousel]
    - do: выбрать даты заселения
    - assert: |
        показался прогресс-бар,
        карусель скрыта под паранджой, стрелки не кликабельны
    - screenshot: внешний вид карусели с паранджой и прогресс-бара в середине поиска [carousel-progress]
    - screenshot: внешний вид прогресс-бара в начале поиска [task-progress-zero]
    - screenshot: внешний вид прогресс-бара в конце поиска [task-progress-full]
    - do: кликнуть в карточку с картой в карусели
    - assert: карусель отелей переключилась на режим карты
    - screenshot: примерный внешний вид карты с пинами [carousel-map]
  Внешний вид карусели на узком экране:
    - tags:
        - carousel
        - showcase
    - do: получить выдачу по запросу 'отели в алуште'
    - assert: над поисковой выдачей появилась карусель отелей во всю ширину экрана
    - do: установить ширину экрана меньше 990px
    - screenshot: пример внешнего вида карусели [carousel-narrow]
  Бейджик кэшбэка Мир:
    - params:
        foreverdata: '228312147'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: |
        над поисковой выдачей появилась карусель отелей во всю ширину экрана
        во второй карточке на картинке есть лейбл Возврат 20% по карте Мир
  Кнопка закрывает карту:
    - do: открыть выдачу 'отели в ялте'
    - assert: появилась отельная карусель
    - do: кликнуть в карточку карты в карусели
    - assert: |
        открылась карта
        в правом верхнем углу карты есть кнопка с крестиком
    - do: кликнуть в кнопку с крестиком
    - assert: карта закрылась
    - tech: сработал динамический счетчик path='/$page/$top/$result/companies-map-list/map[@behaviour@type="dynamic" and @data@action="close"]'
  Попап на карте, когда ничего не найдено:
    - tags:
        - carousel
        - map
        - popup
        - error
    - do: получить выдачу по запросу 'отели в ялте'
    - assert: над поисковой выдачей появилась карусель отелей во всю ширину экрана
    - do: кликнуть на первую карточку карусели на которой выводится карта
    - assert: над поисковой выдачей появилась карта во всю ширину экрана
    - do: перетащить карту так, чтобы в области видимости было только море
    - assert: под фильтрами на карте появился попап с информацией о том, что ничего не найдено
    - screenshot: внешний вид попапа [hotels-not-found]
  Отправка запроса при переходе от списка к карте, если фильтры были изменены:
    # no_assessors потому, что проверка техническая
    - tags:
        - no_assessors
    - do: открыть выдачу 'отели в ялте'
    - assert: появилась отельная карусель
    - do: кликнуть по кнопке выбора количества гостей
    - assert: появился дропдаун выбора гостей
    - do: уменьшить число гостей на 1
    - do: кликнуть в карточку карты в карусели
    - tech: Отправился ajax-запрос с параметром ag_dynamic.middle_yandex_travel_filter.Ages равным '88,88,88'
  Кнопка "Условия подключения":
    - tags:
        - carousel
    - do: получить выдачу по запросу 'отели в алуште'
    - assert: на странице есть кнопка 'Условия подключения'
    - do: навести мышь на ссылку 'Условия подключения'
    - assert: текст ссылки перекрасился в красный
    - tech: ссылка ведет на страницу https://yandex.ru/support/webmaster/search-appearance/hotel-list.html
    - tech: сработал счетчик path='/$page/$top/$result/companies-map-list/carousel/link'

files:
  - features/companies/hotels/hotels-carousel/hotels-carousel@desktop.hermione.js
  - features/companies/hotels/hotels-carousel/hotels-carousel@desktop.hermione.e2e.js

tlds:
  - ru
  - by
  - kz
  - ua

regions:
  ru: 213
  by: 157
  kz: 163
  ua: 143

requests:
  ru: отели в алуште

counter: /$page/$top/$result[@wizard_name="companies" and @subtype="travel_map"]/companies-map-list/carousel/showcase

tags:
  - hasE2E

v-team: KotTeam
