feature: Шапка

specs:
  aliases:
    - &CheckMetrics
      - assertMetrics:
          - web.reformulations_rate
          - web.total_rerequest_count
          - web.rerequest_per_user
          - web.part_rerequest
          - web.total_all_click
          - web.total_request_count
          - web.total_click_count
          - web.tech_part_misc_click
          - web.abandonment
          - web.full_abandonment
          - web.empty_query_rate
          - web.empty_serps_rate
    - &commonAssert
      - tags:
          - smoke_extended
      - tech: в урле табов Картинки и Видео есть параметр 'parent-reqid'
      - assert: есть табы Картинки, Видео, Карты
      - do: кликнуть на таб Картинки
      - assert: в новой вкладке открылся сервис Яндекс Картинки
      - do: кликнуть на таб Видео
      - assert: в новой вкладке открылся сервис Яндекс Видео
      - do: кликнуть на таб Карты
      - assert: в новой вкладке открылся сервис Яндекс Карты
      - tech: проверить счётчики табов Картинки, Видео, Карты
  beforeEach:
    - do: получить выдачу по запросу 'колендарь'
    - assert: вверху страницы есть шапка
    - assert: в шапке есть навигационные табы сервисов Яндекса
  XSS:
    Не отрабатывает xss:
      - tags: no_assessors
      - tlds: all
      - do: получить выдачу по запросу '</script><script>window.location="google.com"</script>'
      - assert: видна выдача Яндекса
      - screenshot: внешний вид шапки [plain]
    Заголовок не отрабатывает xssOnError:
      - tags: no_assessors
      - tlds: all
      - do: получить выдачу по запросу '<img src="/" onerror=window.location="https://ya.ru/patch=xssOnError";>'
      - assert: видна выдача Яндекса
      - screenshot: внешний вид шапки [plain]
  Базовые проверки:
    Заголовка страницы:
      - tags: [smoke_extended]
      - tlds: all
      - assert: заголовок страницы содержит поисковый запрос
    Перезапрос с другим запросом:
      - tags:
          - smoke
          - smoke_extended
      - tlds: all
      - do: получить выдачу по запросу 'колендарь'
      - do: поменять значение 'календарь' на 'testqz' в инпуте
      - assert: запрос изменился
      - do: кликнуть кнопку 'Найти' или 'Enter'(если нет кнопки 'Найти')
      - assert: поисковая выдача обновилась в соответствии с новым запросом
      - assert: значение параметра 'text' в URL изменилось
      - *CheckMetrics
    Перезапрос с тем же запросом:
      - tlds: all
      - do: получить выдачу по запросу 'колендарь'
      - do: кликнуть крестик в инпуте
      - do: ввести снова запрос 'колендарь'
      - do: кликнуть в кнопку 'Найти' или 'Enter'(если нет кнопки 'Найти')
      - assert: |
          произошёл перезапрос
          проверить что выдача обновилась (отработал прогрессбар в браузере или видно что результаты выдачи перегрузились)
      - *CheckMetrics
    BackSpace:
      - tags:
          - smoke_extended
      - tlds: all
      - do: ввести в поле запроса значение 'qz'
      - do: нажать BackSpace
      - assert: значение инпута равно 'q'
      - *CheckMetrics
    Смена запроса в табах после ajax:
      - do: затем ввести в стрелку и получить выдачу по запросу 'testqz'
      - tech: выполнить в консоли `BEM.blocks['serp-request'].navigateTo('?text=testqz')`
      - assert: поисковая выдача обновилась в соответствии с новым запросом
      - *CheckMetrics
      - do: кликнуть в таб 'Картинки'
      - assert: открылась вкладка сервиса 'Картинки', в поисковой строке сервиса указан запрос 'testqz'
      - do: вернуться на вкладку с поисковой выдачей и кликнуть в таб 'Видео'
      - assert: открылась вкладка сервиса 'Видео', в поисковой строке сервиса указан запрос 'testqz'
      - tech: значение параметра 'text' в URL табов должно измениться
      - *CheckMetrics
  Сервисная навигация:
    Наличие основных табов и ссылок:
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - tech: в урле табов Картинки и Видео есть параметр 'parent-reqid'
      - tech: текст запроса в ссылке таба Карты экранируется
      - assert: |
          при клике по таб Новости в новой вкладке/странице браузера открывается правильный URL сервиса
          (сервис Новости есть на доменах ru, by, uz, kz)
      - tech: проверить счётчики табов Картинки, Видео, Карты, Маркет
      - *CheckMetrics
    Наличие табов и ссылок Новости, Переводчик, Все:
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - assert: |
          при клике по табу Новости в новой вкладке/странице браузера открывается правильный URL сервиса
          (таб Новости есть везде кроме com.tr)
      - assert: при клике по табу Переводчик в новой вкладке/странице браузера открывается правильный URL сервиса
      - assert: |
          при клике по табу Все в новой вкладке/странице браузера открывается страница со списком сервисов
          (таб Все есть везде кроме com)
    Позиции табов:
      - tags:
          - smoke_extended
      - tlds: ru
      - assert: на выдаче таб Картинки находится на второй позиции
      - assert: на выдаче таб Видео находится на третьей позиции
      - assert: на выдаче таб Карты находится на четвертой позиции
      - assert: на выдаче таб Товары находится на пятой позиции
      - assert: на выдаче таб Новости находится на шестой позиции
      - assert: на выдаче таб Переводчик находится на седьмой позиции
      - assert: на выдаче таб Все находится на восьмой позиции
  Сервисная навигация на доменах наличие основных табов и ссылок на uz:
    - tlds:
        - uz
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на by:
    - tlds:
        - by
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на kz:
    - tlds:
        - kz
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на ru:
    - tlds:
        - ru
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на ua:
    - tlds:
        - ua
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на com.tr:
    - tlds:
        - com
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на fi:
    - tlds:
        - fi
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на ee:
    - tlds:
        - ee
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на eu:
    - tlds:
        - eu
    - *commonAssert
  Сервисная навигация на доменах наличие основных табов и ссылок на com:
    - tlds:
        - com
    - tags:
        - smoke_extended
    - tech: в урле табов Картинки и Видео есть параметр 'parent-reqid'
    - assert: есть табы Картинки, Видео
    - assert: при клике по табам Картинки, Видео в новых вкладках/страницах браузера открываются правильные URL сервисов
    - tech: проверить счётчики табов Картинки, Видео
  Адаптация к ширине экрана без залогина:
    Plain:
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - screenshot: внешний вид шапки [plain]
    1560x600:
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 1560x600
      - screenshot: внешний вид шапки (набор табиков может отличаться) [1560x600]
    1280x600:
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 1280x600
      - screenshot: внешний вид шапки (набор табиков может отличаться) [1280x600]
    1000x600:
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 1000x600
      - screenshot: внешний вид шапки (набор табиков может отличаться) [1000x600]
    '768x1024 (ipad-portrait)':
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - browsers:
          - ipad-portrait
      - do: перевернуть девайс из горизонтальной в вертикальную ориентацию
      - screenshot: внешний вид шапки (набор табиков может отличаться) [768x1024]
    800x600:
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 800x600
      - screenshot: внешний вид шапки (набор табиков, иконок и кнопок в шапке может отличаться, главное проверить что не ломается верстка) [800x600]
    640x480:
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 640x480
      - screenshot: внешний вид шапки (набор табиков может отличаться) [640x480]
  Адаптация к ширине экрана с залогином:
    Plain:
      - params:
          yandex_login: stas.mihailov666
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - screenshot: внешний вид шапки [plain]
    1280x600:
      - params:
          yandex_login: stas.mihailov666
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 1280x600
      - screenshot: внешний вид шапки (набор табиков может отличаться) [1280x600]
    1000x600:
      - params:
          yandex_login: stas.mihailov666
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 1000x600
      - screenshot: внешний вид шапки (набор табиков может отличаться) [1000x600]
    800x600:
      - params:
          yandex_login: stas.mihailov666
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 800x600
      - screenshot: внешний вид шапки (набор табиков может отличаться) [800x600]
    '768x1024 (ipad-portrait)':
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - browsers:
          - ipad-portrait
      - do: перевернуть девайс из горизонтальной в вертикальную ориентацию
      - screenshot: внешний вид шапки (набор табиков может отличаться) [768x1024]
    640x480:
      - params:
          yandex_login: stas.mihailov666
      - tags:
          - smoke_extended
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: установить размер окна 640x480
      - screenshot: внешний вид шапки (набор табиков может отличаться) [640x480]
  Главный инпут:
    Автофокус:
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - assert: фокус в шапке отсутствует, текстовый курсор в инпуте не мигает
      - do: начать вводить с клавиатуры запрос 'на 2018 год'
      - assert: фокус перемещается в главный инпут и продолжает исходный запрос
    Видимость поискового запроса при длинном логине:
      - params:
          yandex_login: stas.mihailov666.v.30.simvolov
      - tlds:
          - ru
          - by
          - kz
          - ua
          - uz
          - com
          - com.tr
      - do: получить выдачу по запросу 'три березы'
      - do: уменьшить ширину окна браузера до 950 пикселей
      - assert: |
          запрос 'три березы' полнотью помещается в поле ввода
          логин остался на странице и имеет укороченный вид (с многоточием)
      - screenshot: внешний вид соответсует скриншоту [plain]
    Проверка положения курсора после клика:
      - do: кликнуть в главный инпут между первым и вторым символом
      - assert: курсор установился между первым и вторым символом
  Шапка не дергается при открытии попапа:
    - do: получить выдачу по запросу 'кафе пушкинъ'
    - assert: вверху страницы есть шапка
    - assert: в правой колонке есть колдунщик организцации
    - do: кликнуть первую похожую организацию
    - assert: появился попап
    - assert: аватарка в шапке не двигалась

files:
  - features/desktop/yandex-search/yandex-search__menu.hermione.js
  - features/desktop/yandex-search/yandex-search__input.hermione.js
  - features/desktop/yandex-search/yandex-search.hermione.js

v-team: Beauty

priority: high

tags:
  - reviewed

tlds: none
