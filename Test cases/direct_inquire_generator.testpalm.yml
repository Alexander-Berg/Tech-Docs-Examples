feature: Борьба с блокировщиками
experiment: Генерация скрипта антиблокировки

params:
  exp_flags:
    - hideads=1
    - direct_inquire_generator=1
  foreverdata: '4202406061'

specs:
  Проверка работоспособности флага:
    Маскировка рекламы:
      beforeEach:
        - do: включить adguard
        - do: получить выдачу по запросу 'foreverdata'
        - assert: рекламный сниппет должен быть вырезан блокировщиком
        - tech: должен сработать счетчик мониторинга path=690.1132
      Установилась кука yp со значением los.1:
        - do: обновить страницу
        - tech: у рекламного сниппета должен отсутствовать селектор serp-adv-item
        - assert: рекламный сниппет должен присутствовать и выглядеть как органика
        - tech: установилась кука yp со значением los.1
      Проверка счетчика мониторинга:
        - do: обновить страницу
        - tech: должен сработать счетчик мониторинга path=690.1132
      Сравнение селектора с органикой:
        - do: обновить страницу
        - tech: селектор рекламы не должен отличаться от органики
      Сниманием маскировку после двух отрицательных тестов на блокировщик:
        - do: выключить adguard
        - do: обновить страницу
        - tech: у рекламного сниппета должен отсутствовать селектор serp-adv-item
        - assert: рекламный сниппет должен присутствовать и выглядеть как органика
        - do: обновить страницу
        - tech: у рекламного сниппета должен отсутствовать селектор serp-adv-item
        - assert: рекламный сниппет должен присутствовать и выглядеть как органика
        - do: обновить старницу
        - tech: у рекламного сниппета должен присутствовать селектор serp-adv-item
        - assert: рекламный сниппет должен присутствовать и выглядеть как органика
    Отключение маскировки &exp_flags=nomoney:
      Кука los выставляется:
        - params:
            exp_flags:
              - nomoney=1
              - direct_inquire_generator=1
        - do: получить выдачу по запросу 'foreverdata'
        - tech: установилась кука yp со значением los.1
        - assert: реклама вырезалась блокировщиком рекламы
      При включённом hideads реклама не маскируется:
        - params:
            exp_flags:
              - nomoney=1
              - hideads=1
              - direct_inquire_generator=1
        - do: получить выдачу по запросу 'foreverdata'
        - assert: реклама вырезалась блокировщиком рекламы

files:
  - features/desktop/serp-adv/direct_inquire_generator/direct_inquire_generator.hermione.js

v-team: Distribution

tags:
  - skip_e2e_check
  - adv
  - adblock
  - cookie
  - no_assessors

tlds: ru

