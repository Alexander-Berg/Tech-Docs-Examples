feature: Авиа
type: Оплата
description: >-
  Описание перехода на бронирование для команды:
  https://testpalm.yandex-team.ru/testcase/travel-930

  Описание перехода на бронирование для асессоров:
  https://testpalm.yandex-team.ru/testcase/travel-931
specs:
  'ТК Авиа: Изменение цены при оплате на бой':
    - do: >-
        Дернуть ручку тестового контекста
        https://api.travel-balancer-test.yandex.net/api/test_context/v1/avia_token?checkAvailabilityOnRedirOutcome=CAOR_SUCCESS&checkAvailabilityBeforeBookingOutcome=CAO_PRICE_CHANGED&tokenizationOutcome=TO_SUCCESS&confirmationOutcome=CO_SUCCESS&mqEventOutcome=MEO_SUCCESS

        Положить значение из "token" в куку variantTestContext  (paymentContext
        пустой)
    - do: Перейти на страницу бронирования
    - assert: Открылась страница бронирования
    - do: |-
        Заполнить данные о пассажирах валидными данными
        Запомнить сумму заказа
        Нажать кнопку "Оплатить"
    - assert: >-
        Открылась страница оплаты с трастом

        Появился модал "Цена изменилась" с кнопками "Вернуться к результатам
        поиска" и "Продолжить бронирование"

        Запомнить сумму2 из этого модала
    - do: |-
        Нажать Продолжить бронирование
        (карту не вводим, ТК сам сэмулирует оплату автоматически)
    - assert: >-
        Открылась страница  happy page "Вы успешно забронировали билеты"

        Оплаченная сумма в корзинке равна сумме2, которую мы запомнили в п.3

        Цена у единственного пассажира в корзинке также равна сумме2, которую мы
        запомнили в п.3
manual: true
Функциональность: Бронирование
Устройство:
  - Тач
  - Десктоп
Страница: Оплата
Сервис: Авиа
Тестирование асессорами: Нет
Окружение: Testing
Tag: TK
