feature: Способы подтверждения домена

description: |
  Preconditions.
  Кейс выполняется на подготовленной организации:
    - админ(glav@yandex.ru =-123qwe)
  Просьба вернуть организацию в изначальное состояние после выполнения кейса.

aliases:
  - &check
    - do: нажать кнопку "Проверить"
    - assert: появилась надпись "Выполняется проверка"
    - assert: кнопка "Проверить" не активна
    - do: ничего не делать, подождать пару минут
    - assert: появилась надпись "Последняя проверка — {{указана дата и время}}"

specs:
  beforeEach:
    - do: авторизоваться под учеткой админа(glav@yandex.ru) из description
  Положительные:
    1. Способы подтверждения для домена с доменной зоны RU:
      - do: перейти в карточку домена {{CONNECT_HOST}}/portal/services/webmaster/resources/glav.test.ru
      - assert: |
          открылась карточка домена
          состояние домена "Домен не подтверждён"
          отображается вкладка "Подтверждение домена"
          отображаются способы подтверждения "DNS", "Метатег", "HTML-файл"
          отображается кнопка "Проверить"
      - screenshot: внешний вид карточки домена [ru-domain-card]
    2. Способы подтверждения для домена верхнего уровня с доменной зоны COM:
      - do: перейти в карточку домена {{CONNECT_HOST}}/portal/services/webmaster/resources/glav.com
      - assert: |
          открылась карточка домена
          состояние домена "Домен не подтверждён"
          отображается вкладка "Подтверждение домена"
          отображаются способы подтверждения "DNS", "Метатег", "HTML-файл", "WHOIS"
          отображается кнопка "Проверить"
      - screenshot: внешний вид карточки домена [com-domain-card]
    3. Запуск проверки домена через "DNS":
      - do: перейти в карточку домена {{CONNECT_HOST}}/portal/services/webmaster/resources/glav.com
      - do: нажать на вкладку "DNS"
      - screenshot: внешний вид вкладки "DNS" c инструкцией по настройке домена из четырех пунктов [domain]
      - *check
      - assert: появилось сообщение "Результат':' DNS-запись не найдена"
    4. Запуск проверки домена через "Метатег":
      - do: перейти в карточку домена {{CONNECT_HOST}}/portal/services/webmaster/resources/glav.com
      - do: нажать на вкладку "Метатег"
      - screenshot: внешний вид вкладки "Метатег" c инструкцией по настройке домена из трёх пунктов [domain]
      - *check
      - assert: появилось сообщение "Результат':' Страница недоступна."
    5. Запуск проверки домена через "HTML-файл":
      - do: перейти в карточку домена {{CONNECT_HOST}}/portal/services/webmaster/resources/glav.com
      - do: нажать на вкладку "HTML-файл"
      - screenshot: внешний вид вкладки "HTML-файл" c инструкцией по настройке домена из трёх пунктов [domain]
      - *check
      - assert: появилось сообщение "Результат':' Страница недоступна."
    6. Запуск проверки домена через "WHOIS":
      - do: перейти в карточку домена {{CONNECT_HOST}}/portal/services/webmaster/resources/glav.test.com
      - do: нажать на вкладку "WHOIS"
      - screenshot: внешний вид вкладки "WHOIS" c инструкцией по настройке домена из трёх пунктов [domain]
      - *check
      - assert: появилось сообщение "Результат':' Соответствующий адрес электронной почты не найден в данных WHOIS"
  Отрицательные:
    1. Домен подтвержден, способов проверки нет:
      - do: перейти в карточку подтвержденного домена {{CONNECT_HOST}}/portal/services/webmaster/resources/glav.auto.connect-tk.tk
      - screenshot: внешний вид страницы домена [domain]
      - assert: |
          состояние домена "Домен подтверждён"
          вкладки "Подтверждение домена" нет
          отображается вкладка "Управление DNS"
          способов подтверждения домена нет

priority: blocker

files:
  - tests/hermione/suites/domain/check.js

tlds:
  - ru
  - com

tags:
  - smoke_test_assessors
  - regression
  - smoke_test
  - reviewed
