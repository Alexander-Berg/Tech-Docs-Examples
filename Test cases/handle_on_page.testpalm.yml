feature: Отклики
type: Обработка на странице

description: |
  'перед началом прохождения шагов необходимо сделать следующие действия:'
  'для обработки обычного отклика:'
  открыть страницу forms.test.yandex-team.ru/surveys/568/ - открылась тестовая форма для Фемиды [https://jing.yandex-team.ru/files/grikyan91/TESTOVAYa_3_dlya_Femidy_bez_voprosov__Yandex.Forms_2019-01-29_13-57-36.png]
  прикрепить файл в поле 'Резюме'
  ввести данные уже существующего кандидата в поле 'Имя'
  ввести данные уже существующего кандидата в поле 'Фамилия'
  ввести данные уже существующего кандидата в поле 'Телефон'
  ввести данные уже существующего кандидата в поле 'Email'
  согласиться с передачей своих персональных данных - пример внешнего вида заполненной формы [https://jing.yandex-team.ru/files/grikyan91/TESTOVAYa_3_dlya_Femidy_bez_voprosov__Yandex.Forms_2019-01-29_14-08-37.png]
  клик на 'Отправить' - выдало сообщение 'Спасибо за ответ на опрос'
  'для обработки отклика-рекомендации:'
  открыть страницу объявлений /vacancies/publications/
  нажать на 1 или больше объявлениях 'Рекомендовать'
  кликнуть на таб 'Порекомендовать'
  ввести данные уже существующего кандидата в поле 'Имя'
  ввести данные уже существующего кандидата в поле 'Фамилия'
  ввести данные уже существующего кандидата в поле 'Почта'
  ввести данные уже существующего кандидата в поле 'Телефон'
  прикрепить файл в поле 'Резюме'
  заполнить поле 'Чем кандидат полезен для Яндекса'
  согласиться с тем что кандидат интересуется работой в Яндексе - пример внешнего вида заполненной формы [https://jing.yandex-team.ru/files/olgakozlova/Objyavleniya__Femida_2019-08-30_00-24-39.png]
  клик на 'Порекомендовать' - выдало сообщение что рекомендация создана
  клик на ссылку на тикет в очереди REFERENCE в сообщении
  клик на ссылку на /submissions/<id> в тикете REFERENCE - открылась страница отклика
  клик на кнопку 'Одобрить' под рекомендацией - рекомендация перешла в статус 'Одобрена', отклик перешел в статус  'Новый'
  'для обработки отклика-ротации:'
  открыть страницу объявлений /vacancies/publications/
  нажать на 1 или больше объявлениях 'Ротироваться'
  кликнуть на таб 'Ротироваться'
  заполнить поле 'Причина ротации'
  заполнить поле 'Комментарий для нанимающих менеджеров'
  подтвердить ознакомление с правилами ротации - пример заполненной формы [https://jing.yandex-team.ru/files/olgakozlova/Objyavleniya__Femida_2019-08-30_00-30-56.png]
  клик на 'Ротироваться' - выдало сообщение о создании заявки на ротацию
  клик по ссылке в сообщении на тикет в очереди МУROTATION - открылась страница в Трекере
  клик по ссылке в тикете MYROTATION на тикет в очереди ROTATION - открылся тикет ротации
  клик по 'Проверено (Validated)' - тикет перешел в статус Проверено

specs:
  Отправка в спам:
    - do: открыть страницу /submissions/<id>
    - assert: |
        открылась новая страница с деталями отклика
        на странице есть кнопка 'Это спам'
    - screenshot: пример внешнего вида [reject_button]
    - do: клик на кнопку 'Это спам'
    - assert: |
        появился попап для обработки отклика
    - screenshot: пример внешнего вида [spam_form]
    - do: кликнуть кнопку "Отправить в спам"
        попап закрылся
        статус у отклика изменился на 'Обработан'
        появилась информация в поле 'Обработан'
        пропали кнопки 'Обработать' и 'Это спам'
        появилась информация в поле 'Кто обработал'
    - screenshot: пример внешнего вида [handled_submission]
  Cоздание кандидата:
    - do: открыть страницу /submissions/<id>
    - assert: |
        открылась новая страница с деталями отклика
        на странице есть кнопка 'Обработать'
    - screenshot: пример внешнего вида [handle_button]
    - do: клик на кнопку 'Обработать'
    - assert: |
        появился попап для обработки отклика
    - screenshot: пример внешнего вида [handle_form_empty]
    - do: кликнуть на радиобатон "Создать кандидата"
    - screenshot: пример внешнего вида [handle_form_filled]
    - do: кликнуть кнопку "Обработать"
        попап закрылся
        статус у отклика изменился на 'Обработан'
        появилась информация в поле 'Обработан'
        пропали кнопки 'Обработать' и 'Это спам'
        появилась информаци в поле 'Кто обработал'
        появилась информация в поле 'Кандидат'
    - screenshot: пример внешнего вида [handled_submission]
    - do: клик на ссылку в поле 'Кандидат'
    - assert: |
        открылась страница нового кандидата candidates/<id_кандидата>
        _manual_ данные в профиле соответствуют отклику
  Мерж и отказ:
    - do: открыть страницу /submissions/<id>
    - assert: |
        открылась новая страница с деталями отклика
        на странице есть кнопка 'Обработать'
    - screenshot: пример внешнего вида [handle_button]
    - do: клик на кнопку 'Обработать'
    - assert: |
        появился попап для обработки отклика
    - screenshot: пример внешнего вида [handle_form_empty]
    - do: кликнуть на радиобатон в 1-м кандидате
    - do: кликнуть на чекбокс "Отказать кандидату"
    - assert: |
        появилось поле Текст отказа, предзаполненное текстом на русском языке
    - screenshot: пример внешнего вида [handle_form_filled]
    - do: кликнуть кнопку "Отправить"
        попап закрылся
        статус у отклика изменился на 'Обработан'
        появилась информация в поле 'Обработан'
        пропали кнопки 'Обработать' и 'Это спам'
        появилась информаци в поле 'Кто обработал'
        появилась информация в поле 'Кандидат'
    - screenshot: пример внешнего вида [handled_submission]
    - do: клик на ссылку в поле 'Кандидат'
    - assert: |
        открылась страница candidates/<id_кандидата>
        _manual_ id кандидата соответствует отклику к которому мержили кандидата
    - do: _manual_ клик на таб "Внешняя коммуникация"
    - assert: |
        во внешних сообщениях есть отправленное письмо с содержанием из формы обработки отклика
  Отказ по отклику без дублей:
    - do: открыть страницу /submissions/<id>
    - assert: |
        открылась новая страница с деталями отклика
        на странице есть кнопка 'Обработать'
    - screenshot: пример внешнего вида [handle_button]
    - do: клик на кнопку 'Обработать'
    - assert: |
        появился попап для обработки отклика
    - screenshot: пример внешнего вида [handle_form_empty]
    - do: кликнуть на чекбокс "Отказать кандидату"
    - assert: |
        появилось поле Текст отказа, предзаполненное текстом на русском языке
    - screenshot: пример внешнего вида [handle_form_filled]
    - do: кликнуть кнопку "Отправить"
        попап закрылся
        статус у отклика изменился на 'Обработан'
        появилась информация в поле 'Обработан'
        пропали кнопки 'Обработать' и 'Это спам'
        появилась информаци в поле 'Кто обработал'
        появилась информация в поле 'Кандидат'
    - screenshot: пример внешнего вида [handled_submission]
    - do: клик на ссылку в поле 'Кандидат'
    - assert: |
        открылась страница нового кандидата candidates/<id_кандидата>
        _manual_ данные в профиле соответствуют отклику
    - do: _manual_ клик на таб "Внешняя коммуникация"
    - assert: |
        во внешних сообщениях есть отправленное письмо с содержанием из формы обработки отклика
  Создание кандидата (отклик-рекомендация):
    - do: открыть страницу /submissions/<id>
    - assert: |
        открылась новая страница с деталями отклика
        на странице есть кнопка 'Обработать'
    - screenshot: пример внешнего вида [handle_button]
    - do: клик на кнопку 'Обработать'
    - assert: |
        появился попап для обработки отклика
    - screenshot: пример внешнего вида [handle_form_empty]
    - do: кликнуть на радиобатон "Создать кандидата"
    - screenshot: пример внешнего вида [handle_form_filled]
    - do: кликнуть кнопку "Обработать"
        попап закрылся
        статус у отклика изменился на 'Обработан'
        появилась информация в поле 'Обработан'
        пропали кнопки 'Обработать' и 'Это спам'
        появилась информаци в поле 'Кто обработал'
        появилась информация в поле 'Кандидат'
    - screenshot: пример внешнего вида обработанного отклика [handled_submission]
    - do: клик на ссылку в поле 'Кандидат' отклика
    - assert: |
        открылась страница нового кандидата candidates/<id_кандидата>
        _manual_ данные в профиле соответствуют отклику
    - do: _manual_ клик на таб "Внешняя коммуникация"
    - assert: |
        во внешних сообщениях есть отправленное письмо с содержанием из формы обработки отклика
  Обработка отклика-ротации:
    - do: открыть страницу /submissions/<id>
    - assert: |
        открылась новая страница с деталями отклика
        на странице есть кнопка 'Обработать'
    - screenshot: пример внешнего вида [handle_button]
    - do: клик на кнопку 'Обработать'
    - assert: |
        появился попап для обработки отклика
    - screenshot: пример внешнего вида [handle_form_empty]
    - do: выбрать для мержа 1-го кандидата
    - screenshot: пример внешнего вида [handle_form_filled]
    - do: кликнуть кнопку "Обработать"
        попап закрылся
        статус у отклика изменился на 'Обработан'
        появилась информация в поле 'Обработан'
        пропали кнопки 'Обработать' и 'Это спам'
        появилась информаци в поле 'Кто обработал'
        появилась информация в поле 'Кандидат'
    - screenshot: пример внешнего вида обработанного отклика [handled_submission]
    - do: клик на ссылку в поле 'Кандидат' отклика
    - assert: |
        открылась страница candidates/<id_кандидата>
        id кандидата соответствует отклику к которому мержили кандидата

tags:
    - reviewed

files:
  - tests/hermione/suites/desktop/submissions/handle_submission/handle_on_page/handle_on_page.hermione.js

priority: blocker

browsers:
  - yandex-browser-desktop
  - firefox-desktop
  - safari-desktop
