feature: Список организаций

specs-integration:
  beforeEach:
    - do: получить выдачу по запросу 'кафе' _ALTERNATIVE_SEARCH_QUERIES_
    - assert: на выдаче есть список организаций
  Наличие элементов:
    - assert: |
        в списке организаций есть карточки,
        в конце списка есть кнопка '"Посмотреть ещё"'
  Открытие оверлея организации:
    - do: кликнуть на первую организацию в списке
    - assert: открылся оверлей с карточкой организации
  Дозагрузка списка организаций:
    - do: кликнуть на кнопку '"Посмотреть ещё"'
    - assert: загрузились еще организации

specs:
  Основные проверки:
    Внешний вид:
      - do: получить выдачу по запросу 'кафе в москве'
      - assert: |
          на выдаче присутствует колдунщик организаций
      - screenshot: примерный внешний вид карточки организации в списке [plain]
    Сайдблок:
      - do: получить выдачу по запросу 'кафе в москве'
      - assert: на серпе присутствует колдунщик нескольких организаций
      - do: нажать на карточку любой организации
      - tech: сработал счётчик path="/$page/$main/$result/composite/orgs-list/minibadge/item"
      - assert: открылся сайдблок с данными организации
    С аспектами:
      - params:
          srcparams: GEOV:experimental=add_snippet=ugc_aspects/1.x
      - do: получить выдачу по запросу 'суши екб'
      - assert: на серпе присутствует колдунщик нескольких организаций
      - assert: у первой организации в списке есть аспект с цветной полоской
      - screenshot: внешний вид [aspects]
    С кнопкой телефона:
      - do: получить выдачу по запросу 'кафе в зеленограде'
      - assert: на серпе присутствует колдунщик нескольких организаций
      - do: нажать на кнопку телефона у организации
      - assert: открылось системное окно телефонного звонка
      - tech: сработал счётчик path="/$page/$main/$result/composite/orgs-list/minibadge/contacts"
      - tech: отправился счетчик метрики с целью звонка mc.yandex.ru/watch/1206735187 с параметром call
    Проверяем наличие доп. адреса в колдунщике оргмн:
      - tags: skip_e2e_check
      - params:
          foreverdata: '382556587'
      - do: получить выдачу по запросу 'foreverdata'
      - do: повернуть устройство в ландшафтную ориентацию
      - assert: |
          в выдаче есть блок оргмн
          В блоке оргмн под картой есть карточки организаций
          В первой карточке адрес организации без доп. адреса: Неглинная ул., 10, Москва
          Во второй карточке адрес организации заканчивается доп. адресом в скобках: Манежная площадь, Россия, Москва (ТЦ Охотный ряд, -1 этаж)
    Большие фото:
      - tags: skip_e2e_check
      - params:
          exp_flags:
            - GEO_orgs_list_thumb_size=100
      - do: получить выдачу по запросу 'пиццерия в москве'
      - assert: |
          на странице присутствует колдунщик со списком организаций
      - screenshot: примерный внешний вид [plain]
  Похожие запросы в середине списка:
    - tags: no_assessors
    - params:
        exp_flags: GEO_orgmn_discovery=inset
        srcrwr: GEOV:rosetta.search.yandex.net:9904:1s
        srcparams: GEOV:rearr=scheme_Local/Geo/DiscoveryAspects/Enabled=true
    - do: получить выдачу по запросу 'кафе в москве'
    - assert: на странице присутствует колдунщик со списком организаций
    - assert: в середине списка организаций есть блок похожих запросв
    - screenshot: внешних вид похожих запросов [inset]
    - do: кликнуть на первый похожий запрос
    - assert: страница перезагрузилась по новому запросу
    - tech: сработал счетчик /$page/$main/$result/composite/orgs-list/org-related/scroller/link[@id]
  Дозагрузка списка:
    - do: получить выдачу по запросу 'пиццерия в спб'
    - assert: на странице присутствует колдунщик со списком организаций
    - assert: под списком организаций есть кнопка 'Посмотреть ещё'
    - do: посчитать количество показанных карточек
    - assert: количество карточек равно 7
    - do: нажать на кнопку 'Посмотреть ещё'
    - assert: дозагрузилось ещё 5 карточек
    - tech: сработал счетчик /$page/$main/$result/composite/orgs-list/more
    - screenshot: пример внешнего вида последней карточки и кнопки [loaded-and-more]
    - do: нажать на последнюю карточку
    - assert: открылся оверлей с выбранной карточкой организации

files:
  - src/features/Companies/Companies.features/OrgsList/OrgsList.test/OrgsList@touch-phone.hermione.e2e.js
  - src/features/Companies/Companies.features/OrgsList/OrgsList.test/OrgsList@touch-phone.hermione.js

tlds: all

v-team: VanillaGeo

tags:
  - react
  - hasE2E
  - geo
  - geo_orgs_list
