feature: Страница "Экспортные файлы"

description: В кейсах описываются компоненты и общий вид элементов на странице экспортных файлов.

specs:
  имеет внешний вид:
    - do: открыть страницу экспортных файлов https://partner-tst.news.yandex.ru//v2/export_files?userid=521917854&agencyid=1310
    - assert: на странице есть блок "Экспортные файлы", https://jing.yandex-team.ru/files/nightsonne/2022-01-27_21-25-45.png

  позволяет проверить файл на ошибки:
    - do: открыть страницу экспортных файлов https://partner-tst.news.yandex.ru//v2/export_files?userid=521917854&agencyid=1310
    - assert: |
        на странице есть блок "Экспортные файлы",
        блок содержит описание, блок со ссылкой на файл, индикатор "Включен" и индикатор проверки файла,
        проверка файла идет сразу автоматически
    - do: подождать, пока индикатор проверки файла не сменится на статус "Всё в порядке"
    - do: кликнуть на меню троеточия
    - assert: появляется выпадающее меню с пунктами "Проверить файл на ошибки" и "Отключить экспортный файл"
    - do: кликнуть по пункту "Проверить файл на ошибки"
    - assert: |
        запускается проверка файла, статус меняется на "Идёт проверка" с лоадером,
        через какое-то время статус меняется на "Всё в порядке"
    - do: навести курсор мыши на плашку статуса "Всё в порядке"
    - assert: по ховеру появляется тултип "В файле нет ошибок"

  отображает блок добавления нового экспортного файла:
    - do: открыть страницу экспортных файлов https://partner-tst.news.yandex.ru//v2/export_files?userid=521917854&agencyid=1310
    - do: нажать на кнопку "Добавить экспортный файл"
    - assert: |
        появляется блок "Добавление нового экспортного файла"
        блок содержит инпуты - "URL экспортного файла" (поле обязательное, со звездочкой), "Логин (если есть)", "Пароль (если есть)",
        снизу инпутов отображается неактивная кнопка "Отправить на проверку"
    - do: ввести любойсимвол в инпут "URL экспортного файла"
    - assert: кнопка становится активной

  позволяет добавить новый экспортный файл [manual]:
    - do: открыть страницу экспортных файлов https://partner-tst.news.yandex.ru/v2/export_files?userid=521917854&agencyid=1310
    - do: нажать на кнопку "Добавить экспортный файл"
    - assert: |
        появляется блок "Добавление нового экспортного файла"
        блок содержит инпуты - "URL экспортного файла" (поле обязательное, со звездочкой), "Логин (если есть)", "Пароль (если есть)",
        снизу инпутов отображается кнопка "Отправить на проверку"
    - do: ввести путь в раздел "URL экспортного файла", например, https://74.ru/text/rss.region.xml и нажать кнопку "Отправить на проверку"
    - assert: |
        появляется блок с сохраненным файлом в статусе "На модерации",
        в правом верхнем углу появляется всплывающее сообщение
    - do: открыть тестовую админку, раздел "Фиды" и включить добавленный фид
    - do: обновить страницу экспортнных файлов
    - assert: статус "На модерации" изменился на статус "Включен", https://jing.yandex-team.ru/files/nightsonne/2022-01-27_16-45-32.png
    - do: на той же странице тестовой админке удалить добавленный фид
    - do: обновить страницу экспортных файлов
    - assert: блок с сохраненным файлом удален

  позволяет отключить экспортный файл [manual]:
    - do: открыть страницу экспортных файлов https://partner-tst.news.yandex.ru/v2/export_files?userid=521917854&agencyid=1310
    - do: нажать на кнопку "..."
    - assert: |
        появляется всплывающее меню,
        в меню есть пункт "Отключить экспортный файл",
        пункт может быть неактивен, если файл не прошел можерацию и находится в статусе "Есть ошибки",
        внешний вид https://jing.yandex-team.ru/files/nightsonne/2022-02-07_15-21-18.png
    - do: кликнуть на пункт "Отключить экспортный файл"
    - assert: |
        появляется модальное окно с подтверждением и кнопками "Да" и "Отмена",
        внешний вид https://jing.yandex-team.ru/files/nightsonne/2022-02-07_15-24-27.png
    - do: навести курсор мыши на обе кнопки
    - assert: по ховеру меняется стиль кнопок
    - do: кликнуть на затемненную область вне окна
    - assert: окно закрылось
    - do: снова кликнуть на пункт "Отключить экспортный файл"
    - do: в окне кликнуть на кнопку "Отмена"
    - assert: окно закрылось
    - do: снова кликнуть на пункт "Отключить экспортный файл"
    - do: в окне кликнуть на крестик
    - assert: окно закрылось
    - do: снова кликнуть на пункт "Отключить экспортный файл"
    - do: в окне кликнуть на кнопку "Да"
    - assert: |
        окно закрылось,
        блок с файлом затемнен и в статусе "Отключен"
        внешний вид https://jing.yandex-team.ru/files/nightsonne/2022-02-07_15-28-33.png
    - do: нажать на кнопку "..."
    - assert: |
        появляется всплывающее меню,
        в меню пункт "Отключить экспортный файл" неактивен,
        внешний вид https://jing.yandex-team.ru/files/nightsonne/2022-02-07_15-37-02.png
    - do: открыть тестовую админку, раздел "Фиды" и подтвердить удаление фида
    - do: обновить страницу экспортных файлов
    - assert: |
        страница не содержит подключенных файлов/отключенного файла (если он был не один),
        внешний вид страницы без подключенных файлов https://jing.yandex-team.ru/files/nightsonne/2022-02-07_15-33-18.png

files:
  - features/news-partners/export_files/export_files.desktop.hermione.js

qa-engineer: kossakovskaya

manager: halilu

tags:
  - news-partners

tlds:
  - ru
