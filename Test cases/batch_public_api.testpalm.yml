feature: batch-ручка

specs:
  Работа batch-ручки:
    - do: запустить в Runner сценарий "batch-ручка" (https://github.yandex-team.ru/pixel/idm-runner)
    - do: отправить запрос "Запуск пакетных операций. 2 одинаковых get-запроса" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: запрос "Запуск пакетных операций. 2 одинаковых get-запроса" должен содержать поля "id" со значениями "rq1" и "rq2" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-24-20.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Запуск пакетных операций. POST и DELETE запросы" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: запрос "Запуск пакетных операций. POST и DELETE запросы" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-27-14.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "batch-ручка. Только обязательные поля" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: запрос "batch-ручка. Только обязательные поля" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-27-56.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Валидация полей batch-ручки:
    - do: запустить в Runner сценарий "batch-ручка" (https://github.yandex-team.ru/pixel/idm-runner)
    - do: отправить запрос "batch-ручка. Отсутствует обязательное поле path" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "400"
    - screenshot: запрос "batch-ручка. Отсутствует обязательное поле path" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-28-19.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "batch-ручка. Отсутствует обязательное поле method" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "400"
    - screenshot: запрос "batch-ручка. Отсутствует обязательное поле method" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-28-42.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "batch-ручка. Невалидный метод" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "400"
    - screenshot: запрос "batch-ручка. Невалидный метод" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-12%2015-29-04.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

priority: critical

files:
  - idm/tests/api/v1/test_batch.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:idm_backend_palmsync:idm/tests/api/v1/test_batch.py
  - fitcher:idm_backend_palmsync:idm/users/constants/user.py
  - fitcher:idm_backend_palmsync:idm/users/models.py
  - fitcher:idm_backend_palmsync:idm/core/models/system.py
  - fitcher:idm_backend_palmsync:idm/core/models/rolerequest.py
  - fitcher:idm_backend_palmsync:idm/core/models/role.py
  - fitcher:idm_backend_palmsync:idm/tests/utils.py
