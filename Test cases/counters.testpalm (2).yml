feature: Тестирование счётчиков

params:
  foreverdata: '2310953522'

specs:
  Должны выполниться запросы к ресурсам:
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая новостная страница — турбо)
    - assert: открывается турбо-страница в той же вкладке
    - tags: no_assessors
    - assert: должны выполниться запросы к ресурсам

  В логи должны записаться яндексовые счётчики:
    - automation: TURBO-701
    - tags: no_assessors
    - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая новостная страница — турбо)
    - assert: открывается турбо-страница в той же вкладке
    - tech: Проверка счетчика ссылки в заголовке (/turbo/header/link)
    - tech: Проверка счетчика кнопки на источник на странице (/turbo/reference/button)
    - assert: В логи должны записаться яндексовые счётчики

  В урле кастомного счетчика заменяются переменные:
    - do: открыть страницу /turbo?stub=counters/only_custom.json&exp_flags=analytics-disabled=0
    - tech: кастомный счетчик сработал, подставились верные параметры счетчика

  Пиксель метрики с page-url и без:
    - tags: no_assessors
    - do: открыть страницу /turbo?stub=tracking/with-metrika-pixel.json&exp_flags=analytics-disabled=0
    - assert: отработал пиксельный счетчик метрики  с урлом `https://mc.yandex.ru/watch/00000000` и параметром page-url, в котором лежит encodeURIComponent от урла открытой страницы
    - assert: отработал пиксельный счетчик метрики  с урлом `https://mc.yandex.ru/watch/0000` без дополнительных параметров

files:
  - features/common/pages/counters/counters.hermione.js

v-team: Turbo

manager: tanzwuta

qa-engineer: dakhetov, spv

tlds: none
