feature: Авторизация в шапке

specs-integration:
  Авторизация через паспорт:
    - tags:
        - smoke
    - do: почистить куки
    - do: получить выдачу по запросу 'окна'
    - assert: на странице есть быть кнопка 'Войти'
    - do: кликнуть на кнопку 'Войти'
    - assert: откроется passport.yandex.ru
    - do: ввести в поле Логин 'serp-autotests'
    - do: ввести в поле Пароль 'serpserp!'
    - do: нажать 'Войти'
    - assert: произошло перенаправление на выдачу по запросу 'окна' с иконкой пользователя
    - assertMetrics: '*'
  Мультиавторизация:
    - tags:
        - no_assessors
    - do: почистить куки
    - do: получить выдачу по запросу 'окна'
    - assert: на странице присутствует кнопка 'Войти'
    - do: кликнуть в кнопку 'Войти'
    - assert: открылась ссылка на passport.yandex.ru
    - do: ввести в поле Логин 'serp-autotests'
    - do: ввести в поле Пароль 'serpserp!'
    - do: нажать 'Войти'
    - assert: произошло перенаправление на выдачу по запросу 'окна' с иконкой пользователя
    - do: кликнуть на иконку пользователя
    - assert: |
        появилась выпадушка профиля,
        рядом с иконкой пользователя никнейм 'serp-autotests'
        других аккаунтов нет в выпадушке
    - do: кликнуть на 'Добавить аккаунт'
    - assert: открылась ссылка на passport.yandex.ru
    - do: ввести в поле Логин 'ivanovfortest2015'
    - do: ввести в поле Пароль '!serp_test'
    - do: нажать 'Войти'
    - assert: произошло перенаправление на выдачу по запросу 'окна' с иконкой пользователя
    - do: кликнуть на иконку пользователя
    - assert: |
        появилась выпадушка профиля,
        рядом с иконкой пользователя никнейм 'ivanovfortest2015'
        в выпадушке присутствует один дополнительный аккаунт
    - do: кликнуть 'Выйти' в выпадушке
    - assert: страница перезагрузилась,
    - do: кликнуть на иконку пользователя
    - assert: |
        появилась выпадушка профиля,
        рядом с иконкой пользователя никнейм 'serp-autotests'
        других аккаунтов нет в выпадушке
    - assertMetrics: '*'
  Смена аккаунта:
    - do: почистить куки
    - do: получить выдачу по запросу 'окна'
    - assert: на странице присутствует кнопка 'Войти'
    - do: кликнуть в кнопку 'Войти'
    - assert: открылась ссылка на passport.yandex.ru
    - do: ввести в поле Логин 'ivanovfortest2015'
    - do: ввести в поле Пароль '!serp_test'
    - do: нажать 'Войти'
    - assert: |
        произошло перенаправление на выдачу по запросу 'окна' с иконкой пользователя,
    - do: кликнуть на иконку пользователя
    - assert: |
        появилась выпадушка профиля,
        других аккаунтов нет в выпадушке
    - do: кликнуть на 'Добавить аккаунт'
    - assert: открылась ссылка на passport.yandex.ru
    - do: ввести в поле Логин 'serp-autotests'
    - do: ввести в поле Пароль 'serpserp!'
    - do: нажать 'Войти'
    - assert: |
        произошло перенаправление на выдачу по запросу 'окна' с иконкой пользователя,
    - do: кликнуть на иконку пользователя
    - assert: |
        появилась выпадушка профиля,
        в выпадушке присутствует один дополнительный аккаунт
    - do: кликнуть на дополнительный аккаунт над кнопкой 'Добавить аккаунт'
    - assert: страница перезагрузилась,
    - do: кликнуть на иконку пользователя
    - assert: |
        появилась выпадушка профиля,
        рядом с иконкой пользователя никнейм 'ivanovfortest2015'
    - assertMetrics: '*'

specs:
  Логин неизвестен:
    - tags:
        - smoke
    - do: в настройках браузера очистить кэш и удалить файлы cookie
    - do: получить выдачу по запросу 'окна'
    - screenshot: на странице есть ссылка создания аккаунта, кнопка авторизации [unknown-login]
    - do: проверить ссылку регистрации через devtools
    - assert: |
        href ссылки кнопки 'Регистрация' есть параметр 'origin=serp_desktop_auth_new',
        href ссылки кнопки 'Регистрация' ведет на passport.yandex.ru/registration,
        ссылка открывается в том же окне (происходит редирект на passport.yandex.ru/auth - это не баг)
    - tech: проверяем счётчик на ссылке регистрации /head/login/register
    - do: проверить ссылку авторизации через devtools
    - assert: |
        href ссылки кнопки 'Войти' есть параметр 'origin=serp_desktop_auth_new',
        href ссылки кнопки 'Войти' ведет на passport.yandex.ru/auth,
        ссылка открывается в том же окне
    - tech: проверяем счётчик на кнопке войти /head/login/login

files:
  - features/authorization/authorization@desktop.hermione.js
  - features/authorization/authorization@desktop.hermione.e2e.js

v-team: Lego

tags:
  - reviewed
  - zalogin
  - serp_header
  - popup

tlds: all

browsers:
  notFor:
    - android-yandex-browser-17-pad
    - android-yandex-browser-17-touch
    - ios-yandex-browser-17-pad
    - ios-yandex-browser-17-touch
