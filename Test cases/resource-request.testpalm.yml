feature: Запрос и выдача ресурсов

specs:
  beforeEach:
    - do: (PREPARE) запустить в Runner сценарий "scenario работа с ресурсами (запрос, отзыв, подтверждение)" (https://github.yandex-team.ru/pixel/abc-runner)
    - do: (PREPARE) проверить, что robot-internal-002 имеет роль "Заместитель руководителя сервиса" в сервисе с id=303 (/services/staff/)

 
  Запрос ресурса Баланса через ручку "api/v4/resources/financial_resources/":
    - do: отправить запрос "api/v4/resources/financial_resources/ Балансовый ресурс" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201" и полем "resource_type"=341
    - screenshot: ответ за запрос содержит поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2016-59-07.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Получить id ресурса для удаления" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Получить id ресурса для удаления" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-00-23.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удалить ресурс" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос содержит поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-00-54.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Запрос ресурса Метрики через ручку "api/v4/resources/financial_resources/":
    - do: отправить запрос "api/v4/resources/financial_resources/ Метрика" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201" и полем "resource_type"=273
    - screenshot: ответ за запрос содержит поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-03-01.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Получить id ресурса для удаления" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Получить id ресурса для удаления" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-03-40.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удалить ресурс" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос содержит поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-00-54.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Запрос ресурса Директа без менеджера через ручку "api/v4/resources/financial_resources/":
    - do: отправить запрос "api/v4/resources/financial_resources/ Директ" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201" и полем "resource_type"=306  
    - screenshot: ответ за запрос содержит поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-04-40.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Получить id ресурса для удаления" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Получить id ресурса для удаления" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-05-13.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удалить ресурс" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос содержит поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-00-54.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Запрос ресурса Директа с менеджером через ручку "api/v4/resources/financial_resources/":
    - do: отправить запрос "api/v4/resources/financial_resources/ Директ" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "201", полем "resource_type"=306 и полем "main_manager_passport_login"
    - screenshot: ответ за запрос содержит поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-06-34.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Получить id ресурса для удаления" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Получить id ресурса для удаления" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-05-13.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удалить ресурс" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос содержит поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-00-54.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Запрос и подтверждение ресурса робота через "api/v4/resources/request/ POST":
    - do: отправить запрос "api/v4/resources/request/ Запрос робота" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200" 
    - screenshot: ответ за запрос содержит поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-07-39.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Получить id ресурса для подтверждения" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-08-33.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Выдать ресурс /consumers/{id}/ PATCH" с токеном "robot-internal-002"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос содержит поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-09-53.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удалить ресурс робота" с токеном "robot-internal-002"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос содержит поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-00-54.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Запрос и удаление YP квоты через "api/v4/resources/request/ POST":
    - do: отправить запрос "api/v4/resources/request/ Запрос YP квоты" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200" 
    - screenshot: ответ за запрос содержит поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-11-17.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Получить id ресурса для удаления" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Получить id ресурса для удаления" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-12-11.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удалить ресурс" с токеном "robot-internal-002"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос содержит поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-00-54.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Запрос и удаление TVM-приложения через "api/v4/resources/request/ POST":
    - do: отправить запрос "api/v4/resources/request/ Запрос TVM приложения" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200" 
    - screenshot: ответ за запрос содержит поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-13-08.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Получить id ресурса для удаления" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос "Получить id ресурса для удаления" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-13-41.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Удалить ресурс" с токеном "robot-internal-002"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос содержит поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2017-00-54.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

priority: blocker

files:
  - tests/unit/resources/test_constructor.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:abc:src/blocks/desktop/resource-editor-form/**
  - fitcher:abc:src/blocks/desktop/resource-editor/**
  - fitcher:abc:src/blocks/desktop/resource-requester/**
  - fitcher:abc:src/blocks/desktop/resource-roles/**
  - fitcher:abc:src/blocks/desktop/resources/**
  - fitcher:abc:src/blocks/desktop/service-resources/**
  - fitcher:plan:tests/unit/resources/test_constructor.py
