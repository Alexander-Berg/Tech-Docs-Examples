feature: Пейджер

specs:
  aliases:
    - &CheckMetrics
      - assertMetrics:
          - web.reformulations_rate
          - web.total_rerequest_count
          - web.total_all_click
          - web.total_title_click
          - web.total_navurl_click
          - web.total_request_count
          - web.total_click_count
          - web.empty_query_rate
  На выдаче по пустому запросу пейджера нет:
    - tags:
        - smoke_extended
    - tlds: all
    - do: получить выдачу по пустому запросу
    - assert: на странице отсутствует пейджер
    - *CheckMetrics
  На выдаче по запросу ["вакансии" site:my.job.in] пейджера нет:
    - tags:
        - smoke_extended
    - tlds: all
    - do: получить выдачу по запросу '"вакансии" site:my.job.in'
    - assert: на странице отсутствует пейджер, см. скриншот [https://jing.yandex-team.ru/files/karinatsay/2021-11-26T12%3A29%3A25Z.d1ccd92.png]
    - *CheckMetrics
  Переключение страниц:
    - tags:
        - smoke
        - smoke_extended
    - tlds: all
    - do: получить выдачу по запросу 'вызвать врача'
    - screenshot: Проверить внешний вид пейджера (на доменах отличных от ru может осуществляться перевод) [first page]
    - tech: проверить счётчик показа ссылки 'дальше'
    - tech: проверить счётчик ссылки 'дальше'
    - do: |
        перейти по ссылке 'дальше'
        (на доменах отличных от ru может осуществляться перевод)
    - assert: в адресной строке стоит флаг p=1
    - screenshot: Проверить внешний вид пейджера (на доменах отличных от ru может осуществляться перевод) [second page]
    - tech: проверить счётчик показа ссылки '4'
    - tech: проверить счётчик ссылки '4'
    - do: перейти по ссылке '4'
    - screenshot: Проверить внешний вид пейджера (на доменах отличных от ru может осуществляться перевод)[fourth page]
    - assert: в адресной строке стоит флаг p=3
    - tech: проверить счётчик показа ссылки 'в начало'
    - tech: проверить счётчик ссылки 'в начало'
    - do: |
        перейти по ссылке 'в начало'
        (на доменах отличных от ru может осуществляться перевод)
    - assert: пользователю показывается выдача для первой страницы.
    - *CheckMetrics
  25-я страница:
    - tags:
        - smoke_extended
    - tlds: all
    - do: получить выдачу по запросу 'вызвать врача' с флагом p=24
    - screenshot: Проверить внешний вид пейджера (на доменах отличных от ru может осуществляться перевод) [25th page]
    - assert: страница 25 отмечена как активная
    - tech: проверить счётчик показа ссылки '24'
    - tech: проверить счётчик ссылки '24'
    - *CheckMetrics
  24-я страница:
    - tags:
        - smoke_extended
    - tlds: all
    - do: получить выдачу по запросу 'вызвать врача' с флагом p=23
    - screenshot: Проверить внешний вид пейджера (на доменах отличных от ru может осуществляться перевод) [24th page]
    - *CheckMetrics
  10-я страница:
    - tlds: all
    - do: получить выдачу по запросу 'вызвать сантехника' с флагом p=10
    - assert: страница 11 отмечена как активная
    - screenshot: Проверить внешний вид пейджера (на доменах отличных от ru может осуществляться перевод) [11th page]
    - tech: проверить счётчик показа ссылки '9'
    - tech: проверить счётчик ссылки '10'
    - do: перейти по ссылке '12'
    - assert: в адресной строке стоит флаг p=11, выдача изменилась
    - *CheckMetrics

specs-integration:
  На выдаче по пустому запросу пейджера нет:
    - do: получить выдачу по пустому запросу '
    - assert: не должно быть пейджера на странице
  На выдаче по запросу ["вакансии" site:my.job.in] пейджера нет:
    - do: получить выдачу по запросу '"вакансии" site:my.job.in'
    - assert: не должно быть пейджера на странице
    - *CheckMetrics
  Переключение страниц:
    - do: получить выдачу по запросу 'вызвать врача'
    - assert: присутствует ссылка 'дальше' в пейджере
    - counter: /$page/$main/$pager/button-next
    - do: перейти по ссылке 'дальше'
    - assert: в адресной строке должен быть флаг p=1
    - assert: присутствует ссылка '4' в пейджере
    - counter: /$page/$main/$pager/button[@pagenum=3]
    - do: перейти по ссылке '4'
    - assert: в адресной строке должен быть флаг p=3
    - assert: присутствует ссылка 'В начало' в пейджере
    - counter: /$page/$main/$pager/button-begin
    - do: перейти по ссылке 'в начало'
    - assert: по нажатию на кнопку 'в начало' открывается первая страница выдачи
    - *CheckMetrics

files:
  - features/pager/pager@deskpad.hermione.js
  - features/pager/pager@deskpad.hermione.e2e.js

v-team: Beauty

priority: high

tags:
  - reviewed

tlds: none
