feature: Турбо
experiment: Беcкуковый домен турбо-страниц на серпе

specs:
  Технические параметры:
    Флаг turbo-host=hmstr заменяет домен на *.hamster.turbopages.org:
      - params:
          exp_flags:
            - 'turbo-turbopages-org=1'
            - 'turbo-host=hmstr'
          rearr:
            - scheme_Local/TurboPageChecker/CheckHostSaas=1
            - scheme_Local/TurboPageChecker/CheckPublisherDomain=1
            - scheme_Local/TurboUrls/AllowTurbopagesDomain=1
      - do: получить выдачу по запросу 'lenta ru'
      - assert: слайдер с турбо сниппетами появился на выдаче
      - do: кликнуть на первый сниппет
      - assert: турбо-страница открылась в оверлее
      - assert: в адресной строке url начинается с 'https://lenta-ru.hamster.turbopages.org/'

  Turbopages.org для lenta.ru:
    Ссылка оверлея ведет на turbopages.org:
      - params:
          exp_flags: 'turbo-turbopages-org=1'
          rearr:
            - scheme_Local/TurboPageChecker/CheckHostSaas=1
            - scheme_Local/TurboPageChecker/CheckPublisherDomain=1
            - scheme_Local/TurboUrls/AllowTurbopagesDomain=1
      - do: получить выдачу по запросу 'lenta ru'
      - assert: слайдер с турбо сниппетами появился на выдаче
      - do: кликнуть на первый сниппет
      - assert: турбо-страница открылась в оверлее
      - assert: в адресной строке url начинается с 'https://lenta-ru.turbopages.org/'

  Turbopages.org для povar.ru:
    Ссылка оверлея ведет на turbopages.org:
      - params:
          exp_flags: 'turbo-turbopages-org=1'
          rearr:
            - scheme_Local/TurboPageChecker/CheckHostSaas=1
            - scheme_Local/TurboPageChecker/CheckPublisherDomain=1
            - scheme_Local/TurboUrls/AllowTurbopagesDomain=1
      - do: получить выдачу по запросу 'рецепт борща'
      - assert: сниппет с турбо-кнопкой "Посмотреть рецепт" появился на выдаче
      - do: кликнуть на конпку "Посмотреть рецепт"
      - assert: турбо-страница открылась в оверлее
      - assert: в адресной строке url начинается с 'https://povar-ru.turbopages.org/'

  Кастомный домен turbo.gazeta.ru:
    Открывается в новой вкладке:
      - params:
          exp_flags: 'turbo-turbopages-org=1'
          rearr:
            - scheme_Local/TurboPageChecker/CheckHostSaas=1
            - scheme_Local/TurboPageChecker/CheckPublisherDomain=1
            - scheme_Local/TurboUrls/AllowPublisherDomain=1
      - do: получить выдачу по запросу 'газета ру'
      - assert: слайдер с плиткой турбо-сниппетов появился на выдаче
      - do: кликнуть по первой плитке
      - assert: турбо-страница открылась в новой вкладке
      - assert: в адресной строке url начинается с 'https://turbo.gazeta.ru/'

  Overlay:
    Подменяет домен при показе страницы (Multipage):
      - automation: SERP-111735
      - tags:
          - skip_manual_check
      - browsers:
        - ios-yandex-browser-17-touch
        - android-yandex-browser-17-touch
      - params:
          exp_flags: 'turbo-turbopages-org=1'
          rearr:
            - scheme_Local/TurboPageChecker/CheckHostSaas=1
            - scheme_Local/TurboPageChecker/CheckPublisherDomain=1
            - scheme_Local/TurboUrls/AllowPublisherDomain=1
      - do: получить выдачу по запросу 'новости'
      - do: найти новостной bno и кликнуть по плитке с турбо-страницей
      - assert: |
          открылся overlay-multipage
          в омнибоксе отображается хост открытого паблишера
      - do: кликнуть в омнибокс
      - assert: в омнибоксе адрес паблишера, ведущий на turbopages.org
    Подменяет домен при показе страницы (singlepage):
      - automation: SERP-111735
      - tags:
          - skip_manual_check
      - browsers:
          - ios-yandex-browser-17-touch
          - android-yandex-browser-17-touch
      - params:
          exp_flags:
            - turbo-slider-organic=null
            - turbo-turbopages-org=1
          rearr:
            - scheme_Local/TurboPageChecker/CheckHostSaas=1
            - scheme_Local/TurboPageChecker/CheckPublisherDomain=1
            - scheme_Local/TurboUrls/AllowPublisherDomain=1
      - do: получить выдачу по запросу 'сколько сидел давидыч'
      - assert: виден колдунщик фактов
      - do: кликнуть ссылку в колдунщике
      - assert: |
          открылся overlay-iframe
          в омнибоксе отображается хост открытого паблишера
      - do: кликнуть в омнибокс
      - assert: в омнибоксе адрес паблишера, ведущий на turbopages.org
      - do: листать статью вниз, пока не будет видно следующую статью
      - do: кликнуть в омнибокс
      - assert: в омнибоксе адрес текущей статьи в бесконечной ленте, ведущий на turbopages.org

files:
  - features/touch-phone/turbo/turbo-turbopages-org.hermione.js

tags:
  - turbo
  - no_assessors
  - skip_e2e_check
  - overlay

v-team: Turbo

priority: normal

tlds: all
