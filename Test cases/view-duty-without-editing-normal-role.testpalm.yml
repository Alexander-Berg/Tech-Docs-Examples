feature: Дежурства

specs:
  beforeEach:
    - tech: залогиниться пользователем robot-abc-001
  
  Просмотр графиков дежурств:
    Положительные:
      1. Под ролью штатного сотрудника, не имеющего прав на редактирование дежурства:
       - automation: ABC-9976
       - do: открыть вкладку "О сервисе" в таб-меню на странице сервиса "Duty testing" (/services/duty_testing/)
       - screenshot: среди выданных в команде ролей у текущего пользователя нет ролей [https://jing.yandex-team.ru/files/zomb-prj-204/Screenshot%20from%202021-04-06%2013-52-03.png]
       - do: открыть вкладку "График дежурств" в таб-меню на странице сервиса "Duty testing" (/services/duty_testing/duty/)
       - assert: |
               отображен график "Тестовый",
               отсутствуют кнопки "Изменение расписания" и "Настроить график дежурств" под таб-меню
       - screenshot: настроенное расписание с отсутствием кнопок редактирования [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-02-17.png]
       - do: навести указатель мыши на любую смену в графике
       - assert: |
               появилось всплывающее окно с краткой информацией о смене,
               в правом верхнем углу окна отсуствует "карандашик"
       - screenshot: всплывающее окно с информацией о смене [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-03-13.png]

      2. Переключение между графиками:
        - automation: ABC-10827
        - do: открыть страницу "График дежурств" сервиса "autotest-several-duties" (/services/autotest-several-duties/duty)
        - screenshot: на странице над графиками присутствуют фильтры по дате, продолжительности, графикам [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-06-32.png]
        - do: кликнуть на фильтр "Все графики"
        - screenshot: появился выпадающий список с вариантом "Все графики" и списком имеющихся в сервисе графиков [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-07-32.png]
        - do: кликнуть на вариант "дежурство №2"
        - assert: |
               на фильтре по дежурствам написано "дежурство №2"
               на странице показан только один график дежурств - "дежурство №2"

      3. Копирование ссылки на конкретный график:
        - automation: ABC-10827
        - do: открыть страницу "График дежурств" сервиса "autotest-several-duties" (/services/autotest-several-duties/duty)
        - do: проскроллить страницу и найти на ней график дежурств "дежурство №2"
        - screenshot: рядом с названием дежурства есть квадратная кнопка для копирования ссылки на график [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-05-27%2013-55-48.png]
        - do: кликнуть на кнопку копирования графика
        - screenshot: появилась подсказка на зелёном фоне "Скопировано (ссылка на график)" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-05-27%2013-56-59.png]
        - do: открыть новую вкладку
        - do: вставить из буфера обмена скопированную ссылку и перейти по ней
        - assert: |
               открылся график дежурств "дежурство №2"
               на странице показан только график "дежурство №2"
               в URL есть параметр "role" с непустым значением

      4. Изменение даты начала отображения графиков:
        - automation: ABC-10827
        - do: открыть страницу "График дежурств" сервиса "autotest-several-duties" (/services/autotest-several-duties/duty)
        - screenshot: на странице над графиками присутствует фильтр по дате, в котором выбрано сегодняшнее число в формате "дд мес гггг"; графики на странице начинают отображаться также с сегодняшнего числа [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-05-27%2014-04-37.png]
        - do: кликнуть на фильтр по дате
        - assert: появился календарь, в котором выбрана сегодняшняя дата
        - do: кликнуть на любую дату из календаря, кроме сегодняшней
        - assert: |
               в фильтре указана выбранная дата в формате "дд мес гггг"
               графики начинают отображаться с выбранной даты
               в URL есть параметр вида "?date=ддммгггг", где ддммгггг - выбранная дата

      5. Изменение периода отображения графиков:
        - automation: ABC-10827
        - do: открыть страницу "График дежурств" сервиса "autotest-several-duties" (/services/autotest-several-duties/duty)
        - screenshot: на странице над графиками присутствует фильтр по периоду отображения, выбранное значение - 2 месяца [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-09-37.png]
        - do: кликнуть на фильтр по периоду
        - assert: появился выпадающий список вариантов "На 1 месяц", "На 2 месяца", "На полгода"
        - do: кликнуть на вариант "На 1 месяц"
        - screenshot: в фильтре указано выбранное значение - "На 1 месяц", на графиках показаны смены за 1 месяц [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-11-10.png]

      6. Фильтрация по дежурным в графике:
        - automation: ABC-11008
        - do: открыть страницу "График дежурств" сервиса "autotest-several-duties" с предустановленным фильтром (/services/autotest-several-duties/duty?interval=P1M)
        - screenshot: на странице над графиками присутствует фильтр "Все дежурные" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-21-38.png]
        - do: кликнуть в поле "Все дежурные"
        - assert: появился выпадающий список с доступными дежурными 
        - do: кликнуть по любому дежурному из списка
        - assert: |
             выбранный дежурный появился в фильтре, 
             в фильтре нет надписи "Все дежурные", вместо неё написано "Ещё дежурные",
             страница обновилась, показаны графики и смены только с выбранным дежурным 
        - screenshot: примерный вид отфильтрованных по дежурному графиков [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-25-01.png]
        - do: кликнуть в фильтр по дежурным
        - assert: появился выпадающий список с доступными дежурными 
        - do: кликнуть по любому дежурному из списка
        - assert: в фильтре показаны оба выбранных дежурных; страница обновилась, показаны графики и смены только для выбранных дежурных
        - screenshot: примерный вид отфильтрованных по двум дежурным графиков [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-27-56.png]
        - do: очистить фильтр с дежурными
        - assert: |
             фильтр очистился, в нём есть плейсхолдер "Все дежурные",
             страница обновилась, показаны все графики в сервисе - "дежурство №1", "дежурство №2", "дежурство №3"

      7. Фильтрация по себе недоступна, если пользователь не дежурит ни в одном из графиков:
        - automation: ABC-11008
        - do: открыть страницу "График дежурств" сервиса "autotest-several-duties" (/services/autotest-several-duties/duty)
        - screenshot: на странице над графиками есть фильтр "Все дежурные", справа от него есть кнопка "Я" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-38-19.png]
        - assert: кнопка недоступна для кликов 

      8. Фильтрация по себе: 
        - automation: ABC-11008
        - tags: 
          - no_assessors
        - do: открыть страницу "График дежурств" сервиса "autotest-duty-filters" (/services/autotest-duty-filters/duty)
        - screenshot: на странице над графиками есть фильтр "Все дежурные", справа от него есть кнопка "Я" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-50-14.png]
        - do: кликнуть на кнопку "Я" 
        - assert: |
              в фильтр подставился пользователь "Базовая Роль", рядом написано "Ещё дежурные",
              страница обновилась, показан только один график "дежурство №1" со сменами пользователя "Базовая роль"
        - screenshot: отфильтрованные графики [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-52-20.png]

      9. Сброс выбранных в фильтре дежурных при выборе себя: 
        - automation: ABC-11008
        - tags: 
          - no_assessors
        - do: открыть страницу "График дежурств" сервиса "autotest-duty-filters" (/services/autotest-duty-filters/duty)
        - screenshot: на странице над графиками есть фильтр "Все дежурные", справа от него есть кнопка "Я" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-50-14.png]
        - do: кликнуть в поле "Все дежурные"
        - assert: появился выпадающий список с дежурными
        - do: выбрать дежурного "abc-robot full-access"
        - assert: в фильтр подставился дежурный "abc-robot full-access", страница обновилась, показаны графики "дежурство №1" и "дежурство №2"
        - do: кликнуть на кнопку "Я" 
        - assert: |
              из фильтра пропал пользователь "abc-robot full-access", 
              в фильтр подставился пользователь "Базовая Роль", рядом написано "Ещё дежурные",
              страница обновилась, показан только один график "дежурство №1" со сменами пользователя "Базовая роль"
        - screenshot: отфильтрованные графики [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-01%2017-52-20.png]


files: []

priority: blocker

tags: 
  - reviewed
