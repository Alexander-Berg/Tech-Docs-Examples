feature: ЖД
type: Выдача
description: |-
  Перейти на главную сервиса
  Перейти на вкладку Ж/Д билеты
specs:
  'ЖД: Сниппеты с пересадками на выдаче':
    - do: Открыть консоль браузера
    - do: >-
        Перейти на вкладку ЖД

        Открыть выдачу Москва - Тихвин на завтра с прописанным параметром для
        метрики ?_ym_debug=1 (если нет рейсов с пересадками, поискать на другую
        дату)
    - assert: |-
        * Открылась выдача
        * Есть сообщение: Найдены маршруты только с пересадками.
        * Верстка в сниппетах не едет
        * На выдаче все рейсы только с пересадками
        * Для каждого сниппета указан вокзал пересадки и время пересадки
        * В консоли есть событие в метрику: trains_transfers_shown
        * Сниппет выглядит так:
        ![](https://jing.yandex-team.ru/files/jjon89/2021-07-17_17-42-14.png)
    - do: >-
        Для одного из маршрутов посчитать время пересадки (время от прибытия на
        станцию пересадки до отбытия)
    - assert: '* Получившееся время совпадает со временем указанным между рейсами'
    - do: Кликнуть по ссылке Маршрут и цены
    - assert: >-
        - Развернулся маршрут с двумя сниппетами

        - Информация совпадает с общим сниппетом: время отправления/прибытия,
        время и город пересадки, смена вокзала если есть

        - Общая цена ОТ равна сумме минимальных цен за два сниппета:

        ![](https://jing.yandex-team.ru/files/jjon89/2021-07-17_18-37-40.png)
    - do: >-
        Открыть выдачу с пересадками, где не у всех рейсов есть кнопки покупки
        (можно поискать на направлениях: Серов - Ростов-на-Дону,  Пермь - Анапа
        на разные даты):

        ![image](https://jing.yandex-team.ru/files/shenfeld/2020-12-03_13.50.25-0y4e8.png)
    - assert: >-
        * В консоли есть событие в метрику searchTransfersWithoutPrice с
        параметром searchTransfersWithoutPricePercentage со значением, равным
        проценту сегментов без цен (то есть в примере на скрине это должно быть
        50, если совсем нет цен, должно быть 100).
manual: true
Функциональность: Содержание выдачи
Устройство: Десктоп
Страница: Выдача
Сервис: ЖД
Тестирование асессорами: Да
Окружение:
  - Production
  - Testing
Автор: shenfeld
