feature: Обработка запросов ролей

specs:
  Положительные:
    1. Отклонение непосредственного запроса роли со страницы "Подтверждения":
      - do: (PREPARE) залогиниться пользователем robot-internal-003
      - do: (PREPARE) открыть сервис "Автотестовый сервис для запроса ролей 1" (/services/autotestserviceforrolereq1/)
      - do: (PREPARE) через плюсик около заголовка "Команда" запросить роль "DevOps" для пользователя robot-abc-003
      - do: залогиниться пользователем robot-abc-001
      - do: открыть страницу "Подтверждения" на табе "Роли" (/approves/roles/)
      - screenshot: по умолчанию выбран переключатель "Непосредственные", в таблице есть запрос на подтверждение роли для сотрудника "abc-robot service-viewer" [roles-request-for-decline]
      - do: в столбце "Действия" кликнуть на значок "палец вниз"
      - assert: покрутился спиннер, строка с запросом из таблицы пропала
      - do: (PREPARE) открыть сервис "Автотестовый сервис для запроса ролей 1" (/services/autotestserviceforrolereq1/)
      - assert: (PREPARE) |
              в списке ролей "DevOps" не появился пользователь "abc-robot service-viewer"
              на странице нет плашки с запросом роли "DevOps" для пользователя "abc-robot service-viewer"

    2. Одобрение запроса роли с учётом иерархии со страницы "Подтверждения":
      - do: (PREPARE) залогиниться пользователем robot-internal-003
      - do: (PREPARE) открыть сервис "Автотестовый сервис для запроса ролей N2" (/services/autotestserviceforrolereqn2/)
      - do: (PREPARE) через плюсик около заголовка "Команда" запросить роль "DevOps" для пользователя robot-abc-004
      - do: залогиниться пользователем robot-abc-001
      - do: открыть страницу "Подтверждения" на табе "Роли" (/approves/roles/)
      - screenshot: выбран переключатель "Непосредственные", запросов ролей нет [direct-roles-request]
      - do: кликнуть на переключатель "С учетом иерархии"
      - assert: |
              выбран переключатель "С учетом иерархии"
              в таблице есть запрос на подтверждение роли для сотрудника "abc-robot own-only-viewer"
      - screenshot:  запрос на подтверждение роли для сотрудника "abc-robot own-only-viewer" [roles-request-for-approve]
      - do: в столбце "Действия" кликнуть на значок "палец вверх"
      - assert: покрутился спиннер, строка с запросом из таблицы пропала
      - do: (PREPARE) открываем сервис "Автотестовый сервис для запроса ролей N2" (/services/autotestserviceforrolereqn2/)
      - assert: (PREPARE) в списке ролей "DevOps" появился пользователь "abc-robot own-only-viewer"
      - do: (PREPARE) удалить пользователя "abc-robot own-only-viewer" из команды через клик на иконку корзины рядом с ролью "DevOps" 

files:
  - test/features/desktop/approves/roles-approves.hermione.js

priority: blocker

tags:
  - reviewed
  - no_assessors
