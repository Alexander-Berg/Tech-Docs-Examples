feature: Ресурсы
type: Общая страница ресурсов

specs:
  beforeEach: 
    - tech: залогиниться под пользователем robot-abc-001
    - do: открыть страницу "Ресурсы" (/resources/)

  Все ресурсы АВС:
    1. Успешный поиск ресурсов:
      - automation: ABC-10999
      - do: в строке поиска ресурсов написать "autotest-secrets"
      - do: нажать кнопку "Найти"
      - assert: |
            страница обновилась, показан список ресурсов
            в списке ресурсов только те ресурсы, которые содержат в имени "autotest-secrets"
            в строке поиска осталось введённое значение "autotest-secrets"
      - screenshot: в списке ресурсов только ресурсы, содержащие в имени "autotest-secrets" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2012-03-47.png]

    2. Ресурсов в результате поиска не нашлось:
      - automation: ABC-10999
      - do: в строке поиска ресурсов написать "несуществующий ресурс"
      - do: нажать кнопку "Найти"
      - screenshot: страница обновилась; в строке поиска осталось введённое значение "несуществующий ресурс"; показана надпись "Ничего не найдено" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2012-04-26.png]

    3. Экспорт ресурсов в CSV:
      - automation: ABC-10999
      - do: открыть страницу Ресурсов с предустановленными фильтрами (/resources/?service=3838)
      - do: кликнуть на кнопку "Экспорт в CSV"
      - screenshot: появилась подсказка на зелёном фоне с текстом "Письмо поставлено в очередь на отправку" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2012-11-13.png]

    4. Экспорт ресурсов в CSV невозможен для очень большой выборки:
      - automation: ABC-10999
      - do: кликнуть на кнопку "Экспорт в CSV"
      - screenshot: появилась подсказка на красном фоне, в которой есть текст "Отправка на почту возможна только для выборок с размеров меньше 100000" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2012-06-30.png]

    5. Запрос, редактирование и отклонение ресурса:
      - automation: ABC-10999
      - do: кликнуть на кнопку "Запросить ресурс"
      - screenshot: появилась форма запроса ресурса, поля "Для какого сервиса" и "Выберите тип" пустые [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2012-20-41.png]
      - do: ввести в поле "Для какого сервиса" значение "5196"
      - assert: появился выпадающий список с названиями сервисов
      - do: выбрать сервис "autotest-add-tags-for-resources"
      - assert: в поле "Для какого сервиса" подставилось значение "autotest-add-tags-for-resources"
      - do: кликнуть в поле "Выберите тип"
      - assert: появился список доступных типов ресурсов 
      - do: выбрать вариант "Паспорт — HistoryDB API"
      - screenshot: появилась форма для запроса ресурса [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-09-09%2015-33-34.png]
      - do: отметить в форме галочкой пункт "account.events – Получение истории изменения аккаунта"
      - do: кликнуть на кнопку "Отправить"
      - screenshot: в форме появилась надпись "Ресурс запрошен" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-09-09%2015-34-13.png]
      - do: открыть страницу Ресурсов с предустановленным фильтром по сервису-потребителю "autotest-add-tags-for-resources" (/resources/?service=5196) 
      - assert: в списке ресурсов появился ресурс "HistoryDB API" в статусе "Подтверждён"
      - do: кликнуть на многоточие в строке с подтверждённым ресурсом "HistoryDB API"
      - screenshot: появился попап с пунктами "Удалить", "Редактировать" и "Посмотреть" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-09-09%2015-35-49.png]
      - do: кликнуть на пункт "Редактировать"
      - screenshot: открылось окно "Редактирование ресурса" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-09-09%2015-36-33.png]
      - do: поставить галочку напротив пункта "account.auths – Получение истории авторизаций"
      - do: кликнуть на кнопку "Отправить"
      - screenshot: в окне "Редактирование ресурса" появилась надпись "Ресурс запрошен" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-09-09%2015-37-06.png]
      - do: закрыть окно "Редактирование ресурса"
      - assert: в списке ресурсов появился ещё один ресурс "HistoryDB API" в статусе "Подтверждён"
      - do: кликнуть на многоточие в строке с первым подтверждённым ресурсом "HistoryDB API"
      - screenshot: появился попап с пунктами "Удалить", "Редактировать" и "Посмотреть" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-09-09%2015-35-49.png]
      - do: кликнуть на пункт "Удалить"
      - assert: у ресурса сменился статус на "Отозван"
      - do: удалить второй подтверждённый ресурс "HistoryDB API"
      - assert: ресурс удалён, в списке нет подтверждённых ресурсов "HistoryDB API"

    6. Сортировка ресурсов по изменению:
      - automation: ABC-10999
      - screenshot: в таблице с ресурсами у заголовка "Изменен" стрелочка направлена вниз [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2013-04-23.png]
      - do: кликнуть на заголовок "Изменен"
      - assert: |
            стрелочка у заголовка "Изменен" направлена вверх,
            в URL появился параметр "ordering=modified_at",
            в списке ресурсы отсортированы от самой старой даты изменения к более новой

files: []

priority: critical

tags:
  - no_assessors
  - reviewed
