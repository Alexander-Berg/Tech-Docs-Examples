feature: Отчёты

specs:
  Отчёты (верхнее меню). Действия. Различные способы фильтрации и сортировки:
    - do: запустить в Runner сценарий "Отчёты (верхнее меню). Действия" (https://github.yandex-team.ru/pixel/idm-runner)
    - do: отправить запрос "Отчёты. Действия. Фильтрация по датам" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе на запрос "Отчёты. Действия. Фильтрация по датам" все поля "added" должны быть в диапазоне с 2020-04-10 по 2020-04-11 [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2015-56-22.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Отчёты. Действия. Фильтрация по Стаффу. Сотрудник" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе на запрос "Отчёты. Действия. Фильтрация по Стаффу. Сотрудник" каждая запись должна содержать "username"="robot-internal-1" либо в "requester", либо в "user" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2015-58-18.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Отчёты. Действия. Фильтрация по системе" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе запрос "Отчёты. Действия. Фильтрация по системе" каждая запись должна содержать "slug"="testsystem" в "system" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2016-51-56.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Отчёты. Действия. Фильтрация по типу действий" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: в ответе на запрос "Отчёты. Действия. Фильтрация по типу действий" все поля "action" должны иметь значение "grant" или "deprive" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2016-53-22.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Отчёты. Действия. Фильтрация по id действия" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ запрос "Отчёты. Действия. Фильтрация по id действия" должен содержать одну запись с id=4386511596 [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2016-54-15.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Отчёты. Действия. Фильтрация без результата" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ запрос "Отчёты. Действия. Фильтрация без результата" должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-02-04%2016-54-39.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

priority: critical

files:
  - idm/tests/api/frontend/test_action.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:idm-www:test/e2e/my-roles-actions-tab/**
  - fitcher:idm-www:test/auto/my-roles-actions-tab/**
  - fitcher:idm-www:blocks/desktop/filters/**
  - fitcher:idm-www:blocks/desktop/table/**
  - fitcher:idm_backend_palmsync:idm/tests/api/frontend/test_action.py
  - fitcher:idm_backend_palmsync:idm/core/models/action.py
  - fitcher:idm_backend_palmsync:idm/core/models/role.py
  - fitcher:idm_backend_palmsync:idm/core/models/rolefield.py
  - fitcher:idm_backend_palmsync:idm/core/models/transfer.py
  - fitcher:idm_backend_palmsync:idm/core/models/groupmembershipsystemrelation.py
  - fitcher:idm_backend_palmsync:idm/core/constants/system.py
  - fitcher:idm_backend_palmsync:idm/inconsistencies/models.py
  - fitcher:idm_backend_palmsync:idm/users/models.py
  - fitcher:idm_backend_palmsync:idm/tests/utils.py
