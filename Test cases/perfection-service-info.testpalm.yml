feature: Светофоры идеальности

specs:
  aliases:
    - &openServiceResponsiblesModal
      - do: (PREPARE) открыть сервис "Автотестовый сервис с отрицанием проблем" (/services/autotest-not-a-problem/) 
      - do: (PREPARE) кликнуть на иконку карандашика рядом с надписью "Управляющие" 
      - screenshot: (PREPARE) карандашик рядом с надписью "Управляющие" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-20%2016-07-37.png]
      - assert: (PREPARE) появилась модалка "Редактирование управляющих"
    - &addUser
      - do: (PREPARE) в модалке "Редактирование управляющих" в поле "Добавить сотрудника" ввести свои имя и фамилию 
      - do: (PREPARE) под полем появился выпадающий список вариантов 
      - do: (PREPARE) выбрать в выпадающем списке себя 
      - assert: (PREPARE) в блоке "Управляющие" появился выбранный сотрудник 
      - do: (PREPARE) кликнуть на кнопку "Сохранить"
    - &deleteUser
      - do: (PREPARE) кликнуть на иконку корзины рядом со своими именем-фамилией
      - assert: (PREPARE) пользователь пропал из списка
      - do: (PREPARE) кликнуть на кнопку "Сохранить"

  Положительные:
    1. Пользователь с ограниченной ролью не видит светофор идеальности:
      - tags:
        - no_assessors
      - tech: залогиниться пользователем robot-abc-003
      - do: открыть страницу сервиса "Автотестовый сервис" (/services/autotestservice2309/)
      - screenshot: в правой части блока с заголовком сервиса нет информера "Состояние сервиса" и розовой плашки с найденными проблемами [service-header-by-robot-abc-003]

    2. Пользователь с сильно ограниченной ролью не видит светофор идеальности:
      - tags:
        - no_assessors
      - tech: залогиниться пользователем robot-abc-004
      - do: открыть страницу сервиса "Автотестовый сервис" (/services/autotestservice2309/)
      - screenshot: в правой части блока с заголовком сервиса нет информера "Состояние сервиса" и розовой плашки с найденными проблемами [service-header-by-robot-abc-004]
    
    3. Пользователь с базовой ролью может открыть модалку светофора через "Состояние сервиса":
      - tech: залогиниться пользователем robot-abc-001
      - do: открыть страницу сервиса "Автотестовый сервис" (/services/autotestservice2309/)
      - screenshot: в правой части блока с заголовком сервиса есть информер "Состояние сервиса" и розовая плашка с найденными проблемами [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-07-20%2015-46-57.png]
      - do: навести курсор на информер
      - assert: появился попап с подробной информацией о состоянии сервиса
      - do: кликнуть на второй слева квадратик в информере
      - assert: |
              открылась модалка "Состояние сервиса Автотестовый сервис"
              в урле появились параметры "perfection_details" и "issuesGroup=clarity" 
      - screenshot: модалка "Состояние сервиса Автотестовый сервис", выбран таб "Понятность" [clarity-tab-in-modal]

    4. Переключение между вкладками в модалке светофора идеальности:
      - tech: залогиниться пользователем robot-abc-001
      - do: открыть страницу сервиса "Автотестовый сервис" сразу с модалкой "Состояние сервиса" (/services/autotestservice2309/?perfection_details=52&issuesGroup=children)
      - assert: показана информация по критерию "Актуальное состояние вложенных сервисов"
      - do: кликнуть в меню в левой части модалки на таб "Понятность"
      - assert: |
              показана информация по критериям "Описание сервиса на русском языке" и "Описание сервиса на английском языке"
              в урле параметры "issuesGroup" поменял значение на "clarity"
      - do: кликнуть в меню в левой части модалки на таб "Ресурсы"
      - assert: в урле параметры "issuesGroup" поменял значение на "resources"
      - screenshot: показана информация по критериям "Наличие управляющего роботами", "Наличие ответственных за сертификаты", "Наличие ответственных за оборудование на балансе сервиса" [resources-tab]
      - do: кликнуть в меню в левой части модалки на таб "Структура"
      - assert: в урле параметры "issuesGroup" поменял значение на "structure"
      - screenshot: показана информация по критериям "Структура базовых сервисов", "Консистентная структура Градиента", "Сервисы поискового портала под value streams" [structure-tab]
      - do: кликнуть в меню в левой части модалки на таб "Команда"
      - assert: в урле параметры "issuesGroup" поменял значение на "team"
      - screenshot: показана информация по критериям "Робот не может быть Руководителем сервиса", "Руководитель сервиса известен" [team-tab]
      - do: кликнуть в меню в левой части модалки на таб "Сообщения о проблемах"
      - assert: в урле параметры "issuesGroup" поменял значение на "complaints"
      - screenshot: заглушка "Пользователи пока не сообщали о проблемах в сервисе" [complaints-tab]

    5. Возможность открыть модалку светофора идеальности через плашку с найденными проблемами:
      - tech: залогиниться пользователем robot-abc-001
      - do: открыть страницу сервиса "Автотестовый сервис" (/services/autotestservice2309/)
      - assert: в правой части блока с заголовком сервиса есть розовая плашка с найденными проблемами
      - screenshot: на розовой плашке написано, что в сервисе есть 5 проблем [problems-description]
      - do: кликнуть на кнопку "Исправить"
      - assert: |
              открылась модалка "Состояние сервиса Автотестовый сервис" на табе "Вложенные сервисы"  
              в урле появился параметр "perfection_details=52"
      - screenshot: cумма чисел, указанных в квадратах рядом с названиями критериев в модалке, также равна 5 [opened-modal-with-problems]
    
    6. Подача апелляции через модалку светофора идеальности:
      - tech: залогиниться пользователем robot-abc-002
      - *openServiceResponsiblesModal
      - *addUser
      - do: открыть страницу сервиса "Автотестовый сервис с отрицанием проблем" сразу с модалкой "Состояние сервиса" (/services/autotest-not-a-problem/?perfection_details=122&issuesGroup=clarity)
      - assert: |
            открылась модалка "Состояние сервиса Автотестовый сервис с отрицанием проблем",
            в модалке выбран таб "Понятность",
            показаны два критерия - "Описание сервиса на русском языке" и "Описание сервиса на английском языке";
            внизу модалки есть кнопка "Не считаю проблемой"
      - do: кликнуть на кнопку "Не считаю проблемой"
      - assert: в модалке появилось поле ввода "Не считаю проблемой" с пояснением "Обоснование будет отправлено на проверку руководителю вышестоящего сервиса"; кнопка "Отправить" задизейблена
      - do: ввести текст "Тестовый текст с отрицанием проблемы" в поле ввода "Не считаю проблемой"
      - assert: текст ввёлся, кнопка "Отправить" стала доступна
      - do: кликнуть на кнопку "Отправить"
      - assert: покрутился спиннер, поле для ввода пропало, кнопка "Не считаю проблемой" осталась внизу модалки      
      - *openServiceResponsiblesModal
      - *deleteUser

    7. Отмена подачи апелляции через модалку светофора идеальности:
      - tech: залогиниться пользователем robot-abc-002
      - *openServiceResponsiblesModal
      - *addUser
      - do: открыть страницу сервиса "Автотестовый сервис с отрицанием проблем" сразу с модалкой "Состояние сервиса" (/services/autotest-not-a-problem/?perfection_details=122&issuesGroup=clarity)
      - assert: |
            открылась модалка "Состояние сервиса Автотестовый сервис с отрицанием проблем",
            в модалке выбран таб "Понятность",
            показаны два критерия - "Описание сервиса на русском языке" и "Описание сервиса на английском языке";
            внизу модалки есть кнопка "Не считаю проблемой"
      - do: кликнуть на кнопку "Не считаю проблемой"
      - assert: в модалке появилось поле ввода "Не считаю проблемой"
      - do: кликнуть на серую надпись "Отмена" (рядом с кнопкой "Отправить")
      - assert: поле для ввода пропало, кнопка "Не считаю проблемой" осталась внизу модалки  
      - *openServiceResponsiblesModal
      - *deleteUser

files: 
  - test/features/desktop/perfection/perfection-service-info.hermione.js

priority: blocker

tags:
  - reviewed
