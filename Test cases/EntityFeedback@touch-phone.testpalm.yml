feature: Объектный ответ
type: Шторка жалоб

specs-integration:
  Проверка жалобщика:
    - do: получить выдачу по запросу 'мадонна'
    - assert: |
        на выдаче есть карточка объектного ответа,
        в карточке объектного ответа есть футер,
        в футере присутствует ссылка "Сообщить об ошибке"
    - do: нажать на ссылку "Сообщить об ошибке"
    - assert: Открылось модальное окно с жалобщиком

aliases:
  - &base
    - params:
        data_filter: entity-search
    - do: получить выдачу по запросу 'skype'
    - assert: на выдаче присутствует футер карточки ОО
    - assert: в футере карточки ОО присутствует ссылка "Сообщить об ошибке"
    - do: кликнуть на ссылку "Сообщить об ошибке"
    - assert: открылась шторка
  - &metrics
    - params:
        data_filter: entity-search
    - do: получить выдачу по запросу 'skype'
    - assert: на выдаче присутствует футер карточки ОО
    - assert: в футере карточки ОО присутствует ссылка "Сообщить об ошибке"
    - do: нажать на ссылку "Сообщить об ошибке"
    - tech: сработал счётчик /$page/$main/$result/FeedbackFooter/abuse
    - assert: появилось модальное окно обратной связи
    - do: ввести в поле "Сообщение" Сделайте редизайн!
    - do: нажать на кнопку "Отправить"
    - tech: сработал счётчик /$page/$main/$result/FeedbackFooter/feedback-submit
    - assert: появился диалог ввода email

specs:
  Внешний вид:
    Загрузка картинки:
      - *base
      - do: нажать на "Прикрепить фото или видео"
      - do: загрузить картинку image.png
      - assert: картинка загрузилась
      - screenshot: внешний вид [plain]

    Загрузка видео:
      - *base
      - do: нажать на "Прикрепить фото или видео"
      - do: загрузить видео video.png
      - assert: картинка загрузилось
      - screenshot: внешний вид [plain]

    Загрузка картинки и видео:
      - *base
      - do: нажать на "Прикрепить фото или видео"
      - do: загрузить картинку image.png
      - assert: картинка загрузилась
      - do: нажать на "Прикрепить фото или видео"
      - do: загрузить видео video.png
      - assert: видео загрузилось
      - screenshot: внешний вид [plain]

    Загрузка неверного типа файла:
      - *base
      - do: нажать на "Прикрепить фото или видео"
      - do: хагрузить файл wrong.ttt
      - assert: появилось предупреждение ".ttt не подходит. Можно прикрепить только фото или видео"
      - screenshot: внешний вид [plain]

    Вторая страница, без ввода email:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: появилась форма ввода адреса электронной почты
      - screenshot: внешний вид шторки [plain]

    Дизейбл по снятию галки с политики конфиденциальности:
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: появилась форма ввода адреса электронной почты
      - do: нажать на чекбокс "согласен с политикой конфиденциальности"
      - assert: кнопка "Отправить" стала не активна
      - screenshot: внешний вид шторки [plain]

    Тайтл с разделителем:
      - *base
      - assert: В шторке присуствует тайтл с разделителем
      - screenshot: внешний вид тайтл с разделителем [plain]

    Первая страница с выбором чекбоксов:
      - *base
      - do: нажать на первый чекбокс "Картинка не подходит"
      - do: нажать на третий чекбокс "Ошибка в фактах под описанием"
      - screenshot: внешний вид чекбокс листа [plain]

    Переход на предыдущий экран по стрелке "обратно":
      - *base
      - do: ввести в поле "Расскажите подробнее о проблеме" "Сделайте редизайн!"
      - do: нажать на кнопку "Отправить"
      - assert: появилась форма ввода адреса электронной почты
      - do: нажать на стрелку "обратно"
      - assert: пояивлась предыдущая страница
      - screenshot: внешний вид предыдущей страницы [back_to_slide_1]

    Первая страница с выбором чекбокса "Другое":
      - *base
      - do: нажать на пятый чекбокс "Другое"
      - assert: текст в поле ввода сообщения сменился на "Расскажите о проблеме или напишите предложения"
      - screenshot: внешний вид поля ввода сообщения листа [plain]

  Внешний вид футера:
    - params:
        data_filter: entity-search
    - do: получить выдачу по запросу 'skype'
    - assert: на выдаче присутствует футер карточки ОО
    - screenshot: внешний вид футера карточки ОО [plain]

  Базовые проверки:
    С вводом email:
      - *metrics
      - do: ввести в поле "Адрес почты" "hello@ya.ru"
      - do: нажать на кнопку "Продолжить"
      - tech: сработал счётчик /$page/$main/$result/FeedbackFooter/feedback-sended
    Без ввода email:
      - *metrics
      - do: нажать на кнопку "Пропустить"
      - tech: сработал счётчик /$page/$main/$result/FeedbackFooter/feedback-sended
    Изменение email:
      - *metrics
      - do: ввести в поле "Адрес почты" "hello@ya.ru"
      - do: нажать на кнопку "Продолжить"
      - tech: сработал счётчик /$page/$main/$result/FeedbackFooter/feedback-sended
      - assert: появился диалог подтверждения email
      - do: нажать на кнопку "Изменить email"
      - tech: сработал счётчик /$page/$main/$result/FeedbackFooter/change-email

files:
  - src/features/EntityFeedback/EntityFeedback.test/EntityFeedback@touch-phone.hermione.js
  - src/features/EntityFeedback/EntityFeedback.test/EntityFeedback@touch-phone.hermione.e2e.js

v-team: OO

tlds: all
