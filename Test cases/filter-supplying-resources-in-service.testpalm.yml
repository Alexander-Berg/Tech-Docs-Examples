feature: Фильтрация ресурсов
type: Страница ресурсов сервиса

specs:
  beforeEach:
    - tech: залогиниться под пользователем robot-abc-002
  aliases:
    - &goToTestService
      - do: открыть страницу поставляемых ресурсов сервиса "КотикиДелаютКусь" (/services/catsmakebite/resources/?view=supplying&layout=table)
      - assert: открылся список поставляемых ресурсов; в переключателе рядом со сторой поиска выбран вариант "Поставляемые"
    - &goToPassportService
      - do: открыть страницу поставляемых ресурсов сервиса "Паспорт" (/services/passp/resources/?view=supplying&layout=table)
      - assert: открылся список поставляемых ресурсов; в переключателе рядом со сторой поиска выбран вариант "Поставляемые"

  Фильтрация поставляемых ресурсов:
    1. Значения фильтров по умолчанию:
      - automation: ABC-10986
      - *goToTestService
      - screenshot: в правой части есть фильтры, галочки проставлены только в блоке "Статус" напротив пунктов "Запрошен", "Подтвержден, "Выдается", "Выдан" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2021-43-55.png]

    2. Фильтрация по потребителю и его вложенным сервисам со сбросом фильтра:
      - automation: ABC-10986
      - *goToTestService
      - do: в фильтрах в блоке "Потребитель" ввести в поле "Выберите сервис" значение "4282"
      - assert: под полем появился выпадающий список с вариантами, среди которых есть "Автотест фронтенда для сервиса с уникальным названием24"
      - do: кликнуть по варианту "Автотест фронтенда для сервиса с уникальным названием24"
      - assert: |
            выпадающий список скрылся, 
            в поле подставилось значение "Автотест фронтенда для сервиса с уникальным названием24",
            под фильтром появился ещё один - "Показывать ресурсы вложенных сервисов" без галочки,
            в URL появился параметр "service=4282",
            список ресурсов обновился, показаны только те ресурсы, потребитель у которых "Автотест фронтенда для сервиса с уникальным названием24"
      - screenshot: отфильтрованный список поставляемых ресурсов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2021-49-16.png]
      - do: поставить галочку в фильтр "Показывать ресурсы вложенных сервисов"
      - assert: |
            галочка поставилась, 
            в URL появился параметр "with_childs=true",
            список ресурсов обновился, показаны только те ресурсы, потребитель у которых "Автотест фронтенда для сервиса с уникальным названием24" или "Дочерний автотестовый сервис"
      - screenshot: отфильтрованный список поставляемых ресурсов с учётом дочерних сервисов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-28%2021-51-51.png]
      - do: кликнуть на надпись "сбросить" в блоке "Потребитель" под полем со значением "Автотест фронтенда для сервиса с уникальным названием24"
      - assert: |
            в блоке "Потребитель" поле ввода очистилось, в нём появился снова плейсхолдер - "Выберите сервис", 
            чекбокс "Показывать ресурсы вложенных сервисов" исчез,
            в URL пропали параметры "service=4282" и "with_childs=true",
            в списке ресурсов показаны все поставляемы ресурсы сервиса

    3. Фильтрация по типам ресурсов со сбросом фильтра:
      - automation: ABC-10986
      - *goToPassportService
      - screenshot: в правой части есть фильтры, в них есть блок "Типы ресурсов" с пунктами "TVM-приложение", "OAuth API", "HistoryDB API" и "Пользовательские данные" [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2010-33-06.png]
      - do: в блоке "Типы ресурсов" поставить галочку напротив пункта "OAuth API"
      - do: в блоке "Типы ресурсов" поставить галочку напротив пункта "HistoryDB API"
      - assert: |
            галочки напротив пунктов "OAuth API" и "HistoryDB API" поставились, 
            в URL появились параметры "type=88" и "type=89", 
            список ресурсов обновился, показаны только те ресурсы, тип у которых "OAuth API" или "HistoryDB API" 
      - screenshot: отфильтрованный список ресурсов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2010-37-39.png]
      - do: в блоке "Типы ресурсов" кликнуть на надпись "сбросить"
      - assert: |
            галочки напротив пунктов "OAuth API" и "HistoryDB API" снялись, 
            в URL пропали параметры "type=88" и "type=89", 
            список ресурсов обновился, показаны все типы поставляемых ресурсов       

    4. Фильтрация по категории типов со сбросом фильтра:
      - automation: ABC-10986
      - *goToPassportService
      - do: в фильтрах в блоке "Категория типов" кликнуть в поле ввода "Выберите категорию"
      - assert: появился выпадающий список с категориями
      - do: кликнуть на категорию "Безопасность"
      - assert: |
            значение "Безопасность" подставилось в поле ввода в блоке "Категория типов",
            в URL появился параметр "category=5",
            список ресурсов обновился, показаны только ресурсы из категории "Безопасность"
      - screenshot: отфильтрованные ресурсы [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2010-56-35.png]
      - do: в блоке "Категория типов" кликнуть на надпись "сбросить"
      - assert: |
            значение "Безопасность" исчезло из поля ввода в блоке "Категория типов",
            в URL пропал параметр "category=5",
            список ресурсов обновился, показаны ресурсы сервиса из разных категорий

    5. Фильтрация по статусам ресурсов со сбросом фильтра:
      - automation: ABC-10986
      - *goToTestService
      - do: в фильтрах в блоке "Статус" снять галочку напротив статуса "Запрошен"
      - do: в фильтрах в блоке "Статус" снять галочку напротив статуса "Выдается"
      - do: в фильтрах в блоке "Статус" снять галочку напротив статуса "Выдан"
      - do: в фильтрах в блоке "Статус" поставить галочку напротив статуса "Отозван"
      - assert: |
            напротив пункта "Все статусы" проставлен знак "-" 
            стоят галочки напротив статусов "Подтвержден" и "Отозван",
            в URL есть только два параметра "state" со значениями "approved" и "deprived", 
            список ресурсов обновился, показаны только те, которые находятся в статусе "Подтвержден" или "Отозван"
      - screenshot: отфильтрованный список ресурсов [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2011-05-13.png]
      - do: в блоке "Статус" кликнуть на надпись "сбросить"
      - assert: |
            напротив пункта "Все статусы" проставлен знак "-" 
            напротив статусов "Запрошен", "Подтвержден", "Выдается" и "Выдан" проставлены галочки, 
            напротив статуса "Отозван" галочка снята,
            в URL нет параметра "state" со значением и "deprived", 
            список ресурсов обновился, показаны только те, которые находятся в статусе "Запрошен", "Подтвержден", "Выдается" или "Выдан"      

    6. Фильтрация по нескольким фильтрам со сбросом всех:
      - automation: ABC-10986
      - *goToPassportService
      - do: в блок "Потребитель" в поле "Выберите сервис" ввести "orange"
      - do: из выпадающего списка выбрать сервис "Orange"
      - do: поставить галочку в пункте "Показывать ресурсы вложенных сервисов"
      - do: поставить галочку напротив типа ресурсов "OAuth API"
      - do: в "Категориях типов" выбрать "API"
      - do: в блоке "Статус" кликнуть в пункт "Все статусы"
      - assert: |
            в фильтре "Потребитель" указан "Orange",
            напротив фильтра "Показывать ресурсы вложенных сервисов" стоит галочка, 
            в типах ресурсов галочкой отмечен только "OAuth API", 
            в категориях типов указан "API", 
            в блоке "Статус" не стоит ни одной галочки напротив статусов,
            в URL есть параметры "service=760", "with_childs=true", "type=88" и "category=4", 
            список ресурсов обновился, показаны только те, которые подходят под значения фильтров
      - screenshot: отфильтрованный список ресурсов и выбранные значения фильтров [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-06-30%2011-40-58.png]
      - do: кликнуть под фильтрами на кнопку "Сбросить все фильтры"
      - assert: |
            фильтры "Потребитель" очистился,
            пункт "Показывать ресурсы вложенных сервисов" исчез, 
            в типах ресурсов галочек не стоит, 
            в категориях типов не выбраны никакие категории, 
            в блоке "Статус" стоят галочки напротив статусов "Запрошен", "Подтвержден", "Выдается" и "Выдан",
            в URL нет параметров "service=760", "with_childs=true", "type=88" и "category=4", есть параметры "state" со значениями "requested", "approved", "granting" и "granted", 
            список ресурсов обновился, показаны все поставляемые сервисов ресурсы в статусах "Запрошен", "Подтвержден", "Выдается" и "Выдан"

files: []

priority: normal

tags:
  - reviewed
  - no_assessors
