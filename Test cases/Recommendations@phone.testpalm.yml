feature: Лента рекоммендаций
specs:
  beforeEach:
    - do: при дальнейшей проверке указанных ожидаемых результатов обращайте внимание на любые некорректные на ваш взгляд поведения, основываясь на свой опыт использования web-приложений (например, сохранение позиции при переходах туда-обратно кнопками на устройстве, пустые экраны при переходах, кривая верстка, скачкИ элементов, плавность скролла, неработающая функциональность и т.п.)

  Внешний вид карточек в ленте:
    - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations%2Fdefault.json
    - assert: загрузились карточки
    - screenshot: лента карточек соответствует скриншоту [plain]

  Внешний вид нижней части статьи:
    - do: перейти по ссылке https://yandex.ru/turbo?text=bin%3Arecommendation-type-small-with-button
    - do: скроллить к нижней части статьи
    - assert: видна кнопка с текстом "Читать на lifehacker.ru"
    - screenshot: Кнопка и конец статьи (перед началом ленты карточек) соответствует скриншоту [page-bottom]

  Работает вместе с другим related-блоком:
    - params:
        exp_flags:
        - recommendation-feed=1
    - tags: no_assessors
    - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations%2Ftwo-related.json
    - assert: наверху страницы присутствует related-блок "Вам может быть интересно"
    - assert: под ним присутствует лента с карточками рекомендаций
    - screenshot: внешний вид схематично соответствует скриншоту [two-related]

  Скроллит к ленте рекомендаций, если переход произошёл с карточки:
    - do: перейти на страницу https://yandex.ru/turbo/echo.msk.ru/s/news/2720145-echo.html
    - do: проскроллить вниз до ленты рекомендаций
    - do: кликнуть на любую карточку
    - assert: произошёл переход в той же вкладке
    - do: вернуться назад по истории
    - assert: страница автоматически проскроллилась к ленте
    - do: скроллить страницу вверх к началу статьи
    - do: перезагрузить страницу
    - assert: скролла к ленте не произошло

  Прячет плашку социальности:
    - do: перейти на страницу https://yandex.ru/turbo?stub=recommendations/social-panel.json
    - assert: через короткий промежуток времени снизу страницы появилась плашка "Комментировать"
    - do: проскроллить вниз до ленты рекомендаций
    - assert: плашка "Комментировать" стала невидимой
    - do: проскроллить страницу вверх так, чтобы ленты рекомендаций не было видно
    - assert: появилась плашка "Комментировать"

  Ленивая загрузка ленты рекомендаций:
    - params:
        exp_flags: recommendations-lazy-load=1
    - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations/lazy.json
    - do: проскролить до ленты рекоммендаций
    - do: если лента не загрузилась то подождать
    - assert: лента рекоммендаций загрузилась

  Внешний вид с флагом позиции картинки:
    Значение флага recommendation-card-img-pos=0:
      - params:
          exp_flags: recommendation-card-img-pos=0
      - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations%2Fdefault.json
      - assert: загрузились карточки
      - screenshot: лента карточек соответствует скриншоту [plain]
    Значение флага recommendation-card-img-pos=1:
      - params:
          exp_flags: recommendation-card-img-pos=1
      - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations%2Fdefault.json
      - assert: загрузились карточки
      - screenshot: лента карточек соответствует скриншоту [plain]
    Значение флага recommendation-card-img-pos=2:
      - params:
          exp_flags: recommendation-card-img-pos=2
      - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations%2Fdefault.json
      - assert: загрузились карточки
      - screenshot: лента карточек соответствует скриншоту [plain]

  Реклама в ленте рекомендаций:
    params:
      exp_flags:
      - adv-disabled=0
      - recommendation-feed=button
    Проверка наличия рекламного блока в ленте:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?hermione_advert=stub&text=bin%3Arecommendations-advert
      - do: проскроллить страницу вниз до ленты рекомендательный статей
      - assert: после второй карточки рекомендаций находится блок рекламы
      - screenshot: внешний вид соответствует скриншоту [first-advert]
    Количество рекламных блоков:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?hermione_advert=stub&stub=recommendations%2Fwith-adverts.json
      - do: проскроллить страницу вниз до ленты рекомендательный статей
      - assert: отрендирилось 5 блоков рекламы в ленте рекомендаций
    Работа ленты без данных рекламы:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?hermione_advert=stub&text=bin%3Arecommendations-withOutAds
      - do: проскроллить страницу вниз до ленты рекомендательный статей
      - assert: отрендирилось лента рекомендаций
    Работа ленты без данных о кол-ве повторяющихся блоков:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?hermione_advert=stub&text=bin%3Arecommendations-withOutRepeatedAds
      - do: проскроллить страницу вниз до ленты рекомендательный статей
      - assert: отрендирился 1 блок рекламы в ленте рекомендаций
    Проверка id повторяющихся рекламных блоков:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?hermione_advert=stub&text=bin%3Arecommendations-advert
      - do: проскроллить страницу вниз до ленты рекомендательный статей
      - assert: id 2 блока рекламы и 3 блока рекламы в ленте рекомендаций разные
    Проверка шагов повтора рекламных блоков:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?hermione_advert=stub&text=bin%3Arecommendations-advert
      - do: проскроллить страницу вниз до ленты рекомендательный статей
      - assert: количество блоков рекомендаций между 2-й и 3-ей рекламой в ленте равно 2-м
    Проверка наличия рекламы перед карточками рекомендаций:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?hermione_advert=stub&stub=recommendations%2Fwith-adverts.json
      - do: проскроллить страницу вниз до ленты рекомендательный статей
      - assert: рекламный блок отрендерился перед первой карточкой рекомендаций
    Рендеринг нескольких рекламных блоков после карточки:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?hermione_advert=stub&stub=recommendations%2Fwith-adverts.json
      - do: проскроллить страницу вниз до ленты рекомендательный статей
      - assert: после первой карточки рекомендаций находятся два рекламных блока подряд
  Типы карточек в ленте в зависимости от флага из данных:
    small:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?text=bin%3Arecommendation-type-small
      - do: проскроллить до конца страницы до ленты рекомендательных статей
      - assert: загрузилась лента рекомендаций
      - assert: карточки рекомендаций без кнопок
    small-with-button:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?text=bin%3Arecommendation-type-small-with-button
      - do: проскроллить до конца страницы до ленты рекомендательных статей
      - assert: загрузилась лента рекомендаций
      - assert: карточки рекомендаций с кнопками
    default:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?text=bin%3Arecommendation-type-default
      - do: проскроллить до конца страницы
      - assert: загрузилась вторая статья
    Флаг отсутствует:
      - tags: no_assessors
      - do: перейти по ссылке https://yandex.ru/turbo?text=bin%3Arecommendation-type
      - do: проскроллить до конца страницы
      - assert: вторая статья не загрузилась

  Дата публикации:
    Показывает дату публикации по флагу recommendations-pub-date:
      - params:
          exp_flags: recommendations-pub-date=1
      - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations/default.json
      - assert: |
          отображаются карточки рекомендаций
          на карточках есть время публикации
      - screenshot: структура карточки и вид времени публикации соответствует скриншоту [with-pub-date]
    Показывает дату публикации по признаку из данных ajax_recommendations_with_pub_date:
      - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations/with-pub-date.json
      - assert: |
          отображаются карточки рекомендаций
          на карточках есть время публикации

  Тёмная тема:
    Внешний вид:
      - browsers:
        - ios-safari-14-touch
      # На момент написания теста нет возможности пофорсировать тёмную тему через флаг
      # по этой причине пишем хотя бы такой тест
      # Можно переписать после TURBOUI-5996
      - tags: no_assessors
      - params:
          exp_flags: page-custom-display-theme=1
      - do: включить тёмную тему на уровне OS
      - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations/dark-theme.json
      - assert: отображаются карточки рекомендаций
      - screenshot: лента соответствует скриншоту [dark-theme]

  Ограничение ленты:
    Внешний вид кнопки "Показать ещё":
      - do: перейти по ссылке https://yandex.ru/turbo?stub=recommendations/limit-feed-button.json
      - assert: загрузились карточки
      - screenshot: кнопка "Показать ещё" выглядит корректно [button]

files:
  - platform/components/Recommendations/Recommendations.tests/Recommendations@phone.hermione.js
v-team: Turbo
tlds: ru
