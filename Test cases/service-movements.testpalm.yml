feature: Перемещение сервиса

specs:
  beforeEach:
    - do: (PREPARE) запустить в Runner в директории "Front" сценарий "Перемещение сервисов" (https://github.yandex-team.ru/pixel/abc-runner)
    - do: (PREPARE) проверить, что robot-cat-leopold является руководителем в сервисе с id=4075 (/services/postmanaddrolesdepartment3/))
    - do: (PREPARE) проверить, что robot-internal-002 является руководителем в сервисе с id=4719 (/services/service_for_postman_test_move/) 
 
  Создание запроса на перемещение сервиса и его отклонение:
    - do: отправить запрос "Создание запроса на перемещение сервиса" с токеном "robot-internal-002"
    - assert: пришёл ответ со статусом "200"
    - screenshot: ответ на запрос должен содержать поля вида [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2015-35-43.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"
    - do: отправить запрос "Отклоняем запрос на перемещение сервиса" с токеном "robot-internal-003"
    - assert: пришёл ответ со статусом "204" без тела
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"

  Пользователь с ограниченной ролью не может создавать запросы не перемещение сервиса:
    - do: отправить запрос "Ограниченная роль не может переносить сервис" с токеном "robot-cat-matroskin"
    - assert: пришёл ответ со статусом "403" и телом "Your permissions are not enough"
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"    

  Пользователь с сильно ограниченной ролью не может создавать запросы на перемещение сервиса:
    - do: отправить запрос "Сильно ограниченная роль не может переносить сервис" с токеном "robot-cat-bayun"
    - assert: пришёл ответ со статусом "403" и телом "Your permissions are not enough"
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS"  

  Нельзя пытаться перемещать сервис под базовые не листовые: 
    - do: отправить запрос "Нельзя пытаться перемещать сервис под базовые не листовые" с токеном "robot-cat-leopold"
    - assert: пришёл ответ со статусом "403"
    - screenshot: ответ на запрос должен содержать поля [https://jing.yandex-team.ru/files/pixel/Screenshot%20from%202021-03-05%2015-38-12.png]
    - do: кликнуть по табе "Test Results" в Response части postman UI
    - assert: на табе "Test Results" все тесты со статусом "PASS" 


priority: blocker

files:
  - tests/unit/services/api/test_departments.py
  - tests/unit/services/api/test_moves.py

tags:
  - reviewed
  - no_assessors
  - postman_automation
  - fitcher:abc:src/blocks/desktop/service-parent/**
  - fitcher:abc:src/blocks/desktop/service-parent-editor/**
  - fitcher:abc:src/blocks/desktop/service-team-editor-department/**
  - fitcher:abc:src/blocks/desktop/service-move-request/**
  - fitcher:abc:src/blocks/desktop/service-move-requests/**
  - fitcher:abc:src/blocks/desktop/service-move-requests-group/**
  - fitcher:plan:tests/unit/services/api/test_departments.py
  - fitcher:plan:tests/unit/services/api/test_moves.py
