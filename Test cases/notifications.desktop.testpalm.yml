feature: Уведомления

import-steps:
    - tests/hermione/suites/desktop/shared-steps/push-notifications.testpalm.steps.yml
    - tests/hermione/suites/desktop/shared-steps/open-backoffice.testpalm.steps.yml
    - tests/hermione/suites/desktop/shared-steps/new-dialogue.testpalm.steps.yml

tlds: ru

specs:
    beforeEach:
        - attach: Создание нового диалога в Очереди
        - attach: Авторизация и открытие бэкоффиса
        - do: убедиться, что для адреса "https:#yandex.ru:443" не запрещены уведомления (см. "https://yandex.ru/support/common/browsers-settings/notifications.html")

    # Активность вкладки
    # Act - вкладка активна
    # Dsb - вкладка не активна
    #===============================================================
    #                           ||  Другой оп-р  || Текущий оп-р  ||
    #---------------------------------------------------------------
    #                           ||  Act  |  Dsb  ||  Act  |  Dsb  ||
    ##==============================================================
    # Назначение диалога        ||   +   |   +   ||   -   ||||||||||
    # --------------------------------------------------------------
    # Перевод диалога в очередь ||   -   |   +   ||   -   ||||||||||
    # --------------------------------------------------------------
    # Новый диалог в очереди    ||   -   |   +   |||||||||||||||||||
    # --------------------------------------------------------------
    # Новое сообщение           ||   -   |   +   |||||||||||||||||||
    #===============================================================

    Показывается обычное уведомление в активной вкладке при назначение диалога на текущего оператора другим оператором:
        - automation: YDO-6833
        - attach: Авторизация и открытие бэкоффиса вторым оператором
        - do: выполнять все следующие шаги вторым оператором
        - do: кликнуть на диалог со своим сообщением в Очереди
        - do: нажать "Передать другому оператору"
        - do: в открывшемся диалоге найти и выбрать первого оператора
        - do: нажать "Передать"
        - assert: |
              появился тост формата "Диалог передан оператору <имя первого оператора>"
              показалось уведомление с текстом формата "<имя второго оператора> перевел(а) на вас чат"
        - do: нажать на тело уведомления
        - assert: |
              окно браузера первого оператора стало активным
              перекинуло на вкладку бэкоффиса Диалоги
              в списке диалогов выбран только что перенесенный диалог

    Показывается обычное уведомление в неактивной вкладке при назначении диалога на текущего оператора другим оператором:
        - automation: YDO-6833
        - do: открыть новую вкладку браузера и остаться в ней
        - attach: Авторизация и открытие бэкоффиса вторым оператором
        - do: выполнять все следующие шаги вторым оператором
        - do: кликнуть на диалог со своим сообщением в Очереди
        - do: нажать "Передать другому оператору"
        - do: в открывшемся диалоге найти и выбрать первого оператора
        - do: нажать "Передать"
        - assert: |
              появился тост формата "Диалог передан оператору <имя первого оператора>"
              показалось уведомление с текстом формата "<имя второго оператора> перевел(а) на вас чат"
        - do: нажать на тело уведомления
        - assert: |
              окно браузера первого оператора стало активным
              открылась вкладка браузера с бэкоффисом
              перекинуло на вкладку бэкоффиса Диалоги
              в списке диалогов выбран только что перенесенный диалог

    Показывается обычное уведомление в неактивной вкладке при переводе диалога в очередь другим оператором:
        - automation: YDO-6833
        - do: открыть новую вкладку браузера и остаться в ней
        - attach: Авторизация и открытие бэкоффиса вторым оператором
        - do: выполнять все следующие шаги вторым оператором
        - do: кликнуть на диалог со своим сообщением в Очереди
        - do: нажать "Пометить как спам"
        - assert: |
              появился тост "Диалог перенесен в Спам"
              перекинуло на вкладку бэкоффиса Спам
              в списке диалогов выбран только что перенесенный диалог
        - do: нажать "Переместить в очередь"
        - assert: |
              появился тост "Диалог перенесен в Очередь"
              перекинуло на вкладку бэкоффиса Очередь
              в списке диалогов выбран только что перенесенный диалог
              показалось уведомление с текстом формата "Очередь: <последнее сообщение перенесенного диалога>"
        - do: нажать на тело уведомления
        - assert: |
              окно браузера первого оператора стало активным
              открылась вкладка браузера с бэкоффисом
              перекинуло на вкладку бэкоффиса Очередь
              в списке диалогов выбран только что перенесенный диалог

    Показывается обычное уведомление в неактивной вкладке при появлении нового диалога в очереди:
        - automation: YDO-6833
        - do: открыть новую вкладку браузера и остаться в ней
        - attach: Создание нового диалога в Очереди
        - assert: показалось уведомление с текстом формата "Новый чат в очереди"
        - do: нажать на тело уведомления
        - assert: |
              окно браузера стало активным
              открылась вкладка браузера с бэкоффисом
              перекинуло на вкладку бэкоффиса Очередь
              в списке диалогов выбран только что перенесенный диалог

    Показывается обычное уведомление в неактивной вкладке при новом сообщении в диалогах:
        - automation: YDO-6833
        - attach: Отключение пуш-уведомлений в чатах
        - do: кликнуть на диалог со своим сообщением в Очереди
        - do: нажать "Принять"
        - assert: |
              перекинуло на вкладку бэкоффиса Диалоги
              в списке диалогов выбран только что перенесенный диалог
        - do: отправить еще одно сообщение из браузера, в котором был создан новый диалог
        - assert: показалось уведомление с текстом формата "<Имя клиента> <текст нового сообщения>" или "<текст нового сообщения>"

    Показывается пуш-уведомление в неактивной вкладке при новом сообщении в диалогах:
        - automation: YDO-6833
        - attach: Включение пуш-уведомлений в чатах
        - do: кликнуть на диалог со своим сообщением в Очереди
        - do: нажать "Принять"
        - assert: |
              перекинуло на вкладку бэкоффиса Диалоги
              в списке диалогов выбран только что перенесенный диалог
        - do: отправить еще одно сообщение из браузера, в котором был создан новый диалог
        - assert: показалось уведомление с текстом формата "<текст нового сообщения>"

files: []

v-team: Uslugi

tags:
    - no_assessors
    - skip_manual_check
    - floyd
    - smoke
