feature: Колдунщик 1орг
type: Публикации

specs:
  Таб на морде:
    Основные проверки:
      - label: 1org-posts-{{SET_NAME}}
      - do: получить выдачу по запросу 'лига джентльменов алтайский край ателье' _ALTERNATIVE_SEARCH_QUERIES_
      - assert: виден колдунщик организации в правой колонке
      - do: кликнуть по табу 'Новости'
      - assert: появился таб 'Новости'
      - screenshot: внешний вид на морде [plain]
      - do: кликнуть на ссылку 'Читать еще' в каком-либо из постов (может отсутствовать, в таком случае пропустите этот шаг)
      - assert: показался полный текст поста
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/tabs/posts/posts/more'
      - do: кликнуть на ссылку источника в каком-либо из постов (может отсутствовать, в таком случае пропустите этот шаг)
      - assert: в новой вкладке открылась ссылка из поста
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/tabs/posts/posts/link'
      - do: кликнуть по кнопке 'Все новости'
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/tabs/posts/posts/more-button'
      - assert: появился попап организации с открытым табом 'Новости'
    Просмотрщик:
      - label: 1org-posts-viwer-{{SET_NAME}}
      - params:
          yandex_login: 'stas.mihailov666'
      - do: залогиниться в Яндексе
      - do: получить выдачу по запросу 'монтаж-кам проспект ленинского комсомола' _ALTERNATIVE_SEARCH_QUERIES_
      - assert: виден колдунщик организации в правой колонке
      - do: кликнуть по табу 'Новости'
      - assert: появился таб 'Новости'
      - do: кликнуть по первой фотографии в первом посте
      - assert: появился просмотрщик
      - screenshot: внешний вид просмотрщика на морде [plain]
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/tabs/posts/posts/thumb'
      - do: кликнуть по кнопке вперед в просмотрщике
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/tabs/posts/posts/viewer/preview/arrow-right'
      - assert: появилась следующая фотография
      - do: кликнуть по кнопке назад в просмотрщике
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/tabs/posts/posts/viewer/preview/arrow-left'
      - assert: появилась предыдущая фотография
      - do: кликнуть по третьей фотографии в галерее просмотрщика
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/tabs/posts/posts/viewer/gallery/item'
      - assert: появилась третья фотография
      - do: кликнуть по кнопке закрыть
      - tech: сработал счетчик path='/$page/$parallel/$result/composite/tabs/posts/posts/viewer/close'
      - assert: скрылся просмотрщик
      - assertMetrics:
        - feature.web.wizards_common.wizard_companies_right.total.shows
        - feature.web.wizards_common.wizard_companies_right.total.external_clicks
        - feature.web.wizards_common.wizard_companies_right.total.dynamic_clicks
        - web.total_request_count
    Лайки:
      - do: получить выдачу по запросу 'Шоу-рум Плит-Мар гродно' _ALTERNATIVE_SEARCH_QUERIES_
      - assert: виден колдунщик организации в правой колонке
      - do: кликнуть по табу 'Новости'
      - assert: появился таб 'Новости'
      - assert: у первого поста есть лайки
      - do: навести курсор на палец вверх
      - screenshot: внешний вид с наведенным курсором на пальце вверх [reactions-hover]
      - do: кликнуть по пальцу вверх (лайк)
      - assert: счетчик лайков увеличился на единицу
      - screenshot: внешний вид после клика на палец вверх [reactions-liked]
      - do: кликнуть по пальцу вниз (дизлайк)
      - assert: счетчик дизлайков увеличился на единицу
      - tech: сработал счетчик /$page/$parallel/$result/composite/tabs/posts/posts/reactions/like
      - tech: сработал счетчик /$page/$parallel/$result/composite/tabs/posts/posts/reactions/dislike
      - do: кликнуть ещё раз по пальцу вниз (дизлайк)
      - assert: счетчик дизлайков уменьшился на единицу
      - assert: оценка пользотвателя сбросилась
      - assertMetrics:
        - feature.web.wizards_common.wizard_companies_right.total.shows
        - feature.web.wizards_common.wizard_companies_right.total.external_clicks
        - feature.web.wizards_common.wizard_companies_right.total.dynamic_clicks
        - web.total_request_count
    Комментарии:
      - params:
          yandex_login: 'stas.mihailov666'
      - do: залогиниться в Яндексе
      - do: получить выдачу по запросу 'Шоу-рум Плит-Мар гродно' _ALTERNATIVE_SEARCH_QUERIES_
      - assert: виден колдунщик организации в правой колонке
      - do: кликнуть по табу 'Новости'
      - assert: появился таб 'Новости'
      - assert: у первого поста есть иконка комментариев
      - do: кликнуть по иконке комментариев первого поста
      - screenshot: внешний вид после клика на иконку комментариев [comments-opened]
      - assert: открылись комментарии под постом
      - do: кликнуть ещё раз по иконке комментариев первого поста
      - assert: скрылись комментарии под постом
      - assertMetrics:
        - feature.web.wizards_common.wizard_companies_right.total.shows
        - feature.web.wizards_common.wizard_companies_right.total.external_clicks
        - feature.web.wizards_common.wizard_companies_right.total.dynamic_clicks
        - web.total_request_count
  Таб в попапе:
    beforeEach:
      - do: получить выдачу по запросу 'Лига джентльменов Алтайский край ателье' _ALTERNATIVE_SEARCH_QUERIES_
      - assert: виден колдунщик организации в правой колонке
      - do: кликнуть в таб "Новости"
      - assert: открылся таб с публикациями
      - do: кликнуть на кнопку "Все новости"
      - assert: открылся большой попап с табом отзывов
      - do: кликнуть по табу 'Новости'
      - assert: появился таб 'Новости'
    Основные проверки:
      - screenshot: внешний вид в попапе [1org-posts-{{SET_NAME}} >> plain]
      - do: кликнуть по кнопке 'Ещё новости'
      - tech: сработал счетчик path='/$page/$parallel/$result/modal-popup/modal-content-loader/content/company/tabs/posts/ajax-loader/posts/more-button'
      - assert: в список дозагрузились ещё новости
    Просмотрщик:
      - do: кликнуть по первой фотографии в первом посте
      - assert: появился просмотрщик
      - screenshot: внешний вид просмотрщика в попапе [1org-posts-viwer-{{SET_NAME}} >> plain]
      - tech: сработал счетчик path='/$page/$parallel/$result/modal-popup/modal-content-loader/content/company/tabs/posts/ajax-loader/posts/thumb'
      - do: кликнуть по кнопке вперед в просмотрщике
      - tech: сработал счетчик path='/$page/$parallel/$result/modal-popup/modal-content-loader/content/company/tabs/posts/ajax-loader/posts/viewer/preview/arrow-right'
      - assert: появилась следующая фотография
      - do: кликнуть по кнопке назад в просмотрщике
      - tech: сработал счетчик path='/$page/$parallel/$result/modal-popup/modal-content-loader/content/company/tabs/posts/ajax-loader/posts/viewer/preview/arrow-right'
      - assert: появилась предыдущая фотография
      - do: кликнуть по третьей фотографии в галерее просмотрщика
      - tech: сработал счетчик path='/$page/$parallel/$result/modal-popup/modal-content-loader/content/company/tabs/posts/ajax-loader/posts/viewer/gallery/item'
      - assert: появилась третья фотография
      - do: кликнуть по кнопке закрыть
      - tech: сработал счетчик path='/$page/$parallel/$result/modal-popup/modal-content-loader/content/company/tabs/posts/ajax-loader/posts/viewer/close'
      - assert: скрылся просмотрщик
      - assertMetrics:
        - feature.web.wizards_common.wizard_companies_right.total.shows
        - feature.web.wizards_common.wizard_companies_right.total.external_clicks
        - feature.web.wizards_common.wizard_companies_right.total.dynamic_clicks
        - web.total_request_count
    Лайки:
      - assert: у первого поста в попапе есть лайки
      - do: проскролить содержимое попапа до кнопки 'Ещё новости'
      - do: кликнуть по кнопке 'Ещё новости'
      - assert: список новостей дозагрузилился
      - assert: у первого дозагруженного поста есть лайки
      - assertMetrics:
        - feature.web.wizards_common.wizard_companies_right.total.shows
        - feature.web.wizards_common.wizard_companies_right.total.external_clicks
        - feature.web.wizards_common.wizard_companies_right.total.dynamic_clicks
        - web.total_request_count
    Комментарии:
      - assert: у первого поста есть иконка комментариев
      - do: кликнуть по иконке комментариев первого поста
      - assert: открылись комментарии под постом
      - do: кликнуть ещё раз по иконке комментариев первого поста
      - assert: скрылись комментарии под постом
      - assertMetrics:
        - feature.web.wizards_common.wizard_companies_right.total.shows
        - feature.web.wizards_common.wizard_companies_right.total.external_clicks
        - feature.web.wizards_common.wizard_companies_right.total.dynamic_clicks
        - web.total_request_count

v-team: VanillaGeo

tlds: all

counter: /$page/$parallel/$result[@wizard_name="companies" and @subtype="company"]/composite/tabs/posts/posts/more

files:
    - src/features/Companies/Companies.features/Posts/Posts.test/Posts@desktop.hermione.js

tags:
  - skip_e2e_check
  - react
