feature: ЖД
type: Страница заказа
description: >-
  Реквизиты тестовой карты: 5100003697253468, 12/20, 090 (для асессоров шаг
  оплаты пропускается - карту вводить не нужно).


  Для того, чтобы воспроизвести ошибку выкупа страховки **в оркестраторе**,
  установить ФИО пассажира "Ошибка Ошибкаим Статусстраховки".
specs:
  'Обработка случая, когда не удалось выкупить страховку':
    - do: >-
        Оформить заказ **со страховкой** для двух пассажиров, для одного из
        которых произошла ошибка выкупа страховки (ввести ФИО из описания кейса
        ) с прописанным параметром для тестирования метрики **?_ym_debug=1**
    - assert: >-
        * Произошел переход на страницу заказа

        * Кнопка для скачивания билетов называется "Скачать билеты"

        * На странице отображается желтое предупреждение "При покупке страховых
        полисов произошла ошибка, поэтому Яндекс.Путешествиям пришлось оформить
        вам билеты без страховки. Если банк успел снять с карты деньги за
        полисы, он скоро их вернёт."

        * В консоли браузера есть событие в метрику "show_insurance_auto_return"

        * На почту пришло письмо о покупке, в письме нет блока про страховку, но
        есть текст "Здравствуйте, о ооо! Вы оплатили билеты и прошли электронную
        регистрацию. При покупке страховых полисов произошла ошибка, деньги за
        них разблокируются. В списке операций по вашему счёту изменится платёж,
        вместо [сумма с учетом страховки для всех пассажиров] руб. станет [сумма
        без учета страховки для всех пассажиров] руб."

        * Стоимость заказа указана без учета страховки для всех пассажиров

        * Нет пункта про страховку для билетов

        * В письме есть 2 чека: чек о покупке с 2 позициями о страховке + чек о
        возврате страховки (для всех пассажиров)
    - do: |-
        Кликнуть Сдать все билеты
        Запомнить сумму к возврату
        Ввести код из смс
        Кликнуть Подтвердить
    - assert: >-
        * Произошел возврат двух билетов

        * На почту пришло письмо о возврате

        * Сумма к возврату в письме совпадает с суммой в модальном окне при
        возврате

        * Сумма к возврату в чеке совпадает с суммой в модальном окне при
        возврате
    - do: Обновить страницу заказа
    - assert: '* Желтого предупреждения о невыкупе страховки нет'
manual: true
Устройство: Десктоп
Страница: Страница заказа
Сервис: ЖД
Тестирование асессорами: Нет
Окружение: Testing
Автор: shenfeld
