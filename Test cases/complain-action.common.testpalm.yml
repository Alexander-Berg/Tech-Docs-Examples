feature: Метаинформация в жалобах

specs:

    Открывается чат с ботом из метадаты юзера при нажатии на "Пожаловаться" если установлена complain_action только у юзера[manual]:
        - automation:
        - description: |
              На тестовом аккаунте нельзя создавать дополнительные чаты и удалять тестовый чат!
              Авторизоваться в приложении данным аккаунтом  yndx-mssngr-880 / QazMssngr1
              У Вас в списке чатов есть чат с названием **Тестбот**
        - do: Запустить тестовое приложениие и октрыть список чатов
        - assert: Открывается список чатов
        - do: Открыть чат из description
        - assert: Открывается чат из description
        - do: Отправить в чат следующий запрос:```/set_metadata {"complain_action":["messenger://user?user_id=3deb6aac-381d-4f2b-a9fa-b80851618ae9&text=%D0%A5%D0%BE%D1%87%D1%83%20%D0%BF%D0%BE%D0%B6%D0%B0%D0%BB%D0%BE%D0%B2%D0%B0%D1%82%D1%8C%D1%81%D1%8F%21","https://yandex.ru/chat?text=%D0%A5%D0%BE%D1%87%D1%83%20%D0%BF%D0%BE%D0%B6%D0%B0%D0%BB%D0%BE%D0%B2%D0%B0%D1%82%D1%8C%D1%81%D1%8F%21#/user/3deb6aac-381d-4f2b-a9fa-b80851618ae9"]}```
        - assert: Запрос был отправлен и обработан ботом 
        - do: Обновить страницу мессенджера (если это десктопое приложение то перезапустить его)
        - assert: Страница мессенджера была обновлена (приложение было перезапущено)
        - do: Нажать по шапке чата (если тест-кейс проходится на десктопном приложении, то после перезапуска приложения нужно открыть чат из description)
        - assert: Открылась карточка чата
        - do: Нажать на кнопку "Пожаловаться"
        - assert: |
              Осуществляется переход в чат **Цветочный магазин**
              В поле ввода введен текст **Хочу пожаловаться!**
        - do: Вернуться в чат из description и отправить следующий запрос:```/set_metadata {"chatbar":{"img":"https://static.tildacdn.com/tild6636-6130-4231-a132-633037383863/2019_02_13_-113.jpg","title":{"i18n_key":"yahealth_finish_consultation","text":"test"},"subtitle":{"i18n_key":"yahealth_finish_consultation","text":"subtitle-fallback-text"},"button":{"text_color":"#8d75dd","bg_color":"#f2d5c9","title":{"i18n_key":"yahealth_finish_consultation","text":"button-text"},"links":["yellowskin://?url=https%3A%2F%2Fhealth.yandex.ru%2Fconsultation%2F123456%2Ffinish&tab=yahealth","https://health.yandex.ru/consultation/123456/finish?token=6d0aa353-36dc-4453-b478-1c02a81d37ef"],"directives":[{"type":"client_action","name":"postmessage","payload":{"origin":"https://health.yandex.ru","type":"postmessageactiontype","params":{}}}]}}}```
        - assert: |
              Пришло сообщение от бота в ответ
              В окне чата появилась плашка с метадатой (может появится после обнновления страницы)

    Открывается чат с ботом из метадаты чата при нажатии на "Пожаловаться" если установлена complain_action как у чата, так и у юзера[manual]:
        - automation:
        - description: |
              На тестовом аккаунте нельзя создавать дополнительные чаты и удалять тестовый чат!
              Авторизоваться в приложении данным аккаунтом  yndx-mssngr-880 / QazMssngr1
              У Вас в списке чатов есть чат с названием **Pills-Med Помощь**
        - do: Запустить тестовое приложениие и октрыть список чатов
        - assert: Открывается список чатов
        - do: Открыть чат из description
        - assert: Открывается чат из description
        - do: Нажать по шапке чата
        - assert: Открылась карточка чата
        - do: Нажать на кнопку "Пожаловаться"
        - assert: |
              Осуществляется переход в чат **Поддержка cPanel**
              В поле ввода введен текст **Хочу пожаловаться!**

    Открывается чат с ботом из метадаты юзера при нажатии на "Пожаловаться", если установлена complain_action как у чата, так и у юзера, если карточка пользователя открывалась через блок "Участники" в групповом чате[manual]:
        - automation:
        - description: |
              На тестовом аккаунте нельзя создавать дополнительные чаты и удалять тестовый чат!
              Авторизоваться в приложении данным аккаунтом  yndx-mssngr-880 / QazMssngr1
              У Вас в списке чатов есть чат с названием **Тестовый чат метадаты**
        - do: Запустить тестовое приложениие и октрыть список чатов
        - assert: Открывается список чатов
        - do: Открыть чат из description
        - assert: Открывается чат из description
        - do: Нажать по шапке чата
        - assert: Открылась карточка чата
        - do: Нажать на блок "Участники"
        - assert: |
              Открылся блок "Участники"
              В данном блоке есть **Pills-Med Помощь**
        - do: Нажать на участника чата **Pills-Med Помощ**
        - assert: Открывается карточка данного контакта
        - do: Нажать на кнопку "Пожаловаться"
        - assert: |
              Осуществляется переход в чат **Цветочный магазин**
              В поле ввода введен текст **Хочу пожаловаться!**

    Открывается чат с ботом из метадаты юзера при нажатии на "Пожаловаться", если установлена complain_action как у чата, так и у юзера, если карточка пользователя открывалась через окно группового чата[manual]:
        - automation:
        - description: |
              На тестовом аккаунте нельзя создавать дополнительные чаты и удалять тестовый чат!
              Авторизоваться в приложении данным аккаунтом  yndx-mssngr-880 / QazMssngr1
              У Вас в списке чатов есть чат с названием **Тестовый чат метадаты**
        - do: Запустить тестовое приложениие и октрыть список чатов
        - assert: Открывается список чатов
        - do: Открыть чат из description
        - assert: Открывается чат из description
        - do: Нажать на аватар участника чата **Pills-Med Помощь** (От него отправлено сообщение с текстом "Приветственное сообщение" )
        - assert: Открывается карточка данного пользователя
        - do: Нажать на кнопку "Пожаловаться"
        - assert: |
              Осуществляется переход в чат **Цветочный магазин**
              В поле ввода введен текст **Хочу пожаловаться!**

    Происходит стандартный механизм жалобы на сообщение, если у пользователя установлена метадата с complain_action[manual]:
        - automation:
        - description: |
              На тестовом аккаунте нельзя создавать дополнительные чаты и удалять тестовый чат!
              Авторизоваться в приложении данным аккаунтом  yndx-mssngr-880 / QazMssngr1
              У Вас в списке чатов есть чат с названием **Тестовый чат метадаты**
        - do: Запустить тестовое приложениие и октрыть список чатов
        - assert: Открывается список чатов
        - do: Открыть чат из description
        - assert: Открывается чат из description
        - do: Вызвать контекстное меню для сообщения собеседника (сообщение с текстом "Приветственное сообщение")
        - assert: |
              Появляется контекстное меню для данного сообщения
              В контекстном меню есть пункт "Пожаловаться"
        - do: Нажать на пункт "Пожаловаться"
        - assert: Появляется попап с возможностью отправить жалобу (жалобу отправлять ненужно!)

    Происходит стандартный механизм жалобы если у пользователя не установлена метадата с complain_action[manual]:
        - automation:
        - description: |
              На тестовом аккаунте нельзя создавать дополнительные чаты и удалять тестовый чат!
              Авторизоваться в приложении данным аккаунтом  yndx-mssngr-880 / QazMssngr1
              У Вас в списке чатов есть чат с названием **Цветочный магазин**
        - do: Запустить тестовое приложениие и октрыть список чатов
        - assert: Открывается список чатов
        - do: Открыть чат из description
        - assert: Открывается чат из description
        - do: Нажать по шапке чата
        - assert: Открылась карточка чата
        - do: Нажать на пункт "Пожаловаться"
        - assert: Появляется попап с возможностью отправить жалобу (жалобу отправлять ненужно!)

files: []

v-team: Chat

tlds: ru

tags:
    - yamb
    - y-team
