feature: form

specs:
  aliases:
    - &StartSearchForm
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая страница для test_search-form — турбо)
      - assert: открывается турбо-страница в новой вкладке
    - &StartSearchFormWindows1251
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая страница для test_search-form_windows-1251 — турбо)
      - assert: открывается турбо-страница в новой вкладке

  Форма поиска preset=search:
    beforeEach:
      - do: при дальнейшей проверке указанных ожидаемых результатов обращайте внимание на любые некорректные на ваш взгляд поведения, основываясь на свой опыт использования web-приложений (например, сохранение позиции при переходах туда-обратно кнопками на устройстве, пустые экраны при переходах, кривая верстка, скачкИ элементов, плавность скролла, неработающая функциональность и т.п.)

    afterEach:
      - tech: не должно быть клиентских ошибок

    replace-query:
      Пустой поисковый запрос:
        - params:
            foreverdata: '1758874510'
        - *StartSearchForm
        - do: кликнуть в поле ввода
        - do: нажать в поле на кнопку с лупой
        - assert: не произошло отправки формы
        - screenshot: внешний вид аналогичен примеру [error]

      Отправка формы:
        - do: открыть ссылку yandex.ru/turbo?stub=form/preset-search-replace-query.json
        - do: ввести "станция" в поле ввода
        - do: нажать в поле на кнопку с лупой
        - assert: открылась новая вкладка по адресу https://www.mvideo.ru/product-list-page-cls?q=станция&region_id=1&limit=3

      Отправка формы с кодировкой windows-1251:
        - params:
            foreverdata: '3305077141'
        - browsers:
            notFor:
              - searchapp
              - android-pp-4.99-touch
              - android-pp-7-touch
        - *StartSearchFormWindows1251
        - do: ввести "плов" в поле поиска
        - do: нажать в поле на кнопку с лупой
        - assert: |
            открылась новая вкладка сайта "www.povarenok.ru"
            в поле поиска на сайте введена строка "Плов" (регистр букв не важен)

      Отправка postMessage в android ПП в оверлее:
        - params:
            foreverdata: '1758874510'
        - browsers:
          - searchapp
          - android-pp-4.99-touch
          - android-pp-7-touch
        - *StartSearchForm
        - do: ввести "станция" в поле ввода
        - do: нажать в поле на кнопку с лупой
        - assert: открылась новая вкладка по адресу https://www.mvideo.ru/product-list-page-cls?q=станция&region_id=1&limit=3

    replace-action:
      Пустой поисковый запрос:
        - params:
            foreverdata: '1227738537'
        - *StartSearchForm
        - do: кликнуть в поле ввода
        - do: нажать в поле на кнопку с лупой
        - assert: не произошло отправки формы
        - screenshot: внешний вид аналогичен примеру [error]

      Отправка формы:
        - do: открыть ссылку yandex.ru/turbo?stub=form/preset-search-replace-action.json
        - do: ввести "search/touch" в поле ввода
        - do: нажать в поле на кнопку с лупой
        - assert: открылась новая вкладка по адресу https://yandex.ru/search%2Ftouch/search?a=b&c=d (страница Ошибка 404)

      # пока нет проверки отправки/неотправки именно в iframe
      Отправка формы в iframe [manual]:
        - automation: TURBOUI-287
        - params:
            foreverdata: '1227738537'
        - *StartSearchForm
        - do: ввести "search/touch" в поле ввода
        - do: нажать в поле на кнопку с лупой
        - assert: открылась новая вкладка по адресу https://yandex.ru/search%2Ftouch/search?a=b&c=d (страница Ошибка 404)

      Отправка postMessage в android ПП в оверлее:
        - params:
            foreverdata: '1227738537'
        - browsers:
            - searchapp
            - android-pp-4.99-touch
            - android-pp-7-touch
        - *StartSearchForm
        - do: ввести "search/touch" в поле ввода
        - do: нажать в поле на кнопку с лупой
        - assert: открылась новая вкладка по адресу https://yandex.ru/search%2Ftouch/search?a=b&c=d

    Форма поиска внутри турбо:
      Поиск по пустому значению:
        - do: открыть страницу https://yandex.ru/turbo?stub=form/in-turbo-search.json
        - assert: на странице есть форма поиска с введенным текстом
        - screenshot: внешний вид соответствует скриншоту [plain]
        - do: кликнуть на крестик
        - assert: форма очистилась
        - do: кликнуть на лупу
        - assert: страница перезагрузилась и ведет на https://yandex.ru/turbo?text=about&query=&param1=param2

      Поиск по значению:
        - do: открыть страницу https://yandex.ru/turbo?stub=form/in-turbo-search.json
        - assert: на странице есть форма поиска с введенным текстом
        - do: кликнуть на лупу
        - assert: страница перезагрузилась и ведет на https://yandex.ru/turbo?text=about&query=красные+брюки&param1=param2

  Форма в android ПП:
    В postMessage передается абсолютный url, когда в action относительный:
      - browsers:
          - searchapp
      - params:
          foreverdata: '86974714'
      - do: получить выдачу по запросу 'foreverdata' и кликнуть в заголовок первого сниппета (название заголовка Тестовая cтраница для Form с target для отдельной вкладки — турбо)
      - assert: открывается турбо-страница в той же вкладке (в поисковом приложении Яндекс турбо-страница открывается в новой вкладке)
      - assert: на странице есть форма
      - do: нажать "Отправить"
      - assert: в новой вкладке открылась страница https://yandex.ru/turbo?text=test_news

files:
  - features/touch-phone/blocks/form/form.hermione.js

v-team: Turbo

manager: tanzwuta

qa-engineer: spv, dakhetov

tlds: none
