feature: Внешняя анкета
type: Новый сотрудник

description: |
    у вакансии должен быть тип 'Новый сотрудник'
    создать оффер со значением 'Новый сотрудник' в поле 'Тип вывода'
    оффер со значением 'Российская' в поле 'Тип анкеты'
    после отправки анкеты на странице оффера в разделе 'Профиль' заполнились поля значениями соответствующими введенным ранее
    после отправки анкеты на странице оффера появилась ссылка в поле 'Оффер в наниматоре'
    на странице оффера в наниматоре на стаффе предзаполнены ранее заполненные поля в анкете
    в тикете THR описание заполнено значениями из анкеты
    для вывода сотрудника на стафф необходимо найти нужный препрофайл в админке https://staff.test.yandex-team.ru/admin/preprofile/preprofile/
    перейти в него и заполнить поля Uid и Guid уникальными значениями (формат можно подсмотреть у других сотрудников тут https://staff.test.yandex-team.ru/admin/django_intranet_stuff/staff/)
    нажать на кнопку в препрофайле стаффа 'Утвердить и отправить'
    после этого дождаться статуса 'Готов к выводу', тогда появится кнопка 'Вывести на стафф'
    клик на кнопку 'Вывести на стафф', у препрофайла должен стать статус 'Выведен'
    проверить пророс ли номер электронной подписи или нет можно пройдя по ссылке https://staff.test.yandex-team.ru/admin/django_intranet_stuff/staff/
    найти по ссылке выведенного сотрудника и зайти на его страницу
    если телефон пророс, то в разделе 'Staff phones' рядом с введенным ранее телефоном должна стоять галочка 'For digital sign'

specs:
  beforeEach:
    - do: открыть страницу https://femida-ext.test.yandex-team.ru/hire/offers/<id_анкеты> (если правки на стенде, надо указывать доменную часть стенда)
    - screenshot: открылась анкета нового сотрудника [external_questionnaire_form]
  Проверка обязательных полей:
    - do: клик на кнопку 'Отправить'
    - screenshot: под всеми обязательными полями вывелись ошибки [external_questionnaire_form_errors]
  Проверка ошибок логина:
    - do: ввести в поле 'Логин' менее 4х символов
    - screenshot: под полем отобразилась ошибка [short_username_error]
    - do: вести в поле 'Логин' большие буквы, кириллицу, недопустмые символы
    - screenshot: под полем отобразилась ошибка [invalid_symbols_username_error]
  Проверка ошибок файловых полей [manual]:
    - automation: FEMIDA-5662
    - do: выбрать файл в поле 'Фото' больше 5 MB
    - screenshot: под полем отобразилась ошибка [https://jing.yandex-team.ru/files/grikyan91/Rabota_v_Yandekse_2020-06-03_13-24-04.png]
    - do: выбрать в поле 'Гражданство' значение 'Российское'
    - do: выбрать в поле 'Паспорт' файл более 5 MB и более 30и файлов
    - do: выбрать в поле 'СНИЛС' файл более 5 MB
    - assert: |
        под полями с более 5 MB файлами отобразились ошибки
        в поле 'Паспорт' загрузилос только первые 30 файлов
        кнопки 'Добавить файл' пропали
    - screenshot: пример внешнего вида [https://jing.yandex-team.ru/files/grikyan91/Rabota_v_Yandekse_2020-06-03_13-36-56.png]
  Проверка ошибок ЭЦП:
    - do: заполнить поле 'Контактный телефон' своим номером телефона
    - do: установить галочку в поле 'Я хочу выпустить ЭЦП'
    - screenshot: открылся попап [eds]
    - do: клик на 'Принять' в попапе
    - assert: появилась кнопка 'Отправить смс для подтверждения'
    - do: клик на кнопку 'Отправить смс для подтверждения'
    - screenshot: появилось поле для ввода кода из смс [eds_code_input]
    - do: ввести неверный код
    - do: клик на кнопку 'Подтвердить'
    - screenshot: появилось сообщение об ошибке [eds_invalid_code_error]
    - do: ввести еще 2 раза неверный код
    - do: клик на кнопку 'Подтвердить'
    - assert: |
        поле для ввода кода пропало
        появилась кнопка 'Отправить смс для подтверждения'
        появилось сообщение об ошибке
    - screenshot: пример внешнего вида [eds_invalid_code_3_errors]
    - do: клик на кнопку 'Отправить смс для подтверждения'
    - assert: появилось поле для ввода кода из смс
    - do: введить корректный код из смс
    - do: клик на кнопку 'Подтвердить'
    - assert: телефон успешно привязался
  Проверка ошибок валидации:
    - do: выбрать в поле 'Гражданство' значение 'Российское'
    - do: заполните поле 'Дата рождения' с разделителями помимо '.' или указав больше символов чем положено
    - do: заполните поле 'Контактный телефон' без '+' либо введите менее 10 символов после плюса
    - do: заполните поле 'Личный email' без доменной части, либо используя кириллицу
    - do: введите в поле 'БИК' менее 9 символов
    - do: введите в поле 'Расчетный счет' менее 20 символов
    - do: введите в поле 'Номер карты' менее 13 символов
    - do: клик на кнопку 'Отправить'
    - screenshot: под всеми заполненными полями выдались соответствующие ошибки [external_questionnaire_form_errors]
    - do: заполните все обязательные поля корректными значениями
    - do: в поле 'Дата рождения' введите невалидный год/дата/месяц
    - do: клик на кнопку 'Отправить'
    - screenshot: под полем 'Дата рождения' отобразилась ошибка [external_questionnaire_form_errors2]
  Отправка анкеты:
    - do: заполнить поле 'Фамилия'
    - do: заполнить поле 'Имя'
    - do: заполнить поле 'Отчество'
    - do: заполнить поле 'Фамилия латиницей'
    - do: заполнить поле 'Имя латиницей'
    - do: заполнить поле 'Фото'
    - do: заполнить поле 'Дата рождения'
    - do: выбрать значение в поле 'Пол'
    - do: заполнить поле 'Логин'
    - do: заполнить поле 'Личный email'
    - do: выбрать значение в поле 'Операционная система'
    - do: выбрать значение в поле 'Дата выхода на работу'
    - do: выбрать значение в поле 'Гражданство'
    - assert: |
        появилось поле 'Паспорт'
        появилось поле 'СНИЛС' (если выбрано гражданство 'Российское')
        появилось поле 'Адрес проживания'
    - do: выбрать несколько файлов в поле 'Паспорт'
    - do: выбрать значение в поле 'СНИЛС' (если гражданство российское)
    - do: заполнить поле 'Адрес проживания'
    - do: выбрать значение в поле 'Будет ли у вас трудовая книжка к дате выхода на работу?'
    - do: заполнить поле 'Наименование банка'
    - do: заполнить поле 'БИК'
    - do: заполнить поле 'Расчетный счет'
    - do: заполнить поле 'Номер карты'
    - do: установить галочку в поле 'Я хочу выпустить ЭЦП'
    - screenshot: открылся попап [eds]
    - do: клик на 'Принять' в попапе
    - assert: появилась ссылка 'Укажите контактный телефон'
    - screenshot: внешний вид поля [eds_without_phone]
    - do: клик на ссылку 'Укажите контактный телефон'
    - assert: произошел подскролл страницы к полю 'Контактный телефон'
    - do: заполнить поле 'Контактный телефон' своим номером телефона
    - do: вернуться к разделу 'Электронная подпись'
    - assert: |
        появилась кнопка 'Отправить смс для подтверждения'
        появилась ссылка 'Изменить'
    - screenshot: внешний вид поля [eds_with_phone]
    - do: клик на ссылку 'Изменить'
    - assert: произошел подскролл к полю 'Контактный телефон'
    - do: вернуться к разделу 'Электронная подпись'
    - do: клик на кнопку 'Отправить смс для подтверждения'
    - screenshot: появилось поле для ввода кода из смс [eds_code_input]
    - do: ввести код из смс
    - assert: кнопка 'Подтвердить' стала активна
    - do: клик на кнопку 'Подтвердить'
    - screenshot: появилось сообщение о подтвержденном телефоне [eds_code_input_success]
    - do: выбрать значение в поле 'Образование'
    - do: выбрать значение в поле 'Направление'
    - do: заполнить поле 'Учебное заведение'
    - do: заполнить поле 'Дата окончания'
    - do: заполнить поле 'Комментарий'
    - do: поставить галочку в поле согласия передачи персональных данных
    - do: поставить галочку в поле 'Принимаю соглашение о неразглашении (NDA)'
    - screenshot: открылся попап с описанием условий [nda_agreement]
    - do: клик на 'Принять' в попапе
    - screenshot: пример внешнего вида заполненной анкеты [external_questionnaire_form_filled]
    - do: клик на 'Отправить'
    - screenshot: выдало сообщение с благодарностью [external_questionnaire_form_success]

tags:
  - reviewed

priority: critical

browsers:
  - yandex-browser-desktop
  - firefox-desktop
  - safari-desktop

files:
  - tests/hermione/suites/desktop/external_profiles/new_employee/new_employee.hermione.js
