feature: Файловый сниппет
type: Сохранение файла на Яндекс.Диск

import-labels:
  - features/common/mime-view/mime-view.testpalm.yml

specs-integration:
  Присутствует на странице без логина:
    - counter: '/$page/$main/$result/ooconverter/unlogin'
    - do: получить выдачу по запросу 'капибара' с параметром mime=pdf
    - assert: кнопка 'Сохранить на Яндекс.Диск' присутствует в сниппете
  Присутствует на странице с залогином:
    - counter: '/$page/$main/$result/ooconverter/save'
    - do: получить выдачу по запросу 'капибара' с параметром mime=pdf и быть авторизованным
    - assert: кнопка 'Сохранить на Яндекс.Диск' присутствует в сниппете

specs:
  Без логина:
    - do: получить выдачу по запросу 'капибара' с параметром &mime=pdf
    - screenshot: в сниппетах присутствует кнопка 'Сохранить на Яндекс.Диск' [mime-view--{{PLATFORM}}-{{BROWSER_TYPE}} >> plain]
    - do: нажать на кнопку 'Сохранить на Яндекс.Диск'
    - assert: ссылка ведёт на форму авторизации в Паспорте
    - tech: проверить счётчик в кнопке '/$page/$main/$result/ooconverter/unlogin'
    - assertMetrics: "*"
  С залогином:
    - do: произвести залогин через шапку и вернуться на Поиск
    - do: получить выдачу по запросу 'капибара' с параметром &mime=pdf
    - screenshot: в сниппетах присутствует кнопка 'Сохранить на Яндекс.Диск' [mime-view--{{PLATFORM}}-{{BROWSER_TYPE}} >> plain]
    - do: кликнуть по кнопке 'Сохранить на Яндекс.Диск'
    - tech: проверить счётчик в кнопке '/$page/$main/$result/ooconverter/save'
    - tech: клиентских ошибок быть не должно
    - assertMetrics: "*"
  Кнопка "Открыть Яндекс.Диск":
    - do: произвести залогин через шапку и вернуться на Поиск
    - do: получить выдачу по запросу 'капибара' с параметром &mime=pdf
    - screenshot: в сниппетах присутствует кнопка 'Сохранить на Яндекс.Диск' [mime-view--{{PLATFORM}}-{{BROWSER_TYPE}} >> plain]
    - do: кликнуть по кнопке 'Сохранить на Яндекс.Диск'
    - assert: кнопка 'Сохранить на Яндекс.Диск' исчезла
    - assert: появилась кнопка 'Открыть Яндекс.Диск'
    - assertMetrics: "*"

files:
  - features/desktop/adapters/adapter-mime-view.hermione.e2e.js
  - features/desktop/adapters/adapter-mime-view.hermione.js

tags:
  - reviewed
  - zalogin
  - distribution

tlds:
  - ru

v-team: Distribution
