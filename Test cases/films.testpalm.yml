feature: Объектный ответ
type: Карусель фильмов
counter: /$page/$top/$result[@wizard_name="entity_search"]/carousel

specs-integration:
  Присутствует на странице:
    - tags: smoke
    - counters: /$page[@ui="desktop"]/$top/$result[@wizard_name="entity_search"]/carousel/filters/select|/$page[@ui="desktop"]/$main/$result[@wizard_name="entity_search"]/carousel/showcase/item
    - do: получить выдачу по запросу «фильмы» _ALTERNATIVE_SEARCH_QUERIES_
    - assert: на выдаче есть карусель фильмов
    - assert: у карусели есть фильтры (Например, Жанр или Год выпуска) https://nda.ya.ru/t/kxCFCHlO3VxBxQ
    - assert: в карусели есть элементы

specs:
  Заголовок карусели c фильтрами при изменении размеров экрана:
    - do: получить выдачу по запросу 'фильмы'
    - assert: |
        на выдаче есть фильмовая карусель,
        в карусели есть титул с фильтрами
    - screenshot: пример внешнего вида [title-plain]
    - do: установить размер экрана 1667x1200
    - screenshot: пример внешнего вида [max-width-title]
    - do: установить размер экрана 1400x1200
    - screenshot: пример внешнего вида [middle-width-title]
    - assertMetrics: '*'
  Заголовок карусели c фильтрами при разных колонках:
    - do: получить выдачу по запросу 'сериалы'
    - assert: |
        на выдаче есть фильмовая карусель,
        в карусели есть титул с фильтрами
    - do: установить размер экрана 1230x1200
    - screenshot: пример внешнего вида [col10-title]
    - do: установить размер экрана 1130x1200
    - screenshot: пример внешнего вида [col8-title]
    - do: установить размер экрана 1030x1200
    - screenshot: пример внешнего вида [col6-title]
    - assertMetrics: '*'
  Положении карусели после скролла при открытии фильтров должно остаться на месте:
    - browsers:
        - 'chrome-desktop'
    - do: получить выдачу по запросу 'американские фильмы'
    - assert: |
        на выдаче есть фильмовая карусель,
        в карусели есть титул с фильтрами
    - do: кликнуть по кнопке "развернуть"
    - do: проскролить фильмовую карусель
    - do: кликнуть по любому из select-ов в фильтре
    - assert: положение карусели осталось на месте
    - assertMetrics: '*'
  Проверка отсутствия счетчика в Турции:
    В карусели фильмов:
      - params:
          tld: com.tr
      - do: получить выдачу по запросу 'Фильмы 2018' на Турецком домене yandex.com.tr/
      - assert: |
          на выдаче есть карусель
          на выдаче отсутствует счетчик оценок справа в углу
      - assertMetrics: '*'
    В карточке в правой колонке:
      - params:
          tld: com.tr
      - do: получить выдачу по запросу 'монстры на каникулах 3' на Турецком домене yandex.com.tr/
      - assert: |
          на выдаче есть карточка справа
          в карточке присутствует блок с оценками
          в этом блоке рядом с надписью "Ваша оценка" отсутствует знак вопроса
      - assertMetrics: '*'
  Длинный заголовок:
    - do: получить выдачу по запросу 'фильмы' с параметром &ento=0oEg9sc3QtMTMyMjBiOWEuLjAYAoR86T4
    - screenshot: пример внешнего вида длинного заголовка [carousel-long-title]

  Дозагрузка элементов в свёрнутую карусель:
    beforeEach:
      - do: получить выдачу по запросу 'фильмы комедии' ('мультики дисней', 'все фильмы 2020')
      - assert: появилась карусель фильмов
    После смены поискового запроса:
      - tags: smoke_extended
      - do: кликнуть второй фильм в карусели
      - assert: выдача перезагрузилась, карусель не изменилась
      - do: проскроллить карусель до конца
      - assert: новые элементы дозагружаются в карусель

    Без смены поискового запроса:
      - tags: smoke_extended
      - do: скроллить карусель, динамически дозагружая элементы карусели, пока все элементы не будут загружены
      - do: кликнуть кнопку 'Развернуть' (в правом верхнем углу, кнопка в виде двух стрелочек)
      - assert: карусель развернулась
      - do: доскроллить до выдачи под каруселью
      - assert: выдача под развернутой каруселью видна

    Rum метрика дозагрузки:
      - tags: no_assessors
      - do: проскролить карусель до начала динамической загрузки элементов карусели
      - tech: |
          проверить наличие счётчика '/tech/perf/delta'
          с counterId='object-answer_desktop_carousel'
          и наличие в нем переменных time.start, time.end, delta

  После аякс-перезапроса:
    - tags: [smoke, smoke_extended]
    - do: получить выдачу по запросу 'тест'
    - do: сделать перезапрос 'американские фильмы'
    - assert: появилась карусель фильмов
    - do: навести курсор на второй элемент карусели (шаг только для десктопов)
    - assert: появилась карточка фильма с описанием и примерным набором кнопок Смотреть, Трейлер, Оценить, Скрыть (шаг только для десктопов)
    - do: кликнуть/нажать на карточку
    - assert: второй элемент в карусели приподнялся вверх и у него появилась белая полупрозрачная подложка
    - screenshot: пример внешнего вида (незначительные детали могут не совпадать) [plain]
    - assert: произошло обновление выдачи под каруселью
    - do: кликнуть кнопку 'Развернуть'
    - screenshot: пример внешнего вида (незначительные детали могут не совпадать) [expanded]
    - assert: карусель развернулась
    - do: кликнуть первый фильм
    - assert: карусель свернулась

  Скроллинг развернутой карусели:
    С дозагрузкой элементов:
      beforeEach:
        - do: получить выдачу по запросу 'фильмы'
        - assert: появилась карусель фильмов
        - do: кликнуть кнопку 'Развернуть'
        - assert: карусель развернулась

      Фиксированная шапка карусели:
        - tags: smoke_extended
        - do: проверить развёрнутую карусель
        - screenshot: пример внешнего вида фиксированной шапки [plain]
        - assert: у карусели есть шапка с фильтрами по жанру, популярности и году
        - do: проскроллить развернутую карусель вниз
        - assert: шапка карусели видна
        - do: скроллить вниз, динамически дозагружая элементы карусели, пока все элементы не будут загружены, доскроллить до выдачи под каруселью
        - assert: шапка карусели исчезает
        - do: проскроллить вверх до карусели
        - assert: шапка карусели видна

      При дозагрузке элементов карусели скрываем СЕРП:
        - tags: smoke_extended
        - do: проскроллить развернутую карусель вниз (СОВСЕМ ДО КОНЦА КАРУСЕЛИ СКРОЛИТЬ НЕ НАДО) до появления индикатора загрузки (при быстром интернете индикатор может не появится - это не баг)
        - assert: |
                выдача под развернутой каруселью не видна
                футер под развернутой каруселью не виден
                (если доскролить совсем до конца карусели и выдача с футером видны, то это не баг)

    СЕРП под полностью загруженной каруселью:
      - tags: smoke_extended
      - do: получить выдачу по запросу 'американские фильмы'
      - assert: появилась карусель фильмов
      - do: кликнуть кнопку 'Развернуть'
      - assert: карусель развернулась
      - do: скроллить вниз, динамически дозагружая элементы карусели, пока все элементы не будут загружены, доскроллить до выдачи под каруселью
      - assert: выдача под развернутой каруселью видна
      - do: доскроллить до футера под выдачей
      - assert: футер под выдачей виден

    С раскрытым фильтром:
      - do: получить выдачу по запросу 'американские фильмы'
      - assert: появилась карусель фильмов
      - do: кликнуть кнопку 'Развернуть'
      - assert: карусель развернулась
      - do: нажать на любой фильтр
      - assert: появился список возможных вариантов фильтра
      - do: поскроллить карусель (список вариантов фильтра может менять свое положение)
      - assert: после скролла список с возможными вариантами фильтра отображается на том же месте, где был до скролла
      - screenshot: внешний вид [same-position-expanded-filter]

  Пустая фильмовая карусель:
    - tags: smoke_extended
    - do: получить выдачу по запросу 'российские сериалы'
    - assert: появилась карусель американских сериалов 
    - do: в фильтре жанров выбрать 'аниме' (при необходимости изменить другие фильтры, например 'за все время' выставить год, так чтобы карусель стала пустой)
    - screenshot: пример внешнего вида (незначительные детали могут отличаться) [empty-carousel]
    - assert: появилась пустая карусель фильмов

  Заголовок кликабельный:
    - params:
        foreverdata: '561656211'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: появляется карусель фильмов
    - screenshot: пример внешнего вида [plain]
    - do: кликнуть по заголовку карусели
    - assert: карусель развернулась
    - tech: сработал счетчик после клика по заголовку карусели
    # - screenshot: пример внешнего вида [expanded]
    - do: кликнуть по заголовку карусели ещё раз
    - assert: карусель свернулась

  Заголовок кликабельный справа:
    - params:
        foreverdata: '1700013135'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: появляется карусель фильмов
    - screenshot: пример внешнего вида [plain]
    - do: кликнуть по главному заголовку карусели ("Фильмы" справа)
    - assert: карусель развернулась
    # - screenshot: пример внешнего вида [expanded]
    - tech: сработал счетчик после клика по заголовку карусели
    - do: кликнуть по заголовку карусели ещё раз
    - assert: карусель свернулась

  Заголовок с иконкой:
    - tlds: [by, kz, ua, com.tr, com]
    - do: получить выдачу по запросу 'фильмы' и параметром &ento=entlist=lst.vtrfilm
    - assert: появляется карусель фильмов
    - screenshot: пример внешнего вида [plain]

  Нажатие на фильтр после скролла карусели:
    - do: получить выдачу по запросу 'хороший доктор сериал'
    - assert: появился карточка фильма в правой колонке
    - do: нажать на ссылку у факта 'Страна:'
    - assert: появилась карусель с фильмами и фильтрами
    - do: нажать на кнопку 'Развернуть'
    - assert: карусель развернулась
    - do: проскроллить развернутую карусель немного вниз
    - do: нажать на фильтр в шапке карусели
    - assert: список в развернутой карусели не проскроллися на начало, он остался на той же позиции
    - do: выбрать первое значение в фильтре
    - assert: выдача должна перезагрузиться

  Дозагрузка элементов в свёрнутую карусель с фильтрами:
    - do: получить выдачу по запросу 'американские фильмы 2018 года список'
    - assert: появилась карусель фильмов
    - do: проскроллить карусель вправо
    - assert: дозагрузились новые элементы карусели

files:
  - features/desktop/z-entity-search/carousel/films/films.hermione.js
  - features/desktop/z-entity-search/carousel/films/films.hermione.e2e.js

v-team: Video

tags:
  - hasE2E
  - oo_lists

tlds: [ru, by, kz, ua, com.tr, com]
