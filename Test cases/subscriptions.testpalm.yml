feature: Подписки на странице сервиса "Трекер"

description: |
  Preconditions.
  Для выполнения тестов нужно иметь аккаунты из организаций с включенным трекером:
  (1) Администратора организации
    - без подписок
    - с правом редактировать подписки
    - c заполненной платежнуой информацией
    - с больше чем 5 сотрудниками

  (2) Администратора организации
    - с подписками
    - с правом редактировать подписки
    - c заполненной платежнуой информацией

  (3) Пользователя организации
    - с подписками
    - без права редактировать подписки
  Например User: simpleauser@ui-test2.yaconnect.com Пароль: qwerty123456

  (4) Администратора организации
    - без подписок
    - с правом редактировать подписки
    - без заполненной платежнуой информации

specs:
  Положительные:
    1. Добавление и отзыв подписок:
      - do: авторизоваться под администратором организации без подписок с правом редактировать подписки с больше чем 5 сотрудниками(1) из Preconditions
      - do: открыть страницу сервиса "Трекер" {{CONNECT_HOST}}/portal/services/tracker
      - assert: отображается страница без подписок
      - screenshot: внешний вид вкладки "Подписки" при отсутствии подписок [plain]
      - do: нажать на кнопку "Оформить подписку"
      - assert: окно с переходом в заполнение платежной информации не отображается
      - assert: появилось модальное окно "Оформление подписок"
      - assert: в модальном окне "Оформление подписок" отображается кнопка "Рассчитать для всех сотрудников"
      - assert: кнопка "Оформить подписки" не отображается
      - screenshot: внешний вид модального окна "Оформление подписок" [modal-plain]
      - do: нажать на кнопку "Рассчитать для всех сотрудников" (в отделе "Все сотрудники" должно быть больше 5 сотрудников)
      - assert: в подвале модального окна поменялся тариф
      - screenshot: внешний вид модального окна "Оформление подписок" [modal-all]
      - do: удалить подписку на "Всех сотрудников" кликом по кнопке с мусорным бачком рядом с названием отдела
      - do: выбрать трёх пользователей из саджеста
      - assert: отображается кнопка "Оформить подписки"
      - assert: в подвале модального окна отображается расчёт тарифа - "0 ₽ всего в месяц"
      - screenshot: внешний вид модального окна "Оформление подписок" [modal-some]
      - do: нажать на кнопку "Оформить подписки" в модальном окне
      - screenshot: отображается сообщение "Подписки успешно оформлены" [notification]
      - do: нажать на Крестик
      - assert: на вкладке "Подписки" отображается количество подписок
      - screenshot: на вкладке "Подписки" отображаются добавленные подписки [subscribers]
      - assert: при наведении на подписку отображается кнопка "Отозвать подписку"
      - screenshot: внешний вид вкладки "Подписки" с кнопкой "Отозвать подписку" [subscribers-button]
      - do: нажать на кнопку "Отозвать подписку"
      - screenshot: отображается сообщение "Подписка успешно отозвана" [notification-del]
      - do: нажать на Крестик
      - assert: подписка удалилась из списка
      - screenshot: внешний вид вкладки "Подписки" [subscribers-del]
      - do: нажать на галочку около количества подписок
      - assert: выделились все подписки
      - assert: сверху на странице появилось сообщение о выбранных подписках с кнопкой "Отозвать подписки"
      - assert: показывается количество выбранных сотрудников
      - screenshot: внешний вид сообщения о выбранных подписках [subscribers-select]
      - do: отжать галочку у первой подписки
      - assert: количество выбранных сотрудников на сообщении внутри страницы пересчиталось
      - screenshot: внешний вид сообщения о выбранных подписках [subscribers-unselect]
      - do: нажать на кнопку "Отозвать подписки" в сообщении о выбранных подписках
      - screenshot: отображается сообщение "Подписки успешно отозваны" [notification-del2]
      - do: нажать на Крестик
      - screenshot: на вкладке подписок осталась одна строка с подпиской [subscribers-last]
      - do: нажать на кнопку "Отозвать подписку" на единственной строке из списка
      - assert: отображается сообщение "Подписка успешно отозвана"
      - do: нажать на крестик
      - assert: все подписки отозваны
      - screenshot: внещний вид страницы без подписок [subscribers-empty]
  Отрицательные:
    1. Закрытие модального окна "Оформление подписок" по клику на крестик:
      - do: авторизоваться под администратором организации с подписками с правом редактировать подписки (2) из Preconditions
      - do: открыть страницу сервиса "Трекер" {{CONNECT_HOST}}/portal/services/tracker
      - do: нажать на кнопку "Оформить подписку"
      - assert: появилось модальное окно "Оформление подписок"
      - do: кликнуть на крестик
      - assert: модальное окно "Оформление подписок" закрылось
    2. Удаление пользователя в модальном окне "Оформление подписок":
      - do: авторизоваться под администратором организации без подписками с правом редактировать подписки (1) из Preconditions
      - do: открыть страницу сервиса "Трекер" {{CONNECT_HOST}}/portal/services/tracker
      - do: нажать на кнопку "Оформить подписку"
      - assert: появилось модальное окно "Оформление подписок"
      - do: выбрать любого пользователя из саджеста
      - assert: при наведении на пользователя отображается корзина
      - screenshot: внешний вид модального окна с отображение корзины [plain]
      - do: нажать на корзину
      - do: пользователь удалился из списка
    3. Для пользователя без прав - не отображается кнопка "Оформить подписку":
      - do: авторизоваться под пользователем организации с подписками без права редактировать подписки (3)
      - do: открыть страницу сервиса "Трекер" {{CONNECT_HOST}}/portal/services/tracker
      - do: кнопка "Оформить подписку" не отображается
      - screenshot: внешний вид вкладки "Подписки" без кнопки "Оформить подписку" [plain]
    4. Для пользователя без прав - не отображается кнопка "Отозвать подписку":
      - do: авторизоваться под пользователем организации с подписками без права редактировать подписки (3)
      - do: открыть страницу сервиса "Трекер" {{CONNECT_HOST}}/portal/services/tracker
      - do: кнопка "Отозвать подписку" не отображается при наведении на пользователя
      - screenshot: внешний вид вкладки "Подписки" без кнопки "Отозвать подписку" [plain]
    5. Происходит переход на страницу с формой если нет платежной информации:
      - do: авторизоваться под администратором организации без подписок с правом редактировать подписки без заполненной платежнуой информации (4)
      - do: открыть страницу сервиса "Трекер" {{CONNECT_HOST}}/portal/services/tracker
      - do: нажать на кнопку "Оформить подписку"
      - assert: выполнился переход на страницу "Создание платежного аккаунта" {{CONNECT_HOST}}/portal/balance/contract

priority: blocker

tlds:
 - ru
 - com

files:
  - tests/hermione/suites/services/subscriptions.js

tags:
  - smoke_test_assessors
  - regression
  - smoke_test
  - reviewed
  - smoke_test_mini
