feature: Объектный ответ
type: Выбор кинотеатра

priority: normal
tlds: ru

aliases:
  - &CheckContentKP
    - do: получить выдачу по запросу "джентльмены" (отряд самоубийц, море соблазна, вторжение фильм)
    - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Смотреть/Купить"
  - &CheckContentSoapKP
    - do: получить выдачу по запросу "твин пикс" (пищеблок, топи, рик и морти, время приключений)
    - assert: в выдаче есть карточка ОО сериала и заглушка с кнопкой "Смотреть/Купить"
  - &CheckContentMoreTv
    - do: получить выдачу по запросу "рассказ служанки" (чики,а регби сериал, хэппи энд, нави рождённые побеждать фильм)
    - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Смотреть/Купить"
  - &CheckContentAmediateka
    - do: получить выдачу по запросу "игра престолов" (почему женщины убивают, мир дикого запада, чужак, добровольцы)
    - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Смотреть/Купить"
  - &CheckDrawerNoDouble
    - assert: в выдаче есть карточка запрашиваемого фильма с постером и кнопкой "Смотреть" (или "Купить" в зависимости от подписки)
    - do: кликнуть в заглушку
    - assert: отобразилась шторка с выбором кинотеатров
    - do: закрыть шторку
    - assert: шторка закрылась, отобразилась выдача, дополнительной (ещё одной) шторки не отображается

specs:
  Внешний вид заглушки и шторки:
    - label: cinema-choice-drawer-{{BROWSER_TYPE}}
    - params:
        foreverdata: '3613628615'
    - do: залогиниться в Яндексе
    - do: получить выдачу по запросу foreverdata
    - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "смотреть"
    - screenshot: внешний вид заглушки [stub]
    - do: кликнуть в заглушку
    - assert: отобразилась шторка с выбором кинотеатров
    - screenshot: внешний вид шторки [popup]

  Внешний вид заглушки с сериальным навигатором:
    - tags: pp_new_core
    - params:
        foreverdata: '3813745803'
    - do: залогиниться в Яндексе с подпиской Плюс
    - do: перейти по запросу "город ангел бэби сериал"
    - assert: в выдаче есть карточка фильма с заглушкой с постером фильма и кнопкой "Смотреть"
    - screenshot: внешний вид заглушки с корректным отступом до блока с сериями [cinema-choice-with-series-margin]

  Внешний вид шторки с диффом в сезонах и анонсами:
    - params:
        foreverdata: '2373432367'
    - do: получить выдачу по запросу foreverdata
    - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "смотреть"
    - do: кликнуть в заглушку
    - assert: отобразилась шторка с выбором кинотеатров
    - screenshot: внешний вид шторки [popup]
    - do: проскроллить шторку в самый низ до появления футера
    - screenshot: внешний вид [scroller-popup]

  Надпись на заглушке:
    Для незалогина:
      - params:
          foreverdata: '3613628615'
      - do: залогиниться в Яндексе
      - do: получить выдачу по запросу foreverdata
      - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Купить"
      - screenshot: внешний вид кнопки "Купить" [cinema-button-not-logged-in]
    Для залогина:
      beforeEach:
        - do: залогиниться в Яндексе
      Если есть хотя бы один доступный для просмотра вариант:
        - params:
            foreverdata: '466286556'
        - do: получить выдачу по запросу foreverdata
        - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Смотреть"
        - screenshot: внешний вид кнопки "Смотреть" [cinema-button-logged-in-with-watch]
      Если нет доступного для просмотра (только покупной) варианта:
        - params:
            foreverdata: '3613628615'
        - do: получить выдачу по запросу foreverdata
        - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Купить"
        - screenshot: внешний вид кнопки "Купить" [cinema-button-logged-in-with-buy]

  Переход по ссылке "Условия подключения для партнёров":
    - do: получить выдачу по запросу "один дома"
    - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Смотреть"
    - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
    - do: нажать на кнопку "смотреть" в ОО
    - assert: появился попап с вариантами просмотра
    - do: в попапе нажать на ссылку Условия подключения для партнеров
    - assert: произошел переход на страницу условия подключения для партнера

  Корректная работа шторки при ajax-запросах:
    - do: перейти по запросу "Джентльмены"
    - *CheckDrawerNoDouble
    - do: отскроллить вверх к поисковой стрелке и ввести запрос "Пацаны"
    - *CheckDrawerNoDouble
    - do: нажать браузерную кнопку назад
    - *CheckDrawerNoDouble

  Отображение кнопки "Смотреть" в заглушке и попапе для разных типов подписок и контента:
    Без подписки, контент EST:
      beforeEach:
        - do: авторизоваться пользователем с купленным фильмом (test-serp-assessors-plus/hL5-tYe-VGX-fzg)
        - assert: пользователь авторизован
      Купленный фильм:
        - do: получить выдачу по запросу "Зверопой" (альтернативные запросы "Семейка Крудс", "Мадагаскар 1")  # 894109634
        - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Смотреть"
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Некупленный фильм:
        - params:
            foreverdata: '3498075232' # с форевердатой здесь удобней, т.к. выставления подписок в шестерёнке асессоры фейлят этот кейс
        - do: получить выдачу по запросу 'foreverdata' # "шрек 2004" (альтернативные запросы 'босс молокосос 2', 'дюна фильм 2021')  # 3498075232
        - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Купить"
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатров отображается цена для покупки и аренды контента

    Без подписки, контент TVOD:
      beforeEach:
        - do: авторизоваться пользователем с арендованным фильмом (oo-film@yandex.ru / o0film20)
        - assert: пользователь авторизован
      Арендованный фильм:
        - tags: [no_assessors] # сейчас ничего не арендовано
        - do: получить выдачу по запросу "бэтмен навсегда" # 1607803413
        - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Смотреть"
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' вместо цены отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Неарендованный фильм:
        - tags: [no_assessors] # сейчас ничего не арендовано
        - do: получить выдачу по запросу "один дома 2" (аватар 2009) # 2341990910
        - assert: в выдаче есть карточка ОО фильма и заглушка с кнопкой "Купить"
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра отображается цены аренды

    Подписка Плюс (YA_PLUS), SVOD контент:
      beforeEach:
        - do: авторизоваться пользователем с подпиской (test-serp-assessors-plus/hL5-tYe-VGX-fzg), не сохраняя пароль
        - assert: пользователь авторизован
      Кинопоиск фильм:
        - *CheckContentKP # 2865055241
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Кинопоиск сериал:
        - *CheckContentSoapKP # 1115111970
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Moretv:
        - *CheckContentMoreTv # 79466848
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке отображается название кинотеатра
      Amediateka:
        - *CheckContentAmediateka # 2620835695
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке отображается название кинотеатра

    Подписка Кинопоиск + more.tv (YA_PLUS_SUPER), SVOD контент:
      beforeEach:
        - do: авторизоваться пользователем с подпиской (test-serp-assessors-more/kAd-XRd-dkH-4Wp), не сохраняя пароль
        - assert: пользователь авторизован
      Кинопоиск фильм:
        - *CheckContentKP # 245812052
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Кинопоиск сериал:
        - *CheckContentSoapKP # 1998516636
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Moretv:
        - *CheckContentMoreTv # 103666125
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Amediateka:
        - *CheckContentAmediateka # 2620835695
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке отображается название кинотеатра

    Подписка Кинопоиск + Амедиатека (YA_PREMIUM), SVOD контент:
      beforeEach:
        - do: авторизоваться пользователем с подпиской (test-serp-assessors-amedia/XPw-QXu-bcH-3XW), не сохраняя пароль
        - assert: пользователь авторизован
      Кинопоиск фильм:
        - *CheckContentKP # 3719266555
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Кинопоиск сериал:
        - *CheckContentSoapKP # 3196166562
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Moretv:
        - *CheckContentMoreTv # 1959901309
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)
      Amediateka:
        - *CheckContentAmediateka # 1468331991
        - do: нажать на кнопку "Смотреть" в ОО
        - assert: в появившейся шторке рядом с названием кинотеатра 'Кинопоиск' отображается кнопка "Смотреть" (кинотеатров может быть несколько - это не баг)

    Без подписки SVOD контент:
      beforeEach:
        - do: авторизоваться пользователем без подписки (oo-film@yandex.ru / o0film20), не сохраняя пароль
        - assert: пользователь авторизован
      Кинопоиск фильм:
        - *CheckContentKP # 871809787
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке отображается название кинотеатра (кинотеатров может быть несколько - это не баг)
      Кинопоиск сериал:
        - *CheckContentSoapKP # 3055284685
        - screenshot: внешний вид заглушки [cinema-choice-drawer-{{BROWSER_TYPE}} >> stub]
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке отображается название кинотеатра (кинотеатров может быть несколько - это не баг)
      Moretv:
        - *CheckContentMoreTv # 79466848
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке отображается название кинотеатра (кинотеатров может быть несколько - это не баг)
      Amediateka:
        - *CheckContentAmediateka # 2620835695
        - do: нажать на кнопку "Купить" в ОО
        - assert: в появившейся шторке отображается название кинотеатра (кинотеатров может быть несколько - это не баг)

  Просмотр:
    Фильма доступного по подписке:
      - tags: pp_new_core
      - do: авторизоваться в Яндексе пользователем с подпиской Плюс
      - do: перейти по запросу "Джентльмены"
      - assert: на выдаче есть карточка фильма
      - do: кликнуть в обложку фильма и в выпадающем меню выбрать пункт с просмотром на Кинопоиске
      - assert: |
          шторка со списком кинотеатров закрылась
          началось проигрывание фильма, обложка фильма скрыта
          не произошёл переход на Кинопоиск

    Фильма, который недоступен на поиске для просмотра:
      - do: авторизоваться в Яндексе пользователем с подпиской Плюс Амедиатека
      - do: перейти по запросу "Миллиарды"
      - assert: на выдаче есть карточка фильма
      - do: кликнуть в обложку фильма и в выпадающем меню выбрать пункт с просмотром на Кинопоиске
      - assert: |
          шторка со списком кинотеатров закрылась
          проигрывание фильма не началось, отображается обложка фильма
          произошёл переход на Кинопоиск

files:
  - features/touch-phone/z-entity-search/film-card/cinema-choice.hermione.js

v-team: Video

tags:
  - skip_e2e_check
