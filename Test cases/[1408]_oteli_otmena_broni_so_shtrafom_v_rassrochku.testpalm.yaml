feature: Отели
type: Бронирование
description: >-
  Для воспроизведения сценария нужно дернуть ручку ТК и забрать booking_url на
  выходе

  https://api.travel-balancer-test.yandex.net/api/test_context/v1/tokens?originalId=742&partnerId=PI_TRAVELLINE&occupancy=2&forceAvailability=true&cancellation=CR_PARTIALLY_REFUNDABLE&pansionType=PT_BB&offerName=testoffer&priceAmount=100000&partiallyRefundRate=30&partiallyRefundableInMinutes=0&getOfferOutcome=OO_SUCCESS&createOrderOutcome=OO_SUCCESS&hotelDataLookupOutcome=HO_REAL&reservationOutcome=RO_SUCCESS&confirmationOutcome=CO_SUCCESS&refundOutcome=RF_SUCCESS&priceMismatchRate=1.1&ignorePaymentScheduleRestrictions=true
specs:
  Отели. Отмена брони со штрафом в рассрочку:
    - do: >-
        Перейти на страницу брони оффера с действующим периодом штрафа в
        рассрочку
    - assert: |-
        Отрылась страница бронирования
        Есть информация об отмене со штрафом
        Указана сумма штрафа
        В блоке стоимости есть опции предоплаты и полной оплаты
        Сумма предоплаты совпадает с суммой штрафа за отмену
    - do: |-
        Выбрать опцию предоплаты
        Ввести валидные данные
        Кликнуть Оплатить
    - assert: |-
        Произошел переход на страницу оплаты
        Сумма к оплате совпадает с суммой штрафа на предыдущей странице
    - do: |-
        Ввести данные карты и кликнуть Оплатить
        В форме 3ds ввести код 200 и кликнуть Submit
    - assert: >-
        После прокрутки всех необходимых лоадеров отобразилась хэппи пейдж

        На странице есть инфа о необходимости внести доплату с указанием крайней
        даты и числа

        Есть сумма доплаты, равная полной стоимости отеля (указанной на брони) -
        предоплата
    - do: Кликнуть Подробнее о заказе
    - assert: |-
        Открылась страница заказа
        На странице есть суммы предоплаты, доплаты и полной стоимости (наверху)
        Все суммы совпадают с изначальными на странице бронирования
        В таймлайне ниже есть два периода - штрафной и неотменяемый
        Пометка сегодняшней даты стоит на штрафном периоде
        Сумма штрафа в таймлайне равна сумме предоплаты
        Ниже активна кнопка Отменить бронирование
    - do: Кликнуть Отменить бронирование
    - assert: >-
        В открывшемся окне есть информация о сумме штрафа, равной сумме
        предоплаты
    - do: Кликнуть Отменить бронирование
    - assert: |-
        После закрытия окна страница обновляется
        Вверху появляется заголовок Бронирование отменено
        Ниже указано, что удержан штраф и указана сумма штрафа
        Сумма штрафа равна предоплате
        По клику по ссылке "Чеки и документы" есть ссылки на чек платежа и чек возврата
    - do: Кликнуть на ссылку чека платежа
    - assert: |-
        Открылся модал чека прихода
        Сумма в чеке равна сумме рассрочки
    - do: >-
        Закрыть модал по крестику

        Кликнуть на чек возврата (если появляется попап что чек еще оформляется,
        перезагрузить страницу, если не поможет пару раз - скипнуть эту
        проверку, на тестинге часто не доступны чеки возврата)
    - assert: |-
        Открылся модал чека возврата прихода
        Сумма в чеке равна полной стоимости заказа за вычетом предоплаты
manual: true
Функциональность: Рассрочки
Устройство:
  - Тач
  - Десктоп
Страница:
  - Бронирование
  - Страница заказа
Сервис: Отели
Тестирование асессорами: Нет
Окружение:
  - Production
  - Testing
Tag:
  - Smoke
  - TK
Автор: iliasova
