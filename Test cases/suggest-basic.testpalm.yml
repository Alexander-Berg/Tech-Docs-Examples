feature: Саджест
type: Базовые проверки

specs:
  Инпут:
    beforeEach:
      - do: получить выдачу по запросу "тест"
      - assert: получена выдача по указанному запросу
      - do: кликнуть в кнопку "х" поисковой стрелки
      - assert: поисковая стрелка очищена
      - assert: инпут активен
    Вертикальная ориентация - увеличивается по высоте при переполнении текстом:
      - tags: [smoke_extended, suggest_regress]
      - do: набрать в поисковой строке очень длинный запрос "В конце ноября, в оттепель, часов в девять утра, поезд Петербургско-Варшавской железной дороги на всех парах подходил к Петербургу. Было так сыро и туманно, что насилу рассвело; в десяти шагах, вправо и влево от дороги, трудно было разглядеть хоть что-нибудь из окон вагона. Из пассажиров были и возвращавшиеся из-за границы"
      - screenshot: примерный внешний вид [suggest/input/portrait/overflow]
      - assert: инпут активен
      - assert: высота инпута, в котором текст отображается полностью - 5 строк. Если строк 5 и более, то появляется возможность скролла строк в инпуте. ВАЖНО - на некоторых девайсах в зависимости от размера экрана может отображаться 6 строк
      - assertMetrics: '*'
    Горизонтальная ориентация - не увеличивается по высоте при переполнении текстом:
      - do: перевернуть девайс в горизонтальную ориентацию
      - do: набрать в поисковой строке очень длинный запрос "В конце ноября, в оттепель, часов в девять утра, поезд Петербургско-Варшавской железной дороги на всех парах подходил к Петербургу. Было так сыро и туманно, что насилу рассвело; в десяти шагах, вправо и влево от дороги, трудно было разглядеть хоть что-нибудь из окон вагона. Из пассажиров были и возвращавшиеся из-за границы"
      - screenshot: примерный внешний вид [suggest/input/landscape/overflow]
      - assert: высота инпута не увеличилась
      - assert: весь текст размещен в 1 строку
      - assertMetrics: '*'
  Манипуляции:
    beforeEach:
      - do: залогиниться в Яндекс
      - do: получить выдачу по запросу "тест"
      - assert: получена выдача по указанному запросу
      - do: кликнуть в поисковую стрелку
      - assert: инпут активен
      - assert: саджест открыт
    При перезапросе текст элемента подставляется в url:
      - tags: [smoke, smoke_extended, suggest_regress]
      - do: изменить запрос в поисковой стрелке на "Яндекс"
      - do: кликнуть в первую пословную подсказку
      - assert: текст выбранной пословной подсказки добавлен в инпут
      - assert: элементы саджеста обновились
      - assert: выдача не была перезагружена
      - do: кликнуть кнопку "Найти" поисковой стрелки
      - assert: страница перезагрузилась
      - assert: параметр text в урле равен изначальному запросу плюс текст первого элемента саджеста, по которому был клик (кириллица и часть символов в ссылке могут быть закодированы спецсимволами, например "%3D%25D0%25B2...". Для раскодирования можно воспользоваться сервисами типа "URL Decoder")
      - assertMetrics: '*'
    Клик вне блока - саджест должен скрыться:
      - tags: [smoke, smoke_extended, suggest_regress]
      - do: кликнуть вне блока саджеста и поисковой строки
      - assert: саджест закрылся
      - assert: выдача не была перезагружена
      - do: клик в поисковую стрелку
      - assert: саджест открыт
      - assertMetrics: '*'
    Backspace - подсказки обновляются:
      - tags: [smoke, smoke_extended, suggest_regress]
      - do: добавить к тексту запроса "1"
      - assert: элементы саджеста обновились
      - do: нажать 2 раза backspace на клавиатуре
      - assert: элементы саджеста обновились
      - assertMetrics: '*'
    Проверка возврата к предыдущей выдаче:
      - tags: [smoke, smoke_extended, suggest_regress]
      - do: изменить запрос в поисковой стрелке на "запрос 1"
      - do: нажать на кнопку "Найти"
      - assert: выдача обновилась
      - do: изменить запрос в поисковой стрелке на "запрос 2"
      - do: нажать на кнопку "Enter" на клавиатуре
      - assert: выдача обновилась
      - do: нажать кнопку "Назад" браузера или устройства
      - assert: выдача перезагрузилась
      - assert: отображается выдача по запросу "запрос 1", текст в стрелке соответствует запросу
      - do: нажать кнопку "Назад" браузера или устройства
      - assert: выдача перезагрузилась
      - assert: отображается выдачат по запросу "тест", текст в стрелке соответствует запросу
  Перекрывает:
    Фото:
      - params:
          foreverdata: '2736845706'
      - tags: [smoke_extended]
      - do: получить выдачу по запросу "Роза. Посадка, размножение, уход, сорта, фото на Supersadovnik.ru"
      - assert: получена выдача по указанному запросу
      - do: кликнуть в инпут поисковой стрелки
      - assert: саджест не открыт
      - assert: инпут активен
      - screenshot: примерный внешний вид [https://jing.yandex-team.ru/files/qwee/2019-12-26_12.06.26-xSUD6.png]
      - do: изменить текст запроса в инпуте на "кгб"
      - assert: в инпуте отображается заданный запрос
      - assert: саджест открыт
      - assert: открытый саджест перекрывает фото, либо фото находится в затемненной области
      - assertMetrics: '*'
    Спортивный колдунщик:
      - tags: [smoke_extended]
      - do: получить выдачу по запросу "чемпионат испании"
      - assert: получена выдача по указанному запросу
      - assert: на выдаче присутствует спортивный колдунщик
      - do: кликнуть в поисковую стрелку
      - assert: саджест открыт
      - assert: саджест отображается поверх спортивного колдунщика
      - assertMetrics: '*'
  Оверлей:
    Внешний вид и клик:
      - do: получить выдачу по запросу "bmw"
      - assert: получена выдача по указанному запросу
      - do: кликнуть в инпут
      - assert: саджест открыт поверх серповой выдачи
      - assert: поисковая выдача затемнена
      - screenshot: пример внешнего вида [suggest/overlay]
      - do: кликнуть в затемненную область
      - assert: саджест закрылся
    С пустым саджестом:
      beforeEach:
        - do: кликнуть в пустой инпут поисковой стрелки
        - assert: оверлей открыт
      Оверлей отображается (внешний вид):
        - screenshot: пример внешнего вида [plain]
        - assertMetrics: '*'
      Оверлей отображается при пустом саджесте (пустой инпут):
        - assertMetrics: '*'
      Оверлей отображается при пустом саджесте (отсутствие подсказок по запросу):
        - do: набрать запрос "dddddddddddddddddddd"
        - assert: оверлей отображается
        - assertMetrics: '*'
    Скрывается при скролле:
      Скрываем оверлей если сильно ускроллили вниз:
        - do: кликнуть в пустой инпут поисковой стрелки
        - assert: оверлей открыт
        - do: проскролить вниз
        - assert: оверлей закрыт
        - assertMetrics: '*'

specs-integration:
  tags: no_assessors
  Манипуляции:
    beforeEach:
      - do: получить выдачу по запросу "тест"
      - assert: получена выдача по указанному запросу
      - do: кликнуть в поисковую стрелку
      - assert: инпут активен
      - assert: саджест открыт
    При перезапросе текст элемента подставляется в url:
      - do: кликнуть в первую пословную подсказку
      - assert: тект выбранной пословной подсказки добавлен в инпут
      - assert: элементы саджеста обновились
      - assert: выдача не была перезагружена
      - do: кликнуть кнопку "Найти" поисковой стрелки
      - assert: страница перезагрузилась
      - assert: параметр text в урле равен изначальному запросу плюс текст первого элемента саджеста, по которому был клик (кириллица и часть символов в ссылке могут быть закодированы спецсимволами, например "%3D%25D0%25B2...". Для раскодирования можно воспользоваться сервисами типа "URL Decoder")
    Клик вне блока - саджест должен скрыться:
      - do: кликнуть вне блока саджеста и поисковой строки
      - assert: саджест закрылся
      - assert: выдача не была перезагружена
      - do: клик в поисковую стрелку
      - assert: саджест открыт
    Backspace - подсказки обновляются:
      - do: добавить к тексту запроса "1"
      - assert: элементы саджеста обновились
      - do: нажать 2 раза backspace на клавиатуре
      - assert: элементы саджеста обновились
    Клик на крестик - саджест не должен скрыться:
      - do: клик в "х" поисковой стрелки
      - assert: поисковая стрелка очищена
      - assert: саджест открыт
  Проверка возврата к предыдущей выдаче:
    - do: получить выдачу по запросу "аэрофлот"
    - assert: получена выдача по указанному запросу
    - do: кликнуть в поисковую стрелку
    - assert: инпут активен
    - do: изменить запрос в поисковой стрелке на "запрос 1"
    - do: нажать на кнопку "Найти"
    - assert: выдача обновилась
    - do: изменить запрос в поисковой стрелке на "запрос 2"
    - do: нажать на кнопку "Enter" на клавиатуре
    - assert: выдача обновилась
    - do: нажать кнопку "Назад" браузера
    - assert: выдача перезагрузилась
    - assert: отображается выдачат по запросу "запрос 1", текст в стрелке соответствует запросу
    - do: нажать кнопку "Назад" браузера
    - assert: выдача перезагрузилась
    - assert: отображается выдачат по запросу "аэрофлот", текст в стрелке соответствует запросу

files:
  - features/touch-phone/suggest/suggest-basic.hermione.js
  - features/touch-phone/suggest/suggest-basic.hermione.e2e.js

tags:
  - suggest
  - input

browsers:
  notFor:
    - searchapp-phone-group

v-team: Suggest

priority: high

tlds:
  - ru
  - by
  - ua
  - kz
  - uz
  - com
  - com.tr
