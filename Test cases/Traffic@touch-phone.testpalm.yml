feature: Колдунщик пробок
counter: /$page/$main/$result[@wizard_name="traffic"]/title

specs-integration:
  Наличие колдунщика:
    - do: получить выдачу по запросу 'пробки в москве'
    - assert: |
        появился колдунщик пробок,
        в колдунщике присутствует карта
    - counter: /$page/$main/$result[@wizard_name="traffic"]/map

specs:
  aliases:
    - &CheckMetrics
      - assertMetrics:
          - feature.web.wizards_common.maps_wizard.total.shows
          - feature.web.wizards_common.maps_wizard.total.external_clicks
          - feature.web.wizards_common.maps_wizard.total.dynamic_clicks
          - web.total_request_results_clicks
          - web.total_request_results_ext_clicks
          - web.total_request_results_dyn_clicks
          - web.total_request_results_main_column_clicks
          - web.total_request_results_main_column_ext_clicks
          - web.total_request_results_main_column_dyn_clicks
          - web.total_request_results_parallel_column_clicks
          - web.total_request_results_parallel_column_ext_clicks
          - web.total_request_results_parallel_column_dyn_clicks
          - web.tech_part_misc_click
          - web.total_request_count
          - daily.total_session_count

  Для города без баллов:
    beforeEach:
      - do: получить выдачу по запросу 'пробки в туапсе'
      - assert: колдунщик пробок присутствует на странице
      - screenshot: внешний вид колдунщика [view-no-points-{{PLATFORM}}-{{BROWSER_TYPE}} >> plain]

    Проверка внешнего вида:
      - label: view-no-points-{{PLATFORM}}-{{BROWSER_TYPE}}
      - screenshot: внешний вид колдунщика [plain]

    Проверка ссылок и счётчиков:
      - tags: [maps]
      - do: тапнуть по карте
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/map/map'
      - assert: |
          осуществился переход на карту Туапсе на Яндекс.Картах,
          на карте включен слой пробок
      - do: |
          вернуться на страницу выдачи результатов запроса
          и тапнуть по кнопке расхлопывания в верхнем правом углу карты
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/map/open'
      - assert: |
          осуществился переход на карту Туапсе на Яндекс.Картах,
          на карте включен слой пробок
      - *CheckMetrics

  Для города c 0 баллов:
    - params:
        foreverdata: '1997556160'
    - do: получить выдачу по запросу 'foreverdata'
    - assert: колдунщик пробок присутствует на странице
    - screenshot: внешний вид [plain]

  Для города с баллами:
    beforeEach:
      - do: получить выдачу по запросу 'пробки в москве'
      - assert: колдунщик пробок присутствует на странице
      - screenshot: внешний вид колдунщика [view-points-{{PLATFORM}}-{{BROWSER_TYPE}} >> plain]

    Проверка внешнего вида:
      - label: view-points-{{PLATFORM}}-{{BROWSER_TYPE}}
      - screenshot: внешний вид колдунщика [plain]
      - assert: |
          светофор с баллами пробок присутствует,
          время с уровнем пробок присутствует

    Проверка ссылок и счётчиков:
      - tags: [maps]
      - do: тапнуть по карте
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/map/map'
      - assert: |
          осуществился переход на карту Москвы на Яндекс.Картах,
          включен слой пробок
      - do: |
          вернуться на страницу выдачи результатов запроса
          и тапнуть по кнопке расхлопывания в верхнем правом углу карты
      - tech: сработал счётчик path='/$page/$main/$result[@wizard_name="traffic"]/map/open'
      - assert: |
          осуществился переход на карту Москвы на Яндекс.Картах,
          на карте включен слой пробок
      - *CheckMetrics

files:
  - src/features/Traffic/Traffic.test/Traffic@touch-phone.hermione.js
  - src/features/Traffic/Traffic.test/Traffic@touch-phone.hermione.e2e.js

v-team: VanillaGeo

tags: [hasE2E]

tlds: all
