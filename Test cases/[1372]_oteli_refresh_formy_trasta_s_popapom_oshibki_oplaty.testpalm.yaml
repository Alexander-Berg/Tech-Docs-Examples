feature: Отели
type: Бронирование
description: Залогиниться
specs:
  'Отели: Рефреш формы траста с попапом ошибки оплаты':
    - do: 'Перейти на страницу бронирования для любого отеля, на любые даты'
    - assert: >-
        Открылась страница бронирования.

        В корзинке есть галка "У меня есть промокод", по умолчанию выключена.
        Поле инпут для промокода и кнопка "Применить" не показывается.
    - do: Включить галку "У меня есть промокод"
    - assert: Появилось Поле инпут для промокода и кнопка "Применить"
    - do: Запомнить итоговую сумму заказа
    - do: 'В инпут написать промокод "AUTOTEST_PROMOCODE_200", нажать применить'
    - assert: |-
        Инпут, кнопка и галка задизейблились
        В блоке с промокодом появилась сумма скидки: "− 200 ₽"
        Появилась ссылка "Отменить"
        Сумма заказа стала на 200р меньше, чем была в п.3
    - do: >-
        Заполнить информацию о гостях и контактную информацию любыми валидными
        данными.

        Нажать оплатить.
    - assert: |-
        Открылась страница с формой оплаты.
        Сумма к оплате соответствует сумме из п.4
    - do: Нажать на кнопку оплатить заказ
    - assert: >-
        Открылась страница успешной брони happy page

        Сумма заказа соответствует сумме из п.4

        В корзинке есть информация о примененном промокоде: "Скидка по промокоду
        SUCCESS − 200 ₽"
    - do: Обновить страницу
    - assert: |-
        Остались на странице с трастом
        Показался попап "Ошибка оплаты Вы отменили платеж."
        В нем две кнопки: Отменить заказ, Попробовать еще раз
        Сумма c учетом промокода
    - do: Обновить страницу
    - assert: Попап снова показался
    - do: Нажать на кнопку Попробовать еще раз
    - assert: |-
        Попап скрылся
        Открылась форма траста
    - do: Завершить оплату
    - assert: Открылась страница успешного заказа
    - do: Нажать Подробнее о заказе
    - assert: Сумма соответствует сумме с учетом промокода
manual: true
Функциональность: Промокод
Устройство:
  - Десктоп
  - Тач
Страница: Бронирование
Сервис: Отели
Тестирование асессорами: Нет
Окружение: Testing
