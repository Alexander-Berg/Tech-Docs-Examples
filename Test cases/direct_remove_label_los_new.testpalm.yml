feature: Мимикрия рекламы
experiment: Удаляем рекламный лейбл для пользователей с los.1, у которых вырезалась реклама

specs:
  Контроль:
    - params:
        exp_flags:
          - direct_remove_label_los_new=1
          - direct_naked_label=null
        foreverdata: '3450195293'
    - do: |
        включить adblock
        получить выдачу по запросу ‘foreverdata’
        перезагрузить страницу
    - tech: установилась кука yp со значением los.1
    - assert: у рекламных сниппетов есть рекламный лейбл
    - screenshot: внешний вид первого сниппета [control-los-1]
    - tech: |
        скрыть рекламные сниппеты, выполнив в консоли команды
        "[1, 2, 3, 14, 15, 16, 17].forEach(index => { document.querySelector('.serp-item:nth-of-type(' + index + ')').setAttribute('style', 'display:none;'); });
        $('.inquire').bem('inquire').delMod('js');
        $('.inquire').bem('inquire').setMod('js', 'inited');"
    - tech: не установилась кука yp со значением dl.1
    - do: перезагрузить страницу
    - assert: у рекламных сниппетов есть рекламный лейбл
    - screenshot: внешний вид первого сниппета [control-ads-cutted]
    - tech: не сработал счетчик вырезания при los.1 path='tech/direct/antiblock/extra'
    - tech: не сработал счетчик скрытия лейбла $page[@tech@direct_hide_labels=1]

  Флаг 1 (реклама вырезалась):
    - params:
        exp_flags:
          - direct_remove_label_los_new=1
          - direct_naked_label=null
        foreverdata: '3450195293'
    - do: |
        включить adblock
        получить выдачу по запросу ‘foreverdata’
        перезагрузить страницу
    - tech: установилась кука yp со значением los.1
    - assert: у рекламных сниппетов есть рекламный лейбл
    - tech: |
        скрыть рекламные сниппеты, выполнив в консоли команды
        "[1, 2, 3, 14, 15, 16, 17].forEach(index => { document.querySelector('.serp-item:nth-of-type(' + index + ')').setAttribute('style', 'display:none;'); });
        $('.inquire').bem('inquire').delMod('js');
        $('.inquire').bem('inquire').setMod('js', 'inited');"
    - tech: установилась кука yp со значением dl.1
    - tech: сработал счетчик вырезания при los.1 path='tech/direct/antiblock/extra'
    - do: перезагрузить страницу
    - assert: у рекламных сниппетов нет рекламного лейбла
    - screenshot: внешний вид первого сниппета [drll1-ads-cutted-dl]
    - tech: сработал счетчик скрытия лейбла $page[@tech@direct_hide_labels=1]
    - assert: над выдачей присутствует блок предупреждения о влиянии расширения
    - screenshot: внешний вид блока предупреждения [disc]
    - tech: по клику на ссылку подробнее в блоке предепреждения отправляется счётчик '/$page/$main/misspell/type_antiadblock/detail'

  Флаг 1 (реклама не вырезалась):
    - params:
        exp_flags:
          - direct_remove_label_los_new=1
          - direct_naked_label=null
        foreverdata: '3450195293'
    - do: |
        включить adblock
        получить выдачу по запросу ‘foreverdata’
    - tech: установилась кука yp со значением los.1
    - assert: у рекламных сниппетов есть рекламный лейбл
    - screenshot: внешний вид первого сниппета [drll1-los-1]
    - do: перезагрузить страницу
    - tech: не установилась кука yp со значением dl.1
    - assert: у рекламных сниппетов есть рекламный лейбл
    - screenshot: внешний вид первого сниппета [drll1-ads-cutted]
    - tech: не сработал счетчик вырезания при los.1 path='tech/direct/antiblock/extra'
    - tech: не сработал счетчик скрытия лейбла $page[@tech@direct_hide_labels=1]

  Флаг 2 (с los.1):
    - params:
        exp_flags:
          - direct_remove_label_los_new=2
          - direct_naked_label=null
        foreverdata: '3450195293'
    - do: |
        включить adblock
        получить выдачу по запросу ‘foreverdata’
        перезагрузить страницу
    - tech: установилась кука yp со значением los.1
    - tech: не установилась кука yp со значением dl.1
    - assert: у рекламных сниппетов нет рекламного лейбла
    - screenshot: внешний вид первого сниппета [drll2-los-1]
    - tech: сработал счетчик скрытия лейбла $page[@tech@direct_hide_labels=1]
    - tech: |
        скрыть рекламные сниппеты, выполнив в консоли команды
        "[1, 2, 3, 14, 15, 16, 17].forEach(index => { document.querySelector('.serp-item:nth-of-type(' + index + ')').setAttribute('style', 'display:none;'); });
        $('.inquire').bem('inquire').delMod('js');
        $('.inquire').bem('inquire').setMod('js', 'inited');"
    - tech: сработал счетчик вырезания при los.1 path='tech/direct/antiblock/extra'
    - tech: не установилась кука yp со значением dl.1
    - assert: над выдачей присутствует блок предупреждения о влиянии расширения
    - screenshot: внешний вид блока предупреждения [disc]
    - tech: по клику на ссылку подробнее в блоке предепреждения отправляется счётчик '/$page/$main/misspell/type_antiadblock/detail'

  Флаг 2 (без los):
    - params:
        exp_flags:
          - direct_remove_label_los_new=2
          - direct_naked_label=null
        foreverdata: '3450195293'
    - do: получить выдачу по запросу ‘foreverdata’
    - tech: не установилась кука yp со значением los
    - assert: у рекламных сниппетов нет рекламного лейбла
    - screenshot: внешний вид первого сниппета [drll2-no-los]
    - tech: сработал счетчик скрытия лейбла $page[@tech@direct_hide_labels=1]
    - tech: в первом сниппете в первом блоке serp-adv__counter правильная ссылка на yabs-счётчик (содержит 'yabs.yandex.ru/count/')
    - tech: в следующим за ним блоке serp-adv__counter правильная ссылка на блокстат-счётчик (содержит '/clck/safeclick/')

  Флаг 1 (реклама вырезается с задержкой):
    - params:
        exp_flags:
          - direct_remove_label_los_new=1
          - direct_naked_label=null
        foreverdata: '1191704587'
        adblocker: 'ublock'
    - do: получить выдачу по запросу ‘foreverdata’
    - tech: есть кука yp со значением los.1
    - tech: есть кука yp со значением dl.1


files:
  - features/desktop/serp-adv/direct_remove_label_los_new/direct_remove_label_los_new.hermione.js

v-team: Distribution

tags:
  - skip_e2e_check
  - no_assessors
  - adv
  - adblock
  - cookie
  - adv_label

tlds: all
