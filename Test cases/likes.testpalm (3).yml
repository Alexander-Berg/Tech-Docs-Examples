feature: Объектный ответ
type: Оценки в карусели фильмов

import-labels:
  - features/touch-phone/z-entity-search/review/review.testpalm.yml

counter: /$page/$main/$result[@wizard_name="entity_search"]/carousel/showcase/item/thumb/rating-user

specs-integration:
  Проверка оценок в карусели:
    - tags: [smoke]
    - do: разлогиниться
    - do: получить выдачу по запросу 'фильмы'
    - assert: появилась карусель фильмов
    - assert: у плитки в карусели есть звездочка
    - do: кликнуть по оценке пользователя у первого постера
    - assert: открылось модальное окно оставления отзыва
    - do: перевести ползунок со звездой на цифру 10
    - assert: над цифрой 10 есть звезда
    - do: кликнуть по кнопке 'Готово'
    - assert: модальное окно оставления отзыва закрылось
    - assert: оценка пользователя на постере равна 10
  После ajax перезапроса:
    - params:
        ento: 0oCgpydXc4NDI1NjAxEjtsc3QucmVjQ2lNS0JIUmxlSFFTRzJsZmVXVmhjam95TURJeUlDWW1JSE5mWjJWdWNtVTZabWxzYlE9PRgC-EyDeA
    - do: разлогиниться
    - do: получить выдачу по запросу 'фильмы 2022' (если карусель фильмов не появилась, добавить в адресной строке браузера к запросу параметр &ento=0oCgpydXc4NDI1NjAxEjtsc3QucmVjQ2lNS0JIUmxlSFFTRzJsZmVXVmhjam95TURJeUlDWW1JSE5mWjJWdWNtVTZabWxzYlE9PRgC-EyDeA )
    - assert: |
        появилась карусель фильмов,
        в карусели у фильмов есть оценка пользователя (серая звездочка рядом с зеленым рейтингом)
    - screenshot: пример внешнего вида постеров [entity-search__carousel-review-{{SET_NAME}} >> poster]
    - do: кликнуть по оценке пользователя (звездочке) у первого постера
    - assert: открылось модальное окно оставления отзыва
    - do: перевести ползунок со звездой на цифру 6
    - assert: над цифрой 6 есть звезда
    - do: кликнуть по кнопке 'Готово'
    - assert: модальное окно оставления отзыва закрылось
    - assert: оценка пользователя на первом постере равна 6
    - do: кликнуть по второму постеру в карусели
    - assert: |
        произошел перезапрос
        обновилась выдача под каруселью
        на выдаче есть фильмомая карточка ОО
        в карточке есть блок с рейтингом
        оценка не проставлена

specs:
  Выставление оценки:
    - tags: pp_new_core
    - label: entity-search__carousel-review-{{SET_NAME}}
    - do: разлогиниться
    - do: получить выдачу по запросу 'фильмы'
    - assert: |
        появилась карусель фильмов,
        в карусели у фильмов есть оценка пользователя (серая звездочка рядом с зеленым рейтингом)
    - screenshot: пример внешнего вида постеров [poster]
    # первая оценка
    - do: кликнуть по оценке пользователя (звездочке) у первого постера
    - assert: открылось модальное окно оставления отзыва
    # screenshot: внешний вид модального окна оставления отзыва [entity-search__review-edit-{{SET_NAME}} >> review-modal] (закоментировано, т.к надо обновить скриншоты)
    - tech: сработал счетчик /snippet/entity_search/upper/showcase/item/rating-user
    - do: перевести ползунок со звездой на цифру 10
    - assert: над цифрой 10 есть звезда
    - do: кликнуть по кнопке 'Готово'
    - assert: модальное окно оставления отзыва закрылось
    - assert: оценка пользователя на первом постере равна 10
    # screenshot: внешний вид постера с проставленной оценкой [poster-user-rating-set]
    # вторая оценка
    - do: кликнуть по оценке пользователя у второго постера
    - assert: открылось модальное окно оставления отзыва
    - do: перевести ползунок со звездой на цифру 8
    - assert: над цифрой 8 есть звезда
    - do: кликнуть по кнопке 'Готово'
    - assert: модальное окно оставления отзыва закрылось
    # - assert: внизу экрана появилось сообщение с количеством оценок ('2 оценки из 20') (закоментировано, т.к после редизайна оценок сообщение в доработке)
    # - do: кликнуть по сообщению
    # - assert: открылось модальное окно с описанием оценок
  Удаление оценки:
    - do: разлогиниться
    - do: получить выдачу по запросу 'фильмы'
    - assert: |
        появилась карусель фильмов,
        в карусели у фильмов есть оценка пользователя (серая звездочка рядом с зеленым рейтингом)
    - screenshot: пример внешнего вида постеров [entity-search__carousel-review-{{SET_NAME}} >> poster]
    - do: кликнуть по оценке пользователя (звездочке) у первого постера
    - assert: открылось модальное окно оставления отзыва
    # screenshot: внешний вид модального окна оставления отзыва [entity-search__review-edit-{{SET_NAME}} >> review-modal]
    - do: перевести ползунок со звездой на цифру 10
    - assert: над цифрой 10 есть звезда
    - do: кликнуть по кнопке 'Готово'
    - assert: модальное окно оставления отзыва закрылось
    - assert: оценка пользователя на первом постере равна 10
    # screenshot: внешний вид постера с проставленной оценкой [entity-search__carousel-review-{{SET_NAME}} >> poster-user-rating-set]
    - do: кликнуть по оценке пользователя у первого постера
    - assert: открылось модальное окно оставления отзыва
    - assert: ползунок со звездой над 10 цифрой
    - do: кликнуть по десятой звезде
    - assert: оценка сбросилась
    - assert: внизу модального окна кнопка 'Готово' осталась активной
    - do: кликнуть по кнопке 'Готово'
    - assert: модальное окно закрылось
    - assert: оценка пользователя на постере сбросилась
    - tech: сработал счетчик /snippet/entity_search/review-editable/delete
    - assertMetrics: '*'

files:
  - features/touch-phone/z-entity-search/carousel/likes/likes.hermione.js
  - features/touch-phone/z-entity-search/carousel/likes/likes.hermione.e2e.js

v-team: Video

tags: [oo_likes, oo_lists]

tlds: ru

priority: normal
