feature: Органика

counter: /web/item

specs:
  params:
    rearr: ['use_signed_download_urls=1']
  beforeEach:
    - do: получить выдачу по запросу 'гоэлро'
    - assert: отображается органический сниппет
  Проверка поведения по наведению мыши:
    - tlds: all
    - do: навести указатель мыши на тайтл
    - screenshot: пример внешнего вида ховера [hoverTitle]
    - do: навести указатель мыши на гринурл
    - screenshot: пример внешнего вида ховера [hoverGreenurl]
    - do: навести указатель мыши на первый сайтлинк
    - screenshot: пример внешнего вида ховера [hoverSitelinks]
    - do: навести указатель мыши на 'Открыть выпадающее меню' - зелёный треугольник в конце гринурла
    - screenshot: пример внешнего вида ховера [hoverExtralinks]
  Проверка ссылок:
    - tags:
        - smoke
    - tlds: all
    - do: навести курсор на ссылку в тайтле
    - assert: ссылка меняет цвет с синего на красный
    - do: открыть ссылку из тайтла в новой странице/вкладке
    - assert: открывается правильная страница сайта из результатов поиска
    - do: открыть ссылку из первой части гринурла в новой странице/вкладке
    - do: открыть ссылку из второй части гринурла в новой странице/вкладке
    - assert: в обоих случаях в новой странице/вкладке открывается правильная страница сайта из результатов поиска
    - do: навести курсор на ссылку в первом сайтлинке (если есть)
    - assert: ссылка меняет цвет с синего на красный
    - do: открыть ссылку первого сайтлинка (если есть)
    - assert: в новой странице/вкладке открывается правильная страница сайта из результатов поиска
    - assertMetrics: '*'
  Проверка фокуса:
    - tlds: all
    - screenshot: сниппет содержит заголовок, гринурл, текст, сайтлинки [plain]
    - do: нажать клавишу "tab" на клавиатуре
    - screenshot: тайтл обернулся в рамку [focused]
  Проверка выпадающего меню:
    - tlds:
        - ru
        - ua
        - by
        - uz
    - do: кликнуть 'Открыть выпадающее меню' - зелёный треугольник в конце гринурла
    - screenshot: пример внешнего вида [extralinks-opened]
    - assert: появился попап со ссылками (если нет ссылки "Сохраненная копия", попробуйте другой сниппет и проверьте, выключен ли блокировщик рекламы)
    - do: навести мышь на ссылку 'Сохраненная копия'
    - screenshot: пример внешнего вида [extralinks-hovered]
    - assert: при клике по ссылке открывается новая страница/вкладка браузера с сохранённой копией страницы проверяемого сайта
    - assert: uRL страницы содержит https://yandexwebcache.net/yandbtm
    - tech: проверить счётчик ссылки 'Сохраненная копия'
    - do: кликнуть на пункт "Еще с сайта"
    - assert: страница обновилась
    - assert: в поле запроса содержится 'site:minenergo.gov.ru гоэлро'
    - assert: в выдаче документы с сайта minenergo.gov.ru
    - tech: проверить счётчик ссылки "Еще с сайта"
    - do: кликнуть на пункт "Информация о сайте"
    - assert: открылась страница с информацией о сайте
    - tech: проверить счётчик ссылки "Информация о сайте"
    - do: кликнуть в любое место вне выпадающего меню
    - assert: меню закрылось
    - do: кликнуть 'Открыть выпадающее меню' - зелёный треугольник в конце гринурла
    - assert: появился попап со ссылками (если нет ссылки "Сохраненная копия", попробуйте другой сниппет и проверьте, выключен ли блокировщик рекламы)
    - do: нажмите на клавишу escape на клавиатуре
    - assert: меню снова закрылось
    - assertMetrics: '*'
  Выпадающее меню работает после перехода с пустой выдачи (регресс бага SERP-78638):
    - tlds: all
    - do: получить выдачу по пустому запросу '
    - do: набрать другой запрос 'кот' и дождаться новой выдачи
    - do: кликнуть 'Открыть выпадающее меню' - зелёный треугольник в конце гринурла
    - assert: выпадающее меню открылось
    - assertMetrics: '-'
  Проверка закрывания выпадающего меню:
    beforeEach:
      - do: кликнуть 'Открыть выпадающее меню' - зелёный треугольник в конце гринурла
      - assert: появился попап с ссылками
    При повторном клике на кнопку "Открыть выпадающее меню":
      - tlds: all
      - do: кликнуть 'Открыть выпадающее меню'
      - assert: выпадающее меню скрылось
    При клике на кнопку "Расширенный поиск":
      - tlds: all
      - do: кликнуть кнопку 'Расширеный поиск' в поисковой стрелке (справа от кнопки 'Найти')
      - assert: выпадающее меню скрылось
  Провека метрики web.click_count_overlong_p1_120$ = 1:
    - tags:
        - no_assessors
    - do: получить выдачу по запросу 'гоэлро'
    - assert: отображается органический сниппет
    - do: открыть ссылку из тайтла в новой странице/вкладке
    - assertMetrics: '*'
  Провека метрики web.click_count_overlong_p1_120$ = 0:
    - tags:
        - no_assessors
    - do: получить выдачу по запросу 'гоэлро'
    - assert: отображается органический сниппет
    - do: открыть ссылку из тайтла в новой странице/вкладке
    - do: подождать несколько секунд
    - do: кликнуть 'Открыть выпадающее меню' - зелёный треугольник в конце гринурла
    - assertMetrics: '*'

specs-integration:
  beforeEach:
    - do: получить выдачу по запросу 'usa.gov'
    - assert: появился сниппет
  Проверить гринурл:
    - assert: ссылка в гринурле корректная
  Проверить попап в гринурле:
    - do: кликнуть на кнопку '...' справа от гринурла
    - assert: появился попап
    - assert: попап содержит 5 элементов (убедиться что не включен блокировщик рекламы, с включенным блокировщиком в попапе валидно отображается только одна ссылка "Информация о сайте" )
    - assert: первый элемент попапа содержит ссылку на перевод
    - assert: второй элемент попапа содержит ссылку на сохраненную копию
    - assert: третий элемент попапа содержит ссылку на серп с поиском по сайту
    - do: кликнуть по четвертому элементу "Пожаловаться"
    - counter: /web/item/abuse
    - assert: появилась форма фидбека
  Проверка метрик для логов user_sessions (in progress):
    - tags:
      - no_assessors
    - do: установить icookie
    - do: кликнуть по первому сниппету
    - tech: Запустить таску подсчета метрик

files:
  - features/desktop/organic/organic.hermione.js
  - features/desktop/organic/organic.hermione.e2e.js

v-team: Beauty

tags:
  - reviewed
  - organic

tlds: none
