feature: Авиа
type: Бронирование
description: >-
  1. Блок подписки сейчас доступен только в рамках эксперимента, поэтому перед
  его тестированием необходимо в DevTools -> Applications добавить куку
  AVIA_UI_booking со значением subscription, а уже потом проходить шаги кейса.


  2. **ВАЖНО:** Блок подписки не появится, если подписка уже осуществилась
  однажды в рамках этой сессии браузера. Если такое случилось, необходимо
  открыть новое окно в режиме Инкогнито, добавить там куку и проходить кейс.


  3. Наличие блока подписки означает, что для этой сессии/для этого пользователя
  Яндекс.Паспорта подписка ещё не была осуществлена. Отсутствие блока подписки
  означает одно из двух: либо для пользователя/сессии подписка уже оформлена,
  либо кука так и не добавилась.


  4. Подписка оформляется в тот момент, когда мы переходим на страницу оплаты с
  проставленным чекбоксом в блоке Подписок.


  **Как проверить запрос на создание заказа.**

  1. Открыть DevTools браузера (F12 для Chrome и Яндекс.Браузера).

  2. Переключиться во вкладку Network.

  3. Ввести в поле Filter 'create-order'.

  4. Перейти на экран оплаты -> в Network при этом должен появиться запрос
  create-order.

  5. Кликнуть по появившемуся запросу.

  6. Перейти во вкладку Headers.

  7. Проскроллить информацию запроса вниз, до блока Request Payload.

  8. Найти в Request Payload блок subscriptions.


  Эти действия важно совершить до перехода на страницу оплаты. Если открывать
  DevTools уже после этого, запрос create-order там не отобразится.
specs:
  'Авиа: BoY - Подписка на рассылку':
    - do: 'Открыть главную страницу путешествий, вкладка Авиабилеты'
    - do: |-
        Заполнить форму поиска билетов
        Откуда: Екатеринбург
        Куда: Санкт-Петербург
        Туда: 5 число следующего месяца, дату обратно не ставить
        Пассажиры: 1 взрослый
        Класс: Эконом
    - do: Нажать кнопку “Найти”
    - assert: Открылась страница выдачи
    - do: Применить фильтр Авиакомпании = "Аэрофлот".
    - assert: На выдаче остались только варианты от Аэрофлота.
    - do: Кликнуть по любому варианту.
    - assert: Осуществляется переход на страницу покупки для выбранного варианта.
    - do: >-
        Кликнуть по предложению от Аэрофлота. Если такого нет - вернуться на
        выдачу и отыскать вариант, где будет предложение от Аэрофлота.
    - assert: >-
        Осуществляется переход на страницу бронирования Аэрофлота (BoY). Под
        блоком Контактной информации располагается блок Подписки (если его нет -
        см. описание):

        ![image](https://jing.yandex-team.ru/files/gouken67/%D0%91%D0%BB%D0%BE%D0%BA%20%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%BA%D0%B8%20%D0%BD%D0%B0%20BoY%20%D0%90%D1%8D%D1%80%D0%BE%D1%84%D0%BB%D0%BE%D1%82%D0%B0.png)
    - do: >-
        Заполнить данные пассажира.

        Поставить чекбокс в блоке Подписок.

        Открыть DevTools и совершить необходимые действия для просмотра запроса
        на создание заказа **(см. описание)**.

        Перейти на страницу оплаты.

        Проверить, что отправилось в запросе на создание заказа **(см.
        описание)**.
    - assert: >-
        Осуществляется подписка. В запросе на создание заказа в Request Payload
        присутствует блок subscriptions, в котором есть запись "subscribe":
        true.
    - do: Вернуться на страницу бронирования.
    - assert: Блок Подписки исчез.
    - do: Осуществить логин в Яндекс.Паспорт.
    - assert: >-
        Вход в Яндекс.Паспорт произошёл успешно. Вернулись на страницу
        бронирования. Блок Подписки появился вновь.
    - do: >-
        Заполнить данные пассажира. Указать тот же E-Mail, который использовался
        при совершении подписки.

        Поставить чекбокс в блок Подписки и тут же снять.

        Перейти на страницу оплаты.

        Проверить, что отправилось в запросе на создание заказа **(см.
        описание)**.

        Вернуться на страницу бронирования.
    - assert: >-
        Подписка не осуществилась. В запросе на создание заказа в Request
        Payload присутствует блок subscriptions, в котором есть запись
        “subscribe”: false.

        Блок Подписки на месте.
    - do: Обновить страницу.
    - assert: После обновления страницы блок Подписки остаётся на месте.
    - do: >-
        Заполнить данные пассажира. Указать тот же E-Mail, который использовался
        при совершении подписки.

        Поставить чекбокс в блок Подписки.

        Перейти на страницу оплаты.

        Проверить, что отправилось в запросе на создание заказа **(см.
        описание)**.
    - assert: >-
        Осуществляется подписка. В запросе на создание заказа в Request Payload
        присутствует блок subscriptions, в котором есть запись “subscribe”:
        true.
    - do: Вернуться на страницу бронирования.
    - assert: Блок Подписки исчез.
    - do: Разлогиниться из Яндекс.Паспорта.
    - assert: >-
        Выход из учётной записи Яндекс.Паспорта произошёл успешно. Вернулись на
        страницу бронирования. Блок подписки отсутствует.
manual: true
Функциональность: Подписка
Устройство:
  - Десктоп
  - Тач
Страница: Бронирование
Сервис: Авиа
Тестирование асессорами: Да
Окружение: Testing
Автор: gouken67
