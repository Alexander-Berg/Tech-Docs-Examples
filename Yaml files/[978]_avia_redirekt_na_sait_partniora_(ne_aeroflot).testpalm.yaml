feature: Авиа
type: Страница покупки
description: >-
  Все скрины в кейсе соответствуют десктопной версии. В тач-версии отображение
  отличается, но суть меняться не должна.

  Отсутствие логотипа Авиакомпании - не баг!
  **Важно:** Если  в релизе были изменения по логам редиректа - посмотреть в престейбле этот кейс тоже
specs:
  'Авиа: Редирект на сайт партнёра (НЕ Аэрофлот) + логи редиректа':
    - do: Перейти на вкладку авиабилеты
    - do: |-
        На вкладке авиа ввести в поля
        * откуда - Екатеринбург
        * куда - Москва
        * туда - через неделю
        * обратно не заполняем
        Нажать на кнопку "Найти"
    - assert: '* Произошел переход на страницу выдачи'
    -   do: |-
            Дописать utm-метки: добавить к урлу в конце *&utm_campaign=test1&utm_content=test2&utm_medium=test3&utm_source=test4&utm_term=test5*
            Перейти по новому урлу
    - assert: Выдача обновилась, указанные utm-метки отображаются в куках
    - do: |-
        Применить фильтрацию по партнёру = "City Travel"
        В выдаче нажать на карточку любого рейса
        https://jing.yandex-team.ru/files/gouken67/Кликнуть%20в%20сниппет.png
    - assert: Произошел переход в страницу покупки выбранного рейса
    - do: |-
        Нажать на кнопку Купить у названия City Travel
        - В десктопе в блоке справа
        https://jing.yandex-team.ru/files/rifat-k/2019-12-04_15-08-40.png
        - В таче в блоке внизу
        https://jing.yandex-team.ru/files/shenfeld/2021-02-09_10.13.59-jlb00.png
    - assert: Произошел переход на сайт партнера в новой вкладке. Стоимость на сайте партнёра совпадает со стоимостью, которая была указана на странице покупки.
    - do: |-
          Перейти по ссылке https://deploy.yandex-team.ru/stages/travel-frontend-portal-testing/logs
          В поле Search parameters ввести message = "AVIA_REDIRECT";
          Кликнуть по кнопке Search
    - assert: Отобразились логи AVIA_REDIRECT и AVIA_REDIRECT_SHOW
    - do: |-
          Среди логов AVIA_REDIRECT отыскать свой:
          - На десктопе: посмотреть свой yandexuid в куках (F12, затем Application), затем найти последний лог с таким же yandexuid
          - На таче: Просто найти подходящий по времени и направлению
    - assert: Нужный лог присутствует в начале поиска логов
    - do: Проверить данные, которые содержит лог
    - assert: |-
          Следующие поля должны быть заполнены соответствующим образом:
          * marker - число-буквенный код с разделителем '-'
          * show_id - 'число.число.0'
          * utm-метки - те значения, которые мы ввели ранее
          * userip - совпадает с тем, что указано на ip.yandex.ru
          * yandexuid - на десктопе - совпадает с тем, что в куках, на тачах - непустой
          * billing_order_id - число
          * billing_client_id - число
          * national_version - 'ru'
          * original_price - число, совпадает с ценой варианта, по которому совершили редирект
          * price - число, не равно 0
          * pp - 502 для десктопа, 508 для тачей

manual: true
Функциональность: Переход к партнёру
Устройство:
  - Десктоп
  - Тач
Страница: Страница покупки
Сервис: Авиа
Тестирование асессорами: Нет
Окружение: Testing
Tag: Smoke
