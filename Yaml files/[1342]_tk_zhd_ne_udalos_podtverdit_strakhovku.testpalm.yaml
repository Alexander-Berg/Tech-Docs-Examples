feature: ЖД
type: Оплата
description: >-
  * Дернуть ручку тестового контекста:
  https://api.travel-balancer-test.yandex.net/api/test_context/v1/train_token?insurancePricingOutcome=IPO_SUCCESS&insuranceCheckoutOutcome=ICO_FAILURE&insuranceCheckoutConfirmOutcome=ICCO_SUCCESS&refundPricingOutcome=RPO_SUCCESS&refundCheckoutOutcome=RCO_SUCCESS&createReservationOutcome=RCRO_SUCCESS&confirmReservationOutcome=RCOO_SUCCESS&officeReturnDelayInSeconds=0&officeAcquireDelayInSeconds=0&alwaysTimeoutAfterConfirmingInSeconds=0

  * В ответе запомнить токен из поля test_context_token
specs:
  'ТК ЖД: Не удалось подтвердить страховку':
    - do: |-
        Перейти на вкладку ЖД
        Перейти на поиск Москва - Санкт-Петербург через месяц
        Для любого поезда кликнуть по кнопке Выбрать место
        На странице выбора мест выбрать любое место в любом вагоне
        Нажать Указать пассажиров
    - assert: '* Произошел переход на страницу ввода данных'
    - do: >-
        Добавить к урлу параметр trainTestContextToken со значением полученного
        токена

        Перейти по полученной ссылке

        Заполнить все поля валидными данными

        Нажать Проверить заказ и купить
    - assert: |-
        * Произошел переход на страницу подтверждения
        * На странице есть блок для добавления страховки
    - do: |-
        Запомнить итоговую сумму без страховки
        Выбрать страховку
        Нажать Ввести карту и оплатить
    - assert: >-
        * Осуществился переход на страницу оплаты

        * Через какое-то время появилось модальное окно c текстом "Не удалось
        купить страховой полис

        При покупке страхового полиса произошла ошибка" и двумя кнопками
        "Выбрать места заново" и "Продолжить без страховки"
    - do: Нажать на кнопку "Продолжить без страховки"
    - assert: '* Открылась форма оплаты'
    - do: |-
        Ввести данные тестовой карты
        Например: 5100003697253468, 12/20, 090
        Нажать Оплатить
    - assert: '* Произошел переход на страницу хэппи пейдж'
    - do: Нажать "Подробнее о заказе"
    - assert: |-
        - Открылась страница заказа с подробными данными о заказе
        - Рядом с ценами за билеты нет позиции "Страховка"
        - Итоговая сумма равна сумме без страховки на странице подтверждения
manual: true
Устройство:
  - Десктоп
  - Тач
Страница: Оплата
Сервис: ЖД
Тестирование асессорами: Нет
Окружение: Testing
Tag:
  - TK
  - orkestrator
Автор: shenfeld
