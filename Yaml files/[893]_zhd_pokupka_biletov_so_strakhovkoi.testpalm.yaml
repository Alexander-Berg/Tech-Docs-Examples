feature: ЖД
type: Страница заказа
description: >-
  Асессоры не смогут проверить, так как для них отключаем оплату, а без оплаты
  страховка не выкупится.


  Реквизиты тестовой карты: 5100003697253468, 12/20, 090

  Перейти на вкладку ЖД билеты
specs:
  'Покупка билетов со страховкой':
    - do: >-
        Перейти на выдачу Москва - Ростов-на-Дону через неделю

        Для любого поезда кликнуть по кнопке покупки

        Выбрать 3 пассажиров - 1 взрослого, 1 ребенка от 5 до 10 лет, 1 ребенка
        без места

        Выбрать места

        Нажать на кнопку "Указать пассажиров"

        Заполнить все поля валидными данными

        В поле электронной почты указать почту на @yandex-team.ru

        Нажать по кнопке "Проверить заказ и купить"
    - assert: |-
        * Осуществился переход на страницу подтверждения
        * Внизу страницы есть чекбокс для добавления страховки
    - do: Нажать на чекбокс
    - assert: >-
        * В корзинке со стоимостью справа в пункт Страховка добавилась сумма
        страховки

        * К итоговой сумме добавилась стоимость страховки
    - do: |-
        Нажать на кнопку "Ввести карту и оплатить"
        На странице оплаты ввести данные тестовой карты из описания кейса
        Нажать на кнопку "Оплатить"
    - assert: >-
        * Через какое-то время произошел переход на страницу заказа для 3
        пассажиров

        * На странице есть кнопка "Скачать билеты и страховку"

        * На почту пришло письмо о покупке

        * Стоимость заказа в письме совпадает с итоговой суммой со страницы
        подтверждения (равна сумме за билеты + за страховки)

        * В письме есть блок "Страхование" с текстом "Стоимость страхового
        полиса: ... руб. Он включает страхование жизни и здоровья всех
        пассажиров и находится в том же файле, что и посадочный купон." и
        ссылкой "Подробнее об условиях"

        * Для каждого билета на странице успешной покупки билета есть пункт
        Страховка

        * При нажатии на иконку ? рядом с пунктом страховки появляется попап с
        текстом "Страхование жизни и здоровья от несчастных случаев." и ссылкой
        "Подробнее об условиях.", которая ведет на правила от Ренессанса

        * Сумма стоимостей страховки всех пассажиров совпадает с общей
        стоимостью на странице подтверждения

        * Для ребенка без места Цена билета и Сервисный сбор равны 0, Стоимость
        страховки равна 70

        * Для остальных билетов стоимость страховки рассчитана в зависимости от
        стоимости билета:

        ![image](https://jing.yandex-team.ru/files/shenfeld/Kupit_strahovku_ot_neschastnogo_sluchaya_2019-04-05_17-16-41.png)
    - do: Нажать на кнопку "Скачать билеты и страховку"
    - assert: >-
        * Произошло скачивание pdf-файла на десктопе. На таче могут быть
        вариации открытия/сохранения документа
    - do: Открыть файл
    - assert: >-
        * В файле есть электронные билеты для 3 пассажиров и страховки для 3
        пассажиров (3 разных бланка)
    - do: Кликнуть по ссылке "Подробнее об условиях" из письма
    - assert: >-
        * Открылась страница Ренессанс Страхования с подробными условиями
        страхования
    - do: Открыть чек из письма и со страницы заказа
    - assert: >-
        * В чеке 3 позиции "Страхование поездки (страховая премия)"

        * Суммы за страховки и итоговая сумма в чеке совпадают с суммами в
        письме и на странице заказа

        * **В тестинге не проверить из-за заглушки у траста, поэтому просто
        проверить скачивание чека**
    - do: Открыть pdf-файл с билетами из письма
    - assert: >-
        * В файле есть электронные билеты для 3 пассажиров и страховки для 3
        пассажиров (3 разных бланка)
manual: true
Устройство:
  - Десктоп
  - Тач
Страница: Страница заказа
Сервис: ЖД
Тестирование асессорами: Нет
Окружение: Testing
Автор: shenfeld
